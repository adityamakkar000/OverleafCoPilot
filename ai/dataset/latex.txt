

\section{Greatest Common Divisor}
\begin{center}
    \add{Lecture 1 Wed 09/04}

    \re{Introduction, definition of gcd}
\end{center}

Number theory is in some sense about the interplay between addition and multiplication. The theorems can be very innocent looking but the proofs tend to involve every branch of pure mathematics. For example, Fermat's Last Theorem states that the equation $x^n + y^n = z^n$ has no nonzero integer solutions when $n\geq 3$. The proof by Wiles and Taylor almost 30 years ago uses techniques from geometry, topology, analysis and algebraic number theory. Some examples of innocent looking but unsolved conjectures include Landau's four problems about primes:
\begin{itemize}
    \item (Goldbach) Every even integer at least $4$ is a sum of two primes.
    \item (Twin prime) There are infinitely many primes $p$ such that $p+2$ is prime.
    \item (Legendre) For any positive integer $n$, there is a prime between $n^2$ and $(n+1)^2$.
    \item (Bunyakovsky) There are infinitely many integers $n$ such that $n^2 + 1$ is prime.
\end{itemize}
\qt{What do we need to do to \textbf{prove} these?} Let's pretend we have a truly marvelous proof of Goldbach but it doesn't fit in the margin.
\begin{itemize}
    \item (Direct proof) Let $n$ be an arbitrary even integer at least $4$. Explain why $n$ can be written as $p+q$ where $p$ and $q$ are primes. One possible way to do this is by writing down a formula for $p$ and $q$ and check that $n = p + q$ and that $p$ and $q$ are both prime.

    \qt{Why doesn't the following work?} Let $n$ be an arbitrary even integer at least $4$. Let $p = n - 3$ and $q = 3$. Then $n = p + q$.

    \item (Proof by contradiction) Suppose for a contradiction that $n$ is an even integer at least $4$ that is not a sum of two primes. Use this to derive something that possibly can't be true. Two types of contradictions:
    \begin{itemize}
        \item A false statement. E.g. $1 = 0$.
        \item Two statements that can't be true at the same time. E.g. $x < y$ and $y < x$.
    \end{itemize}
    A better set up: Suppose for a contradiction that $n$ is the \wow{smallest} even integer at least $4$ that is not a sum of two primes. Now imagine that we somehow prove that $n-2$ is not a sum of two primes and that $n-2\geq 4$. \qt{Are we done?}
\end{itemize}

\begin{comment}
\noindent The motivating problem for the first three quarters of this course will be the following result of Dirichlet.

\begin{theorem}
    Suppose $a$ and $m$ are coprime integers. Then there are infinitely many postive integers $k$ such that $mk + a$ is a prime.
\end{theorem}

We will give proofs of this result for various values of $a$ and $m$ and in the process discover many abstract ideas in mathematics. \qt{How can we prove that there are infinitely many of something?}


    In the beginning, there was nothing. Then god said, let there be $1$. There is not much one can do with just $1$, so addition was added. We can then \textbf{define} $2$ as $1 + 1$ and then $3 = 1 + 2$. We now have two choices for the next number, as $1 + 3$ or as $2 + 2$. Note that
$$1 + 3 = 1 + (1 + 2),\qquad 2 + 2 = (1 + 1) + 2.$$
By requiring that addition is associative, we have that these two numbers are equal and we call it $4$. Continuing forever gives the set of natural numbers
$$\N = \{1,2,3,\ldots\}.$$
We may view the addition $n+m$ as adding $1$ to $n$ a total of $m$ times.

In order to reverse the process of addition, we need a number that adds $1$ to give $1$. This number is called $0$. Continuing lowering the numbers gives the usual subtraction and expands our set of numbers to the set of integers
$$\Z = \{\ldots,-2,-1,0,1,2,\ldots\}.$$
Another familiar operation now appears. We can define multiplication $n\times m$ as adding $n$ to $0$ a total of $m$ times if $m\geq0$ and as adding $-n$ to $0$ a total of $-m$ times if $m < 0$. The set $\Z$ along with $+,-,\times,0,1$ with the usual laws of arithmetic is a \textbf{commutative ring}.

In order to reverse the process of multiplication, namely division, the set of rational numbers
$$\Q = \{\frac{a}{b}\colon a,b\in\Z, b\neq 0\}$$
naturally appears. This process in general is called taking the \textbf{field of fractions}.
The next set up is the set $\R$ of real numbers, which is the \textbf{completion} of $\Q$. In other words, one can think of real numbers as limits of sequences of rational numbers that should converge. For example, the sequence $3, 3.1, 3.14, 3.141, 3.1415, \ldots$  should converge and its limit is $\pi$. The sequence $1, -1, 1, -1, \ldots$ shouldn't converge because it keeps fluctuating. ``Should converge'' roughly means that if you go far out enough, any two terms are close enough. The precise terminology is \textbf{Cauchy sequence}, which you will learn in MATH 147. Note here we say two numbers $a,b$ are close if the absolute value $|a - b|$ is small. There are other absolute values that people consider in number theory using prime factorizations, leading to other completions $\Q_p$ of $\Q$.

Finally the set $\R$ is not ``complete'' in the algebraic sense. There are polynomial equations with coefficients in $\R$ that don't have solutions. For example $x^2 + 1 = 0$ has no solutions in $\R$. Adding, or more precisely adjoining, $\sqrt{-1}$ to $\R$, gives the set $\C$ of complex numbers. The quadratic formula then allows us to solve quadratic equations in $\C$. It is only until the 16th century when people wanted to solve cubic equations that we finally sat down to understand how complex numbers work. Around 1800, the Fundamental theorem of Algebra was proved, which states that every non-constant polynomial equation with coefficients in $\C$ has a solution in $\C$. We say $\C$ is \textbf{algebraically closed}.

At this point, our number system is complete in both analytic and algebraic senses. This is also the reason why you don't hear ``breaking news: mathematicians discovered new numbers''. If we start relaxing the laws of arithmetic, we get the Quarternions where multiplication isn't commutative, or Octonions where multiplication also isn't associative.
\end{comment}

\v
What allows us to pick the smallest counterexample above, is the following well-ordering principle.

\begin{proposition}
The set $\N$ is well-ordered. In other words, every non-empty collection of positive integers has a smallest element.
\end{proposition}

\add{\begin{proof} Texts in this kind of blue color are generally skipped in class.
    \begin{itemize}
        \item \qt{(We are proving a statement about \textbf{every} non-empty subset of $\N$):} Let $S$ be a non-empty subset of $\N$.
        \item \qt{(Give a formula for a candidate for the smallest element):} Let $n\in S$ be an element. Let $T = \{x\in S\colon x \leq n\}$. Then $T$ is a non-empty finite set and thus has a smallest element $n_0$.
        \item \qt{(Prove that $n_0$ is the smallest element of $S$):} For any $x\in S$, if $x>n$, then $x>n\geq n_0$; if $x\leq n$, then $x\in T$ and so $x\geq n_0$.
    \end{itemize}
    Therefore, $n_0$ is the smallest element of $S$.
\end{proof}}

\begin{cor}\label{cor:WP}
The set $\N\cup\{0\}$ is well-ordered. In other words, every non-empty collection of non-negative integers has a smallest element.
\end{cor}

\begin{comment}
\begin{cor}
    (Induction) For any $n\in\N$, let $P(n)$ be a statement such that the following are true:
    \begin{enumerate}
        \item $P(1)$ is true,
        \item $(P(1)\wedge\cdots\wedge P(n-1))\Rightarrow P(n)$ is true for all integers $n\geq2$.
    \end{enumerate}
    Then $P(n)$ is true for all $n\in\N$.
\end{cor}

\begin{proof}
    Let $S$ be the set of natural numbers $n$ such that $P(n)$ is false. If $S$ is empty, then we are done. Suppose for a contradiction that $S$ is non-empty. Let $m\in S$ be its smallest element. Since $P(1)$ is true, we know that $m\neq 1$ and so $m\geq2$. Since $m$ is the smallest element of $S$, we know that $P(1),\ldots,P(m-1)$ are all true, but then by property 2, we have $P(m)$ is true. Contradiction.
\end{proof}

\noindent\textbf{Remark}: There are variant forms where multiple base cases are needed or where the starting point is $>1$.
\end{comment}

\begin{proposition}
    (Division algorithm) Let $a,b$ be integers such that $a>0$. Then there exists integers $q,r$ such that $$b = aq + r,\qquad 0\leq r < a.$$
\end{proposition}

\noindent\textbf{``Proof'' by example:} Let's try to divide $b = 420$ by $a = 69$. \qt{Which of the following works?}
\begin{eqnarray*}
    420 &=& 69\cdot0 + 420\\
    420 &=& 69\cdot1 + 351\\
    420 &=& 69\cdot2 + 282\\
    420 &=& 69\cdot3 + 213\\
    420 &=& 69\cdot4 + 144\\
    420 &=& 69\cdot5 + 75\\
    420 &=& 69\cdot6 + 6\\
    420 &=& 69\cdot7 - 63
\end{eqnarray*}
So we may take $q = 6$ and $r = 6$. \qt{How can we turn this into a proper proof?} \wow{Main idea: We kept subtracting $69$ from $420$ until we can't anymore without going negative.} \qt{How do we know this process will always end?} Consider the set
\begin{eqnarray*}
    S &=& \{420 - 69k\colon k\in\Z, 420 - 69k\geq 0\}\\
    &=& \{6, 75, 144, 213, 282, 351, 420, 489, \ldots\}.
\end{eqnarray*}
Then $r$ can be constructed as the smallest element of $S$.

\v

\add{\begin{proof}
    \begin{itemize}
        \item \qt{(Define the set $S$):} Consider the set $S = \{b - ak\colon k\in\Z, b - ak\geq 0\}$. The set $S$ is a subset of $\N\cup\{0\}$.
        \item \qt{(To use Corollary \ref{cor:WP}, we need to make sure $S$ is non-empty):} Since $a > 0$, we see that $\displaystyle\lim_{k\rightarrow-\infty} b - ak = \infty$. Hence for $k$ sufficiently negative, $b - ak\geq 0$. Hence $S\subseteq \N\cup\{0\}$ is non-empty.
        \item \qt{(Give the definition of $r$):} Let $r\in S$ be its smallest element.
        \item \qt{(Give the definition of $q$):} Then $r = b - ak$ for some $k\in\Z$. Let $q = k$ so that $b = aq + r$.
        \item \qt{(Prove that $r$ satisfies the desired inequality):} By definition, $r\geq 0$. It remains to prove that $r < a$. \qt{(It is usually a good idea to tell your reader what you are going to prove next.)}
        \item \qt{(When in doubt, proof by contradiction):}  Suppose for a contradiction that $r\geq a$.
        \item \qt{(Find something smaller than $r$ in $S$):}  Then $r-a\geq0$ and $r-a = b-ak-a = b-a(k+1)\in S$. However, $r-a < r$ contradicting the minimality of $r$.
    \end{itemize}
    Therefore, $b = aq + r$ and $0\leq r < a$.
\end{proof}}

\noindent\textbf{Remark}: The integers $q,r$ are unique and are called the quotient and remainder when $b$ is divided by $a$. We also have the division algorithm for negative $a$. In general, we have
$$\exists q,r\in\Z,\quad b = aq + r \mbox{ and } 0\leq r < |a|.$$

\qtt What is the smallest positive integer $d$ that can be written as $$69x + 420y\ww x,y\in\Z?$$
\qt{Can $d$ be $1$? Can $d$ be $2$?} Note that $3\mid 69$ and $3\mid 420$. So for any integers $x,y$, we have $3\mid 69x + 420y$. This implies that $d$ has to be divisible by $3$. \qt{Can $d$ be $3$?} Note from the above division algorithm, we have
$$6 = 69\times(-6) + 420\times 1.$$
\qt{Is $d = 3$ or $d = 6$?} What if we apply the division algorithm to divide $69$ by $6$? We get
$$69 = 6\times 11 + 3.$$
So we have
\begin{eqnarray*}
    3 &=& 69 - 6 \times 11\\
      &=& 69 - (69\times(-6) + 420\times 1)\times 11\\
      &=& 69\times(1 - (-6)\times 11) + 420\times(-11)\\
      &=& 69 \times67 + 420\times(-11).
\end{eqnarray*}
\qt{What allows us to find something positive and smaller than $6$ that can be written as $69x + 420y$?} Why can't we keep going to possibly find something smaller than $3$? The key point is that $6\nmid 69$. So when we divide $69$ by $6$, we get a nonzero remainder $3$. However, $3\mid 69$ and $3\mid 420$, so we will have a remainder of $0$ if we were to divide $69$ or $420$ (or $6$) by $3$.


\begin{proposition}
    Let $a,b$ be integers that are not both $0$. Let $d$ be the smallest positive integer of the form $ax + by$ for some integers $x,y$.
    \begin{enumerate}[(a)]
        \item If $e$ is an integer such that $e\mid a$ and $e\mid b$, then $e\mid d$.
        \item We have $d\mid a$ and $d\mid b$.
    \end{enumerate}
\end{proposition}
We write $d = \gcd(a,b)$ and say $d$ is the \textbf{greatest common divisor} of $a$ and $b$.

\v
\add{\begin{proof}
    \begin{itemize}
        \item \qt{(Give some names to the $x,y$ that make up $d$):} Let $x_0$ and $y_0$ be integers such that $d = ax_0 + by_0$.
        \item \qt{(Proof of (a)):} If $e\mid a$ and $e\mid b$, then $e\mid ax_0 + by_0$. So $e\mid d$.
        \item \qt{($a$ and $b$ are symmetric):} We now prove the $d\mid a$ part of (b).
        \item \qt{(Perform the same operation as in the example to find something smaller):} Suppose for a contradiction that $d\nmid a$. We apply the division algorithm to find integers $q,r$ such that $a = dq + r$ with $0\leq r < d$. The assumption $d\nmid a$ implies that $r \neq 0$. So $r$ is positive and smaller than $d$.
        \item \qt{(Prove as in the example that $r$ is of the form $ax + by$):} Then $$r = a - dq = a - (ax_0 + by_0)q = a(1 - x_0q) + b(-y_0q).$$
        Note that $1 - x_0q$ and $-y_0q$ are integers.
    \end{itemize}
    This contradicts the minimality of $d$. So we have $d\mid a$. The argument for $d\mid b$ is the same.
\end{proof}}


We define $\gcd(0,0) = 0$. If one were to \add{define} $\gcd(a,b)$ as the greatest common divisor of $a$ and $b$, then the following result requires a proof. For our definition of $\gcd(a,b)$, it follows from the definition.

\begin{cor}\label{cor:BL}
    (Bezout's Lemma) Let $a,b$ be integers. Then there exist integers $x,y$ such that $$\gcd(a,b) = ax + by.$$
\end{cor}

\noindent In fact, $\gcd(a,b)$ is the smallest positive integer of the form $ax + by$, when $a$ and $b$ are not both $0$.

\begin{center}
    \add{Lecture 2 Fri 09/06}

    \re{Properties of gcd}
\end{center}

%\re{Recall from last time: We defined $\gcd(a,b)$ as the smallest positive integer of the form $ax + by$ if $a,b$ are not both $0$, and $\gcd(0,0) = 0$. We explained why it matches the name ``greatest common divisor''.}

\begin{proposition}\label{prop:GCDCT}
    Let $a,b$ be integers. Let $d$ be a non-negative integer. Then the following are equivalent:
    \begin{enumerate}[(a)]
        \item $d\mid a$ and $d\mid b$ and $d = ax + by$ for some integers $x,y$;
        \item $d = \gcd(a,b)$.
    \end{enumerate}
\end{proposition}

\begin{proof}
    \qt{(Proving a statement like this requires proving that ($a$) implies ($b$) and ($b$) implies ($a$). You are free to pick which one to do first.)} ($b$) $\Rightarrow$ ($a$) follows from the definition of gcd. We now prove ($a$) $\Rightarrow$ ($b$).
    \qt{(One way to prove that two non-negative integers $n$ and $m$ are equal is to prove that $n\mid m$ and $m\mid n$.)} Since $d\mid a$ and $d\mid b$ and $\gcd(a,b)$ is of the form $ax + by$ for some integers $x,y$, we have $d\mid \gcd(a,b)$. Since $\gcd(a,b)\mid a$ and $\gcd(a,b)\mid b$ and $d$ is of the form $ax + by$ for some integers $x,y$, we have $\gcd(a,b)\mid d$. Hence $d = \pm\gcd(a,b)$. Since both are non-negative, we have $d = \gcd(a,b)$.
\end{proof}

\begin{cor}\label{cor:amidb}
    Let $a,b$ be integers. Then the following are equivalent:
    \begin{enumerate}[(a)]
        \item $a\mid b$;
        \item $\gcd(a,b) = |a|$.
    \end{enumerate}
    In particular, we have $\gcd(a, 0) = |a|$.
\end{cor}

\begin{proof}
    ($b$) $\Rightarrow$ ($a$): Suppose $\gcd(a,b) = |a|$. Then from $a\mid |a|$ and $|a|\mid b$, we have $a\mid b$. \qt{(It is also true that $|a|\mid a$, but we don't need it here.)}

    ($a$) $\Rightarrow$ ($b$): Suppose $a\mid b$. We use Proposition \ref{prop:GCDCT} with $d = |a|$ to prove $d = \gcd(a,b)$. From $|a|\mid a$ and $a\mid b$, we have $|a|\mid b$. Moreover, we know that $|a| = a\cdot(\pm1)$ is of the form $ax + by$. So $|a| = \gcd(a,b)$.
\end{proof}

\begin{proposition}\label{prop:EE}
    Let $a,b,q$ be integers. Then $\gcd(a, b) = \gcd(a, b - aq)$.
\end{proposition}

\begin{proof}
    We use Proposition \ref{prop:GCDCT} with $d = \gcd(a,b-aq)\geq0$ to prove $d = \gcd(a,b)$. It suffices to prove that $d\mid a$, $d\mid b$ and $d = ax + by$ for some integers $x,y$. From $d = \gcd(a, b - aq)$, we have $d\mid a$ and $d\mid b - aq$. Since $b = (b - aq) + aq$, we have $d\mid b$. From Bezout's lemma, we know there are integers $x_0, y_0$ such that $d = ax_0 + (b - aq)y_0$, which we can rearrange into
    $$d = a(x_0 - qy_0) + by_0$$
    with $x_0 - qy_0$ and $y_0$ both integers.
\end{proof}

Proposition \ref{prop:EE} makes calculation very easy. Let's compute $\gcd(69, 2024)$. We know for any integer $q$, we have
$$\gcd(69, 2024) = \gcd(69, 2024 - 69q).$$
Note we don't have to take $q$ to be the quotient when dividing $2024$ by $69$. A convenient choice could be $q = 30$ so that $69q = 2070$. Then
$$\gcd(69,2024) = \gcd(69, -46) = \gcd(46, 69) = \gcd(46, 69-46) = \gcd(46, 23) = 23.$$
Here, we also used
$$\gcd(a,b) = \gcd(b,a)\aa \gcd(a, b) = \gcd(a, -b)$$
which you will prove in HW 1 P1.

In the formula $\gcd(a,b) = \gcd(a, b - aq)$, there is a fairly natural choice for $q$ when $a\neq 0$. Namely, we can apply the division algorithm to write $b = aq + r$ where $0\leq r < |a|$. Then $$\gcd(a,b) = \gcd(a, b - aq) =  \gcd(a, r) = \gcd(r, a).$$
The upshot now is that the absolute value of the first coordinate becomes smaller when we replace $(a,b)$ by $(r,a)$. This process can be repeated until the first coordinate becomes $0$, in which case the gcd is easy to compute. This is the Euclidean algorithm.

\vspace{5pt}
\noindent\wow{Euclidean algorithm}: Input a pair of integers $(a,b)$. Output $\gcd(a,b)$.
\begin{itemize}
    \item Step 1: If $a = 0$, return $|b|$.
    \item Step 2: If $a\neq 0$, replace $(a,b)$ by $(r,a)$ where $r$ is the remainder when $b$ is divided by $a$. Go back to Step 1.
\end{itemize}%By swapping $a$ and $b$, we may assume $|b|\geq|a|$. If $|b|=|a|$ or if $|a|=0$, then $\gcd(a,b) = |b|$. Suppose $|b|>|a|>0$. Then there is a very natural choice of $q$, namely the quotient when $b$ is divided by $a$, in which case $b - aq$ equals the remainder, which is less than $|a|$. We then repeat this process.
As an example, we can compute
$$\gcd(1239,735) = \gcd(735,1239) = \gcd(504,735) = \gcd(231,504) = \gcd(42,231) = \gcd(21,42) = \gcd(0,21) = 21.$$


\qtt (IMO 1959P1) Let $n$ be an integer. What values can $\gcd(14n + 3, 21n + 4)$ take?
$$\gcd(14n+3, 21n+4) = \gcd(14n+3, 21n+4 - (14n+3)) = \gcd(14n+3, 7n+1)$$
and $$\gcd(14n+3, 7n+1) = \gcd(14n+3-(7n+1)2,7n+1) = \gcd(1, 7n+1) = 1.$$


\v
\noindent\wow{Challenge Question}: Let $n$ be an integer. What values can $\gcd(506 - n^2, 506 - (n + 1)^2)$ take?

\v
We say two integers $a$ and $b$ are \textbf{coprime} if $\gcd(a,b) = 1$.

\begin{cor}\label{cor:CCT}
    Let $a,b$ be integers. Then there exist integers $x,y$ such that $ax + by = 1$ if and only if $\gcd(a,b) = 1$.
\end{cor}


\begin{proof}
    Apply Proposition \ref{prop:GCDCT} with $d = 1$.
\end{proof}

Revisiting $\gcd(14n+3, 21n+4)$, we observe that $$3(14n+3) + (-2)(21n+4) = 1.$$
So $\gcd(14n + 3, 21n + 4) = 1$ for all integers $n$.




\begin{proposition}\label{prop:CAD}
    Let $a,b,c$ be integers such that $\gcd(a,c) = 1$. Then $\gcd(c, ab) = \gcd(c, b)$.
\end{proposition}

\begin{proof}
    We apply Proposition \ref{prop:GCDCT} with $d = \gcd(c,b)\geq0$ to prove that $d = \gcd(c, ab)$. In other words, we prove $d\mid c$, $d\mid ab$, and $d = cx + aby$ for some integers $x,y$. From $d = \gcd(c,b)$, we have $d\mid c$ and $d\mid b$, which with $b\mid ab$ gives $d\mid ab$. By Bezout's lemma, we have
    \begin{eqnarray*}
        d &=& cx_1 + by_1\\
        1 &=& cx_2 + ay_2
    \end{eqnarray*}
    for some integers $x_1,y_1,x_2,y_2$. Multiply them to get
    $$d = c(cx_1x_2 + ax_1y_2+bx_2y_1) + ab(y_1y_2).$$
    We take $x = cx_1x_2 + ax_1y_2+bx_2y_1$ and $y = y_1y_2$. Then $d = cx + aby$ with integers $x,y$.
\end{proof}

\begin{cor}\label{cor:CAD}
    Let $a,b,c$ be integers. Suppose $c\mid ab$ and $\gcd(a,c) = 1$. Then $c\mid b$.
\end{cor}

\begin{proof}
    Since $c\mid ab$, we have by Corollary \ref{cor:amidb} that $\gcd(c, ab) = |c|$. Since $\gcd(a,c) = 1$, we have by Proposition \ref{prop:CAD} that $\gcd(c, ab) = \gcd(c,b)$. Hence $|c| = \gcd(c,b)$. By Corollary \ref{cor:amidb} again, we have $c\mid b$.
\end{proof}

\add{\begin{proof}
    We give another (but equivalent) proof without invoking the earlier results. From $\gcd(a,c) = 1$, we have $1 = ax + cy$ for some integers $x,y$. Multiplying by $b$ gives $b = abx + cby$. Since $c\mid ab$ and $c\mid c$, we have $c\mid abx + cby$ and so $c\mid b$.
\end{proof}}


\begin{comment}
\noindent\textbf{Example}: How many elements does the following set have? $$S = \{\gcd(506-n^2, 506-(n+1)^2)\colon n\in\Z\}.$$
We have
$$\gcd(506-n^2, 506-(n+1)^2) = \gcd(506-n^2, 506-n^2-2n-1) = \gcd(506-n^2, 2n+1).$$
Note that $\gcd(2, 2n+1) = 1$ since $2n+1$ is not divisible by $2$. Hence, we have
\begin{eqnarray*}
    \gcd(506-n^2, 2n+1) &=& \gcd(2(506-n^2),2n+1)\\ &=& \gcd(1012-2n^2+(2n+1)n,2n+1)\\
    &=&\gcd(1012+n, 2n+1)\\
    &=&\gcd(1012+n, (2n+1)-2(1012+n))\\
    &=&\gcd(1012+n, 2023).
\end{eqnarray*}
Now $\gcd(1012+n, 2023)$ is a non-negative divisor of $2023$. Conversely, given any non-negative divisor $d$ of $2023$, by taking $n = d-1012$, we have $\gcd(1012+n,2023) = \gcd(d,2023) = d$. In other words, $S$ is the set of positive divisors of $2023$. The prime factorization of $2023$ is $7\times 17^2$. Hence $2023$ has $6$ positive divisors:
$$1,\quad 17,\quad 17^2,\quad 7,\quad 7\times17,\quad 7\times17^2.$$
\end{comment}


\subsection*{Exercises}
\begin{enumerate}[\thesection .1]
    \item (Uniqueness of division algorithm) Given integers $a,b$ such that $a\neq 0$, prove that the integers $q,r$ such that $b = aq + r$ and $0\leq r < |a|$ are unique.
    \item Given $a,b,c\in\Z$ that not all $0$, let $\gcd(a,b,c)$ be the smallest positive integer of the form $ax + by + cz$. Prove that $\gcd(a,b,c) = \gcd(a, \gcd(b,c)).$
    \item Let $a,b,c,d$ be nonzero integers such that $ad - bc = \pm\gcd(a,c).$ Prove that $\gcd(an + b, cn + d) = 1$ for every integer $n$.
    \item Let $n$ be any integer. What values can $\gcd(506 - n^2, 506 - (n + 1)^2)$ take?
\end{enumerate}

\begin{center}
    \add{Lecture 2.5 (Tutorial) Fri 09/06}

    \re{Congruences}
\end{center}

Given integers $m,a,b$, we say $a$ and $b$ are congruent mod $m$ if and only if $m\mid a - b$ and write
$$a\equiv b\pmod{m}.$$
For example, we have
$$15\equiv 9\pmod{3},\qquad 420\equiv 6\pmod{69}.$$
When $m = 0$, we have
$$a\equiv b\pmod{0}\,\,\Leftrightarrow\,\, 0\mid a - b\,\,\Leftrightarrow\,\,\exists k\in\Z, a - b = 0\cdot k\,\,\Leftrightarrow\,\, a = b.$$
Note also that $a\equiv 0\pmod{m}$ if and only if $m\mid a$.
Congruences is an equivalence relation:
\begin{itemize}
    \item (Reflexive) $a\equiv a\pmod{m}$: since $m\mid a - a$;
    \item (Symmetric) if $a\equiv b\pmod{m}$, then $b\equiv a\pmod{m}$: since $m\mid a - b$ implies $m\mid b - a$;
    \item (Transitive) if $a\equiv b\pmod{m}$ and $b\equiv c\pmod{m}$, then $a\equiv c\pmod{m}$: since $m\mid a - b$ and $m\mid b - c$ imply $m\mid (a - b) + (b - c)$.
\end{itemize}
\wow{When you have an equivalence relation, things generally work out as you expected!}

\begin{lemma}
    Suppose $a_1\equiv a_2\pmod{m}$ and $b_1\equiv b_2\pmod{m}$. Then
    $$a_1 + b_1\equiv a_2 + b_2\pmod{m}\aa a_1b_1\equiv a_2b_2\pmod{m}.$$
\end{lemma}

\begin{proof}
    We are given that $m\mid a_1 - a_2$ and $m\mid b_1 - b_2$. I will leave the additive one as an exercise. For the multiplicative one, we need to prove that $$m\mid a_1b_1 - a_2b_2.$$
    We use the following trick
    $$a_1b_1 - a_2b_2 = a_1b_1 - a_2b_1 + a_2b_1 - a_2b_2 = (a_1 - a_2)b_1 + a_2(b_1 - b_2).$$
    Since $m\mid a_1 - a_2$ and $m\mid b_1 - b_2$, we are done.
\end{proof}

For example, we have
$$10\equiv 1\pmod{3}\qquad\mbox{so}\qquad 10^n\equiv 1^n\equiv 1\pmod{3}$$
for any positive integer $n$. As a result,
\begin{eqnarray*}
    69145 &=& 6\cdot10^4 + 9\cdot 10^3 + 1\cdot10^2 + 4\cdot10 + 5\\
    &\equiv&6 + 9 + 1 + 4 + 5\pmod{3}\\
    &\equiv&1\pmod{3}.
\end{eqnarray*}
We thus have the familiar divisibility by $3$ rule: a positive integer is divisible by $3$ if and only if the sum of its digits is divisible by $3$.

\v
You have probably heard of the following:
\begin{eqnarray*}
    1/7 &=& 0.142857142857\cdots\\
    2/7 &=& 0.285714285714\cdots\\
    3/7 &=& 0.428571428571\cdots\\
    4/7 &=& 0.571428571428\cdots\\
    5/7 &=& 0.714285714285\cdots\\
    6/7 &=& 0.857142857142\cdots
\end{eqnarray*}
Thus, the fractions $m/7$ for $m = 1,\ldots,6$ are all formed from repeating $142857$ but starting from different spots. \qt{Why does this happen?} The shifting of the digits is a consequence of
\begin{eqnarray*}
    10/7 &=& 1 + 3/7\\
    100/7 &=& 14 + 2/7\\
    1000/7 &=& 142 + 6/7\\
    10000/7 &=& 1428 + 4/7\\
    100000/7 &=& 14285 + 5/7\\
    1000000/7 &=& 142857 + 1/7
\end{eqnarray*}
In terms of congruences, this reads
\begin{eqnarray*}
    10 &\equiv&3\pmod{7}\\
    10^2 &\equiv&2\pmod{7}\\
    10^3 &\equiv&6\pmod{7}\\
    10^4 &\equiv&4\pmod{7}\\
    10^5 &\equiv&5\pmod{7}\\
    10^6 &\equiv&1\pmod{7}
\end{eqnarray*}
Therefore, the reason why $1/7$, $2/7$, ..., $6/7$ have the above pattern is because the remainder of $10$, $10^2$, ..., $10^6$ when divided by $7$ recover $1,2,\ldots,6$ (in a possibly different order). If we were to try this mod $11$, we just get $10^2\equiv 1\pmod{11}$ and then it will just repeat $10$ and $1$. If we try this mod $13$, we get
\begin{eqnarray*}
    10 &\equiv&10\pmod{13}\\
    10^2 &\equiv&100 \,\,\,\equiv\,\,\, 9\pmod{13}\\
    10^3 &\equiv&90\,\,\,\equiv\,\,\, -1\pmod{13}\\
    10^6 &\equiv&1\pmod{13}
\end{eqnarray*}
This means that it will cycle with a period of $6$.

\v
\noindent\wow{Exercise:} Check that this works for $17$. \wow{It is unknown whether this happens for infinitely many primes $p$.}

\v
Note above that $10^{12}\equiv 1\pmod{13}$, and $10^{10}\equiv 1\pmod{11}$.

\begin{theorem}(Fermat's $\ell$ittle Theorem)
    Let $p$ be a prime and let $a\in\Z$ such that $p\nmid a$. Then $$a^{p-1}\equiv 1\pmod{p}.$$
\end{theorem}

\noindent\textbf{``Proof'' by example:}  We have
\begin{eqnarray*}
    10\cdot1 &\equiv&3\pmod{7}\\
    10\cdot2 &\equiv&6\pmod{7}\\
    10\cdot3 &\equiv&2\pmod{7}\\
    10\cdot4 &\equiv&5\pmod{7}\\
    10\cdot5 &\equiv&1\pmod{7}\\
    10\cdot6 &\equiv&4\pmod{7}
\end{eqnarray*}
Multiplying them together gives
$$10^6\cdot 1\cdot2\cdot3\cdot4\cdot5\cdot6\equiv 1\cdot2\cdot3\cdot4\cdot5\cdot6\pmod{7}.$$
Canceling the $1\cdot2\cdot3\cdot4\cdot5\cdot6$ from both sides gives $10^6\equiv 1\pmod{7}$. \hfill$\Box$

\begin{lemma}
    Let $m,a,b,c$ be integers such that $\gcd(c,m)\neq 0$. Suppose $ac\equiv bc\pmod{m}$. Then $$a\equiv b\pmod{\frac{m}{\gcd(c,m)}}.$$
\end{lemma}

\add{\begin{proof}
    We have $m\mid ac - bc$. So $$\frac{m}{\gcd(c,m)}\mid \frac{c}{\gcd(c,m)}(a - b).$$
    \qt{(We prove next that $\gcd(\frac{m}{\gcd(c,m)},\frac{c}{\gcd(c,m)}) = 1$):} By Bezout's lemma, we have $\gcd(c,m) = mx + cy$ for some integers $x,y$. Divide it by $\gcd(c,m)$ to get
    $$1 = \frac{m}{\gcd(c,m)}x + \frac{c}{\gcd(c,m)}y.$$
    By Corollary \ref{cor:CCT}, we have $\gcd(\frac{m}{\gcd(c,m)},\frac{c}{\gcd(c,m)}) = 1$. Then by Corollary \ref{cor:CAD}, we have $$\frac{m}{\gcd(c,m)}\mid a - b$$
    which is equivalent to the desired congruence.
\end{proof}}



\begin{center}
    \add{Lecture 3 Mon 09/09}

    \re{Unique factorization via $p$-adic valuation}
\end{center}

\section{Prime factorization}
A \textbf{prime} is an integer $p>1$ such that its only positive divisors are $1$ and $p$. For any integer $a$, $\gcd(p,a)$ can only be $1$ and $p$ and more precisely,
$$\gcd(p,a) = \begin{cases}1&\mbox{if }p\nmid a,\\ p&\mbox{if }p\mid a.\end{cases}$$
Note that if $p$ and $q$ are two primes, then
$$p\mid q \Longleftrightarrow p = q.$$
In other words, distinct primes are coprime. This is the origin of the name ``coprime''.

\begin{proposition}\label{prop:EL}
    (Euclid's Lemma) Let $p$ be a prime. Then for any integers $a,b$, if $p\mid ab$, then $p\mid a$ or $p\mid b$.
\end{proposition}

\begin{proof}
    If $p\mid a$, then we are done. Suppose $p\nmid a$. Then $\gcd(p,a) = 1$. Then from $p\mid ab$, we get $p\mid b$ by Corollary \ref{cor:CAD}.
\end{proof}

\begin{cor}\label{cor:CEL}
    (Contrapositive of Euclid's Lemma) Let $p$ be a prime. Then for any integers $a,b$, if $p\nmid a$ and $p\nmid b$, then $p\nmid ab$.
\end{cor}

The converse of Euclid's Lemma is also true:

\begin{proposition}
    Let $n>1$ be an integer such that whenever $n$ divides a product of integers, $n$ must divide one of the factors. Then $n$ is a prime.
\end{proposition}

\add{\begin{proof}
    Let $d\mid n$ be a positive divisor of $n$. \qt{(We prove that either $d = 1$ or $d = n$)} Then $n = de$ for some $e\in\Z$. Since $d,n>0$, we have $e>0$ and $e\mid n$. Since $n=de$, we have $n\mid de$ and so we get $n\mid d$ or $n\mid e$. If $n\mid d$, then along with $d\mid n$, we get $d = n$. If $n\mid e$, then along with $e\mid n$, we get $e = n$ and so $d = 1$.
\end{proof}

\noindent\textbf{Remark}: The proof of Euclid's Lemma $\Rightarrow$ prime uses only division, whereas the proof of prime $\Rightarrow$ Euclid's Lemma requires the theory of gcd. There are number systems in general where the notion of gcd doesn't exist, or worse where unique factorization doesn't hold.}

\v
Our next major result is the famous fundamental theorem of arithmetic, which you are probably taking for granted.
\begin{theorem}
(Fundamental Theorem of Arithmetic) Every positive integer can be written as a product of primes, unique up to reordering.
\end{theorem}

For example, we have
\begin{eqnarray*}
    69 &=& 3 \cdot 23\\
    145 &=& 5\cdot 29\\
    420 &=& 2\cdot2 \cdot 3 \cdot 5 \cdot 7\\
    2023 &=& 7 \cdot 17\cdot17\\
    2024 &=& 2\cdot2\cdot2 \cdot 11 \cdot 23\\
    2025 &=& 3\cdot3\cdot3\cdot3\cdot5\cdot5
\end{eqnarray*}

For any prime $p$ and any integer $n\neq 0$, we define the \wow{$p$-adic valuation} $\nu_p(n)$ to be the largest integer $k$ such that $p^k\mid n$. A commonly used notation is
$$p^{\nu_p(n)} \mid\mid n.$$
Alternatively, $\nu_p(n)$ is the unique non-negative integer $k$ such that
$$p^k\mid n\qquad\mbox{and}\qquad p\nmid\frac{n}{p^k}.$$
We use the convention $\nu_p(0) = \infty$. For example,
$$\nu_3(2025) = 4,\qquad \nu_2(2024) = 3,\qquad \nu_2(420) = 2.$$
It follows immediately from the definitions that if $p$ and $q$ are two primes, then
$$\nu_p(q) = \begin{cases}
    1&\mbox{ if }q=p,\\
    0&\mbox{ if }q\neq p.
\end{cases}$$


\begin{proposition}\label{prop:nunm}
    Let $p$ be any prime and let $n,m$ nonzero integers. Then
    $$\nu_p(nm) = \nu_p(n) + \nu_p(m),\qquad \nu_p(n+m) \geq \min\{\nu_p(n),\nu_p(m)\}.$$
    If $\nu_p(n)\neq \nu_p(m)$, then $$\nu_p(n+m) = \min\{\nu_p(n),\nu_p(m)\}.$$
\end{proposition}

\begin{proof}
    Let $k = \nu_p(n)$ and $\ell = \nu_p(m)$. From $p^k\mid n$ and $p^\ell\mid m$, we have $p^{k+\ell}\mid nm$. From $p\nmid n/p^k$ and $p\nmid m/p^\ell$, we have $p\nmid nm/p^{k+\ell}$ by Corollary \ref{cor:CEL}. Therefore, $\nu_p(nm) = k + \ell$.

    Suppose without loss of generality that $k\leq \ell$. Then $p^k\mid p^\ell$ and so $p^k\mid m$. Since $p^k\mid n$, we have $p^k\mid n+m$. Thus $\nu_p(n+m)\geq k$. Suppose $k<\ell$. Then $p\mid m/p^k$ but $p\nmid n/p^k$. Hence $p\nmid (n+m)/p^k$. So $\nu_p(n+m) = k$.
\end{proof}

\begin{cor}
    For any positive integer $\ell\in\N$ and nonzero integers $n_1,\ldots,n_\ell$, we have $$\nu_p\Big(\prod_{i=1}^\ell n_i\Big)=\nu_p(n_1\cdots n_\ell) = \nu_p(n_1) + \cdots + \nu_p(n_\ell) = \sum_{i=1}^\ell \nu_p(n_i).$$
\end{cor}

\begin{proof}
    We prove by induction on $\ell$.
    \begin{itemize}
        \item \qt{(Prove the base case when $\ell = 1$): } Suppose first $\ell = 1$. Then we need to prove that $\nu_p(n_1) = \nu_p(n_1)$, which is clearly true.
        \item \qt{(Suppose $\ell\geq2$ and that the statement is true for all the previous cases):} Suppose now $\ell \geq 2$. Suppose that for any $k = 1,2,\ldots,\ell-1$ and any nonzero integers $m_1,\ldots,m_k$, we have $$\nu_p(m_1\cdots m_k) = \nu_p(m_1) + \cdots + \nu_p(m_k).$$
        \item \qt{(Under the above inductive hypothesis, prove the case for $\ell$): } Let $n_1,\ldots,n_\ell$ be arbitrary nonzero integers. Since $\ell\geq 2$, we have $\ell - 1 \geq 1$. So by the inductive hypothesis with $k = \ell - 1$, we have
        $$\nu_p(n_1\cdots n_{\ell-1}) = \nu_p(n_1) + \cdots + \nu_p(n_{\ell-1}).$$
        Now by Proposition \ref{prop:nunm}, we have
        \begin{eqnarray*}
            \nu_p(n_1\cdots n_\ell) &=& \nu_p((n_1\cdots n_{\ell-1})n_\ell)\\
            &=&\nu_p(n_1\cdots n_{\ell-1}) + \nu_p(n_\ell)\\
            &=&\nu_p(n_1) + \cdots + \nu_p(n_{\ell-1}) + \nu_p(n_\ell).
        \end{eqnarray*}
    \end{itemize}
    Therefore, we are done.
\end{proof}

\wow{Whenever you notice that your proof involves ``repeatedly'' or ``$\cdots$'', induction is typically the way to make things precise.}

\begin{cor}
    Let $n_q$ be non-negative integers for primes $q$ such that all but finitely many of them are $0$. Then for any prime $p$,
    $$\nu_p\left(\prod_q q^{n_q}\right) = \sum_q \nu_p(q^{n_q}) =  n_p.$$
    In particular, prime factorizations are unique, because the exponent of a prime $p$ can be recovered as the $p$-adic valuation. (Unless otherwise specified, a sum or product over an index $p$ or $q$ is running only over primes $p$.)
\end{cor}

We prove next the existence of prime factorization.






\begin{theorem}
    Let $n\in\N$. Then $\nu_p(n) = 0$ for all but finitely many primes $p$ and $$n = \prod_{p}p^{\nu_p(n)}.$$
    In particular, prime factorizations exist.
\end{theorem}

\begin{proof}
    If $p>n$, then clearly $p\nmid n$ and so $\nu_p(n)=0$.
    We prove the second statement by induction on $n$. Suppose first that $n = 1$. Then $\nu_p(1) = 0$ for all primes $p$ and $\prod_p p^0 = 1$. Hence the statement is true for the base case $n = 1$.

    Suppose now $n\geq 2$ and that for every integer $m = 1,2,\ldots,n-1$, we have $m = \prod_p p^{\nu_p(m)}$. We now prove $n = \prod_p p^{\nu_p(n)}$. Suppose first that $n=q$ is a prime. In this case, $$\prod_p p^{\nu_p(q)} = q^1 \prod_{p\neq q} p^0 = q.$$
    Suppose now $n$ is not a prime. Let $d$ be a positive divisor of $n$ with $1<d<n$. Let $e = n/d$. Then $e$ is an integer with $1<e<n$. By the induction hypothesis, we have $$d = \prod_{p}p^{\nu_p(d)},\qquad e = \prod_{p}p^{\nu_p(e)}.$$ Multiplying them gives $$n = de = \prod_p p^{\nu_p(d)+\nu_p(e)} = \prod_p p^{\nu_p(n)}$$
    since $\nu_p(d)+\nu_p(e) = \nu_p(de) = \nu_p(n).$
\end{proof}

\begin{center}
    \add{Lecture 4 Wed 09/11}

    \re{Some applications of unique factorization}
\end{center}

We can extend $\nu_p$ to all rational numbers by defining $\nu_p(a/b) = \nu_p(a) - \nu_p(b).$ The multiplicative property of $\nu_p$ implies that if $a/b = c/d$, then $ad = bc$ and so $\nu_p(a) + \nu_p(d) = \nu_p(b) + \nu_p(c)$. In other words,  $$\nu_p(a) - \nu_p(b) = \nu_p(c) - \nu_p(d).$$
Hence $\nu_p(a/b)$ is independent on the choices of $a$ and $b$.

\begin{cor}
    (Unique prime factorization for rational numbers.) Let $r\in\Q$ be nonzero. Then $$ r = \pm\prod_p p^{\nu_p(r)}.$$ As a consequence,
    \begin{enumerate}[(a)]
        \item $r\in\Z$ if and only if $\nu_p(r)\geq 0$ for all primes $p$;
        \item $r = \pm 1$ if and only if $\nu_p(r) = 0$ for all primes $p$.
    \end{enumerate}
\end{cor}

\begin{cor}
    Let $d,n$ be nonzero integers. Then $d\mid n$ if and only if $\nu_p(d)\leq\nu_p(n)$ for all primes $p$.
\end{cor}

\begin{proof}
    We have $d\mid n$ if and only if $n/d\in\Z$ if and only if $\nu_p(n/d) = \nu_p(n) - \nu_p(d)\geq0$ for all primes $p$.
\end{proof}

\begin{cor}
    Let $n$ be a nonzero integer. Then the number of positive divisors of $n$ is $$\prod_p (1 + \nu_p(n)).$$
\end{cor}

\begin{proof}
    Any positive divisor $d$ is uniquely determined by $\nu_p(d)$ for all primes $p$. There are $1+\nu_p(n)$ possible values for $\nu_p(d)$ in order for $0\leq \nu_p(d)\leq\nu_p(n)$.
\end{proof}

\qtt Suppose $n\in\N$. When is the number of positive divisor of $n$ odd?

\v
\noindent We need $\nu_p(n)$ to be even for all prime $p$. In other words, $n$ is a perfect square. Alternatively, we can pair up the positive divisors of $n$ by $(m, n/m)$. In order for there to be an odd number of them, there is some $m$ such that $m = n/m$, implying that $n = m^2$.

\begin{cor}
    Let $n,m$ be nonzero integers. Then for any prime $p$, $$\nu_p(\gcd(n,m)) = \min\{\nu_p(n),\nu_p(m)\}.$$
\end{cor}

\begin{proof}
    Since $\gcd(n,m)$ divides $n$ and $m$, we see that for any prime $p$, $\nu_p(\gcd(n,m))\leq\nu_p(n)$ and also $\leq\nu_p(m)$. Hence $\nu_p(\gcd(n,m)) \leq \min\{\nu_p(n),\nu_p(m)\}.$ For the other inequality, let $d_p = \min\{\nu_p(n),\nu_p(m)\}$. Note that $d_p = 0$ for $p>\max\{n,m\}$. We let $d = \prod_p p^{d_p}$. From $d_p\leq \nu_p(n)$ for all $p$, we get $d\mid n$ and similarly $d\mid m$. Hence $d\mid \gcd(n,m)$ and so $d_p\leq \nu_p(\gcd(n,m))$ for all primes $p$.
\end{proof}

This formula allows us to compute gcd very quickly from the prime factorization. For example,
$$\gcd(2^43^55^27^3,2^23^27^4)=2^23^27^3.$$
However, in practice (to a computer), Euclidean's algorithm is much faster for computing gcd, since factorization is very hard. Using this formula, we can give another proof for Proposition \ref{prop:CAD}: Let $a,b,c$ be integers such that $\gcd(a,c) = 1$. Then $\gcd(c, ab) = \gcd(c, b)$.

\v
\noindent\textbf{Second proof of Proposition \ref{prop:CAD}:}
Let $p$ be any prime. It suffices to prove that
$$\min\{\nu_p(c),\nu_p(a) + \nu_p(b)\} = \min\{\nu_p(c),\nu_p(b)\}.$$
The assumption $\gcd(a,c) = 1$ gives that $\min\{\nu_p(a),\nu_p(c)\} = 0$. That is, either $\nu_p(a) = 0$ or $\nu_p(c) = 0$. If $\nu_p(a) = 0$, then we have
$$\min\{\nu_p(c),\nu_p(a) + \nu_p(b)\} = \min\{\nu_p(c),0 + \nu_p(b)\} = \min\{\nu_p(c),\nu_p(b)\}.$$
If $\nu_p(c) = 0$, then we have
$$\min\{\nu_p(c),\nu_p(a) + \nu_p(b)\} = 0 = \min\{\nu_p(c),\nu_p(b)\}.$$
This concludes the proof. \hfill $\Box$

Similarly for nonzero integers $x,y,z$, we have
$$\nu_p(\gcd(x,y,z)) = \min\{\nu_p(x),\nu_p(y),\nu_p(z)\}.$$

A related concept is the least common multiple $\lcm(m,n)$ of two integers $m,n$, or of multiple integers. One easily checks that $$\nu_p(\lcm(n,m)) = \max\{\nu_p(n),\nu_p(m)\}.$$
Since $$\min\{a,b\} + \max\{a,b\} = a + b,$$
we get $$\gcd(n,m)\lcm(n,m) = |nm|.$$
The extra absolute value is only to deal with the case where $m$ or $n$ is negative, as the $p$-adic valuations don't see the sign of an integer.

\v
\noindent\wow{Exercise:} Prove that if $e$ is an integer such that $a\mid e$ and $b\mid e$, then $\lcm(a,b)\mid e$.

\v
We end this section with an application to the irrationality of $\sqrt{2}$.

\begin{proposition}
    The equation $x^2 = 2y^2$ has no nonzero integer solutions. As a consequence, $\sqrt{2}$ is irrational.
\end{proposition}

\begin{proof}
    Suppose for a contradiction that $a,b$ are nonzero integers such $a^2 = 2b^2$. We take $\nu_2$ of both sides to get
    $$2\nu_2(a) = 1 + 2\nu_2(b).$$
    This is a contradiction because the LHS is an even integer while the RHS is an odd integer.
\end{proof}

\subsection*{Exercises}
\begin{enumerate}[\thesection .1]
        \item Prove that the equation $2^x = 3^y$ has no positive integer solutions. This implies that $\log_23$ is irrational.
    \item Let $p$ be a prime. Define $|r|_p$ for any nonzero $r\in\Q$ by $|r|_p = p^{-\nu_p(r)}$ and define $|0|_p = 0$. Then for any $r,s\in\Q$, prove that
    \begin{enumerate}
        \item $|rs|_p = |r|_p|s|_p$,
        \item $|r+s|_p \leq \max\{|r|_p,|s|_p\}\leq |r|_p + |s|_p.$
    \end{enumerate}
    In other words, $|.|_p$ behaves similar to the usual absolute value, and is called the $p$-adic absolute value.
    \item Prove that the equation $x^3 = 2y^3 + 4z^3$ has no non-zero integer solutions.
\end{enumerate}



\section{Binomial coefficients}
The number $$L_n = \lcm(1,2,\ldots, n)$$
is closely related to the prime counting function.

We consider a seemingly unrelated question. \qt{What is the prime factorization of $L_{69}$?}
$$L_{69} = 2^6\cdot 3^3\cdot 5^2\cdot 7^2\cdot 11\cdot13\cdot17\cdot19\cdot 23\cdot 29\cdot31\cdot 37\cdot 41\cdot 43\cdot 47\cdot 53\cdot 59\cdot 61\cdot 67.$$

Let $p$ be any prime. Let $k$ be a non-negative integer such that $p^k\leq n < p^{k+1}$. Then no integer from $1$ to $n$ is divisible by $p^{k+1}$ and $p^k\leq n$ with $\nu_p(p^k) = k$. In other words $$\nu_p(L_n) = \max\{\nu_p(1),\ldots,\nu_p(n)\} = k.$$
Now from $p^k\leq n < p^{k+1}$, we have
$$k\leq \log_pn < k+1\qquad\mbox{so}\qquad \nu_p(L_n) = k = \left\lfloor\frac{\log n}{\log p}\right\rfloor.$$ In this class, unless otherwise specified, $\log$ will be the natural log. We will prove that
$$2^n\leq L_n\leq 4^{n-1}$$
for $n\geq 7$. The actual growth rate of $L_n$ is $e^n$. We can observe from the above formula for $L_{69}$ that it is very close to just the product of all the primes less than 69.

\begin{center}
    \add{Lecture 5 Fri 09/13}

    \re{$p$-adic valuation of the binomial coefficients}
\end{center}

\begin{theorem}\label{thm:PMT1}
    (Prime number theorem) We have $$\lim_{n\rightarrow\infty}\frac{\log L_n}{n} = 1.$$
\end{theorem}




You might be more familiar with the Prime number theorem stated in terms of the prime counting function
$\pi(x)$ which counts the number of primes less than or equal to $x$.

\begin{theorem}\label{thm:PMT2}
        The Prime number theorem is equivalent to
    $$\lim_{x\rightarrow\infty}\frac{\pi(x)}{x/\log x} = 1.$$
\end{theorem}

Note that
$$\log L_n = \sum_{p\leq n}\left\lfloor\frac{\log n}{\log p}\right\rfloor\log p.$$
Roughly speaking, most of the contribution will come from the primes $p$ that are close to $n$, in which case $\log p\sim\log n$ and $\left\lfloor\frac{\log n}{\log p}\right\rfloor = 1.$ So $\log L_n\sim \pi(n)\log n.$ Making this precise requires some very careful estimates, which is too technical to fit the margins here.

\v
\alert{The following block of blue text can be safely ignored.} \add{Here is a very sketchy sketch of the proof of the prime number theorem. We define the Riemann-zeta function
$$\zeta(s) = \sum_{n=1}^\infty \frac{1}{n^s},$$
which a priori is only defined for $s>1$. For example,
$$\zeta(2) = \sum_{n=1}^\infty\frac{1}{n^2} = \frac{\pi^2}{6},\qquad \zeta(4) = \sum_{n=1}^\infty\frac{1}{n^4} =  \frac{\pi^4}{90}.$$
The value of $\zeta$ at an even positive integer $n$ is some rational multiple of $\pi^n$. It is known that $\zeta(3)$ is irrational and that infinitely many of the $\zeta(2k+1)$ are irrational. They are of course all conjectured to be transcendental.

\vspace{5pt}
Using prime factorization, we have the factorization
$$\zeta(s) = \prod_p \left(1 + \frac{1}{p^s} + \frac{1}{p^{2s}} + \cdots\right) = \prod_p \frac{1}{1-p^{-s}}.$$
Note that if there were only finitely many primes, then this product is a finite product and thus always exist. However, $\zeta(1)$ is the harmonic series which diverges. This is Euler's proof of the infinitude of primes.

\vspace{5pt}
We take the logarithmic derivative of $\zeta(s)$ to get
$$\frac{d}{ds}\log\zeta(s) = - \sum_p \frac{d}{ds}\log(1 - p^{-s}) = -\sum_p \frac{p^{-s}\log p}{1-p^{-s}} = -\sum_p \log p\left(\frac{1}{p^s} + \frac{1}{p^{2s}} + \cdots\right).$$
We can express this in terms of the von Mangoldt function: $$-\frac{\zeta'(s)}{\zeta(s)} = \sum_n \frac{\Lambda(n)}{n^s},$$
where
$$\Lambda(m) = \begin{cases}
    \log p&\mbox{if }m\mbox{ is a positive power of a prime }p\\
    0&\mbox{otherwise}.
\end{cases}$$
Note that $$\log L_n = \sum_{p\leq n}\left\lfloor\frac{\log n}{\log p}\right\rfloor\log p = \sum_{m\leq n}\Lambda(m),$$ since $\left\lfloor\frac{\log n}{\log p}\right\rfloor$ is the number of powers of $p$ less than or equal to $n$.

There is a somewhat reasonable way to define $\zeta(s)$ for $0<s<1$. We note that
$$2^{-s}\zeta(s) = \sum_{n=1}^\infty\frac{1}{(2n)^s} = \sum_{n\text{ even}}\frac{1}{n^s} = \sum_{n=1}^\infty \frac{1+(-1)^n}{2}\frac{1}{n^s} = \frac{1}{2}\left(\sum_{n=1}^\infty\frac{1}{n^s}+\sum_{n=1}^\infty\frac{(-1)^n}{n^s}  \right).$$
So $$\zeta(s) = \frac{1}{1-2^{1-s}}\sum_{n=1}^\infty\frac{(-1)^{n+1}}{n^s}$$
and the alternating series converges for $s>0$. To connect the two regions $s>1$ and $0<s<1$, we go to the complex world! The exponential $n^s$ is defined as
$$n^s = e^{s\ln n} = e^{\text{Re}(s)\ln n + i\text{Im}(s)\ln n} = n^{\text{Re}(s)}(\cos(\text{Im}(s)\ln n) + i\sin(\text{Im}(s)\ln n).$$
The key result from complex analysis, which took 100 years to develop after Gauss first conjectured the asymptotic formula for $\pi(x)$, is:

\begin{theorem}\label{thm:psis}
    The function $\zeta(s)$ is analytic for $\text{Re}(s)>1$. It has a simple pole at $s = 1$ with residue $1$ and admits a (unique) analytic continuation to all $s\in\C\backslash\{1\}$. Moreover,
    $$\psi(x) := \sum_{m\leq x}\Lambda(m) =  x - \log(2\pi) - \sum_{\zeta(\rho) = 0}\frac{x^\rho}{\rho}.$$
\end{theorem}
Here:
\begin{enumerate}
    \item \textbf{analytic} means differentiable in the complex world. It turns out that being differentiable implies being infinitely differentiable.
    \item \textbf{simple pole} at $s=1$ \textbf{with residue $1$} means that for $s$ near $1$, $\zeta(s)\sim\frac{1}{s-1}.$
    \item \textbf{analytic continuation} means that there is a function $L$ that is analytic on $\C\backslash\{1\}$ such that $L(s) = \zeta(s)$ for $\text{Re}(s)>1$. (The meme where $1+2+\cdots = -1/12$ is the statement that $L(-1) = -1/12$. Another notable value is $L(0) = -1/2$.)
    \item $\zeta$ has \textbf{trivial zeroes} at the negative even integers and the contribution from them is $$\sum_{n=1}^\infty \frac{1}{2nx^{2n}} = \frac12\log(1 - x^{-2}).$$
    All other zeroes of $\zeta$, called \textbf{nontrivial zeroes}, lie in the \textbf{critical strip} where $0 \leq \text{Re}(s) \leq 1$ and are symmetric under $s\mapsto 1-s$.
\end{enumerate}

Theorem \ref{thm:PMT1} then follows from the following result on the zeroes of the zeta function.

\begin{theorem}\label{thm:zerofree}
    If $\zeta(\beta+ it) = 0$ where $1/2\leq\beta\leq 1$, then $$\beta \leq 1 - \frac{1}{71\log(|t|+2)}.$$
\end{theorem}

These results are enough to conclude that $\psi(x)\sim x$. Theorem \ref{thm:zerofree} has been improved to
$$\beta \leq 1 - \frac{1}{57.54(\log |t|)^{2/3}(\log\log|t|)^{1/3}}.$$
The \textbf{Riemann hypothesis} predicts that $\beta = 1/2$.}

\v
To prove the bounds $2^n\leq L_n\leq 4^{n-1}$, we need to prove some results about binomial coefficients. We start with Legendre's formula.

\begin{proposition}\label{prop:leg}
    For any prime $p$ and any positive integer $n$,
    $$\nu_p(n!) = \sum_{k=1}^\infty \left\lfloor\frac{n}{p^k}\right\rfloor = \sum_{k=1}^{\lfloor\log_pn\rfloor} \left\lfloor\frac{n}{p^k}\right\rfloor =\left\lfloor\frac{n}{p}\right\rfloor + \left\lfloor\frac{n}{p^2}\right\rfloor + \left\lfloor\frac{n}{p^3}\right\rfloor + \cdots$$
\end{proposition}

\begin{proof}
    For any $k\in\N$, let $u(k)$ denote the number of integers from $1$ to $n$ that are multiplies of $p^k$. Then $u(k) - u(k+1)$ is the number of integers from $1$ to $n$ with $\nu_p = k$. Then
    $$\nu_p(n!) = (u(1)-u(2)) + 2(u(2)-u(3)) + 3(u(3)-u(4)) + \cdots = u(1) + u(2) + u(3) + \cdots.$$
    We are done because $u(k) = \lfloor n/p^k\rfloor.$
\end{proof}

We recall the definition of the binomial coefficients
$$\binom{n}{r} = \frac{n!}{r!(n-r)!} = \frac{n(n-1)\cdots(n-r+1)}{r!}$$
for $0\leq r\leq n$. We define it to be $0$ if $r<0$ or if $r>n$. They have combinatoric interpretations as the number of ways to pick $r$ objects from a collection of $n$ objects.

\begin{theorem} (Binomial Theorem) We have the algebraic identity: $$(x + y)^n = \sum_{r=0}^n \binom{n}{r}x^ry^{n-r}.$$
\end{theorem}

\begin{proof}
    When expanding a product of $n$ terms of the form $x + y$, the coefficient of $x^ry^{n-r}$ is the number of ways to pick $x$ a total of $r$ times.
\end{proof}

\begin{proof}
    Alternatively, prove by induction and Pascal's identity $\displaystyle\binom{n}{r} = \binom{n-1}{r-1} + \binom{n-1}{r}.$
\end{proof}

We care more about the $p$-adic valuation of the binomial coefficients. We start with a simple example.
\begin{lemma}\label{lem:important}
    Let $p$ be a prime and let $r = 1,\ldots,p-1$. Then $\nu_p(\binom{p}{r}) = 1$.
\end{lemma}

\begin{proof}
    In fact, we have
    $$\nu_p\Big(\binom{p}{r}\Big) = \left\lfloor\frac{p}{p}\right\rfloor - \left\lfloor\frac{r}{p}\right\rfloor - \left\lfloor\frac{p-r}{p}\right\rfloor = 1 - 0 - 0 = 1.$$
    Alternatively, $$\binom{p}{r} = \frac{p(p-1)\cdots(p-r+1)}{r(r-1)\cdots 1}.$$
    We see that there is a $p$ in the numerator but no $p$ in the denominator. So it will survive the division.
\end{proof}

More generally, notice that we need to handle terms of the form
$$\left\lfloor\frac{n}{p^k}\right\rfloor - \left\lfloor\frac{r}{p^k}\right\rfloor - \left\lfloor\frac{n-r}{p^k}\right\rfloor.$$
Let's prove a general result about them.

\begin{lemma}\label{lem:ind}
    Let $a,n\in\N$ and $m = 0,1,\ldots,n$. Let $n_a,m_a$ be the remainders when $n,m$ are divided by $a$. Then
    $$\left\lfloor\frac{n}{a}\right\rfloor - \left\lfloor\frac{m}{a}\right\rfloor - \left\lfloor\frac{n-m}{a}\right\rfloor = \begin{cases}
        1&\mbox{if }n_a < m_a,\\
        0&\mbox{if }n_a\geq m_a.
    \end{cases}$$
\end{lemma}

\noindent\textbf{``Proof'' by example:} We note that
$$\frac{2024}{69} = 29 + \frac{23}{69},\qquad\frac{420}{69} = 6 + \frac{6}{69},\qquad\frac{145}{69} = 2 + \frac{7}{69}.$$
Then
\begin{eqnarray*}
    \frac{2024-420}{69} &=& 29 - 6 + \frac{23 - 6}{69} = 29 - 6 + \frac{17}{69}\\
    \frac{420-145}{69}&=&  6 - 2 + \frac{6 - 7}{69} = 6 - 2 -1 + \frac{68}{69}.
\end{eqnarray*}

\add{\begin{proof}
    We have
    $$\left\lfloor\frac{n}{a}\right\rfloor = \frac{n-n_a}{a},\qquad\left\lfloor\frac{m}{a}\right\rfloor = \frac{m-m_a}{a}$$ and $$\frac{n-m}{a} = \frac{n-n_a}{a} - \frac{m-m_a}{a} + \frac{n_a-m_a}{a} = \left\lfloor\frac{n}{a}\right\rfloor - \left\lfloor\frac{m}{a}\right\rfloor+ \frac{n_a-m_a}{a}.$$
    Since $n_a,m_a$ are remainders, we know that $-1 < (n_a-m_a)/a < 1$. If $n_a\geq m_a$, then $(n_a-m_a)/a \in [0,1)$ and so $$\left\lfloor\frac{n-m}{a}\right\rfloor = \left\lfloor\frac{n}{a}\right\rfloor - \left\lfloor\frac{m}{a}\right\rfloor.$$
    If $n_a < m_a$, then $(n_a-m_a)/a \in (-1,0)$ and so $$\left\lfloor\frac{n-m}{a}\right\rfloor = \left\lfloor\frac{n}{a}\right\rfloor - \left\lfloor\frac{m}{a}\right\rfloor - 1.$$
    Hence we are done.
\end{proof}}

\begin{cor}\label{cor:trib}
    Let $n\in\N$ and $r = 0,1,\ldots,n$. Let $p$ be a prime. Then
    $$0\leq \nu_p\left(\binom{n}{r}\right) \leq \left\lfloor\frac{\log n}{\log p}\right\rfloor.$$
\end{cor}

\begin{proof}
    By Legendre's formula (Proposition \ref{prop:leg}), we have
    $$\nu_p\left(\binom{n}{r}\right) = \sum_{k=1}^{\lfloor\log_pn\rfloor} \left\lfloor\frac{n}{p^k}\right\rfloor - \left\lfloor\frac{r}{p^k}\right\rfloor - \left\lfloor\frac{n-r}{p^k}\right\rfloor.$$
    By Lemma \ref{lem:ind}, each summand is either $0$ or $1$ and the number of terms in the sum is $\left\lfloor\frac{\log n}{\log p}\right\rfloor$.
\end{proof}

We work towards the lower bound $L_n\geq 2^n$ next. For this purpose, it is useful to identify potentially large factors of $L_n$.

\begin{lemma}\label{lem:nmn}
    Let $m,n$ be positive integers such that $1\leq m\leq n$. Then $\displaystyle m\binom{n}{m} \mid L_n.$
\end{lemma}

\begin{proof}
Let $p$ be any prime and let $k$ be the unique non-negative integer such that $p^k \leq n < p^{k+1}$. In other words, $k = \nu_p(L_n)$. It is enough to prove that $$\nu_p\left(m\binom{n}{m}\right) \leq k.$$
Let $\nu_p(m) = \ell\geq0$. Then the remainders when $m$ is divided by $p,p^2,\ldots,p^\ell$ are all $0$. Hence, we have
$$\left\lfloor\frac{n}{p^j}\right\rfloor - \left\lfloor\frac{m}{p^j}\right\rfloor - \left\lfloor\frac{n-m}{p^j}\right\rfloor
        =0\qquad\mbox{if }j\leq \ell.$$
Since it is also at most $1$ for any $j = \ell + 1,\ldots,k$, we have $$\nu_p\left(\binom{n}{m}\right) \leq k-\ell.$$
Combining with $\nu_p(m) =\ell$ completes the proof.
\end{proof}

\noindent\wow{Exercise:} Prove that
$$L_n = \lcm\Big(1\binom{n}{1},2\binom{n}{2},\ldots,n\binom{n}{n}\Big).$$

\begin{lemma}\label{lem:2m1div}
    Let $m$ be a positive integer. Then $m(m+1)\binom{2m+1}{m}\mid L_{2m+1}.$
\end{lemma}

\begin{proof}
    Apply Lemma \ref{lem:nmn} to $n = 2m+1$ gives
    $$m\binom{2m+1}{m} \mid L_{2m+1}\aa (m+1)\binom{2m+1}{m+1} \mid L_{2m+1}.$$
    Since $\binom{2m+1}{m+1} = \binom{2m+1}{m}$ and $\gcd(m,m+1) = 1$, we have $$\gcd\left(m\binom{2m+1}{m},(m+1)\binom{2m+1}{m+1}\right) = \binom{2m+1}{m}\gcd(m,m+1) = \binom{2m+1}{m}.$$
So their lcm is $m(m+1)\binom{2m+1}{m}$ and it divides $L_{2m+1}$.
\end{proof}

\begin{center}
    \add{Lecture 5.5 (Tutorial) Fri 09/13}

    \re{Lifting the Exponent}
\end{center}

Our motivating example is: find
$$\nu_{11}(10^{11^{12}} + 12^{11^{10}}).$$
This question originated from the IMO 1991 shortlist, which asked for the largest integer $k$ such that $$1991^k\mid 1990^{1991^{1992}} + 1992^{1991^{1990}}.$$
The method is essentially the same, with the extra twist that $1991 = 11\times 181$. Note first that
\begin{eqnarray*}
    10^{11^{12}}&\equiv& (-1)^{11^{12}}\,\,\,\equiv\,\,\,-1\pmod{11}\\
    12^{11^{10}}&\equiv&1^{11^{10}}\,\,\,\equiv\,\,\,1\pmod{11}.
\end{eqnarray*}
So the answer is at least $1$.

To solve the question, we need the hammer known as LTE.

\begin{proposition}\label{prop:LTE}
    (LTE, $p$ odd) Let $p$ be an odd prime and let $a,b$ be integers such that $p\nmid a$, $p\nmid b$ and $p\mid a - b$. Let $n\in\N$. Then
    $$\nu_p(a^n - b^n) = \nu_p(a - b) + \nu_p(n).$$
\end{proposition}

\noindent Applying this to $a = 10$, $b = -1$, $n = 11^{12}$ and $p = 11$, we find that
$$\nu_{11}(10^{11^{12}} - (-1)^{11^{12}}) = \nu_{11}(10 - (-1)) + \nu_{11}(11^{12}) = 13.$$
In other words, since $(-1)^{11^{12}} = -1$, we can write $$10^{11^{12}} = 11^{13}a - 1,\qquad\mbox{where}\qquad11\nmid a.$$
Similarly, we have
$$\nu_{11}(12^{11^{10}} - (1)^{11^{10}}) = \nu_{11}(12 - 1) + \nu_{11}(11^{10}) = 11.$$
Hence, we have
$$12^{11^{10}} = 11^{11}b + 1,\qquad\mbox{where}\qquad11\nmid b.$$
Combining gives
$$10^{11^{12}} + 12^{11^{10}} = 11^{13}a + 11^{11}b.$$
Since $\nu_{11}(11^{13}a) = 13 > 11 = \nu_{11}(11^{11}b)$, we see that
$$\nu_{11}(10^{11^{12}} + 12^{11^{10}}) = 11.$$


Now let's prove LTE. First we note that it follows from the following two lemmas by induction.

\begin{lemma}\label{lem:LTEnmid}
    Let $p$ be a prime and let $a,b$ be integers such that $p\nmid a$, $p\nmid b$ and $p\mid a - b$. Let $n\in\N$ such that $p\nmid n$. Then
    $$\nu_p(a^n - b^n) = \nu_p(a - b).$$
\end{lemma}

\begin{lemma}\label{lem:LTEmid}
    Let $p$ be an odd prime and let $a,b$ be integers such that $p\nmid a$, $p\nmid b$ and $p\mid a - b$. Then
    $$\nu_p(a^p - b^p) = \nu_p(a - b) + 1.$$
\end{lemma}

\noindent\textbf{Proof of Proposition \ref{prop:LTE} from Lemmas \ref{lem:LTEnmid} and \ref{lem:LTEmid}:} We prove by induction on $n$. When $n = 1$, both sides equal $\nu_p(a - b)$, so it is true. Suppose now $n\geq 2$ and that $\nu_p(a^m - b^m) = \nu_p(a - b) + \nu_p(m)$ for all $m = 1,\ldots,n-1$. Suppose first that $p\nmid n$. Then $\nu_p(n) = 0$ and we are done by Lemma \ref{lem:LTEnmid}:
$$\nu_p(a^n - b^n) = \nu_p(a - b) = \nu_p(a - b) + \nu_p(n).$$
Suppose now $p\mid n$. Let $m = n/p$. Then $1
\leq m \leq n-1$. Then we know from the inductive hypothesis that $\nu_p(a^m - b^m) = \nu_p(a - b) + \nu_p(m) \geq \nu_p(a - b) \geq 1$. We can now apply Lemma \ref{lem:LTEmid} to $a^{m}$ and $b^{m}$ to get
$$\nu_p(a^{pm} - b^{pm}) = \nu_p(a^m - b^m) + 1.$$
Hence
$$\nu_p(a^n - b^n) = \nu_p(a^m - b^m) + 1 = \nu_p(a - b) + \nu_p(m) + 1 = \nu_p(a - b) + \nu_p(n).$$

\noindent\textbf{Proof of Lemma \ref{lem:LTEnmid}:} It suffices to prove that $$\frac{a^n - b^n}{a - b} = a^{n-1} + a^{n-2}b + \cdots + b^{n-1}$$ is not divisible by $p$. Since $a\equiv b\pmod{p}$, we have
$$a^{n-1} + a^{n-2}b + \cdots + b^{n-1}\equiv b^{n-1} + b^{n-1} + \cdots + b^{n-1} \equiv nb^{n-1}\not\equiv 0\pmod{p}$$
since $p\nmid b$ and $p\nmid n$. \hfill $\Box$



\v
\noindent\textbf{Proof of Lemma \ref{lem:LTEmid}:} We write $a = b + p^kc$ where $k = \nu_p(a - b)\geq1$ and $p\nmid c$. Then we expand
$$a^p = (b + p^kc)^p = b^p + pb^{p-1}p^kc + \sum_{r = 2}^{p-1}\binom{p}{r}b^{p-r}(p^kc)^r + p^{kp}c^p.$$
Let's look at the $p$-adic valuation of each term. The $b^p$ term gets cancelled when we take $a^p - b^p$. Since $p\nmid b$ and $p\nmid c$, we see that
$\nu_p(pb^{p-1}p^kc) = k + 1.$ We now prove that the remaining terms all have $p$-adic valuation at least $k+2$. For $r = 2,\ldots,p-1$, we have
$$\nu_p(\binom{p}{r}b^{p-r}(p^kc)^r) = 1 + rk \geq 1 + 2k = 1 + k + k \geq 1 + k + 1 = k + 2$$
and since $p\geq 3$, we have
$$\nu_p(p^{kp}c^p) = kp \geq 3k = k + k + k \geq k + 1 + 1 = k + 2.$$
Therefore, we have $\nu_p(a^p - b^p) = k + 1 = \nu_p(a - b) + 1$ as desired. \hfill $\Box$

\v
\noindent\qt{Where does this fail for $p = 2$?} In this case, $\nu_p(p^{kp}c^p) = 2k$ could be $k + 1$ when $k = 1$. In fact,
$$\nu_2(3^2 - 1^2) = \nu_2(8) = 3 = \nu_2(3 - 1) + 2.$$

\begin{proposition}\label{prop:LTEp2}
    (LTE, $p=2$). Suppose $a,b$ are odd and $n$ is even. Then
    $$\nu_2(a^n - b^n) = \nu_2(a^2 - b^2) + \nu_2(n) - 1.$$
\end{proposition}

\begin{center}
    \add{Lecture 6 Mon 09/16}

    \re{Lower and upper bounds for $L_n$}
\end{center}

We now work towards the lower bound:
\begin{theorem}\label{thm:Lnlower}
    For any integer $n\geq 7$, we have $$L_n = \lcm(1,2,\ldots,n)> 2^n.$$
\end{theorem}
Note that
\begin{eqnarray*}
    L_6 &=& 2^2\cdot 3\cdot 5 = 60 < 2^6\\
    L_7 &=& 420 > 2^7\\
    L_8 &=& 840 > 2^8.
\end{eqnarray*}



\begin{lemma}\label{lem:binomarchi}
    Let $m$ be a positive integer. Then
    $$\frac{4^m}{m+1} < \binom{2m+1}{m} < 4^m\aa \frac{4^m}{2m+1} < \binom{2m}{m}< 4^m.$$
\end{lemma}

\begin{proof}
    Note the formula $$2^{2m+1} = \sum_{r=0}^{2m+1}\binom{2m+1}{r}\aa 2^{2m} = \sum_{r=0}^{2m}\binom{2m}{r}.$$
Note also that $\binom{2m+1}{m} = \binom{2m+1}{m+1}$ is the largest binomial coefficient of the form $\binom{2m+1}{r}$, and $\binom{2m}{m}$ is the largest binomial coefficient of the form $\binom{2m}{r}$. Hence we have
$$2\binom{2m+1}{m} < \sum_{r=0}^{2m+1}\binom{2m+1}{r} = 2\cdot 4^m < (2m+2)\binom{2m+1}{m}$$
and
$$\binom{2m}{m} < \sum_{r=0}^{2m}\binom{2m}{r} = 4^m < (2m+1)\binom{2m}{m}.$$
Rearranging gives the desired inequalities.
\end{proof}

\noindent\textbf{Remark:} From the Stirling's approximation
$$m!\sim \sqrt{2\pi m}\left(\frac{m}{e}\right)^m,$$
we can get the more precise estimate $$\binom{2m}{m}\sim \frac{4^m}{\sqrt{\pi m}}.$$

\noindent\textbf{Proof of Theorem \ref{thm:Lnlower}:} Suppose first $n = 2m+1$ is odd, with $m\geq 3$. By Lemma \ref{lem:2m1div} and Lemma \ref{lem:binomarchi}, we have
$$L_{2m+1} \geq m(m+1)\binom{2m+1}{m} > m4^m > 2\cdot 4^m = 2^{2m+1}.$$
Suppose now $n = 2m + 2$ is even. We have already checked $L_8>2^8$ explicitly. So we may assume $n\geq 10$ and so $m\geq 4$. Then once again,
$$L_{2m+2} \geq L_{2m+1} > m4^m \geq 4\cdot 4^m = 2^{2m+2}.$$


We now prove the upper bound:
\begin{theorem}\label{thm:Ln}
    For any $n\in\N$, we have $$L_n = \lcm(1,2,\ldots,n) \leq 4^{n-1}.$$
\end{theorem}
This implies Erd\"{o}s' bound
$$\prod_{p\leq n}p \leq L_n \leq 4^{n-1}.$$

\begin{proof}
    We will prove by induction on $n$. The base case $n = 1$ is clear since $L_1 = 1 = 4^{1-1}$. Suppose now $n\geq 2$ and that $L_k\leq 4^{k-1}$ for every $k = 1,\ldots,n-1$. Suppose first that $n = 2m$ is even. Note that $L_n$ can only be different from $L_{n-1}$ when $n$ is a power of a prime $p$ in which case $L_n/L_{n-1} = p$. Since $n$ is even, we see that either $L_n = L_{n-1}$ when $n$ is not a power of $2$ or $L_n = 2L_{n-1}$ when $n$ is a power of $2$. In both cases,
    $$L_n \leq 2 L_{n-1} \leq 2\cdot 4^{n-2}\leq 4^{n-1}$$ by induction. Suppose now $n = 2m+1$ is odd. We note that the desired result follows from
    $$L_{2m+1}\mid L_{m+1}\binom{2m+1}{m}$$
    because then $$L_{2m+1} \leq L_{m+1} \binom{2m+1}{m} < 4^m \cdot 4^m =  4^{2m}$$
    by induction.

    Let $p$ be any prime. It suffices to prove that $$\nu_p(L_{2m+1})-\nu_p(L_{m+1})\leq\nu_p\Big(\binom{2m+1}{m}\Big).$$
    ``Proof'' by example: Let's prove
    $$\nu_2(L_{139}) - \nu_2(L_{70}) \leq \nu_2\Big(\binom{139}{69}\Big).$$
    From $$64 \leq 70 < 128 \leq 139 < 256,$$ we have $$\nu_2(L_{139}) - \nu_2(L_{70}) = 7 - 6 = 1.$$
    On the other hand,
    $$\nu_2\Big(\binom{139}{69}\Big) \geq \left\lfloor\frac{139}{128}\right\rfloor - \left\lfloor\frac{69}{128}\right\rfloor - \left\lfloor\frac{70}{128}\right\rfloor = 1 = \nu_2(L_{139}) - \nu_2(L_{70}).$$
    As another example, let's prove
    $$\nu_7(L_{139}) - \nu_7(L_{70}) \leq \nu_7\Big(\binom{139}{69}\Big).$$
    In this case, we have
    $$49 \leq 70 < 139 < 343,$$
    so we have
    $$\nu_7(L_{139}) - \nu_7(L_{70}) = 2 - 2 = 0 \leq \nu_7\Big(\binom{139}{69}\Big).$$
    \add{These two examples illustrate the only 2 possibilities:
    $$p^k\leq m + 1 < p^{k+1} \leq 2m + 1 < p^{k+2},\qquad\mbox{or}\qquad p^k\leq m + 1 < 2m + 1 < p^{k+1}.$$
    In the first case,
    $$\nu_p(L_{m+1}) = k\aa \nu_p(L_{2m+1}) = k+1$$
    while
    $$\nu_p\Big(\binom{2m+1}{m}\Big) \geq \left\lfloor\frac{2m+1}{p^{k+1}}\right\rfloor - \left\lfloor\frac{m+1}{p^{k+1}}\right\rfloor - \left\lfloor\frac{m}{p^{k+1}}\right\rfloor\geq 1 - 0 - 0 = 1.$$
    In the second case,
    $$\nu_p(L_{m+1}) = \nu_p(L_{2m+1}) = k,\qquad\mbox{so}\qquad \nu_p(L_{2m+1}) - \nu_p(L_{m+1}) = 0 \leq \nu_p\Big(\binom{2m+1}{m}\Big).$$
    Finally we note that
    $$2m + 1 < 2(m+1) < 2p^{k+1}\leq p^{k+2}.$$
    Hence, it is not possible for $2m+1\geq p^{k+2}$.}
\end{proof}



\begin{center}
    \add{Lecture 7 Wed 09/18}

    \re{Bertrand postulate}
\end{center}
We now work towards proving Bertrand's postulate, that there is always a prime between $n$ and $2n$. I will prove that there is a prime between $1012$ and $2024$ and leave it to you (HW 3) to translate this into a proper proof.

From Lemma \ref{lem:binomarchi} with $m = 1012$, we have
$$\frac{4^{1012}}{2025} \leq \binom{2024}{1012}.$$
We consider the prime factorization of $\binom{2024}{1012}$. For any prime $p$, recall we have the bound (Corollary \ref{cor:trib}):
$$\nu_p\left(\binom{2024}{1012}\right) \leq \left\lfloor\log_p(2024)\right\rfloor.$$
In particular, no prime $p > 2024$ can divide it; and if $p > \sqrt{2024} \simeq 45$, then $\log_p(2024) < 2$ and so
$$\nu_p\left(\binom{2024}{1012}\right) \leq 1.$$
We want to be more precise on when it is $0$ or $1$. Suppose now $p>\sqrt{2024}$. Then
$$\nu_p\left(\binom{2024}{1012}\right) = \left\lfloor\frac{2024}{p}\right\rfloor - 2\left\lfloor\frac{1012}{p}\right\rfloor.$$
Note that if $1012 < p \leq 2024$ (which is the range we really care about), then
$$1\leq \frac{2024}{p} < 2,\qquad \frac{1012}{p} < 1 \qquad \Longrightarrow \qquad \nu_p\left(\binom{2024}{1012}\right) = \left\lfloor\frac{2024}{p}\right\rfloor - 2\left\lfloor\frac{1012}{p}\right\rfloor = 1-2\cdot0 = 1.$$
On the other hand, if $2024/3 < p \leq 1012$, then
$$2\leq \frac{2024}{p} < 3,\qquad 1\leq \frac{1012}{p} < \frac{3}{2} \qquad \Longrightarrow \qquad \nu_p\left(\binom{2024}{1012}\right) = \left\lfloor\frac{2024}{p}\right\rfloor - 2\left\lfloor\frac{1012}{p}\right\rfloor = 2-2\cdot1 = 0.$$
Putting these together, we have
\begin{eqnarray*}
    \frac{4^{1012}}{2025} \leq \binom{2024}{1012} &=& \prod_{p \leq 2024}p^{\nu_p(\binom{2024}{1012})}\\
    &\leq&\prod_{p\leq\sqrt{2024}}p^{\log_p(2024)}\prod_{\sqrt{2024} < p \leq 2024/3} p^{1}\prod_{1012 < p \leq 2024}p\\
    &\leq& \prod_{p\leq\sqrt{2024}}2024\cdot\prod_{p\leq 2024/3}p\cdot\prod_{1012 < p \leq 2024}2024\\
    &\leq&2024^{\sqrt{2024} + \pi(2024)-\pi(1012)}\cdot 4^{2024/3-1}.
\end{eqnarray*}
Rearranging gives
$$\pi(2024) - \pi(1012) \geq \log_{2024}(4^{1012 - 2024/3 + 1}/2025) - \sqrt{2024} \simeq 15.62.$$
In HW 3, you will prove that
$$\pi(2n) - \pi(n) \geq \frac{(n/3+1)\log 4 - \log(2n+1)}{\log 2n} - \sqrt{2n}.$$
Using a bit of calculus and computer aids, one finds that this lower bound is positive for $n\geq 459$. For $n < 459$, we can verify that $\pi(2n) - \pi(n) > 0$ directly using the primes $2,3,5,7,13,23,43,83,163,317,631$. This concludes the proof of Bertrand's postulate.

\begin{theorem}
    (Bertrand's postulate) For any positive integer $n$, there is a prime $p \in (n, 2n]$.
\end{theorem}


\subsection*{Exercises}
\begin{enumerate}[\thesection .1]
    \item Prove that for every prime $p \neq 3$, there exists a positive integer $n$, an integer $a = 0,1$ and an integer $b = 0,1,\ldots,n-1$ such that $p = n^2 + an + b$.
    \item How many $0$'s does the number $40!$ ends in?

    \wow{Challenge Question}: Can you figure out what the last nonzero digit of $40!$ is?
    \item Prove that for any $n\in\N$ and any prime $p$, we have $\nu_p(n!) < n/(p-1).$\label{exer:5}
    \item Prove that for any $n\in\N$, if $n\mid\binom{n}{m}$ for all $m = 1,\ldots,n-1$, then $n$ is a prime.
    \item According to the Prime number theorem, we know that $L_n\sim e^n$. Prove (without using the PNT) that for any $\alpha > 0$, we have $L_n \leq 4^{n-\alpha}$ for $n$ sufficiently large (depending on $\alpha$). You may use the better asympototic for the binomial coefficient from Sterling's formula.
    \item Use Exercise 3.\ref{exer:5} to conclude that $$\sum_{p}\frac{\log p}{p-1}\rightarrow\infty.$$
    With a little bit more effort, one can prove that $$\sum_{p\leq n}\frac{\log p}{p} = \log n + O(1).$$
    In other words, there exists an absolute constant $C>0$ such that for any $n\in\N$, $$\left|\sum_{p\leq n}\frac{\log p}{p} - \log n\right| \leq C.$$
\end{enumerate}


\section{Euclid's proof of the infinitude of primes}

Before all of these fancy results on the prime counting function, the very first proof of the infinitude of primes was due to Euclid. Here is another way to think about the proof. The key ideas are as follows:
\begin{enumerate}[(a)]
    \item Every integer $n\geq 2$ has a prime divisor.
    \item Given $n$ primes $p_1,\ldots,p_n$, the integer $p_1\cdots p_n + 1$ is not divisible by $p_1,\ldots,p_n$.
\end{enumerate}
Hence if $p_1,\ldots,p_n$ were all the primes, then $p_1\cdots p_n + 1$ has a prime divisor that isn't any of them, which is a contradiction.

There is a more general result on the infinitude of primes satisfying congruence conditions. Recall that $a\equiv b\pmod{m}$ means that $m\mid a - b$, or equivalently that $a$ and $b$ have the same remainder when divided by $m$. Since numbers congruent to $a$ mod $m$ form an arithmetic progression, this result is also referred to as the infinitude of primes in arithmetic progressions. It marks the beginning of modern analytic number theory.

\begin{theorem}
    (Dirichlet) Let $a,m$ be coprime positive integers. Then there are infinitely many primes $p\equiv a\pmod{m}$.
\end{theorem}

\add{We now know (Siegel-Walfisz) that there are an equal number of them, asymptotically, over all possible congruence classes. More precisely, if $p\equiv a\pmod{m}$, then $\gcd(p,m) = \gcd(a,m)$. If $p$ is prime large enough to not divide $m$, then $\gcd(p,m) = 1$. The number of integers $a = 1,\ldots,m$ such that $\gcd(a,m)=1$ is $\phi(m)$, the Euler-$\phi$ (or the Euler-Totient) function of $m$. Then}
$$\add{\lim_{x\rightarrow\infty}\frac{\#\,\text{primes }p\leq x,p\equiv a \,\,(\text{mod }m)}{x/\log x} = \frac{1}{\phi(m)}.}$$
We won't be able to prove the full Dirichlet's Theorem. Our next main goal is to prove it in the case $a = 1$ and $m\in\N$.

\subsection*{Primes $\equiv 2\pmod{3}$}

We can generalize Euclid's strategy as follows:
\wow{\begin{enumerate}[(a)]
    \item Every integer of the form A has a prime divisor of the form B.
    \item Given $n$ primes $p_1,\ldots,p_n$, of the form B, construct an integer of the form A that is not divisible by $p_1,\ldots,p_n$.
\end{enumerate}}
Then we can conclude that there are infinitely many primes of the form B, for if $p_1,\ldots,p_n$ are all of them, then we can use (b) to generate an integer that has a prime divisor of the form B by (a) but it can't be $p_1,\ldots,p_n$.

As an example, we can use this to prove the infinitude of primes $\equiv 2\pmod{3}$. Note that a product of primes that are all $\equiv 1\pmod{3}$ is also $\equiv 1\pmod{3}$. Hence if $n\geq 2$ is an integer such that $n\equiv 2\pmod{3}$, then $n$ has a prime divisor that is $\equiv2\pmod{3}$. In this case, being of form A would mean that $n\geq 2$ and $n\equiv 2\pmod{3}$, and being of form B would mean that $p\equiv 2\pmod{3}$. Now given primes $p_1,\ldots,p_n\equiv 2\pmod{3}$, we can construct an integer of form A by simply taking $3p_1\cdots p_n + 2$. Note however that this is divisible by $p_1$ if we assume without loss of generality that $p_1 = 2$. We can easily fix it by taking $3p_2\cdots p_n + 2$ instead.

\begin{center}
    \add{Lecture 8 Fri 09/20}

    \re{Infinitude of primes of the form $4k+1$, $4k+3$}
\end{center}

\subsection*{Primes $\equiv 3\pmod{4}$ or $\equiv 5\pmod{6}$}

The same method works for the case of primes $\equiv 3\pmod{4}$. If an odd prime $p\not\equiv 1\pmod{4}$, then $p\equiv 3\pmod{4}$. Hence any integer $n\geq2$ with $n\equiv 3\pmod{4}$ has a prime divisor $\equiv 3\pmod{4}$. Then given primes $p_1,\ldots,p_n\equiv 3\pmod{4}$ where $p_1 = 3$, we take $4p_2\cdots p_n + 3$ to be an integer of the desired form that is not divisible by $p_1,\ldots,p_n$.

The reason why this method works for these two cases is that when $m = 3$ or $m = 4$, if $\gcd(a,m) = 1$ and $p\not\equiv 1\pmod{m}$, then there is only one possible remainder for $p$ mod $m$. Recall that $\phi(m)$ is the number of integers $a = 1,2,\ldots,m$ such that $\gcd(a,m) = 1$. Then we have $\phi(3) = \phi(4) = 2$. Note that $\phi(5) = 4$. So if an integer $n\not\equiv 1\pmod{5}$, then $n$ is not a product of primes all $\equiv 1\pmod{5}$, but the prime divisors of $n$ could be $\equiv 2,3,4\pmod{5}$. So we can't use this to guarantee that $n$ must a prime divisor with a certain remainder mod $5$. This method does work again for primes $\equiv 5\pmod{6}$ since $\phi(6) = 2$.

\v
\noindent\wow{Exercise:}
\begin{enumerate}[(i)]
    \item Prove that $\phi(m) = 2$ if and only if $m = 3,4,6$.
    \item Prove that for any prime $p$ and any $k\in\N$, we have $\phi(p) = p - 1$ and $\phi(p^k) = p^k - p^{k-1}.$
    \item Prove that if $m,n$ are coprime positive integers, then $\phi(mn) = \phi(m)\phi(n)$. (Look up Chinese Remainder Theorem if you haven't seen it.)
\end{enumerate}


\subsection*{Primes $\equiv 1\pmod{4}$}

This is a bit trickier. We have the following result.

\begin{proposition}
    If $p$ is an odd prime dividing $n^2 + 1$ for some $n\in\Z$, then $p\equiv 1\pmod{4}$.
\end{proposition}

\begin{proof}
    Suppose $n\in\Z$ such that $p\mid n^2 + 1$. Then in terms of congruences, we have $$n^2\equiv -1\pmod{p}.$$
    Note that $p\nmid n$, as $p\mid n$ would imply $n^2\equiv 0\pmod{p}$. Then by Fermat's little Theorem, we have $n^{p-1}\equiv 1\pmod{p}$. Since $p$ is odd, we see that $(p-1)/2\in\N$. Hence we have
    $$n^{p-1} = (n^2)^{\frac{p-1}{2}}\equiv (-1)^{\frac{p-1}{2}}\pmod{p}.$$
    Since $p > 2$, we see that $1\not\equiv-1\pmod{p}$. So from $1\equiv(-1)^{(p-1)/2}\pmod{p}$, we see that $1 = (-1)^{(p-1)/2}$ which implies that $\frac{p-1}{2}$ is even. Writing $\frac{p-1}{2} = 2k$ for some $k\in\Z$ gives $p = 4k + 1\equiv 1\pmod{4}$.
\end{proof}

By taking $4n^2 + 1$ instead, we remove the possibility of $p=2$.
\begin{enumerate}[(a)]
    \item Every integer of the form $4n^2+1$ for some $n\in\N$ has a prime divisor $\equiv 1\pmod{4}.$ In fact, all of the prime divisors of $4n^2 + 1$ are $\equiv 1\pmod{4}$.
    \item Given primes $p_1,\ldots,p_n\equiv 1\pmod{4}$, we can simply take $4(p_1\cdots p_n)^2 + 1.$
\end{enumerate}

In order to generalize this strategy to primes $\equiv 1\pmod{m}$, we need to find the magical polynomial in place of $x^2 + 1$. Our strategy is now:
\begin{enumerate}[(a)]
    \item Find a polynomial $f(x) = a_dx^d + \cdots + a_1x \pm 1$ with integer coefficients and $d\geq 1$ such that if $p$ is a prime divisor of $f(n)$ for some $n\in\Z$, then $p\equiv 1\pmod{m}$.
    \item Given primes $p_1,\ldots,p_n\equiv 1\pmod{m}$, we can simply take $f(p_1\cdots p_n) = (p_1\cdots p_n)(\cdots) \pm 1,$ which is not divisible by $p_1,\ldots,p_n$.
\end{enumerate}




The crucial idea here is that if $a^2\equiv -1\pmod{p}$, then
$$a^4\equiv 1\pmod{p}$$
but
$$a^3\equiv -a\not\equiv 1\pmod{p},\qquad a^2\equiv -1\not\equiv 1\pmod{p},\qquad a\not\equiv 1\pmod{p}.$$
We define the \wow{order} of an integer $a$ mod $m$, where $\gcd(a,m) = 1$, denoted $o_m(a)$, to be the smallest positive integer $d$ such that $n^d \equiv 1\pmod{m}.$ In this case, we have $o_p(a) = 4$.

As another example, recall from the first tutorial:
\begin{eqnarray*}
    10 &\equiv&3\pmod{7}\\
    10^2 &\equiv&2\pmod{7}\\
    10^3 &\equiv&6\pmod{7}\\
    10^4 &\equiv&4\pmod{7}\\
    10^5 &\equiv&5\pmod{7}\\
    10^6 &\equiv&1\pmod{7}
\end{eqnarray*}
This means that $6$ is the smallest positive integer such that $10^d\equiv 1\pmod{7}$. Hence $o_7(10) = 6$. Simiarly, recall that $10^3\equiv-1\pmod{13}$ and $10^6\equiv 1\pmod{13}$. This implies that $o_{13}(10) = 6.$

\v
The following result is extremely important:
\begin{proposition}\label{prop:lag}
    Let $a,m$ be coprime integers. Suppose $n\in\N$ with $a^n\equiv 1\pmod{m}$. Then $o_m(a)\mid n$.
\end{proposition}

\begin{proof}
    Note that $o_m(a)\leq n$. Apply the division algorithm to get integers $s,t$ such that $n = o_m(a)s + t$ where $0\leq t < o_m(a)$ and $s\geq 0$. Then
$$a^t \equiv a^t (a^{o_m(a)})^s = a^{t + o_m(a)s} = a^{n}\equiv 1\pmod{m}.$$
Hence it follows from the minimality of $o_m(a)$ that $t = 0$. Therefore, $o_m(a)\mid n$.
\end{proof}

Returning the main goal of the infinitude of primes $\equiv 1\pmod{m}$, we recall from Fermat's little Theorem that if $p\nmid a$, then $a^{p-1}\equiv 1\pmod{p}$. Hence by Proposition \ref{prop:lag}, we have $o_p(a)\mid p - 1.$ In terms of congruences, we have $p\equiv 1\pmod{o_p(a)}$. With this in mind, our goal now is to \wow{find a polynomial $f(x)$ such that if $p\mid f(a)$, then $o_p(a) = m$.}

\begin{center}
    \add{Lecture 8.5 (Tutorial) Fri 09/20}

    \re{More on orders}
\end{center}

\qt{What about $o_{49}(2)$?} First, we note that $o_7(2) = 3$ since $2$ and $4$ are not $1$ mod $7$ but $8$ is. Write $d = o_{49}(2)$. Then
$$2^d\equiv 1\pmod{49}.$$
We have $2^d\equiv 1\pmod{7}$ as well. By Proposition \ref{prop:lag}, we have $o_7(2)\mid d$. Hence we have $d = 3q$ for some $q\in\N$. Since $49\mid 2^d - 1$, we have $\nu_7(2^d - 1) \geq 2$. Using LTE (Proposition \ref{prop:LTE}) with $a = 2^3$, $b = 1$ and $p = 7$, we have
$$\nu_7(2^{3q} - 1) = \nu_7(2^3 - 1) + \nu_7(q) = 1 + \nu_7(q).$$
The smallest $q$ to make this at least $2$ is $q = 7$. Hence $o_{49}(2) = 21$.

\v
\noindent\wow{Exercise:} Prove that for any $k\geq 1$, we have $o_{7^k}(2) = 3\cdot 7^{k-1}.$

\v
\qt{What is the largest possible value for $o_m(a)$?} We have the following generalization of Fermat's little Theorem.

\begin{theorem}\label{thm:eulerp}
    (Euler) Let $m\in\N$ and $a\in\Z$ such that $\gcd(a,m) = 1$. Then $a^{\phi(m)} \equiv 1\pmod{m}$. As a result, we have $o_m(a)\mid\phi(m)$.
\end{theorem}

Theorem \ref{thm:eulerp} can be proved using the same technique as the proof of Fermat's little Theorem in Tutorial 1. In fact, this method generalizes to the case of finite rings, which we will discuss later in the course.

We say an integer $a$ is \wow{primitive} mod $m$ if $o_m(a) = \phi(m)$, and say $a$ is a primitive root/element mod $m$. We saw in Tutorial 1 that whether $10$ is primitive mod a prime $p$ is closely related to whether $1/p, 2/p,\ldots (p-1)/p$ have the cyclic structure. We will be able to prove later (after quadratic reciprocity):

\begin{proposition}
    Let $p = 2^{2^n} + 1$ be a Fermat prime at least $17$ (i.e., $n\geq 2$). Then $10$ is primitive mod $p$.
\end{proposition}

\qt{Do primitive roots mod $m$ always exist?} Since $10$ is primitive mod $7$, we see that $3$ is also primitive mod $7$. Let's find $d = o_{49}(3)$ exactly like $o_{49}(2)$. From $3^d\equiv 1\pmod{49}$, we get $3^d\equiv 1\pmod{7}$ and so $o_7(3)\mid d$. Writing $d = 6q$ for some $q\in\N$, we have
$$\nu_7(3^{6q} - 1) = \nu_7(729^q - 1) = \nu_7(729 - 1) + \nu_7(q) = 1 + \nu_7(q).$$
Hence the smallest $q$ that makes this at least $2$ is $q = 7$. In other words, $$o_{49}(3) = 42 = 49 - 7 = \phi(49).$$
Hence $3$ is primitive mod $49$. Similarly, for any $k\in\N$, we have
$$o_{7^k}(3) = 6\cdot 7^{k-1} = 7^k - 7^{k-1} = \phi(7^k).$$
So $3$ is primitive mod $7^k$ for all $k\in\N$. On the other hand,
$$o_8(1) = 1\aa o_8(3) = o_8(5) = o_8(7) = 2,\qquad\mbox{but}\qquad \phi(8) = 4.$$
So primitive roots mod $8$ don't exist. We will prove much later that primitive roots mod $m$ exist if and only if $m = 2, 4, p^k, 2p^k$ where $p$ is an odd prime.

There \textbf{is} a world where primitive roots always exist. The complex numbers! We define the order $o(z)$ of some complex number $z\in\C$ similarly as the smallest positive integer $d$ such that $z^d = 1$, if it exists. For example, $o(i) = 4$. \qt{What are all the complex numbers $z$ with $o(z) = 4$?} They must be roots of $x^4 = 1$, which are $\pm1$ and $\pm i$. We have $o(1) = 1$, $o(-1) = 2$, $o(\pm i) = 4$. The polynomial $x^2 + 1$ that we used to prove the infinitude of primes $\equiv 1\pmod{4}$ factors as
$$x^2 + 1 = (x - i)(x - (-i)).$$

Let's try this with an arbitrary $m\geq 2$. What are all the complex numbers $z$ with $o(z) = m$? They must be roots of $x^m = 1$, which are given by $\zeta_m^k$ for $k = 1,2,\ldots, m$ where $\zeta_m = e^{2\pi i/m}$. In HW4, you will prove that $$o(\zeta_m^k) = \frac{m}{\gcd(m,k)}.$$
Hence, we see that $o(\zeta_m^k) = m$ if and only if $\gcd(m,k) = 1$. We define the \wow{$m$-th cyclotomic polynomial} $\Phi_m(x)$ as
$$\Phi_m(x) = \prod_{o(z) = m}(x - z) = \prod_{\substack{1\leq k\leq m\\ \gcd(k,m)=1}}(x - \zeta_m^k).$$

\add{Another way to construct the $m$-th cyclotomic polynomial is to start from $x^m - 1$ and remove factors whose roots have smaller orders. For example, when $m = 6$, we should remove solutions to $x^2-1$, as they have order dividing $2$, and $x^3 - 1$, as they have order dividing $3$, but $$\frac{x^6-1}{(x^2-1)(x^3 - 1)} = \frac{x^6-1}{x^5 - x^3 - x^2 + 1}$$
isn't a polynomial. The problem is that when we remove the solutions to $x^2 - 1$, we have already removed the solution to $x - 1$, so we shouldn't remove it again from $x^3 - 1$. In other words, we should take
$$\Phi_6(x) = \frac{x^6 - 1}{(x^2 - 1)\big((x^3 - 1)/(x-1)\big)} = \frac{x^3 + 1}{x + 1} = x^2 - x + 1.$$
What about something more complicated like $\Phi_{105}(x)$? Using the same ``inclusion-exclusion sieve'', we should take
$$\Phi_{105}(x) = \frac{(x^{105}-1)(x^3-1)(x^5-1)(x^7-1)}{(x^{15}-1)(x^{21}-1)(x^{35}-1)(x-1)} = x^{48} + \cdots - 2x^{41} + \cdots + 1.$$
It seems quite random that it is actually a polynomial. We need a better definition that is easier to work with. So we forget about integrality and just define a polynomial with coefficients in $\C$ and hope for the best!}

\subsection*{Exercises}
\begin{enumerate}[\thesection .1]
    \item Use the polynomial $n^2 + 4$, and a small modification, to prove that there are infinitely many primes of the form $8k + 5$.

    \item Let $h(x)$ is a polynomial with integer coefficients with $h(0) = 1$. Prove that the sequence defined by $a_1 = 1$ and $a_{i+1} = h(a_1a_2\cdots a_i)$ for $i\geq 1$, consists of pairwise coprime integers.

    \item Let $h(x) = ax + b$ where $a,b$ are coprime integers. Prove that the sequence defined by $a_1 = 1$ and $a_{i+1} = h(a_1a_2\cdots a_i)$ for $i\geq 1$, consists of pairwise coprime integers.

    \item Prove that there does not exist a non-constant polynomial $h(x)$ with integer coefficients such that $h(n)$ is a prime for all integers $n$.

    \item Prove that $2^{2^n}-1$ has at least $n+1$ distinct prime divisors when $n\geq 6$.

    \item Prove that $\phi(m)$ is even for any integer $m\geq 3$. (Note that $\phi(1) = \phi(2) = 1$.)

    \item Check that $-3$ is primitive mod $11$ but $-3$ is not primitive mod $11^2$. Can you find some integer $a$ that is primitive mod $11^2$?


\end{enumerate}

\begin{center}
    \add{Lecture 9 Mon 09/23}

    \re{$\Phi_m(x)$}
\end{center}

\section{Cyclotomic polynomials and primes $\equiv 1\pmod{m}$}

Given our definition of the $m$-th cyclotomic polynomial $\Phi_m(x)$ as
$$\Phi_m(x) = \prod_{o(z) = m}(x - z) = \prod_{\substack{1\leq k\leq m\\ \gcd(k,m)=1}}(x - \zeta_m^k),$$
all we can say so far is that $$\Phi_m(x) = x^{\phi(m)} + \cdots.$$
In this section, we prove that $\Phi_m(x)$ is exactly what we need to prove the infinitude of primes $\equiv 1\pmod{m}$. Let us write down the first few $\Phi_m(x)$ to get a feel:
\begin{eqnarray*}
    \Phi_1(x) &=& x - 1\\
    \Phi_2(x) &=& x + 1\\
    \Phi_3(x) &=& (x - \zeta_3)(x - \zeta_3^2) = \frac{x^3 - 1}{x - 1} = x^2 + x + 1\\
    \Phi_4(x) &=& (x - i)(x + i) = x^2 + 1\\
    \Phi_5(x) &=& (x - \zeta_5)(x - \zeta_5^2)(x - \zeta_5^3)(x - \zeta_5^4) = \frac{x^5 - 1}{x - 1} = x^4 + x^3 + x^2 + x + 1\\
    \Phi_6(x) &=& (x - \zeta_6)(x - \zeta_6^5) =  x^2 - x + 1\\
    \Phi_7(x) &=& \frac{x^7 - 1}{x - 1} = x^6 + x^5 + x^4 + x^3 + x^2 + x + 1.
\end{eqnarray*}
We observe that if $q$ is a prime, then

\vspace{-15pt}$$\Phi_q(x) = \prod_{k=1}^{q-1}(x - \zeta_q^k) = \frac{\displaystyle\prod_{k=1}^q(x - \zeta_q^k)}{x - 1} = \frac{x^q - 1}{x - 1}.$$
Note that $\zeta_6^2 = \zeta_3$ and $\zeta_6^3 = \zeta_2 = -1$, we have
\begin{eqnarray*}
    x^6 - 1 &=& \add{(x - \zeta_6)}\qt{(x - \zeta_6^2)}\wow{(x - \zeta_6^3)}\qt{(x - \zeta_6^4)}\add{(x - \zeta_6^5)}(x - \zeta_6^6)\\
    &=& \add{(x - \zeta_6)(x - \zeta_6^5)}\qt{(x - \zeta_3)(x - \zeta_3^2)}\wow{(x + 1)}(x - 1)\\
    &=& \add{\Phi_6(x)}\, \qt{\Phi_3(x)}\, \wow{\Phi_2(x)} \,\Phi_1(x).
\end{eqnarray*}
This is not a coincidence!


\begin{proposition}\label{prop:xm1}
    Let $m\in\N$. We have the factorization $$x^m - 1 = \prod_{d\mid m}\Phi_d(x).$$
\end{proposition}

\begin{proof}
    By the definition of the cyclotomic polynomials, we have
    $$\prod_{d\mid m}\Phi_d(x) = \prod_{d\mid m}\prod_{o(z) = d}(x - z) = \prod_{o(z)\mid m}(x - z).$$
    On the other hand, if $z\in\C$ such that $o(z) \mid m$, then $z^m = (z^{o(z)})^{m/o(z)} = 1$; and if $z^m = 1$, then $o(z)\mid m$ (by writing $z = \zeta_m^k$ and using the above, or by using an argument similar to the proof of Proposition \ref{prop:lag}). In other words, the complex numbers with order dividing $m$ are exactly the roots of $x^m - 1$, which are all distinct. Hence we have
    $$x^m - 1 = \prod_{o(z) \mid m}(x - z) = \prod_{d\mid m}\Phi_d(x)$$
    as desired.
\end{proof}

\add{\noindent\textbf{Remark}: The same proof of HW 3 Q4b can be used to show that
$$\Phi_m(x) = \prod_{d\mid m}(x^{m/d} - 1)^{\mu(d)}$$
where $\mu$ is the Mobius function. This is the exactly the ``inclusion-exclusion'' defintion of $\Phi_m(x)$ at the end of Section 4.}

\begin{cor}\label{cor:sumphi}
    Let $m\in\N$. Then $\displaystyle m = \sum_{d\mid m}\phi(d).$
\end{cor}

\begin{proof}
    Take degrees, noting that $\deg(\Phi_d(x))$ is the number of $k = 1,2,\ldots,d$ such that $\gcd(k,d) = 1$ and so $\deg(\Phi_d(x)) = \phi(d)$.
\end{proof}

\begin{cor}
    Let $m\in\N$. Then $\Phi_m(x)$ is a polynomial with integer coefficients. Moreover, $\Phi_1(0) = -1$ and $\Phi_m(0) = 1$ for $m\geq 2$.
\end{cor}

\begin{proof}
    We prove by induction on $m$. We have $\Phi_1(x) = x - 1$. Suppose now $m\geq 2$. We know that
    $$x^m - 1 = \Phi_m(x)\cdot\Phi_1(x)\prod_{\substack{d\mid m\\ 1 <d < m}}\Phi_d(x) = \Phi_m(x)\cdot(x - 1)\prod_{\substack{d\mid m\\ 1 <d < m}}\Phi_d(x).$$
    By induction, each of the $\Phi_d(x)$ for $d<m$ is a monic polynomial with integer coefficient and so is their product. Therefore, so is the quotient of $x^m - 1$ by it by long division of polynomials. Also by induction, we have $\Phi_d(0) = 1$ for $1<d<m$. So setting $x = 0$ gives $\Phi_m(0) = 1$.
\end{proof}

\add{\noindent\textbf{Remark}: There is a more direct proof of $\Phi_m(0) = 1$ for $m>2$. Let $S$ be the set of integers $1\leq j < m/2$ that are coprime to $m$. Then the set of integers $m/2 < k \leq m$ coprime to $m$ are all of the form $m - j$ for some $j\in S$. If $m/2$ is an integer, then it is at least $2$ and divides $m$, so it is not coprime to $m$. Now
$$\Phi_m(0) = \prod_{j\in S}(-\zeta_m^j)(-\zeta_m^{m-j}) = 1.$$}



\begin{proposition}\label{prop:LTE2}
    Let $m\in\N$ and let $n>1$ be an integer coprime to $m$. Let $a\in\Z$ with $n\mid \Phi_m(a)$. Then $o_n(a) = m$.
\end{proposition}

\begin{proof}
    We write $x^m - 1$ as $F(x)\Phi_m(x)$ where $F(x)\in\Z[x]$ is the product of $\Phi_d(x)$ over all positive integers $d\mid m$ with $d<m$. Then $\Phi_m(a)\mid a^m - 1$ and we have $n\mid a^m - 1$. Hence $o_n(a)\mid m$.
    Suppose for a contradiction that $\ell:=o_n(a)<m$. Then we have $n\mid a^\ell - 1$.  Since $\ell\mid m$ and $\ell < m$, we know that any divisor of $\ell$ is a divisor of $m$ and is less than $m$. In other words, $$F(x) = \prod_{d\mid \ell}\Phi_d(x)\cdot\prod_{\substack{d\mid m\\ d<m \\ d\nmid\ell}}\Phi_d(x) = (x^\ell - 1)G(x)$$ for some $G(x)\in\Z[x]$. We thus have the factorization
    $$a^m - 1 = (a^\ell - 1)\Phi_m(a)G(a).$$
    Fix some prime $p$ dividing $n$, which exists since $n>1$. From $p\mid n$ and $n\mid \Phi_m(a)$, we have $p\mid\Phi_m(a)$ and so
    $$\nu_p(a^m - 1) = \nu_p(a^\ell - 1) + \nu_p(\Phi_m(a)) + \nu_p(G(a)) > \nu_p(a^\ell - 1).$$
    Since $\ell\mid m$, we write $m = \ell k$ for some positive integer $k$. Since $n$ and $m$ are coprime, we have $p\nmid k$. Hence by LTE (Lemma \ref{lem:LTEnmid}) and $p\mid a^\ell-1$, we have $\nu_p(a^m - 1) = \nu_p(a^\ell - 1)$. Contradiction.
\end{proof}


\begin{cor}
    Let $m\in\N$. Let $a\in\Z$. Let $p$ be any prime divisor of $\Phi_m(a)$. Then either $p\mid m$ or $p\equiv 1\pmod{m}$.
\end{cor}

\begin{proof}
    If $p\mid m$, then we are done. If $p\nmid m$, then $p$ is coprime to $m$ and so by Proposition \ref{prop:LTE2}, we have $o_p(a) = m$ which implies $m\mid p - 1$ by Proposition \ref{prop:lag} and so $p\equiv 1\pmod{m}$ .
\end{proof}

\begin{cor}
    Let $m\in\N$. Let $a\in\Z$. Let $p$ be any prime divisor of $\Phi_m(ma)$. Then $p\equiv 1\pmod{m}$.
\end{cor}

\begin{proof}
    Since the constant term of $\Phi_m(x)$ is $\pm1$, we see that $\gcd(m,\Phi_m(ma)) = 1$ and so $p\nmid m$.
\end{proof}



\begin{theorem}
    Let $m\in\N$. There are infinitely many primes $\equiv1\pmod{m}$.
\end{theorem}

\begin{proof}
    We may assume $m\geq 3$. Since $\Phi_m(x)$ is monic, we know that $\Phi_m(x)\rightarrow\infty$ as $x$ goes to infinity. In fact, it is quite easy to see that for $a\geq 3$, we have
    $$|\Phi_m(a)| = \prod_{\substack{1\leq k\leq m\\ \gcd(k,m) = 1}}|a - \zeta_m^k| \geq (a - 1)^{\phi(m)} \geq 4.$$
    Suppose for a contradiction that $p_1,\ldots,p_n$ are all the primes $\equiv 1\pmod{m}$. Let $$N = \Phi_m(mp_1\cdots p_n) = (mp_1\cdots p_n)(\in\Z) + 1\geq5.$$
    Let $p$ be a prime divisor of $N$. Then $p\nmid m$ since $\gcd(m,N) = 1$.  By Proposition \ref{prop:LTE2}, we then have $o_p(a) = m$ where $a = mp_1\cdots p_n$. By Proposition \ref{prop:lag}, this implies that $m\mid p - 1$ and so $p\equiv 1\pmod{m}$. Hence $p = p_i$ for some $i = 1,\ldots, n$. However, none of $p_1,\ldots,p_n$ divides $N$. Contradiction.
\end{proof}

\begin{center}
    \add{Lecture 10 Wed 09/25}

    \re{Into the great Pagoda}
\end{center}

\add{It makes one wonder for which coprime positive integers $a$ and $m$ does there exist a Euclid type proof for the infinitude of primes congruent to $a$ mod $m$. All of these proofs lead to the construction of an \wow{Euclidean polynomial} for $a$ mod $m$: a polynomial $h(x)$ with integer coefficients such that the prime divisors of $h(n)$ for integers $n$ (either belong to a fixed finite set, or) are $1$ mod $m$, or are $a$ mod $m$; and that infinitely many primes that are $a$ mod $m$ arise this way.

\begin{theorem}
    A Euclidean polynomial for $a$ mod $m$ exists if and only if $a^2\equiv 1\pmod{m}$.
\end{theorem}

Schur (1912) proved the backwards direction and Murty (1988) proved the forwards direction. For example, this implies that there are no Euclid type argument for the infinitude of primes of the form $5k+2$. }

Here are some Euclidean polynomials in small moduli:
\begin{enumerate}[(a)]
    \item Primes dividing $5(2n)^2 - 1$ are congruent to $1$ or $4$ mod $5$.
    \item Primes dividing $2n^2+1$ are congruent to $1$ or $3$ mod $8$.
    \item Primes dividing $2n^2-1$ are congruent to $1$ or $7$ mod $8$.
   % \item Odd primes dividing $n^2+4$ are congruent to $1$ or $5$ mod $8$.
    \item Primes dividing $(7n)^3 + (7n)^2 - 2(7n) - 1$ are congruent to $1$ or $6$ mod $7$.
    \item Primes dividing $(3n)^3 - 3(3n) - 1$ are congruent to $1$ or $8$ mod $9$.
\end{enumerate}
Statements (a) - (c) are results in Quadratic Reciprocity. Statement (d) and (e) use the theory of finite fields. \add{Schur's result uses the theory of field extensions and Galois theory.
Murty's result is about the splitting of primes and uses Chebotarev's density theorem, which is ironic because it is actually a generalization of Dirichlet's result on primes in arithmetic progression!}

Here is a preview of what quadratic reciprocity says. Let's consider statement (a). Let $p$ be an odd prime. Then statement (a) (ignoring the factor of $2$) says that
$$\exists n\in\Z, p\mid 5n^2 - 1 \quad\Longleftrightarrow\quad p\equiv 1,4\pmod{5}.$$
Now $$p\mid 5n^2 - 1 \quad\Longleftrightarrow\quad 5n^2\equiv 1\pmod{p} \quad\Longleftrightarrow\quad (5n)^2\equiv 5\pmod{p}.$$
In other words, $p$ is a prime divisor of $5n^2 - 1$ for some integer $n$ is equivalent to $5$ being a square mod $p$. On the other hands, the squares mod $5$ are exactly $0,1,4$ as $1^2\equiv 4^2\equiv 1$ and $2^2\equiv 3^2\equiv 4$. Since $5\nmid 5n^2 - 1$, we may ignore the case $p = 5$. Hence, we can rephrase the above as: if $p\neq 5$, then
$$5\mbox{ is a square mod }p\quad\Longleftrightarrow\quad p\mbox{ is a square mod }5.$$
Our next goal is to develop some abtract algebra in order to prove the infinitude of primes $\equiv -1\pmod{m}$ where $m = p^k$ is a power of a prime.

\subsection*{Exercises}
\begin{enumerate}[\thesection .1]
    \item Compute $\Phi_9(x)$ and find a polynomial $f(x)$ such that $x^3f(x + x^{-1}) = \Phi_9(x)$.
    \item Prove that for any $k\in\N$, we have $\Phi_{2^k}(x) = x^{2^{k-1}}+1$.
    \item Prove that for any $k\in\N$, we have $\Phi_{3^k}(x) = x^{2\cdot 3^{k-1}}+x^{3^{k-1}} + 1$.
    \item Prove that for any $h,k\in\N$, we have $\Phi_{2^h3^k}(x) = x^{2^h 3^{k-1}}-x^{2^{h-1}3^{k-1}} + 1$.
    \item Suppose $q\in\N$ such that $\Phi_q(x) = x^{2s} + cx^s + 1$ for some nonzero integer $c$, where $s = \phi(q)/2$. Prove that $c = \pm1$.
    \item Prove that if $p$ is a prime at least $5$, then there exists a polynomial $h(x)$ with integer coefficients such that $x^{2p} + x^p + 1 = (x^2 + x + 1)h(x).$
    \item The cyclotomic polynomials $\Phi_q(x)$ are all irreducible in the sense that they do not admit a factorization into a product of polynomials with integer coefficients with smaller degrees. You showed in HW 4 P1(d) that $\Phi_q(x)$ is reciprocal in the sense that $\Phi_q(x^{-1}) = x^{-\phi(q)}\Phi_q(x).$ Prove that if $\Phi_q(x)$ is a trinomial, that is of the form $x^{\phi(q)} + cx^s + 1$ for some nonzero integers $c,s$, then $q = 2^h3^k$ for some non-negative integer $h$ and positive integer $k$.
    \item Using the fact that primes dividing $2n^2 + 1$ are congruent to $1$ or $3$ mod $8$, prove that there are infinitely many primes of the form $8k+3$.
    \item Let $q > 3$ be a prime. Prove that there does not exist integers $x,y$ such that $x^{q-1} + \cdots + x + 1 = y^{q-2} - 1.$
\end{enumerate}



\section{Abstract Algebra}

We have seen so many beautiful results about the integers and if you think about it, everything really just boils down to addition and multiplication, and a notion of size. The sets $\Q$, $\R$, $\C$ or the sets of polynomials with coefficients in them also have addition and multiplication and a notion of size. Can we try defining primes and gcd and do all of the above? For example, what should a prime in $\R$ mean, what should a prime in $\R[x]$ mean?

The key in defining a prime is the notion of divisibility. We say $a\mid b$ in $\Z$ if $b = ka$ for some $k\in\Z$. The natural extension to $\R$ would be that $a\mid b$ in $\R$ if $b = ka$ for some $k\in\R$. This is a little silly because we can divide in $\R$ so if $a\neq 0$, then by taking $k = b/a$, we have $b = ka$. This is more meaningful in $\R[x]$ where we say $a\mid b$ in $\R[x]$ if $b = ka$ for some $k\in \R[x]$. Then we have non-divisions like $x+1 \nmid x^2 + 1$. Note that the definition of division only uses multiplication.

In abstract algebra, we step away from numbers and consider any set for which arithmetic operations like addition and multiplication can be defined.

\vspace{5pt}
\noindent\textbf{Definition}: A \wow{commutative ring} $R$ is a set equipped with two binary operations: $$(a,b)\mapsto a+b:R\times R\rightarrow R,\qquad (a,b)\mapsto ab:R\times R\rightarrow R,$$
one unary operation: $$a\mapsto -a: R\rightarrow R$$
and two nullary operations: $$0\in R,\qquad 1\in R,\qquad\mbox{with    }\quad0\neq 1$$
such that the usual laws of arithmetic hold:
\begin{enumerate}[(1)]
    \item (Commutative) $a + b = b + a$ and $ab = ba$;
    \item (Associative) $a + (b + c) = (a + b) + c$ and $a(bc) = (ab)c$;
    \item (Distributive) $a(b + c) = ab + ac$;
    \item (Additive identity) $a + 0 = a$ and $a + (-a) = 0$;
    \item (Multiplicative identity) $a\cdot 1 = a$.
\end{enumerate}

\noindent\textbf{Remark}: More generally, we do not assume multiplication to be commutative (for example matrix multiplication is not commutative) in which case we will add $(b+c)a = ba + ca$ to (3) and $1\cdot a = a$ to (5). All rings are assumed to be commutative in this class.

\vspace{5pt}
We do not assume that a multiplicative inverse $a^{-1}$ always exist. We say $a\mid b$ in $R$ if there exists $k\in R$ such that $b = ka$. If $a\mid 1$, that is if $ab = 1$ for some $b\in R$, then we say $a$ is a \wow{unit} and write $b = a^{-1}$. We define the \wow{group of units} as $$R^\times = \{a\in R\colon \exists b\in R, ab = 1\}.$$

The set $\Z$ of integers with the usual $0,1,+,\times,-$ is a commutative ring. An integer $a\in\Z$ is a unit if and only if $a\mid 1$ if and only if $a = \pm 1$. So $\Z^\times = \{1,-1\}$.

\v
The sets $\Q$, $\R$, $\C$ with the usual operations are all commutative rings. Every nonzero element is a unit. A commutative ring $R$ is \wow{field} if $R^\times = R \backslash \{0\}.$
    %\item If $R$ is a commutative ring, then the set $R[x]$ of polynomials with coefficients in $R$ is a commutative ring. When $R = \Z,\Q,\R,\C$, we know that $\deg(fg) = \deg(f)+\deg(g)$; so if $fg = 1$, then $\deg(f) = 0$ and $\deg(g) = 0$. So they are constants in $R$. Hence when $R = \Z,\Q,\R,\C$, $R[x]^\times = R^\times.$

    %In general, we can still define the degree $\deg(f)$ of a polynomial $f\in R[x]$ as the largest integer $n$ such that the coefficient of $x^n$ in $f$ is nonzero. An essential step in proving $\deg(fg) = \deg(f)\deg(g)$ requires knowing that if $a,b\neq0$, then $ab\neq 0$.
A commutative ring is an \wow{integral domain} if the product of two nonzero elements is nonzero. In other words, $a\neq 0\mbox{ and } b\neq 0\Rightarrow ab\neq 0$. Equivalently, $ab = 0\Rightarrow a = 0\mbox{ or }b = 0.$ The ring $\Z$ of integers is an integral domain that is not a field. The rings $\Q,\R,\C$ are both integral domains and fields.

    %\begin{lemma}\label{lem:degfg}
    %    If $R$ is an integral domain, then $R[x]$ is also an integral domain and $R[x]^\times = R^\times$. Moreover, for any $f,g\in R[x]$ that are nonzero, $\deg(fg) = \deg(f) + \deg(g)$.
   % \end{lemma}

    \begin{lemma}\label{lem:fieldid}
        Let $R$ be a commutative ring.
        \begin{enumerate}[(a)]
            \item For any $a\in R$, we have $a\cdot 0 = 0$, $a\cdot(-1) = -a$ and $-(-a) = a$. In particular, $0\notin R^\times$.
            \item If $a,b\in R^\times$, then $ab\in R^\times$ and $a^{-1}\in R^\times$.
            \item If $R$ is a field, then $R$ is an integral domain.
        \end{enumerate}
    \end{lemma}

    \begin{proof}
        \add{Let $a\in R$ be arbitrary. Then $a\cdot0 + a\cdot 1 = a\cdot(0 + 1) = a\cdot 1.$ Then
        \begin{eqnarray*}
            a\cdot 0 &=& a\cdot0 + (a\cdot1 + (-(a\cdot1)))\\
            &=&(a\cdot 0 + a\cdot 1) + (-(a\cdot1))\\
            &=&a\cdot1 + (-(a\cdot1))\\
            &=&0.
        \end{eqnarray*}
        From $a\cdot(-1) + a\cdot 1 = a\cdot(-1 + 1) = a\cdot 0 = 0$, we get $a\cdot(-1) = -(a\cdot 1) = -a$ by adding $-(a\cdot 1)$ to both sides. Finally, from $a + (-a) = 0$, we add $-(-a)$ to both sides to get $a = -(-a)$.} Note that $0$ is never a unit because for any $b\in R$, $0\cdot b = 0\neq 1$.

        Suppose now $a,b$ are units. Then $ab(b^{-1}a^{-1}) = a(bb^{-1})a^{-1} = aa^{-1} = 1$. Hence $ab$ is a unit. From $aa^{-1}=1$, we also see that $a^{-1}\in R^\times$ and $(a^{-1})^{-1} = a$. Suppose now $R$ is a field. Then the product of two nonzero elements (which are automatically units) is a unit, which is never $0$. Hence, $R$ is an integral domain.
    \end{proof}

\v
To give an example of a ring that is not an integral domain, we consider $$R = \Z\times\Z = \{(a,b)\colon a,b\in\Z\}.$$
We take $(0,0)$ to be $0_R$ and $(1,1)$ to be $1_R$. We define addition and multiplication coordinate-wise:
$$(a,b) + (c,d) = (a + c, b + d)\aa (a,b)\cdot(c,d) = (ac, bd).$$
Then negation is given by $-(a,b) = (-a, -b)$. We note that $R$ is not an integral domain because
$$(1,0)\cdot(0,1) = (0,0).$$
In general, if $R_1$ and $R_2$ are two rings, we can define a ring structure on the Cartesian product $$R_1\times R_2 = \{(a,b)\colon a\in R_1,b\in R_2\}$$ exactly as above. It will not be an integral domain.



It is possible to define a ring structure on $\Z\times\Z$ that makes it an integral domain. We write $S = \Z\times\Z$ and define
\begin{eqnarray*}
    0_S &=& (0,0)\\
    1_S &=& (1,0)\\
    (a,b) + (c,d) &=& (a + c, b + d)\\
    (a,b)\cdot(c,d) &=& (ac - bd, ad + bc)\\
    -(a,b) &=&(-a, -b).
\end{eqnarray*}
One can check that all the ring axioms are satisfied. For example
$$(a,b)\cdot(1,0) = (a\cdot1 - b\cdot 0, a\cdot0+b\cdot1) = (a,b).$$
In particular, we see that $(1,0)\cdot(0,1) = (0,1)\neq(0,0).$ Let's prove that $S$ is an integral domain. Suppose $(a,b)\cdot(c,d) = 0$ and both $(a,b)$ and $(c,d)$ are nonzero. Then
\begin{eqnarray*}
    ac - bd &=& 0,\\
    ad + bc &=& 0.
\end{eqnarray*}
Multiply the first equation by $c$ and the second by $d$ and add them: $a(c^2 + d^2) = 0$. Since $c$ and $d$ are integers not both $0$, we have $c^2 + d^2\neq 0$. So $a = 0$. Then from $bc = bd = 0$, we get $b = 0$. This contradicts the assumption that $(a,b)\neq (0,0)$.

   \begin{center}
    \add{Lecture 11 Fri 09/27}

    \re{Homomorphism, characteristic}
    \end{center}

\qt{What really is happening in this example?} We write suggestively $i_S = (0,1)$. Note that $$i_S^2 = (0,1)\cdot(0,1) = (0\cdot0-1\cdot1,0\cdot1 + 1\cdot0) = (-1,0) = -1_S.$$
Moreover, for any positive integer $n$ and (more generally) any element $r$ of a ring $R$, we write $nr$ for the sum of $n$ $r$'s and $(-n)r$ for the sum of $n$ $-r$'s. In this example, we have $n(a,b) = (na, nb)$ so every element $(a,b)\in S$ can be expressed as
$$(a,b) = a(1,0) + b(0,1) = a1_S + bi_S.$$
Then by distributivity, we can compute multiplication as
$$(a,b)\cdot(c,d) = (a1_S + bi_S)(c1_S + di_S) = ac 1_S + bci_S + adi_S + bdi_S^2 = (ac - bd)1_S + (ad + bc)i_S.$$
This looks like the multiplication of complex numbers! In fact, we can define a map $f:S\rightarrow\C$ by $f(a,b) = a + bi$. Then we have
\begin{eqnarray*}
    f(0_S) &=& 0\\
    f(1_S) &=& 1\\
    f(i_S) &=& i\\
    f((a,b)\cdot(c,d)) &=& f(a,b)f(c,d)\\
    f((a,b) + (c,d)) &=& f(a,b) + f(c,d).
\end{eqnarray*}
In general, a \wow{ring homomorphism} is a map $f:R_1\rightarrow R_2$ between two rings $R_1,R_2$ such that for any $a,b\in R_1$, $$f(a+b) = f(a) + f(b),\qquad f(ab) = f(a)f(b),\qquad f(1) = 1.$$
Take $a = b = 0$, we get $f(0) = f(0) + f(0)$ and so $f(0) = 0$. Then take $b = -a$ to get $f(-a) = -f(a)$. The assumption $f(1) = 1$ is required to rule-out the $0$ map. In other words, a ring homomorphism respects all the ring operations on $R_1$ and $R_2$.

The natural inclusions $\Z\rightarrow\Q\rightarrow\R\rightarrow\C$ are all ring homomorphisms. They are all injective. \qt{Is the map $f:\C\rightarrow\R$ taking a complex number $a + bi$ to its real part $a$ a ring homomorphism?} \spp{No, because it doesn't behave well with multiplication. For example, $f(i) = 0$ but $f(i\cdot i) = f(-1) = -1\neq f(i)\cdot f(i)$.} \wow{Does there exist any ring homomorphism $\C\rightarrow\R$?} \spp{Suppose there is a ring homomorphism $g:\C\rightarrow\R$. Then from $g(1) = 1$, we see that $g(-1) = -1$. So $g(i)^2 = g(i^2) = g(-1) = -1$ but there isn't any real number that square to $-1$.}

A ring homomorphism $f:R_1\rightarrow R_2$ is \wow{injective} if whenever $f(a) = f(b)$, we have $a = b$. Since $f$ is a homomorphism, we note that $f(a) = f(b)$ if and only if $f(a - b) = f(a) - f(b) = 0$; and clearly $a = b$ if and only if $a - b = 0$. We define the \wow{kernel} of $f$ as
$$\ker(f) = \{r\in R_1\colon f(r) = 0\}.$$
Then we see that $f$ is injective if and only if $\ker(f) = \{0\}.$ The natural inclusions above are all injective, so is the map $S\rightarrow\C$ above.

A ring homomorphism $f:R_1\rightarrow R_2$ is \wow{surjective} if for every $s\in R_2$, there exists $r\in R_1$ such that $s = f(r)$. We define the \wow{image} of $f$ as
$$\mathrm{im}(f) = \{f(r)\colon r\in R_1\}.$$
Then $f$ is surjective if and only if $\mathrm{im}(f) = R_2$. In the $f:S\rightarrow \C$ example above, we see that
$$\mathrm{im}(f) = \{a + bi\colon a,b\in\Z\} = \Z[i],$$
also known as the ring of \wow{Gaussian integers}.

A ring homomorphism $f:R_1\rightarrow R_2$ is \wow{bijective} if it is both injective and surjective. In this case, we can define its inverse $f^{-1}:R_2\rightarrow R_1$ where $f^{-1}(s)$ is the unique $r\in R_1$ such that $f(r) = s$. Then $f^{-1}$ is also bijective. We call a bijective ring homomorphism an \wow{isomorphism} and say $R_1$ and $R_2$ are isomorphic if there is an isomorphism $R_1\rightarrow R_2$, and we write $R_1\cong R_2$.

\begin{lemma}
    Let $R_1$, $R_2$, $R_3$ be commutative rings.
    \begin{enumerate}[(a)]
        \item The projection map $R_1\times R_2\rightarrow R_1$ sending $(a,b)$ to $a$ is a ring homomorphism. Similarly for the projection map $R_1\times R_2\rightarrow R_2$ sending $(a,b)$ to $b$.
        \item If $f:R_1\rightarrow R_2$ and $g:R_2\rightarrow R_3$ are ring homomorphisms, then $g\circ f:R_1\rightarrow R_3$ is a ring homomorphism.
        \item If $f:R_1\rightarrow R_2$ is an isomorphism, then $f^{-1}:R_2\rightarrow R_1$ is also an isomorphism.
    \end{enumerate}
\end{lemma}

\add{\begin{proof}
    Just check definitions. Write $\pi_1(a,b) = a$. Then $\pi_1(1,1) = 1$ and
    $$\pi_1((a,b) + (c,d)) = \pi_1(a + c, b + d) = a + c = \pi_1(a,b) + \pi_1(c,d)$$
    and
    $$\pi_1((a,b)\cdot(c,d)) = \pi_1(ac, bd) = ac = \pi_1(a,b)\pi_1(c,d).$$
    Similarly for $\pi_2(a,b) = b$.

    For (b), we use the subscript $1,2,3$ to denote the operations in $R_1,R_2,R_3$. Then $g\circ f(1_1) = g(1_2) = 1_3$. For $a,b\in R_1$, we have
    $$g\circ f(a +_1 b) = g(f(a) +_2 f(b)) = g(f(a)) +_3 g(f(b))$$
    and
    $$g\circ f(a \times_1 b) = g(f(a) \times_2 f(b)) = g(f(a)) \times_3 g(f(b)).$$
    Hence $g\circ f$ is a ring homomorphism.

    For (c), we just need to check that $f^{-1}$ is a ring homomorphism. Since $f(1_1) = 1_2$, we have $f^{-1}(1_2) = 1_1$. For $a,b\in R_2$, since $f$ is bijective, let $c,d\in R_1$ such that $f(c) = a$ and $f(d) = b$. Then from $f(c + d) = f(c) + f(d) = a + b$, we see that $f^{-1}(a + b) = c + d = f^{-1}(a) + f^{-1}(b)$, and similarly for multiplication.
\end{proof}}

Recalling the notation $nr$ where $n\in\Z$ and $r\in R$ earlier, we actually used the following implicitly.

\begin{lemma}\label{lem:nr}
    Let $R$ be a commutative ring. Let $n,m\in\Z$ and $r,s\in R$. Then
    \begin{enumerate}[(a)]
        \item $nr + mr = (n + m)r$;
        \item $(nr)(ms) = (nm)(rs)$;
        \item If $f:R\rightarrow S$ is a ring homomorphism, then $f(nr) = nf(r).$
    \end{enumerate}
\end{lemma}

\begin{proof}  Exercise.
\end{proof}

\begin{lemma}\label{lem:can}
        Let $R$ be a commutative ring. There is a unique ring homomorphism $f:\Z\rightarrow R$ (called the canonical
        homomorphism).
\end{lemma}

\begin{proof}
    Any ring homomorphism $f:\Z\rightarrow R$ must send the integer $1$ to the element $1_R$. Hence for any $n\in\Z$, we must have $f(n) = f(n\cdot 1) = nf(1) = n\cdot 1_R$ by Lemma \ref{lem:nr}(c), which proves uniqueness. Conversely, Lemma \ref{lem:nr}(a,b) imply that the map $f(n) = n\cdot 1_R$ is a ring homomorphism.
\end{proof}

    If this map $f$ is injective, then we say that the \wow{characteristic} of $R$ is $0$. In all the examples ($\Z,\Q,\R,\C,\Z\times\Z,\Z[i]$) we saw, the characteristic is $0$. If $f$ is not injective, then there is some nonzero integer $a$ such that $f(a) = 0$. Now $f(-a) = -f(a) = 0$, so we may assume $a$ is positive. The smallest positive integer $d$ such that $f(d) = 0$ is the \wow{characteristic} of $R$.

\begin{center}
    \add{Lecture 11.5 (Tutorial) Fri 09/27}

    \re{What are real numbers?}
\end{center}

Have you ever lay awake at night and wondered what really are real numbers and how does arithmetic work with them? For example, we learned in grade school that to add two numbers like 69 and 420, we start from the last digit and work backwards. However, what about irrational numbers like $\pi$ and $e$? They don't have a ``last digit''.

$$\begin{array}{c}
      \phantom{+9999}69\\
      +\phantom{999} 420\\
    \hline %or \bottomrule if using the `booktabs` package
     \phantom{+999}489
    \end{array}\hspace{50pt}
    \begin{array}{c}
      \phantom{+999}    3.1415926535897932384626433832795\ldots\\
      +\phantom{999}   2.7182818284590452353602874713527\ldots\\
    \hline %or \bottomrule if using the `booktabs` package
      \\
    \end{array}$$
If we start adding from the first digits, how do we know we won't run into a sequence of $9$'s and then have to carry a $1$ at some point? In this tutorial, I will define real numbers properly and prove that they form a field!

We start with the notion of \wow{equivalence relations}. We have already seen this in the first tutorial. Let $S$ be a set and we say a relation $\sim$ between elements of $S$ is an equivalence relation if for every $a,b,c\in S$:
\begin{itemize}
    \item (Reflexive) $a\sim a$
    \item (Symmetric) if $a\sim b$, then $b\sim a$
    \item (Transitive) if $a\sim b$ and $b\sim c$, then $a\sim c$.
\end{itemize}
For example, equality, congruence mod $m$, \add{ring isomorphisms for some fixed set of rings} are all equivalence relations. Given an equivalence relation, there is a well-defined notion of equivalence classes. For any $a\in S$, we define the \wow{equivalence class containing $a$} as $$[a] = \{b\in S\colon a\sim b\}.$$
For example, for equality, we have $[a] = \{a\}$; for congruence mod $m$, we have
$$[a] = \{b\in\Z\colon a\equiv b\pmod{m}\} = \{a + md\colon d\in\Z\}.$$
Note that a more precise definition of $\Z/m\Z$ is the set $\{[0],[1],\ldots,[m-1]\}$ with $$[a] + [b] = [a + b]\aa [a]\cdot[b] = [ab].$$
Note that $a\in[a]$ since $a\sim a$. If $b\in [a]\cap[c]$, then $b\sim a$ and $b\sim c$, which implies that $a\sim c$. Then for any $d\in S$, we have $d\sim a$ if and only if $d\sim c$. So $[a]=[c]$. In other words, \wow{equivalence classes are either equal or disjoint}.

Next we recall the definition of a \wow{Cauchy sequence} from MATH 147. A Cauchy sequence $(x_n)_n$ in $\Q$ is a sequence where $x_n\in\Q$ and for every $\epsilon > 0$, there is some $N\in\N$ such that whenever $n,m>N$, we have $|x_n - x_m| < \epsilon$. For example, we can take $x_n$ to be the first $n$ digits in the decimal expansion of $\pi$:
$$x_1 = 3.1,\qquad x_2 = 3.14,\qquad x_3 = 3.141,\qquad x_4 = 3.1415, \mbox{ etc}.$$ We can also take the constant sequence $x_n = a$ where $a\in\Q$. The sequence $x_n = (-1)^n$ is not Cauchy because $|x_n - x_{n+1}| = 2$ cannot be made arbitrarily small. The key idea is that we want the \wow{real numbers to arise as limits of Cauchy sequences in $\Q$} without even knowing what the limits are! Different Cauchy sequences can have the same ``limits''. For example, the constant sequence $x_n = 1$ and the sequence $y_n = 0.99\cdots9$ with $n$ 9's both ``converge'' to $1$. We don't want them to define different real numbers.

We define a relation on the set of Cauchy sequences in $\Q$. We say $$(x_n)_n\sim(y_n)_n\qquad\Longleftrightarrow\qquad\lim_{n\rightarrow\infty} (x_n - y_n) = 0.$$
That is, for every $\epsilon > 0$, there exists $N\in\N$ such that for $n> N$, we have $|x_n - y_n| < \epsilon.$ It is easy to check that $\sim$ is an equivalence relation.
\begin{itemize}
    \item (Reflexive) $\lim\, (x_n - x_n) = 0$.
    \item (Symmetric) if $\lim\, (x_n - y_n) = 0$, then $\lim\, (y_n - x_n) = 0$.
    \item (Transitive) if $\lim\, (x_n - y_n) = 0$ and $\lim\, (y_n - z_n) = 0$, then $\lim\, (x_n - z_n) = 0$.
\end{itemize}
We define $\R$ as the set of equivalence classes of Cauchy sequences in $\Q$. For every $a\in\Q$, the equivalence class of the constant sequence $(a,a,\ldots)$ is the real number $a$. \qt{Which real number corresponds to the equivalence class of the sequence $x_n = 1/n$?} In this case, $\lim x_n = 0$, so it is equivalent to the constant sequence $(0,0,\ldots)$. Hence it is the real number $0$. We now define the ring operations.

\begin{lemma}
    If $(x_n)_n$ and $(y_n)_n$ are two Cauchy sequences, then $(x_n + y_n)_n$ and $(x_ny_n)_n$ are both Cauchy sequences. Moreover, $|x_n|$ is bounded. If $\displaystyle\lim_{n\rightarrow\infty}|x_n|\neq 0$, then $(x_n^{-1})_n$ is a Cauchy sequence.
\end{lemma}

\add{\begin{proof}
    This is a MATH 147 exercise/homework/result.
\end{proof}}

We define addition and multiplication on $\R$ via
$$[(x_n)_n] + [(y_n)_n] = [(x_n + y_n)_n]\aa[(x_n)_n] \cdot [(y_n)_n] = [(x_ny_n)_n]$$
and the additive and multiplicative inverses by
$$-[(x_n)_n] = [(-x_n)_n]\aa[(x_n)_n]^{-1} = [(x_n^{-1})_n].$$
When defining operations on equivalence classes, we need to prove that it is independent on the choices of the representatives. For example, we need to prove that if $(x_n)_n\sim(z_n)_n$ and $(y_n)_n\sim(w_n)_n$, then $(x_ny_n)_n\sim(z_nw_n)_n$ and $(x_n + y_n)_n\sim (z_n + w_n)_n$. The proof is essentially the same as when we proved that modular arithmetic is well-defined. Suppose $\lim x_n -z_n = 0$ and $\lim y_n-w_n = 0$. Then
$$(x_n + y_n) - (z_n + w_n) = (x_n - z_n) + (y_n - w_n) \rightarrow 0$$
and
$$x_ny_n - z_nw_n = x_n(y_n - w_n) + (x_n - z_n)w_n\rightarrow0.$$

\noindent\textbf{Remark 1:} In terms of abstract algebra, we have a ring $S$ and an equivalence relation $\sim$ and we want to define a ring structure on the set $S/\!\!\sim$ of equivalence classes using the ring structure of $S$. What extra condition do we need on $\sim$? Let $$I = \{a\in S\colon a\sim 0\}.$$
Then we see that we need:
\begin{itemize}
    \item $0\in I$;
    \item if $a,b\in I$, then $a + b\in I$;
    \item if $a\in I$ and $r\in S$, then $ra\in I$.
\end{itemize}
These are in fact \wow{ideals}. We will come back to this next week.

\v
\noindent\textbf{Remark 2:} In terms of analysis, we are taking the space $\Q$ and the absolute value $|.|$ and ``completed'' it by adding in limits of sequences that should converge. This process is called \wow{completion}. There are other interesting absolute values however! For any prime $p$, we can define the $p$-adic absolute value of a rational number by
$$|r|_p = p^{-\nu_p(r)}.$$
When we complete $\Q$ with respect to the $p$-adic absolute value, we get the field $\Q_p$ of $p$-adic numbers.

\v
\alert{I won't ask you questions about Cauchy sequences and you can pretend that real numbers are what you thought they were! We will be using the idea of equivalence relations and equivalence classes.}



\begin{center}
    \add{Lecture 12 Mon 09/30}

    \re{$\Z/m\Z$ part 1}
\end{center}

    For any integer $m\geq2$, there is a ring of characteristic $m$. Namely, $\Z/m\Z = \{0,1,\ldots,m-1\}$. We define $0 = 0$ and $1 = 1$. We define addition and multiplication by the usual addition and multiplication and then applying the division algorithm to find the remainder by $m$. For example, in $\Z/69\Z$, we have $25\times 4 = \spp{100} = 31.$ Note also that $23\times 3 = 0$ in $\Z/69\Z$ but $23$ and $3$ are nonzero.

    \begin{lemma}\label{lem:charid}
        If $R$ is an integral domain, then its characteristic is either $0$ or a prime.
    \end{lemma}

    \begin{proof}
        Suppose the characteristic $d$ of $R$ is positive. Let $q$ be a positive divisor of $d$ so $d = qk$ for some $k\in\N$.  Then $f(q)f(k) = f(d) = 0$ where $f:\Z\rightarrow R$ is the canonical homomorphism. Since $R$ is an integral domain, either $f(q) = 0$ or $f(k) = 0$. Note that $q\leq d$ and $k\leq d$. Hence by minimality of $d$, we have $q = d$ in the first case, and $k = d$ so $q = 1$ in the second case. Hence we have shown that the only positive divisors of $d$ are $1$ and $d$. In other words, $d$ is a prime.
    \end{proof}

    The converse is certainly not true because $\Z\times\Z$ is a ring of characteristic $0$ but is not an integral domain, and $\Z/p\Z\times\Z/p\Z$ is a ring of characteristic $p$ but is not an integral domain.



We play more with the ring $\Z/m\Z$ and recover some of the results in congruence arithmetic.

\v\noindent\wow{Question 1: What are the units of $\Z/m\Z$?}

\v
Let's consider $\Z/69\Z$. \qt{Is $1$ a unit?} \spp{Yes, the element $1$ in a ring is always a unit.} \qt{Is $2$ a unit? Can we find some $x\in\{0,1,\ldots,68\}$ such that the remainder when $2b$ is divided by $69$ is $1$?} This is like solving the congruence equation $$2x\equiv 1\pmod{69}.$$
By observation, we see that $x = 35$ works. So $2^{-1} = 35$. \qt{What about $3$? Can we solve $3x\equiv 1\pmod{69}$?} That is, we want $69\mid 3x - 1$. So $3x - 1 = 69y$ for some integer $y$. Rearranging gives $3x - 69y = 1$. However, $\gcd(3,69) = 3$ divides every integer of the form $3x - 69y$, so it can't ever be $1$. Hence $3$ is not a unit in $\Z/69\Z$. In general, in order for $a$ to be a unit in $\Z/69\Z$, we need there to exist integers $x$ and $y$ such that $$ax - 69y = 1.$$
We know this is possible if and only if $\gcd(a, 69) = 1$. Hence
$$(\Z/69\Z)^\times = \{a = 0,1,\ldots,68\colon \gcd(a,69) = 1\}.$$
Replacing $69$ by $m$ gives:

\begin{lemma}
    For an integer $m\geq2$, we have $(\Z/m\Z)^\times = \{a = 0,1,\ldots,m-1\colon \gcd(a,m) = 1\}.$ Its size is $\phi(m)$.
\end{lemma}

\begin{cor}
    For an integer $m\geq 2$, $\Z/m\Z$ is a field if and only if $m$ is a prime $p$. We also denote $\Z/p\Z$ by $\F_p$.
\end{cor}

\begin{proof}
    By definition, $\Z/m\Z$ is a field if and only if every nonzero element is a unit if and only if $\gcd(a,m) = 1$ for every $a = 1,2,\ldots,m-1$ if and only if $m$ is a prime.
\end{proof}

\noindent\wow{Question 2: When does there exist a ring homomorphism $\Z/m\Z\rightarrow\Z/n\Z$?}

\v
\qt{Is there a ring homomorphism $f:\Z/69\Z\rightarrow\Z/2\Z$?} It should send $1$ to $1$; then $2=1+1$ to $1+1 = 0$ in $\Z/2\Z$; then $3 = 1 + 1 + 1$ to $1 + 1 + 1 = 1$ in $\Z/2\Z$. Continue on, we see that it should send every even number to $0$ and every odd number to $1$. Now $f(68) = 0$ and $f(1) = 1$. In $\Z/69\Z$, we have $68 + 1 = 0$, but $$f(68) + f(1) = 0 + 1 = 1\neq f(0) = f(68 + 1).$$
Hence there is no ring homomorphism $\Z/69\Z\rightarrow\Z/2\Z$. \qt{What about $\Z/69\Z\rightarrow\Z/3\Z$?} Simply taking the remainder by $3$ gives a map $g:\Z/69\Z\rightarrow\Z/3\Z$. To check that it is a ring homomorphism, we take $a,b\in\{0,1,\ldots,68\}$. We write $a + b = 69q + r$ with remainder $r\in\{0,1,\ldots,68\}$. Then $a + b = r$ in $\Z/69\Z$. Now
$$a\equiv g(a)\pmod{3},\qquad b\equiv g(b)\pmod{3},\qquad r\equiv g(r)\pmod{3}.$$
From $a + b = 69q + r$, we have
$$a + b\equiv r\pmod{3}\qquad\mbox{and so}\qquad g(a) + g(b)\equiv g(r)\pmod{3}.$$
The formula $g(a)g(b)\equiv g(ab)\pmod{3}$ can be checked in the same way. \wow{The key here is that $3\mid 69$.}

\begin{lemma}\label{lem:chardiv}
    Let $R$ be a commutative ring of characteristic $d > 0$. Let $f:\Z\rightarrow R$ be the canonical homomorphism. Then $f(n) = 0$ if and only if $d\mid n$.
\end{lemma}

\begin{proof}
    If $d\mid n$, then $n = dk$ for some integer $k$ and we have $f(n) = f(d)f(k) = 0$. Suppose conversely that $f(n) = 0$. Applying the division algorithm to $n$ divided by $d$ gives $n = dq + r$ for some integers $q,r$ with $0\leq r < d$. Then $f(r) = f(n) - f(d)f(q) = 0$. Since $d$ is the smallest positive integer such that $f(d) = 0$ and $r < d$, we see that $r$ can't be positive and so $r = 0$, implying that $d\mid n$.
\end{proof}

\begin{cor}
    For integers $m,n\geq 2$, there exists a ring homomorphism $\Z/m\Z\rightarrow\Z/n\Z$ if and only if $n\mid m$.
\end{cor}

\begin{proof}
    Suppose a ring homomorphism $\Z/m\Z\rightarrow\Z/n\Z$ exists. Consider the composition $$h:\Z\rightarrow\Z/m\Z\rightarrow\Z/n\Z.$$
    By uniqueness, $h$ is the canonical homomorphism $\Z\rightarrow\Z/n\Z$. Note that $h(m) = 0$ since $m$ goes $0$ in $\Z/m\Z$. Hence by Lemma \ref{lem:chardiv}, we have $n\mid m$ since $\Z/n\Z$ has characteristic $n$.

    The converse direction where $n\mid m$ follows exactly as the example of $3\mid 69$ above.
\end{proof}

\begin{center}
    \add{Lecture 13 Wed 10/02}

    \re{$\Z/m\Z$ part 2}
\end{center}

\noindent\wow{Question 3: What does the Chinese Remainder Theorem say?}

\begin{theorem}\label{thm:CRTcong}
    (Chinese Remainder Theorem) Let $m$ and $n$ be coprime integers. Let $a$ and $b$ be integers. Then there exist a unique integer $x = 0,1,\ldots,mn-1$ such that
    $$\begin{cases}
        x\equiv a\pmod{m}\\
        x\equiv b\pmod{n}
    \end{cases}$$
\end{theorem}

\begin{proof}
    \wow{Exercise/Look it up!} A more general version of this will be discussed later.
\end{proof}

Since $m\mid mn$ and $n\mid mn$, we have a ring homomorphism
\begin{eqnarray*}
    \Z/mn\Z &\rightarrow& \Z/m\Z\times\Z/n\Z\\
    x &\mapsto& (x\mbox{ mod }m, x\mbox{ mod }n).
\end{eqnarray*}
Then the Chinese Remainder Theorem is really saying that this ring homomorphism is bijective: injective (different elements map to different things) and surjective (the image is everything). An \wow{isomorphism} is a ring homomorphism that is bijective. We say two rings $R_1$ and $R_2$ are \wow{isomorphic} if there is an isomorphism between them and we write \wow{$R_1\cong R_2$}. In this case, we have
$$\Z/mn\Z\cong\Z/m\Z\times\Z/n\Z.$$
We can continue breaking off coprime factors. More generally, let $$m = p_1^{k_1}\cdots p_r^{k_r}$$ be the prime factorization of $m$, then
we have
\begin{eqnarray*}
    \Z/m\Z &\cong& \Z/p_1^{k_1}\Z\times\cdots\times\Z/p_r^{k_r}\Z\\
    \Big(\Z/m\Z\Big)^\times &\cong& \Big(\Z/p_1^{k_1}\Z\Big)^\times\times\cdots\times\Big(\Z/p_r^{k_r}\Z\Big)^\times
\end{eqnarray*}



\begin{cor}
    Let $m\in\N$ with prime factorization $p_1^{k_1}\cdots p_r^{k_r}$. Then $$\displaystyle\phi(m) = \prod_{i=1}^r\left(p_i^{k_i}-p_i^{k_i-1}\right)=m\prod_{p\mid m}\left(1-\frac{1}{p}\right).$$
\end{cor}

\begin{proof}
    We have $\phi(m) = \prod_{i=1}^r \phi(p_i^{k_i}).$ It is easy to see that for any prime $p$ and positive integer $k$, $\phi(p^k) = p^k - p^{k-1}$ since there are $p^{k-1}$ numbers in $0,1,2,\ldots,p^k-1$ that are divisible by $p$.
\end{proof}



\noindent\wow{Question 4: What about Fermat's little Theorem?}

\v
\begin{lemma}\label{lem:perm}
        Let $R$ be a commutative ring. Let $a\in R$.
        \begin{enumerate}[(a)]
            \item The map $x\mapsto x + a$ defines a bijection $R\rightarrow R$.
            \item The map $x\mapsto xa$ is a bijection $R\rightarrow R$ if and only if $a\in R^\times$.
        \end{enumerate}
    \end{lemma}

    \begin{proof}
        The map $x\mapsto x + (-a)$ is the inverse of $x\mapsto x+a$. If $a\in R^\times$, then $x\mapsto xa^{-1}$ is the inverse of $x\mapsto xa$. Conversely, if $x\mapsto xa$ is surjective, then $ba = 1$ for some $b\in R$ and so $a\in R^\times$.
    \end{proof}

    \begin{cor}
        Let $R$ be an integral domain. Suppose $R$ is finite. Then $R$ is a field.
    \end{cor}

    \begin{proof}
        Let $a$ be a nonzero element. Then for any $x\neq y$, we have $x - y\neq 0$ and so $(x - y)a\neq 0$, implying that $xa\neq ya$. So the map $x\mapsto xa:R\rightarrow R$ is injective. An injective map between two finite sets of the same size is surjective (by the Pigeonhole principle) and so bijective. Hence $a$ is a unit.
    \end{proof}

    For a finite ring $R$, we define its \wow{order} $|R|$ to be the number of elements of $R$.

    \begin{theorem}\label{thm:69}
        Let $R$ be a finite commutative ring. Let $a\in R$.
        \begin{enumerate}[(a)]
            \item Then $|R|\cdot a = 0.$ In particular, the characteristic of $R$ divides $|R|$.
            \item If $a\in R^\times$, then $a^{|R^\times|} = 1.$
        \end{enumerate}
    \end{theorem}

    \begin{proof}
        Let $n = |R|$ and let $r_1,\ldots,r_n$ denote all the elements of $R$. Then $r_1 + a, r_2 + a,\ldots, r_n + a$ is a permutation of $r_1,r_2,\ldots,r_n$ since $x\mapsto x+a$ is a bijection. Hence
        $$(r_1 + a) + \cdots + (r_n + a) = r_1 + \cdots + r_n.$$
        Cancelling the $r_1 + \cdots + r_n$ from both sides gives $na = 0$. Applying this to $a = 1_R$ gives $f(n) = 0$ where $f:\Z\rightarrow R$ is the canonical homomorphism. We then have the characteristic of $R$ dividing $n$ by Lemma \ref{lem:chardiv}.

        Statement (b) follows by essentially the same argument. Let $t = |R^\times|$ and let $s_1,\ldots, s_t$ denote all the elements of $R^\times$. Suppose $a\in R^\times$. By Lemma \ref{lem:fieldid}, we know that each $as_1,\ldots,as_t$ is a unit and by Lemma \ref{lem:perm}, we know they are all distinct, and so they are a permutation of $s_1,\ldots,s_t$. We now multiply them to get
        $$a^ts_1\cdots s_t = s_1\cdots s_t.$$
        Cancelling the $s_1\cdots s_t$ from both sides by multiplying by $s_t^{-1}\cdots s_1^{-1}$ gives $a^t = 1$.
    \end{proof}

\begin{cor}
    (Euler's Theorem, Fermat's little Theorem) Let $m\in\N$. Let $a$ be an integer coprime to $m$. Then $a^{\phi(m)}\equiv 1\pmod{m}$. If $m = p$ is a prime and $p\nmid a$, then $a^{p-1}\equiv 1\pmod{p}$.
\end{cor}

\add{We write $o_+(a)$, the additive order of $a$ in $R$, for the smallest positive integer $d$ such that $da = 0$. Then by a standard division algorithm argument (see for example the proof of Proposition \ref{prop:lag}), we have $o_+(a)\mid |R|$. We write $o(a)$, the order of $a$ in $R^\times$, for the smallest positive integer $d$ such that $a^d = 1$ if $a\in R^\times$. Then $o(a)\mid |R^\times|$.}

\v
\noindent\wow{Question 5: When is a ring isomorphic to $\Z/m\Z$?}

\v
When thinking about isomorphic rings, we should think of them as essentially the same thing but labelled differently. \qt{So what are some intrinsic properties of $\Z/m\Z$?} It was introduced as a ring of characteristic $m$. In other words, none of $0_R,1_R,2\cdot1_R,\ldots,(m-1)\cdot 1_R$ equals $0_R$ but $m\cdot 1_R = 0_R$. Note that this also implies that if $0\leq i < j \leq m-1$, then $i\cdot 1_R\neq j\cdot 1_R$, for if otherwise, $(j-i)\cdot 1_R = 0_R$ and $1 \leq j - i < m$. Hence, for a ring $R$ of characteristic $m$, the $m$ elements $0_R,1_R,2\cdot1_R,\ldots,(m-1)\cdot 1_R$ are distinct. In the case of $\Z/m\Z$, these are all the elements.

\begin{proposition}\label{prop:orderchar}
    Let $m\geq 2$ be an integer and let $R$ be a commutative ring with characteristic $m$. Then the following are equivalent:
    \begin{enumerate}[(a)]
        \item The canonical map $f:\Z\rightarrow R$ is surjective;
        \item $|R| = m$;
        \item $R\cong\Z/m\Z$;
    \end{enumerate}
\end{proposition}

\begin{proof}
    From the above discussion, we see that the image of $f$ is exactly the set $\{0_R,1_R,2\cdot1_R,\ldots,(m-1)\cdot 1_R\}$ of $m$ elements. Hence $f$ is surjective if and only if these are all the elements of $R$ if and only if $|R| = m$.

    It is easy to check that the map $g:\Z/m\Z\rightarrow R$ sending $a = 0,1,\ldots,m-1$ to $a\cdot 1_R$ is a ring homomorphism (similar to the proof of that $a\mapsto a\mbox{ mod }3$ is a ring homomorphism $\Z/69\Z\rightarrow\Z/3\Z$), and injective by the above. It is surjective if and only if $|R| = m$.
\end{proof}



\begin{cor}\label{cor:primeorder}
    Let $R$ be a commutative ring of order $p$ where $p$ is a prime. Then $R\cong \Z/p\Z = \F_p.$
\end{cor}

\begin{proof}
    By Theorem \ref{thm:69}, we know that the characteristic of $R$ has to divide $p$, and so equals $p$ since $p$ is a prime. Then by Proposition \ref{prop:orderchar}, we have $R\cong \Z/p\Z$.
\end{proof}

Since we assumed that $0\neq 1$ in a ring, every ring has size at least $2$. Corollary \ref{cor:primeorder} then implies that there is only one commutative ring, up to isomorphism, of order $2$ ($\Z/2\Z = \F_2$), of order $3$ ($\Z/3\Z = \F_3$), of order $5$ ($\Z/5\Z = \F_5$), of order $7$ ($\Z/7\Z = \F_7$). \qt{What about rings of order $4$ or $6$?} There are at least $2$ non-isomorphic commutative rings of order $4$, namely $\Z/2\Z\times\Z/2\Z$ and $\Z/4\Z$. The former has characteristic $2$ while the latter has characteristic $4$. If we try the same with $6$, we will have $\Z/2\Z\times\Z/3\Z$ and $\Z/6\Z$, but we know they are isomorphic by the Chinese Remainder Theorem. You will prove in HW 5 that if $m$ is squarefree (so that it is not divisible by $p^2$ for any prime), then any commutative ring of order $m$ is isomorphic to $\Z/m\Z$. This applies to rings of order $6$.

For rings of order $4$, there are two more! We will in fact be able to generalize this to rings of order $p^2$ for any prime $p$. In this case, one can actually brute-force it.

\v
\add{Let $R$ be a commutative ring of order $4$. Let's write $R = \{0,1,\alpha,\beta\}$. The first main branching point is whether $1 + 1 \in \{0,1\}$. Suppose first that $1 + 1\notin\{0,1\}$ and we write without loss of generality $1 + 1 = \alpha$. What is $1+\alpha$ in this case? We know it can't be $1$ or $\alpha$. If $1 + \alpha = 0$, then this forces $1 + \beta = \beta$ which is not possible. Therefore, we must have $1 + \alpha = \beta$ and $1 + \beta = 0$. In other words, $\alpha = 1 + 1$ and $\beta = 1 + 1 + 1$ and so the canonical homomorphism $\Z\rightarrow R$ is surjective, implying that $R\cong\Z/4\Z$.

Suppose now $1 + 1\in\{0,1\}$, and so $1 + 1 = 0$. Note that we must have $\alpha + \alpha = \alpha(1+1) = 0$. The addition table is now uniquely determined.
    \begin{center}
    \begin{tabular}{c|c|c|c|c}
             $+$&$0$&$1$&$\alpha$&$\beta$  \\ \hline
             $0$&$0$&$1$&$\alpha$&$\beta$  \\ \hline
             $1$&$1$&$\wow{0}$&$\wow{\beta}$&$\wow{\alpha}$  \\ \hline
             $\alpha$&$\alpha$&$\wow{\beta}$&$\wow{0}$&$\wow{1}$   \\ \hline
             $\beta$&$\beta$&$\wow{\alpha}$&$\wow{1}$&$\wow{0}$
    \end{tabular}
    \hspace{20pt}
    \begin{tabular}{c|c|c|c|c}
             $\times_1$&$0$&$1$&$\alpha$&$\beta$   \\ \hline
             $0$&$0$&$0$&$0$&$0$  \\ \hline
             $1$&$0$&$1$&$\alpha$&$\beta$   \\ \hline
             $\alpha$&$0$&$\alpha$&$\wow{0}$&$\wow{\alpha}$ \\ \hline
             $\beta$&$0$&$\beta$&$\wow{\alpha}$&$\wow{1}$
    \end{tabular}
    \hspace{10pt}
    \begin{tabular}{c|c|c|c|c}
             $\times_2$&$0$&$1$&$\alpha$&$\beta$   \\ \hline
             $0$&$0$&$0$&$0$&$0$  \\ \hline
             $1$&$0$&$1$&$\alpha$&$\beta$   \\ \hline
             $\alpha$&$0$&$\alpha$&$\wow{\alpha}$&$\wow{0}$ \\ \hline
             $\beta$&$0$&$\beta$&$\wow{0}$&$\wow{\beta}$
    \end{tabular}
    \hspace{10pt}
    \begin{tabular}{c|c|c|c|c}
             $\times_3$&$0$&$1$&$\alpha$&$\beta$   \\ \hline
             $0$&$0$&$0$&$0$&$0$  \\ \hline
             $1$&$0$&$1$&$\alpha$&$\beta$   \\ \hline
             $\alpha$&$0$&$\alpha$&$\wow{\beta}$&$\wow{1}$ \\ \hline
             $\beta$&$0$&$\beta$&$\wow{1}$&$\wow{\alpha}$
    \end{tabular}
    \end{center}
    There are now multiple options for the multiplication table. We note that it is determined by $\alpha^2$ as $$\alpha\beta = \alpha(\alpha+1) = \alpha^2 + \alpha,\qquad\beta^2 = (\alpha+1)^2 = \alpha^2 + 1.$$ There are now three isomorphism classes. If $\alpha^2\in\{0,1\}$, then either $\alpha^2 = 0$ or $\beta^2 = 0$ and so by renaming, we may assume $\alpha^2 = 0$ and we get the ring $\F_2[x]/(x^2)$. If $\alpha^2 = \alpha$, then we get the ring $\F_2[x]/(x^2 - x).$ If $\alpha^2 = \beta$, then we get the ring $\F_4$. We list the special property that they each have to show that they are all non-isomorphic.
    \begin{enumerate}
        \item $\Z/4\Z$ has an element $a$ such that $a + a\neq 0$.
        \item $\F_2[x]/(x^2)$ has a nonzero element $a$ such that $a^2 = 0$.
        \item $\F_2[x]/(x^2 - x)$ has the property that every element $a$ is idempotent, that is $a^2 = a$.
        \item $\F_4$ is an integral domain (and also a field).
    \end{enumerate}
}



\begin{center}
    \add{Lecture 14 Fri 10/04}

    \re{Ideals}
\end{center}


%\section{Quotients}

It is time to stop beating around the bush and talk about what $/$ means. Actually I am going to beat around the bush a bit longer! Let $R$ be a commutative ring. An \wow{ideal} is a subset $I\subseteq R$ such that
\begin{enumerate}[(a)]
    \item $0\in I$;
    \item for any $a,b\in I$, we have $a + b \in I$;
    \item for any $a\in I$ and any $r\in R$, we have $ra\in I$.
\end{enumerate}
\qt{What are the ideals of $\Z$ that contain $69$?} Suppose $I$ is one such. Then it contains $0$ and $69$. Then using (b) with $a = b = 69$, we get $69\cdot2\in I$. Then with $a = 69\cdot2$ and $b = 69$, we get $69\cdot3\in I$. Or we can be smart and use (c) with $a = 69$ and $r = 3$ directly to get $69\cdot3\in I$. More generally, with $r = k$ any integer, we get $69k\in I$ for any integer $k$. Does $I$ need to contain anything else?

\begin{lemma}\label{lem:idealgen}
    Let $R$ be a commutative ring. Let $a\in R$ be any element. Then the set $$aR = (a) = \{ra\colon r\in R\} = \{b\in R\colon a\mid b\}$$ is an ideal of $R$ containing $a$, and is a subset of any ideal of $R$ containing $a$.
\end{lemma}

\begin{proof}
    Take $r = 0$ to get $0\in (a)$. For any $r,r_1,r_2\in R$, we have $r_1a + r_2a = (r_1+r_2)a\in(a)$ and $r(r_1a) = (rr_1)a\in(a)$. Hence $(a)$ is an ideal of $R$. Any ideal $I$ containing $a$ contains $ra$ for any $r\in R$ by (c). So $(a)\subseteq I$.
\end{proof}

We call $(a)$ the ideal \wow{generated} by $a$. In our example, we note that $69\in d\Z$ if and only if $d\mid 69$. So $69$ is also an element of the ideals $69\Z$, $23\Z$, $3\Z$ and $\Z$. \qt{What about the ideals $(-69)\Z$, $(-23)\Z$, $(-3)\Z$ and $(-1)\Z$?}

\begin{lemma}
    Let $R$ be a commutative ring. Let $a\in R$ be any element and let $u\in R^\times$ be a unit. Then $(a) = (au)$. In particular, $(u) = (1) = R$.
\end{lemma}

\begin{proof}
    For any $r\in R$, we have $ra = (ru^{-1})(au) \in (au)$ and $rau = (ru)a\in(a)$.
\end{proof}

\begin{cor}
    Suppose $R$ is a field. Then the only ideals are $(0) = \{0\}$ and $(1) = R$.
\end{cor}

\begin{proof}
    Any nonzero ideal contains a nonzero element, which is a unit in a field.
\end{proof}

\begin{lemma}\label{lem:Rfield}
    Let $R$ be a commutative ring such that the only ideals are $\{0\}$ and $R$. Then $R$ is a field.
\end{lemma}

\begin{proof}
    Let $a\in R$ be a nonzero element. Then $(a)\neq\{0\}$ since it contains $a$. Hence $(a) = R$ and so $1 = ab$ for some $b\in R$.
\end{proof}

\noindent\textbf{Remark:} It is possible for $(a) = (b)$ but $b\neq au$ for any unit $u$. See Exercise 6.\ref{exer:6.6}.

\v
An ideal of the form $(a)$ is called a \wow{principal ideal}. An integral domain where every ideal is principal is called a \wow{Principal ideal domain} or \wow{PID} for short.


\begin{proposition}\label{prop:PID}
    $\Z$ is a PID.
\end{proposition}
\begin{proof}
    Let $I$ be an ideal of $\Z$. If $I = \{0\}$, then $I = (0)$ is principal. Suppose $I$ contains a nonzero integer. Let $d$ be a nonzero element of $I$ such that $|d|$ is the smallest. Then we know that $(d)\subseteq I$ and it remains to prove that $I\subseteq (d)$. Let $n\in I$. We apply the division algorithm to obtain $n = dq + r$ for some integers $q,r$ with $0\leq r < |d|$. Then $r = n - dq\in I$ since $n,d\in I$. However, $|r| < |d|$. So by the minimality of $d$, we see that $r$ can't be nonzero. So $r = 0$ and $d\mid n$, implying that $n\in (d)$.
\end{proof}

The key to the above argument is the division algorithm and the notion of size. A \wow{Euclidean domain} is an integral domain $R$ with a function $N:R\backslash\{0\}\rightarrow \N\cup\{0\}$ if $a,b\in R$ with $a\neq 0$, there exists $q,r\in R$ such that $b = aq + r$ where either $r = 0$ or $N(r) < N(a)$. In HW 6, you will repeat the proof of Proposition \ref{prop:PID} to prove that every Euclidean domain is a PID. (The range of $N$ being $\N\cup\{0\}$ is not important. Any well-ordered subset of $\R$ will do.)

\v
\noindent\wow{Chellenge exercise:} Prove that $\Z[i] = \{a + bi\colon a,b\in\Z\}$ is a Euclidean domain with $N(a + bi) = a^2 + b^2$.

\v
\add{\qt{What are the ideals of $\Z/69\Z$?} As always, we have the zero ideal $(0)$ and the full ring $(1)$ as ideals. We can try to repeat the proof of Proposition \ref{prop:PID} even though we don't even have an integral domain. Let $I\subseteq\{[0],[1],\ldots,[68]\}=\Z/69\Z$ be a nonzero \wow{proper} (i.e. not the whole ring) ideal. Let $d = 2,\ldots,68$ be smallest such that $[d]\in I$. Let $n\in\Z$ such that $[n]\in I$. (Note we can have $n = 69$ since $[69] = [0]\in I$.) Apply the division algorithm to get $n = dq + r$ for some integers $q,r$ such that $0\leq r < d$. Then $[r] = [n] - [d][q]\in I$. By minimality of $d$, we have $r = 0$ and so $d\mid n$ in $\Z$ and $[d]\mid[n]$ in $\Z/69\Z$. We therefore have $I = ([d])$. Applying the above to $n = 69$ also implies that $d\mid 69$, so $d = 3$ or $23$. In other words, there are four ideals of $\Z/69\Z$:
$$\{[0]\} = ([0]),\quad \{[0],[23],[46]\} = ([23]),\quad\{[0],[3],[6],\ldots,[66]\} = ([3]), \quad \Z/69\Z = ([1]).$$
Note that they correspond exactly to the four ideals of $\Z$ containing $69$:
$$69\Z,\quad 23\Z,\quad 3\Z,\quad \Z.$$
\qt{Coincidence?}}

\v
\noindent\textbf{Remark 1:} I actually can't give you an example of an ideal that is not principal yet. Every ideal of every ring that we have looked at is principal!

\v
\noindent\textbf{Remark 2:} Condition (c) of an ideal: $a\in I\wedge r\in R\Rightarrow ra\in I$ might seem a bit weird. Another way to think of $a\in I$ is to think of it as a division $I\mid a$. Then we can translate the $3$ conditions as:
\begin{enumerate}[(a)]
    \item $I\mid 0$;
    \item if $I\mid a$ and $I\mid b$, then $I\mid a + b$;
    \item if $I\mid a$ and $a\mid b$, then $I\mid b$.
\end{enumerate}
Historically, it is a widely believed though incorrectly (but it makes a cool story) that ideals came to existence when Kummer tried to prove Fermat's Last Theorem! When he factored $$x^n - z^n = \prod_{k=1}^n(x - \zeta_n^k z),$$
he ran into the ring $\Z[\zeta_n]$ where unique factorization can fail (for the first time when $n = 23$). Kummer realized that we should allow more ``things'' in our notion of division, and called them \wow{ideal numbers}.

\begin{center}
    \add{Lecture 14.5 Fri 10/04}

    \re{Some algebraic number theory}
\end{center}

The ring $\Z[\sqrt{-2}] = \{a + b\sqrt{-2}\colon a,b\in\Z\}$ is also a Euclidean domain with $N(a + b\sqrt{-2}) = a^2 + 2b^2$. Things break down a bit with the ring $\Z[\sqrt{-3}] = \{a + b\sqrt{-3}\colon a,b\in\Z\}$ because of the following factorization
$$4 = 2\cdot 2 = (1 + \sqrt{-3})(1 - \sqrt{-3}).$$
We note that none of the factors divide each other in $R = \Z[\sqrt{-3}]$:
$$\frac{1+\sqrt{-3}}{2} \notin R,\qquad \frac{2}{1+\sqrt{-3}} = \frac{1-\sqrt{-3}}{2}\notin R.$$
Maybe they share some common factors? Intuition says that this is very unlikely because the numbers are already so small. We can check when $a + b\sqrt{-3}$ divide $2$ in $R$ by dividing in $\C$ to get
$$\frac{2}{a + b\sqrt{-3}} = \frac{2(a - b\sqrt{-3})}{a^2 + 3b^2}.$$
In order for this to be in $R$, we need
$$a^2 + 3b^2\mid 2a\aa a^2 + 3b^2\mid 2b.$$
If $b\neq 0$, we would have $a^2 + 3b^2 \geq 3b^2 \geq 3|b| > |2b|$ and so $a^2 + 3b^2\nmid 2b$. Hence we must have $b = 0$, but then we are just when $a\mid 2$ as integers. So the only divisors of $2$ in $R$ are $\pm1$ and $\pm 2$. However, we saw above that $\pm2$ does not divide $1\pm\sqrt{-3}$. This raises several issues:
\begin{itemize}
    \item Since $2$ does not have any interesting factorization in $R$, it seems like we should say ``$2$ is prime in $R$''. However, $2\mid (1+\sqrt{-3})(1 - \sqrt{-3})$ but $2$ doesn't divide any of the factors. So it doesn't satisfy Euclid's lemma for primes.

    For a general commutative ring $R$, a nonzero non-unit element $r\in R$ is said to be:
    \begin{itemize}
        \item \wow{irreducible} if it cannot be written as $r = ab$ where $a$ and $b$ are not units;
        \item \wow{prime} if whenever $r\mid ab$ in $R$ for some $a,b\in R$, we have $r\mid a$ or $r\mid b$.
    \end{itemize}
    When $R = \Z$, we know that irreducible and prime are the same. For $R = \Z[\sqrt{-3}]$, we saw that $2$ is irreducible but not prime.

    \wow{Exercise}: Prove that if $R$ is a PID, then irreducible and prime are the same.

    \item When proving Euclid's lemma for $\Z$, we needed the notion of $\gcd$ to say that if $c\mid ab$ and $\gcd(a,c) = 1$, then $c\mid b$. \qt{Can we define $\gcd(2, 1+\sqrt{-3})$}? We saw above that the only common factors of $2$ and $1 + \sqrt{-3}$ are $\pm1$. So should we say ``$\gcd(2, 1+\sqrt{-3}) = 1$''? The importance of $\gcd(a,c) = 1$ in the case of $\Z$ is the existence of $x,y\in\Z$ such that $ax + cy = 1$. Can we find $x,y\in R$ such that $$2x + (1 + \sqrt{-3})y = 1?$$
    For $a,b,c,d\in\Z$, we have
    $$2(a + b\sqrt{-3}) + (1 + \sqrt{-3})(c + d\sqrt{-3}) = (2a + c - 3d) + (2b + c + d)\sqrt{-3}.$$
    Observe that
    $$2a + c - 3d\equiv 2b + c + d\pmod{2}$$
    so it's not possible for $2a + c - 3d = 1$ while $2b + c + d = 0$. In other words, if we want to define $\gcd$ as the ``greatest common divisor'', then B\'{e}zout's lemma no longer hold.
\end{itemize}

Enter Kummer's ideal numbers! Recall that we can also talk about an ideal $I$ ``dividing'' an element $a$: we say $I\mid a$ if $a\in I$. If we take two elements $a,b\in R$, in order for an ideal $I$ be a common ``divisor'' of $a$ and $b$, we just need $a,b\in I$. If we extend the notion of $I\mid a$ to $I\mid J$ where $I,J$ are ideals, we would say $I\mid J$ if $J\subseteq I$. Then finding the ``greatest common divisor ideal of $a,b$'' becomes finding the smallest ideal containing $a,b$. Similar to Lemma \ref{lem:idealgen}, any ideal containing $a,b$ must contain all elements of the form $ax + by$ where $x,y\in R$ and it is easy to check that the latter form an ideal.

\begin{lemma}
    Let $R$ be a ring. Let $a,b\in R$. Then $(a,b) = aR + bR = \{ax + by\colon x,y\in R\}$ is an ideal of $R$.
\end{lemma}

\begin{proof}
    Clearly $0\in (a,b)$. Let $x_1,y_1,x_2,y_2\in R$. Then
    $$ax_1 + by_1 + ax_2 + by_2 = a(x_1 + x_2) + b(y_1 + y_2) \in (a,b).$$
    For any $r\in R$, we have
    $$r(ax_1 + by_1) = a(rx_1) + b(ry_1) \in (a,b).$$
    Hence $(a,b)$ is an ideal.
\end{proof}

Back to our example of $2$ and $1 + \sqrt{-3}$ in $R = \Z[\sqrt{-3}]$, we have the ideal $$I = (2, 1 + \sqrt{-3})$$
as the ``gcd'' of $2$ and $1 + \sqrt{-3}$. Let's prove that $I$ is not a principal ideal. Suppose for a contradiction that $I = (a)$ for some $a\in R$. Then from $a\mid 2$ and $a\mid 1 + \sqrt{-3}$, we see that $a = \pm 1$ and so $I = R$. However, we have seen that $1\notin I$, so $I\neq R$.

All of these complications go away if $2\mid 1 + \sqrt{-3}$. In other words, we would like our ring to contain $\alpha = \frac{1 + \sqrt{-3}}{2}$. Let $$S = \Z[\alpha] = \{f(\alpha)\colon f(x)\in\Z[x]\}.$$
Now
$$\sqrt{-3} = 2\alpha - 1.$$
Squaring gives $-3 = 4\alpha^2 - 4\alpha + 1$ and so
$$\alpha^2 - \alpha + 1 = 0.$$
\wow{Wait a moment...} In fact, $\alpha = \zeta_6$. Note since $\alpha^2 = \alpha - 1$, we can always replace higher powers of $\alpha$ by lower powers. So we still have
$$S = \{a + b\alpha\colon a,b\in\Z\}.$$
This is the ring of \wow{Eisenstein integers} and it is a Euclidean domain with
$$N(a + b\alpha) = |a + b\frac{1+\sqrt{-3}}{2}|^2 = a^2 + ab + b^2.$$

The fact that $\alpha$ is a root of a monic polynomial with integer coefficient is what makes $\alpha$ an \wow{algebraic integer}. It allows us to express every element of $S$ as an integer combination of powers of $\alpha$ up to some fixed degree. You will explore this more in HW 6.

If one continues further to look at $\Z[\sqrt{-5}]$, then we have the similarly suspicious factorization
$$6 = 2\cdot 3 = (1 + \sqrt{-5})(1 - \sqrt{-5}).$$
This time, we can't enlarge the ring to fix the problem anymore. One can show that the only algebraic integers (root of a monic polynomial with integer coefficients) of the form $a + b\sqrt{-5}$ where $a,b\in\Q$ are all in $\Z[\sqrt{-5}]$. The key difference with $-3$ is that $-3\equiv 1\pmod{4}$ but $-5$ isn't. We will simply have to accept that some ideals in $\Z[\sqrt{-5}]$ are non-principal and we won't have unique factorization. With regard to rings of the form $\Z[\zeta_m]$, we will see towards the end of the semester that $\Z[\zeta_{23}]$ does not have unique factorization.

\begin{center}
    \add{Lecture 15 Mon 10/07}

    \re{kernel, image, $R/I$}
\end{center}


There is another class of subset of $R$ that deserves special attention. Recall that a commutative ring $R$ comes with $5$ operations: $0$, $1$, $-$, $+$, $\times$. A \wow{subring} of $R$ is a subset $S$ closed under all the ring operations of $R$. In other words:
\begin{enumerate}[(a)]
    \item $0\in S$, $1\in S$;
    \item if $a,b\in S$, then $-a\in S$, $a+b\in S$, $ab\in S$.
\end{enumerate}
In other other words, $S$ is a ring with the ring operations of $R$. In this case, the natural inclusion $S\rightarrow R$ (by viewing an element of $S$ is an element of $R$) is a ring homomorphism.

For example, $\Z\subseteq\Q\subseteq\R\subseteq\C$ are all subrings in the next. The ring $\Z[i]$ is a subring of $\C$. \qt{Can an ideal be a subring?} Since a subring needs to contain $1$ and an ideal that contains $1$ is the whole ring, we see that only the entire ring can be both an ideal and a subring.

Suppose $\varphi:R_1\rightarrow R_2$ is a ring homomorphism between two commutative rings $R_1$ and $R_2$. We define the \wow{kernel} and \wow{image} of $\varphi$ by:
$$\ker(\varphi) = \{a\in R_1\colon \varphi(a) = 0\}\subseteq R_1\aa\mathrm{im}(\varphi) = \{\varphi(a)\colon a\in R_1\}\subseteq R_2.$$

\begin{proposition}\label{prop:1iso}
    Suppose $\varphi:R_1\rightarrow R_2$ is a ring homomorphism between two commutative rings $R_1$ and $R_2$. Then:
    \begin{enumerate}[(a)]
        \item $\ker(\varphi)$ is a proper ideal of $R_1$;
        \item $\ker(\varphi) = \{0\}$ if and only if $\varphi$ is injective;
        \item $\mathrm{im}(\varphi)$ is a subring of $R_2$
        \item $\mathrm{im}(\varphi) = R_2$ if and only if $\varphi$ is surjective.
    \end{enumerate}
\end{proposition}

\begin{proof}
    By the definition of homomorphism and our convention that $1\neq 0$, we have $$0\in\ker(\varphi),\qquad\mbox{and}\qquad 1\notin \ker(\varphi).$$
For any $a,b\in \ker(\varphi)$, we have $a + b\in\ker(\varphi)$ since
$$\varphi(a+b) = \varphi(a) + \varphi(b) = 0 + 0 = 0$$
and for any $r\in R_1$, we have $ra\in\ker(\varphi)$ since
$$\varphi(ra) = \varphi(r)\varphi(a) = \varphi(r)\cdot 0 = 0.$$
This proves that $\ker(\varphi)$ is a proper ideal of $R_1$. Note that for $a,b\in R_1$, we have
$$\varphi(a) = \varphi(b) \quad\Longleftrightarrow\quad \varphi(a - b) = 0 \quad\Longleftrightarrow\quad a - b \in\ker(\varphi).$$
Hence $\ker(\varphi) = \{0\}$ if and only if $\varphi$ is injective.

Next we consider $\mathrm{im}(\varphi)$. Since $\varphi(0) = 0$ and $\varphi(1) = 1$, we see that $\mathrm{im}(\varphi)$ contains $0$ and $1$. Given $a,b\in \mathrm{im}(\varphi)$, there exists $\alpha,\beta\in R_1$ such that $a = \varphi(\alpha)$ and $b = \varphi(\beta)$. Then
$$-a = \varphi(-\alpha),\qquad a + b = \varphi(\alpha+\beta),\qquad ab = \varphi(\alpha\beta)$$
are all in $\mathrm{im}(\varphi)$. Hence $\mathrm{im}(\varphi)$ is a subring of $R_2$. Statement (d) is simply the definition of surjectivity.
\end{proof}

\begin{cor}\label{cor:fieldinj}
    Suppose $\varphi:R_1\rightarrow R_2$ is a ring homomorphism between two commutative rings $R_1$ and $R_2$. Suppose $R_1$ is a field. Then $\varphi$ is injective.
\end{cor}

\begin{proof}
    The only proper ideal of a field is $(0)$.
\end{proof}

Note that in the above proof, we saw that
$$\varphi(a) = \varphi(b) \quad\Longleftrightarrow\quad a - b \in\ker(\varphi) \quad\Longleftrightarrow\quad \ker(\varphi)\mid a - b \quad\Longleftrightarrow\quad a\equiv b\pmod{\ker(\varphi)}.$$
In other words, the value of $\varphi(a)$ depends only on the ``equivalence class of $a$ mod $\ker(\varphi)$''. This is essentially the idea of \wow{quotients}.

Let $R$ be a commutative ring and let $I$ be a proper ideal. We define a relation $\sim$ on $R$ by:
$$a\sim b \quad\Longleftrightarrow\quad a - b \in I \quad\Longleftrightarrow\quad a\equiv b\pmod{I}.$$
Then just like congruences mod $m$, this is an equivalence relation. The equivalence classes are also called \wow{cosets}:
$$[a] = \{b\in R\colon b - a \in I\} = \{a + c\colon c\in I\} = a + I.$$
Two equivalence classes $[a]$ and $[b]$ are equal if and only if $a-b\in I$. We define the set \wow{$R/I$} as the set of equivalence classes: $$R/I = \{[a]\colon a\in R\} = \{a + I\colon a\in R\}.$$
It is worth remarking that so far, all we need is that $I$ is closed under addition and contains $0$, in order for $\sim$ to be an equivalence relation. In other words, all of the above works if $I$ is a subring instead. We now define the ring structure exactly mimicing $\Z/m\Z$:
\begin{eqnarray*}
    0 &=& [0]\\
    1 &=& [1]\\
    {}[a] + [b] &=& [a + b]\\
    {}[a]\cdot[b] &=& [ab]\\
    -[a] &=& [-a].
\end{eqnarray*}
We need to check that the above operations are well-defined, in the sense that they don't depend on the choice of the representatives. In other words, if $a\sim c$ and $b\sim d$, then
$$a + b\sim c + d\aa ab\sim cd\aa -a \sim -c.$$
These follow exactly like the case of congruences mod $m$. For example,
$$ab - cd = a(b - d) + d(a - c).$$
From $I\mid b - d$ and $I\mid a - c$, we have $I\mid ab - cd$.

\v
\noindent\textbf{Example}: What is $\Z[\sqrt{-3}]/(2)$? Let $R = \Z[\sqrt{-3}]$ and $$I = (2) = \{a + b\sqrt{-3}\in\Z[\sqrt{-3}]\colon 2\mid a,2\mid b\}.$$
Then there are four cosets, depending on the parities of $a$ and $b$. Namely,
$$R/I = \{[0], [1], [\sqrt{-3}], [1 + \sqrt{-3}]\}.$$
Is this isomorphic to $\Z/4\Z$ or $\Z/2\Z\times\Z/2\Z$ or neither? Since $[2] = [0]$, we see that $R/I$ has characteristic $2$ so it is not isomorphic to $\Z/4\Z$. We write
$$0 = [0],\qquad 1 = [1],\qquad \alpha = [\sqrt{-3}],\qquad \beta = [1+\sqrt{-3}].$$
Then
$$\alpha^2 = [-3] = 1,\qquad \alpha\beta = [-3 + \sqrt{-3}] = \beta,\qquad \beta^2 = [-2 + 2\sqrt{-3}] = 0.$$
Hence $R/I$ is not isomorphic to $\Z/2\Z\times\Z/2\Z$ since $\Z/2\Z\times\Z/2\Z$ doesn't have a nonzero element whose square is $0$. So $R/I$ is some mysterious ring of order $4$ that is not an integral domain.

\v
\noindent\wow{Exercise}: Prove that $\Z[\sqrt{-3}]/(1 + \sqrt{-3})\cong\Z/4\Z$ and $\Z[\sqrt{-3}]/(5)$ is a field of order $25$.

\begin{proposition}\label{prop:quotuniv}
    (Universal property of quotients) Let $R$ be a commutative ring and let $I$ be a proper ideal. Then $R/I$ with the above operations is a commutative ring. It is the unique ring structure on $R/I$ for which the natural map $R\rightarrow R/I$ sending $a$ to $[a]$ is a ring homomorphism. Moreover, given any ring homomorphism $\varphi:R\rightarrow S$ for which $I\subseteq\ker(\varphi)$, there is a unique ring homomorphism $\psi:R/I\rightarrow S$ for which the composition $R\rightarrow R/I\rightarrow S$ is $\varphi$.
\end{proposition}

In other words, giving a ring homomorphism $R/I\rightarrow S$ is the same as giving a ring homomorphism $R\rightarrow S$ whose kernel contains $I$.

\v
\begin{proof}
    \wow{Exercise}. Check definitions. It is worth doing exactly once in your life. Note that $\psi([a]) = \varphi(a)$.
\end{proof}


\begin{center}
    \add{Lecture 16 Wed 10/09}

    \re{Correspondence theorem, First isomorphism theorem, Chinese remainder theorem}
\end{center}

What are the ideals of $R/I$? We have the following general result.

\begin{lemma}\label{lem:ct}
    Let $\varphi:R\rightarrow S$ be a ring homomorphism.
    \begin{enumerate}[(a)]
        \item If $J$ is an ideal of $R$, then $\varphi(J) = \{\varphi(a)\colon a\in J\}$ is an ideal of $\textrm{im}(\varphi)$.
        \item If $J'$ is an ideal of $\textrm{im}(\varphi)$, then $\varphi^{-1}(J') = \{a\in R\colon \varphi(a)\in J'\}$ is an ideal of $R$ containing $\ker(\varphi)$.
    \end{enumerate}
\end{lemma}

\begin{proof}
    (a) We have $0 = \varphi(0)\in\varphi(J)$. For any $\varphi(a),\varphi(b)\in\varphi(J)$ with $a,b\in J$, we have $\varphi(a) + \varphi(b) = \varphi(a + b)\in \varphi(J)$ since $a + b\in J$. For any $\varphi(a)\in\varphi(J)$ and $\varphi(r)\in\textrm{im}(\varphi)$ with $a\in J$ and $r\in R$, we have $\varphi(a)\varphi(r) = \varphi(ar)\in\varphi(J)$ since $ar\in J$. Hence $\varphi(J)$ is an ideal of $\textrm{im}(\varphi)$.

    (b) For any $a\in\ker(\varphi)$, $\varphi(a) = 0\in J'$ and so $0\in\ker(\varphi)\subseteq \varphi^{-1}(J')$. For any $a,b\in \varphi^{-1}(J')$ and $r\in R$, we have $\varphi(a),\varphi(b)\in J'$ and $\varphi(r)\in\textrm{im}(\varphi)$, and so $\varphi(a + b) = \varphi(a) + \varphi(b)\in J'$ and $\varphi(ar) = \varphi(a)\varphi(r)\in J'$. Hence $\varphi^{-1}(J')$ is an ideal of $R$ containing $\ker(\varphi)$.
\end{proof}

\begin{theorem}\label{thm:ct1}
    (Correspondence Theorem) Let $\varphi:R\rightarrow S$ be a ring homomorphism. Then there is a bijection between the set of ideals of $R$ containing $\ker(\varphi)$ and the set of ideals of $\textrm{im}(\varphi)$.
\end{theorem}

\begin{proof}
    Lemma \ref{lem:ct} gives the maps
    \begin{eqnarray*}
        \{\mbox{ideals of }R\mbox{ containing }\ker(\varphi)\} &\longrightarrow&\{\mbox{ideals of }\textrm{im}(\varphi)\}\\
        J &\longmapsto & \varphi(J)\\
        \varphi^{-1}(J') &\longmapsfrom& J'.
    \end{eqnarray*}
    It is easy to check that the compositions are identities: $\varphi(\varphi^{-1}(J')) = J'$ and $\varphi^{-1}(\varphi(J)) = J$.
\end{proof}

\begin{cor}
    (Correspondence Theorem) Let $R$ be a commutative ring and let $I$ be a proper ideal. Then the ideals of $R/I$ are in bijection with the ideals of $R$ containing $I$.
\end{cor}

\begin{proof}
    Apply Theorem \ref{thm:ct1} to the natural map $R\rightarrow R/I\colon a\mapsto[a].$
\end{proof}

Recall that for a ring homomorphism $\varphi:R\rightarrow S$, its kernel $\ker(\varphi)$ is a proper ideal of $R$ and its image $\mathrm{im}(\varphi)$ is a subring of $S$. Since $\mathrm{im}(\varphi)$ itself is a ring and $\varphi$ only ``see'' its image, we may view $\varphi:R\rightarrow \mathrm{im}(\varphi).$ Now the kernel of $\varphi$ contains (in fact, equals) $\ker(\varphi)$. Hence by the universal property (Proposition \ref{prop:quotuniv}), $\varphi$ ``factors through''
$$R/\ker(\varphi)\rightarrow\mathrm{im}(\varphi).$$
There is now no more redundant information left.

\begin{theorem}\label{thm:1iso}
    (First isomorphism theorem) Let $\varphi:R\rightarrow S$ be a homomorphism of rings. Then the natural map $\psi:R/\ker(\varphi)\rightarrow\mathrm{im}(\varphi)$ sending the coset $[a]$ to $\varphi(a)$ is an isomorphism.
\end{theorem}

\begin{proof}
    We only need to check that $\psi$ is bijective. For every $\varphi(a)\in\mathrm{im}(\varphi)$, we have $\varphi(a) = \psi([a])\in \mathrm{im}(\psi)$, so the map is surjective. If $\psi([a]) = 0$, then $\varphi(a) = 0$ and so $a\in\ker(\varphi)$ but then $[a] = [0]$. Hence $\ker(\psi) = 0$ and so $\psi$ is injective.
\end{proof}

Let's apply the first isomorphism theorem to the canonical homomorphism $f:\Z\rightarrow R$. Let $m$ denote the characteristic of $R$. Then Lemma \ref{lem:chardiv} implies that $\ker(f) = m\Z$. The image of $f$ is then a subring of $R$ isomorphic to $\Z/m\Z$. This is called the \wow{prime subring} of $R$. Note also that if $f$ is surjective, then $R\cong \Z/m\Z$. For example, if $R$ is a finite field, then we know that $\textrm{char}(R) = p$ for some prime $p$ and so it's prime subring is isomorphic to $\Z/p\Z\cong\F_p$ and we will view $\F_p\subseteq R$.

\v
Our next goal is to use the similarity between congruence classes mod $I$ and congruences mod $m$ to come up with and prove a ring theoretic version of the Chinese Remainder Theorem: Let $m$ and $n$ be coprime integers. Then
$$\Z/mn\Z\cong\Z/m\Z\times\Z/n\Z.$$
With the help of ideals, we can translate the condition of being coprime to $(r,s) = (1) = R$.

\begin{theorem}\label{thm:CRTPID}
    (Chinese remainder theorem) Let $R$ be a commutative ring. Let $r,s\in R$ such that $(r,s) = R$. Then $$R/(rs)\cong R/(r)\times R/(s).$$
\end{theorem}

\begin{proof}
    Consider the ring homomorphism
    $$\varphi:R\rightarrow R/(r)\times R/(s)\colon a\mapsto ([a]_r,[a]_s).$$
    It suffices to show that $\varphi$ is surjective with kernel $(rs)$ and then we will be done by the first isomorphism theorem.

    The statement $\ker(\varphi) = (rs)$ is equivalent to
    $$\forall a\in R, r\mid a\wedge s\mid a\iff rs\mid a.$$
    The ($\Leftarrow$) direction is obvious. The ($\Rightarrow$) direction is exactly like HW 1 Q1c. Since $(r,s) = R$, there exists $x,y\in R$ such that $rx + sy = 1$. Then $rax + say = a$. From $r\mid a$, we get $rs\mid sa$. From $s\mid a$, we get $rs\mid ra$. So $rs\mid a$.

    We now show $\varphi$ is surjective. Let $a,b\in R$ be arbitrary. Then we need to find some $c\in R$ such that $[c]_r = [a]_r$ and $[c]_s = [b]_s$. We observe that
    \begin{eqnarray*}
        [rx]_r &=& [0]_r\\
        {}[rx]_s &=& [1 - sy]_s = [1]_s\\
        {}[sy]_r &=& [1 - rx]_r = [1]_r\\
        {}[sy]_s &=& [0]_s
    \end{eqnarray*}
    Hence $c = brx + asy$ does the job.
\end{proof}

\add{
There is in fact a more general version replacing $(r)$ and $(s)$ by two ideals $I$ and $J$. We define
\begin{eqnarray*}
    I+J &=& \{a + b\colon a\in I, b\in J\}\\
    IJ &=& \{a_1b_1 + \cdots + a_mb_m\colon a_i\in I, b_i\in J, m\geq0\}.
\end{eqnarray*}

\begin{theorem}
    (Chinese remainder theorem) Let $R$ be a commutative ring. Let $I$ and $J$ be two proper ideals of $R$ such that $I + J = R$. Then the natural map $$\varphi:r\mapsto (r+I, r+J) \colon R\rightarrow R/I \times R/J$$
    is a surjective homomorphism with kernel $IJ$. In other words,
    $$R/(IJ)\cong R/I\times R/J.$$
\end{theorem}


\begin{proof}
    The assumption $I + J = R$ means that there exist $a\in I$ and $b\in J$ such that $a + b = 1$. We prove $\varphi$ is surjective. Take any $s,t\in R$. We need to find an $r\in R$ such that $r - s\in I$ and $r - t\in J$. Let $r = ta + sb$. Then
    \begin{eqnarray*}
        r - s &=& ta + s(b - 1) = ta - sa\in I,\\
        r - t &=& t(a - 1) + sb = -tb + sb \in J.
    \end{eqnarray*}
    The kernel of $\varphi$ is clearly $I\cap J$. It is easy to see by definition that $IJ\subseteq I\cap J$, so it remains to prove $I\cap J \subseteq IJ$. Let $r\in I\cap J$. Then $r = r(a + b) = ra + rb \in IJ$.
\end{proof}
}






\subsection*{Exercises}
\begin{enumerate}[\thesection .1]
    \item Let $R$ be a commutative ring with $a,b,c\in R$. Prove that if $ab = 1 = ac$, then $b = c$.

    \item Let $f:R\rightarrow R'$ be an isomorphism between two commutative rings. Prove that its inverse $f^{-1}:R'\rightarrow R$ is a ring homomorphism, and so is also an isomorphism. (Recall that $f^{-1}$ is defined so that for any $b\in R'$, $f^{-1}(b)$ is the unique $a\in R$ such that $f(a) = b$.)

    \item Prove that $\R$ and $\C$ are not isomorphic.
    \item Let $R = \Z^2 = \Z\times\Z$. Let $r = (0,1)$. Prove that:
    \begin{enumerate}
        \item whenever $r\mid ab$ for some $a,b\in R$, we have $r\mid a$ or $r\mid b$;
        \item there exist $a,b\in R\backslash R^\times$ such that $r = ab$.
    \end{enumerate}\label{exer:7.10}
    \item Let $R = \Q + x\R[x] = \{f(x)\in \R[x]\colon f(0)\in\Q\}$. Prove that:
    \begin{enumerate}
        \item there exist $a,b\in R$ such that $x\mid ab$ but $x\nmid a$ and $x\nmid b$;
        \item there do not exist $a,b\in R\backslash R^\times$ such that $x = ab$.
    \end{enumerate}\label{exer:7.11}

    \item Let $R$ be the ring of continuous (real-valued) functions on $[0,3]$ with pointwise addition and multiplication, and the constant functions $0$ and $1$ as $0$ and $1$. Consider
    $$a(x) = \begin{cases}
        1-x&\mbox{if }0\leq x\leq 1\\
        0&\mbox{if }1\leq x\leq 2\\
        x-2&\mbox{if }2\leq x\leq 3
    \end{cases},\qquad b(x) = \begin{cases}
        1-x&\mbox{if }0\leq x\leq 1\\
        0&\mbox{if }1\leq x\leq 2\\
        2-x&\mbox{if }2\leq x\leq 3
    \end{cases}.$$
    Prove that $a(x)R = b(x)R$ but there does not exist a unit $u(x)\in R^\times$ such that $b(x) = a(x)u(x)$.\label{exer:6.6}

\end{enumerate}

\begin{center}
    \add{Lecture 17 Fri 10/11}

    \re{$R[x]$}
\end{center}


\section{Polynomial ring}

For any commutative ring $R$, we let $R[x]$ denote the ring of polynomials with coefficients in $R$ very similar to $\Z[x]$. That is,
$$R[x] = \{a_nx^n + \cdots + a_0\colon a_i\in R, n\geq 0\}.$$
Two polynomials $a_nx^n + \cdots + a_0$ and $b_mx^m + \cdots + b_0$ are said to be \wow{equal} if $n = m$ and $a_i = b_i$ for all $i$. Addition and multiplication of polynomials are exactly what you expected: multiply things out and then collect terms with the same degree. For example, in $(\Z/69\Z)[x]$, we have
\begin{eqnarray*}
    &&([23]x^2 + [3]x + [1])([3]x^3 + [4]x)\\
    &=&[69]x^5 + [92]x^3 + [9]x^4 + [12]x^2 + [3]x^3 + [4]x\\
    &=&[9]x^4 + [26]x^3 + [12]x^2 + [4]x.
\end{eqnarray*}
We define the \wow{degree} of a polynomial $a_nx^n + \cdots + a_0\in R[x]$ as the largest index $n$ such that $a_n\neq 0$. We then say $a_n$ is the \wow{leading coefficient}. If $a_n = 1$, we say the polynomial is \wow{monic}. We follow the convention of $\deg(0) = -\infty$. Note that
$$(a_nx^n + \cdots )(b_mx^m + \cdots ) = a_nb_mx^{m+n} + \cdots$$
has no terms of exponent higher than $m+n$. Hence, we see that $$\deg(fg) \leq \deg(f) + \deg(g).$$
In our example above, we see that equality might not hold because we could have $a_n\neq 0$ and $b_m\neq 0$ but $a_nb_m = 0$. This is clearly not possible if $R$ is an integral domain.

\begin{lemma}
    Let $R$ be an integral domain. Then for any $f,g\in R[x]$, we have $\deg(fg) = \deg(f) + \deg(g)$.
\end{lemma}

We may view $R$ as a subring of $R[x]$ by viewing every $r\in R$ as the degree $0$ constant polynomial $r\in R[x]$. Conversely, it is easy to see that the degree $0$ polynomials are exactly the nonzero constants.

\begin{lemma}
    Let $R$ be an integral domain. Then $R[x]^\times = R^\times$.
\end{lemma}

\begin{proof}
    In order for $fg = 1$, we have $\deg(f) + \deg(g) = 0$ and so both $\deg(f) = \deg(g) = 0$ implying that $f$ and $g$ are nonzero elements of $R$ that multiply to $1$.
\end{proof}

One of the most fundamental property of polynomials is the existence of a division algorithm.

\begin{proposition}\label{prop:divalgRx}
    (Division algorithm for polynomials) Let $R$ be a commutative ring. Let $f(x)\in R[x]$ and let $g(x)\in R[x]$ such that the leading coefficient of $g$ is a unit in $R$. Then there exist polynomials $q(x),r(x)\in R[x]$ such that $$f(x) = g(x)q(x) + r(x),\qquad\mbox{and}\qquad \deg(r) < \deg(g).$$
\end{proposition}

\begin{proof}
    Just long division. \add{Let $a$ denote the leading coefficient of $g(x)$. So $a\in R^\times$. If $g(x) = a$ has degree $0$, then we take $q(x) = a^{-1}f(x)$ and $r(x) = 0$. Suppose now $\deg(g) > 0.$ We prove by induction on $\deg(f)$. If $\deg(f) < \deg(g)$, we simply take $q = 0$ and $r = f$. Suppose now $\deg(f) \geq \deg(g)$. Let $b\in R$ be the leading coefficient of $f(x)$. Then $$f(x) - ba^{-1}x^{\deg(f) - \deg(g)}g(x)$$
    is a polynomial with less degree than $f$. By the induction hypothesis, this can be written $gq_1 + r_1$ with $\deg(r_1) < \deg(g)$. Then $f = gq + r$ with $q = ba^{-1}x^{\deg(f) - \deg(g)} + q_1.$}
\end{proof}

When $R = \Z$, the condition that the leading coefficient of $g$ is unit means that it is $\pm1$. In general, we can always divide by monic polynomials. When $R = F$ is a field, we see that for any nonzero polynomial $g(x)$, its leading coefficient is nonzero and so is a unit. In other words, $F[x]$ is a Euclidean domain with $N(f) = \deg(f)$. Hence it is a PID and everything works!

\qt{What data is needed to define a homomorphism $\varphi:R[x]\rightarrow S$?} Composing $\varphi$ with the natural inclusion $R\rightarrow R[x]$ gives a ring homomorphism $\psi:R\rightarrow S$. Let $\alpha = \varphi(x)\in S$. Then we see that
$$\varphi(a_nx^n + \cdots + a_0) = \psi(a_n)\varphi(x)^n + \cdots + \psi(a_0) = \psi(a_n)\alpha^n + \cdots + \psi(a_0).$$

\begin{proposition}\label{prop:univRx}
    Let $R,S$ be commutative rings. Then giving a homomorphism $R[x]\rightarrow S$ is the same as giving a homomorphism $R\rightarrow S$ along with an element $\alpha\in S$.
\end{proposition}

Applying this to the identity map $R\rightarrow R$ and any $\alpha\in R$, we get the evaluation homomorphism $\mathrm{ev}_\alpha:R[x]\rightarrow R$ sending $$a_nx^n + a_{n-1}x^{n-1} + \cdots + a_0\,\,\, \longmapsto \,\,\,a_n\alpha^n + a_{n-1}\alpha^{n-1} + \cdots + a_0.$$
We write $f(\alpha)\in R$ for the image of $f$ under this map. For any constant polynomial $r\in R$, we have $\mathrm{ev}_\alpha(r) = r$. Hence $\mathrm{ev}_\alpha$ is surjective. Its kernel is given
$$\ker(\mathrm{ev}_\alpha) = \{f(x)\in R[x]\colon f(\alpha) = 0\}.$$
It is clear that $x - \alpha\in\ker(\mathrm{ev}_\alpha).$ So $(x - \alpha)\subseteq\ker(\mathrm{ev}_\alpha)$.

\begin{proposition}\label{prop:rem}
    Let $R$ be a commutative ring. Let $f(x)\in R[x]$ and let $c\in R$. The remainder when $f(x)$ is divided by $x - c$ is the constant polynomial $f(c)$.
\end{proposition}

\begin{proof}
    The remainder $r(x)$ satisfies $\deg(r) < \deg(x - c) = 1$. So $r(x) = r_0$ is a constant. Apply $\mathrm{ev}_c$ to $f(x) = (x - c)q(x) + r_0$ to get $r_0 = f(c)$.
\end{proof}

As a consequence, we have $\ker(\mathrm{ev}_\alpha) = (x - \alpha)$ since $f(\alpha) = 0$ implies that $f(x)$ is divisible by $x - \alpha$. Hence by the first isomorphism theorem, we have
$$R[x]/(x-\alpha)\cong R.$$

As another example, we can take the natural inclusion $\Z\rightarrow\C$ and any $\alpha\in\C$. Then we get $\Z[x]\rightarrow\C$ sending $f(x)$ to $f(\alpha)$. Its image is a subring of $\C$, denoted $\Z[\alpha]$.

\begin{center}
    \add{Lecture 17.5 Fri 10/11\\ Tutorial}

    \re{$R/(a,b)$}
\end{center}

Consider the homomorphism $\varphi:\Z[x]\rightarrow\C$ sending $f(x)$ to $f(\sqrt{-3})$. Its image is the ring $\Z[\sqrt{-3}]$. \qt{What is its kernel?} Note first that $\sqrt{-3}$ is a root of $x^2 + 3$. So we have $x^2 + 3 \in\ker(\varphi)$. Suppose now $f(x)\in\ker(\varphi)$. Then $f(x)$ is a real polynomial having $\sqrt{-3}$ as a root. So it also has $-\sqrt{-3}$ as a root. Then we have
$(x - \sqrt{-3})(x + \sqrt{-3})\mid f(x)\mbox{ in }\C[x].$ So $x^2 + 3\mid f(x)$ in $\C[x]$. To conclude that $x^2 + 3 \mid f(x)$ in $\Z[x]$, we apply the division algorithm to find $q(x),r(x)\in\Z[x]$ such that $f(x) = (x^2 + 3)q(x) + r(x)$ and $\deg(r) < \deg(x^2 + 3)$. From $x^2 + 3\mid f(x)$ in $\C[x]$, we get $x^2 + 3\mid r(x)$ in $\C[x]$, but from $\deg(r) < \deg(x^2 + 3)$, we have $r = 0$. Therefore, we have $\ker(\varphi) = (x^2 + 3)$. By the first isomorphism theorem, we have
$$\Z[\sqrt{-3}] \cong \Z[x]/(x^2 + 3).$$
Or equivalently, we have a surjective homomorphism
$$\varphi:\Z[x]\rightarrow\Z[\sqrt{-3}]\qquad\mbox{with}\qquad\ker(\varphi) = (x^2 + 3).$$
Consider the ideal $I = (1 + \sqrt{-3})$ of $\Z[\sqrt{-3}]$. By the Correspondence Theorem (Theorem \ref{thm:ct1}), there is a unique ideal $J$ of $\Z[x]$ containing $(x^2 + 3)$ such that $\varphi(J) = I$. Since $\varphi(1 + x) = 1 + \sqrt{-3}$. We see that $$J = (x + 1, x^2 + 3) = \varphi^{-1}(I).$$
Now we consider the composition
$$\psi:\Z[x]\rightarrow\Z[\sqrt{-3}]\rightarrow\Z[\sqrt{-3}]/(1 + \sqrt{-3}).$$
It is surjective since it is the composition of two surjective homomorphisms, and its kernel is $\varphi^{-1}(I) = J$. Hence, by the first isomorphism theorem, we have
$$\Z[\sqrt{-3}]/(1 + \sqrt{-3}) \cong \Z[x]/(x+1, x^2 + 3).$$
We now compute this quotient by modding out $x + 1$ first! Consider the composition
$$\varphi':\Z[x]\rightarrow\Z[x]/(x + 1) \xrightarrow{\cong}\Z$$
defined by
$$f(x)\mapsto [f(x)]_{x+1} \mapsto f(-1).$$
What is $\varphi'(J)$? Any element of $J$ is of the form $(x + 1)g(x) + (x^2 + 3)h(x)$ for some $g,h\in\Z[x]$ and $\varphi'$ sends it to
$$(-1 + 1)g(-1) + ((-1)^2 + 3)h(-1) = 4h(-1).$$
Hence $\varphi'(J) = 4\Z$ and $\varphi'^{-1}(4\Z) = J$ since $J$ contains $\ker(\varphi')$. We can now further compose $\varphi'$ to get
$$\psi':\Z[x]\rightarrow\Z\rightarrow\Z/4\Z$$
which is surjective with kernel $J$. Therefore,
$$\Z[\sqrt{-3}]/(1 + \sqrt{-3}) \cong \Z[x]/(x+1, x^2 + 3)\cong\Z/4\Z.$$
We have given a proof by example of the following result.

\begin{lemma}
    Let $R$ be a commutative ring and let $a,b\in R$ such that $(a,b) \neq R$. Let $[b]_a$ denote the image of $b$ under the natural map $R\rightarrow R/(a)$. Then
    $$R/(a,b) \cong (R/(a))/([b]_a).$$
\end{lemma}

\add{This result is a special case of the following:
\begin{theorem}\label{thm:3iso}
    (Third isomorphism theorem) Let $R$ be a commutative ring and let $I$ be a proper ideal of $R$. Let $J$ be a proper ideal of $R$ containing $I$. Then $$(R/I)/(J/I) \cong R/J.$$
\end{theorem}

\begin{proof}
    There are multiple ways to do this. We take the composition of the natural maps:
    $$\psi: R\rightarrow R/I \rightarrow (R/I)/(J/I).$$
    Since both quotient maps are surjective, so is $\psi$. By the first isomorphism theorem, it suffices to prove that $\ker(\psi) = J$. This is now just a definition check. We write $[a] = a + I\in R/I$. Then
    $$\ker(\psi) = \{a\in R\colon [a] \in J/I\} = \varphi^{-1}(J/I) = \varphi^{-1}(\varphi(J)) = J$$
    where $\varphi:R\rightarrow R/I$.
\end{proof}}

Let's try this with $\Z[\sqrt{-3}]/(2)$. We have
$$\Z[\sqrt{-3}]/(2) \cong \Z[x](x^2 + 3, 2) \cong (\Z[x]/(2))/([x^2 + 3]_2).$$
In HW 7 P1, you will show that if $a\in R$, then
$$R[x]/aR[x] \cong (R/aR)[x].$$
In this case, we have
$$\Z[x]/2\Z[x]\cong(\Z/2\Z)[x] = \F_2[x].$$
So
$$\Z[\sqrt{-3}]/(2)\cong \F_2[x]/(x^2 + 3) = \F_2[x]/(x^2 + 1).$$
Recall that $\Z[\sqrt{-3}]/(2)$ has a funny element $\beta\neq 0$ such that $\beta^2 = 0$. Can we find such an element in $\F_2[x]/(x^2 + 1)$? Note that
$$(x + 1)^2 = x^2 + 2x + 1 = x^2 + 1 \in\F_2[x].$$
Hence $$[x+1]\neq 0\aa [x+1]^2 = 0.$$
\wow{Exercise}: Show that
$$\F_2[x]/(x^2 + 1) = \F_2[x]/((x+1)^2)\cong\F_2[x]/(x^2).$$

What about $\Z[\sqrt{-3}]/(5)$? Using the same method, we have
$$\Z[\sqrt{-3}]/(5) \cong \Z[x](x^2 + 3, 5) \cong (\Z[x]/(5))/([x^2 + 3]_5)\cong \F_5[x]/(x^2 + 3).$$
How many elements are there in this ring? Given any $f(x)\in\F_5[x]$, we can apply the division algorithm to get $f(x) = (x^2 + 3)q(x) + r(x)$ for some $q,r\in\F_5[x]$ and $\deg(r) < \deg(x^2 + 3)$. Then
$$[f(x)] = [(x^2 + 3)q(x) + r(x)] = [r(x)] = [ax + b]$$
for some $a,b\in\F_5$. We see that there are 25 choices for $a,b$ and if $r_1(x)$ and $r_2(x)$ both have degree at most $1$, then so does $r_1(x) - r_2(x)$, so we cna't have $x^2 + 3 \mid r_1(x) - r_2(x)$ unless $r_1(x) = r_2(x)$. Therefore,
$$|\F_5[x]/(x^2 + 3)| = 25.$$
We claimed that this is a field before. Can we find the inverse of $[x+1]$? Note that
$$(x + 1)(x - 1) - (x^2 + 3) = -4 = 1 \in \F_5[x].$$
Taking congruence classes mod $x^2 + 3$, we have
$$[x+1][x-1] = 1\qquad\mbox{so}\qquad[x+1]^{-1} = [x-1].$$
More generally, given $[f(x)]$ nonzero in $\F_5[x]/(x^2 + 3)$, we have $x^2 + 3\nmid f(x)$ and we want to find polynomials $g(x),h(x)\in\F_5[x]$ such that
$$f(x)g(x) + (x^2 + 3)h(x) = 1$$
since then we would have $[f(x)][g(x)] = 1.$ THe existence of $g(x),h(x)$ is equivalent to the ideal $(f(x),x^2 + 3) = \F_5[x]$. Since $\F_5[x]$ is a PID, we know that $(f(x),x^2 + 3) = (j(x))$ for some $j\in\F_5[x]$. Since $j(x)\mid x^2 + 3$ in $\F_5[x]$, we see by checking the divisors of $x^2 + 3$ in $\F_5[x]$ that $j(x) = u$ or $j(x) = (x^2 + 3)u$ where $u\in\F_5^\times$. If $j(x) = (x^2 + 3)u$, then from $j(x)\mid f(x)$, we get $x^2 + 3\mid f(x)$ which is not possible. So $j(x) = u$ and we have $(f(x),x^2+3) = (u) = \F_5[x]$. The key ingredients in this analysis are:
\begin{itemize}
    \item $x^2 + 3$ is \wow{irreducible} in $\F_5[x]$;
    \item $\F_5[x]$ is a PID.
\end{itemize}

\begin{center}
    \add{Lecture 18 Mon 10/21}

    \re{$f'(x)$}
\end{center}

\begin{cor}\label{cor:FF}
    Let $R$ be an integral domain. Let $f(x)\in R[x]$ and let $c_1,\ldots,c_n\in R$ be distinct. Then $c_1,\ldots,c_n$ all are roots of $f(x)$ if and only if $(x - c_1)(x - c_2)\cdots(x - c_n) \mid f(x)$.
\end{cor}

\begin{proof}
    Only the forwards direction needs to be proved. We prove by induction on $n$. The case $n = 1$ follows immediately from Proposition \ref{prop:rem}. Suppose now $n\geq 2$. By induction using $c_1,\ldots,c_{n-1}$, we see that there exists $g(x)\in R[x]$ such that $f(x) = (x - c_1)\cdots(x - c_{n-1})g(x)$. Apply $\mathrm{ev}_{c_n}$ to get $$0 = (c_n-c_1)\cdots(c_n-c_{n-1})g(c_n).$$
    Since each $c_n - c_i\neq 0$ and $R$ is an integral domain, we see that $g(c_n) = 0$. Then $g(x) = (x - c_n)h(x)$ for some $h\in R[x]$. So $f(x) = (x - c_1)\cdots(x - c_n)h(x)$.
\end{proof}

\v
\noindent\textbf{Remark}: It is very important that $R$ is an integral domain. For example in $(\Z/15\Z)[x]$, the polynomial $x^2 - 1$ has four roots: $\pm1$ and $\pm4$.

\begin{cor}
    Let $R$ be an integral domain. Let $f(x)\in R[x]$ with degree $d\geq0$. Then $f(x)$ has at most $d$ distinct roots in $R$.
\end{cor}

\begin{proof}
    Let $c_1,\ldots,c_n\in R$ be all the distinct roots of $f(x)$ in $R$. Then by Corollary \ref{cor:FF}, there exists some $g(x)\in R[x]$ such that $f(x) = (x - c_1)\cdots(x - c_n)g(x)$. Taking degrees gives $d = n + \deg(g) \geq n.$
\end{proof}


We say $c\in R$ is a \wow{repeated root} of $f(x)$ if $(x-c)^2\mid f(x) $. Repeated roots can be checked using the formal \wow{derivative} of $f(x)$ defined as
$$f'(x) = na_nx^{n-1} + \cdots + 2a_2x + a_1.$$ The word ``formal'' is referring to the fact that this has nothing to do with taking limits.
The same rules of derivatives in calculus apply here:
$$(f+g)'(x) = f'(x) + g'(x),\qquad (fg)'(x) = f(x)g'(x) + f'(x)g(x),\qquad (f\circ g)'(x) = f'(g(x))g'(x).$$
Additivity is easy to check from the definition. Then one can use it to reduce the product rule and the chain rule to the case $f(x) = a_nx^n$.

As an example, consider $R = \F_p$ and the polynomials $f(x) = x^p - x$ and $g(x) = x^p - 1$. Then,
$$f'(x) = px^{p-1} - 1 = -1,\qquad g'(x) = px^{p-1} = 0.$$

\begin{proposition}
    Let $R$ be a commutative ring. Let $f(x)\in R[x]$ and let $c\in R$. Then $c$ is a repeated root of $f(x)$ if and only if $f(c) = f'(c) = 0$.
\end{proposition}

\begin{proof}
    For both directions, we may assume $c$ is a root. So $f(x) = (x - c)g(x)$ for some $g(x)\in R[x]$. Differentiate it to get $f'(x) = g(x) + (x - c)g'(x)$. Hence $f'(c) = g(c)$. So $g(x)$ has another factor of $x - c$ if and only if $f'(c) = 0$.
\end{proof}

The polynomial $x^p - x$ has derivative $-1$, which has no root. Hence $x^p - x$ has no repeated roots in $\F_p$. In fact, every $a\in \F_p^\times$ satisfies $a^{p-1} = 1$ by Fermat's little theorem (or by $|\F_p^\times| = p-1$). Hence the $p$ elements $0,1,\ldots,p-1\in\F_p$ are distinct and are all roots of $x^p - x$. Since $\deg(x^p - x) = p$, we have the factorization
$$x^p - x = x(x - 1)(x - 2)\cdots(x - (p-1)).$$
The polynomial $x^p - 1$ has derivative $0$ and has $1$ as a root. Hence it has $1$ as a repeated root. In fact
$$x^p - 1 = (x - 1)^p.$$

\begin{lemma}\label{lem:fresh}
    Let $R$ be a commutative ring of characteristic $p$ where $p$ is a prime. Then the map $r\mapsto r^p$ is a ring homomorphism $R\rightarrow R$. This is called the \wow{Frobenius} map, denoted $\Frob_p$.
    Composing the Frobenius map with itself also gives ring homomorphisms. In other words, for any $a,b\in R$ and any $n\in\N$, we have
    $$(a+b)^{p^n} = a^{p^n} + b^{p^n}.$$
\end{lemma}

\begin{proof}
    It is easy to see that $\Frob_p$ preserves $1$ and multiplication. To check addition, we use the Binomial Theorem to get, for any $a,b\in R$,
    $$(a+b)^p = a^p + \binom{p}{1}a^{p-1}b + \binom{p}{2}a^{p-2}b^2 + \cdots + b^p.$$
    We saw before that for $r = 1,\ldots,p-1$ (Lemma \ref{lem:important}), the binomial coefficient $\binom{p}{r}$ is divisible by $p$, which makes it $0$ in $R$. Hence, we have $(a + b)^p = a^p + b^p$.
\end{proof}

\begin{cor}\label{cor:pnmidorder}
    Let $R$ be an integral domain of characteristic $p$ where $p$ is a prime. Let $\alpha\in R^\times$ where $o(\alpha) = m\in\N$ exists. Then $p\nmid m$.
\end{cor}

\begin{proof}
    Suppose for a contradiction that $p\mid m$. Write $m = dp$ for some $d\in\N$. From $\alpha^m = 1$, we get
    $$0 = \alpha^{dp} - 1 = (\alpha^d - 1)^p.$$
    Since $R$ is an integral domain, we have $\alpha^d -1 = 0$ and so $\alpha^d = 1$. However, $1\leq d < m$ so this contradicts the minimality of $m$.
\end{proof}





\begin{center}
    \add{Lecture 19 Wed 10/23}

    \re{$F[x]$}
\end{center}

We now focus on the case where $R = F$ is a field. Recall that in this case, the division algorithm turns $F[x]$ into a Euclidean domain with $\deg$ as the function $N:F[x]\backslash\{0\}\rightarrow\N\cup\{0\}$. It turns out that for a PID, the notion of irreducible and prime, defined in Tutorial 14.5, coincide. The significance of the PID-ness is in the following lemma.

\begin{lemma}\label{lem:PIDgcd}
    Let $R$ be a PID. Suppose $f,g\in R$ such that their only common divisors are units. Then $f,g$ are coprime. In other words, $(f,g) = R$, or equivalently, there exists $a,b\in R$ such that $af + bg = 1$.
\end{lemma}

\begin{proof}
    Since $R$ is a PID, the ideal $(f,g)$ is of the form $(h)$ for some $h\in R$. Then $h$ is a common divisor of $f$ and $g$. So $h$ is a unit and thus $(f,g) = R$.
\end{proof}


A polynomial $f(x)\in F[x]$ is \wow{irreducible} if $\deg(f)\geq1$ and there does not exist polynomials $a(x),b(x)\in F[x]$ of degree at least $1$ such that $a(x)b(x) = f(x)$.

\v
\noindent\wow{Exercise}: Prove that everything in Sections 1 and 2 work for $F[x]$. What should the replacement notion for ``positive''?

\v
By Proposition \ref{prop:rem}, if $f(x)$ has a root $c\in F$, then $x - c\mid f(x)$. So if $f(x)$ is irreducible of degree at least $2$, then $f(x)$ has no roots in $F$. Conversely, if $f(x) = a(x)b(x)$ is reducible and has degree at most $3$, then at least one of $a(x)$ and $b(x)$ has degree $1$ and $f(x)$ will have a root.

\begin{lemma}
    Let $F$ be a field. Linear (degree $1$) polynomials in $F[x]$ are all irreducible. Quadratic (degree 2) and cubic (degree 3) polynomials in $F[x]$ are irreducible if and only if they don't have a root in $F$.
\end{lemma}

The Fundamental Theorem of Algebra states that every non-constant polynomial in $\C[x]$ has a root in $\C$. So the only irreducible polynomials in $\C[x]$ are linear. The Conjugate Root Theorem can then be used to say that the only irreducible polynomials in $\R[x]$ are linear or quadratic with negative discriminant ($ax^2 + bx + c$ with $b^2 - 4ac < 0$). The question becomes a lot harder for $\Q[x]$ or for $\F_p[x]$, and in fact lies at the heart of number theory!

For example, $x^2 + 1$ is irreducible in $\Q[x]$ and in $\R[x]$ because it doesn't have roots in $\Q$ or $\R$, but is reducible in $\C[x]$ because $i\in\C$ is a root and so $x^2 + 1 = (x + i)(x - i).$ \qt{Is $x^2 + 1$ irreducible in $\F_2[x]$?} \spp{No, because $1$ is a root and in fact $x^2 + 1 = (x + 1)^2$ in $\F_2[x]$.} \qt{What about $\F_3[x]$?} There are only three elements in $\F_3$: $0$, $1$, $2$; and we can check that none of them are roots: $$0^2 + 1 = 1,\qquad 1^2 + 1 = 2,\qquad 2^2 + 1 = 5 = 2.$$ So $x^2 + 1$ is irreducible in $\F_3[x]$. If we try this with $\F_5$, then we find that $$2^2 + 1 = 5 = 0\aa 3^2 + 1 = 10 = 0.$$
Hence $x^2 + 1 = (x  - 2)(x - 3)\in\F_5[x]$ is not irreducible. \qt{For which prime $p$ is $x^2 + 1$ irreducible in $\F_p[x]$?} We saw before that if $x^2\equiv -1\pmod{p}$ has a solution, then $p\equiv 1\pmod{4}$. We will see very soon that the converse is true: if $p\equiv 1\pmod{4}$, then $-1$ is a square mod $p$. So $x^2 + 1$ is irreducible in $\F_p[x]$ if and only if $p\equiv 3\pmod{4}$.

A degree $4$ polynomial can be reducible without having a root. For example, we can simply take the product of two irreducible polynomials of degree $2$. Here is a more interesting one. The polynomial $x^4 + 1$ has no root in $\F_3[x]$ by plug-and-check. Note that in $\F_3[x]$, we have
$$(x^2 - 1)^2 = x^4 - 2x^2 + 1 = x^4 + x^2 + 1$$
and so
$$x^4 + 1 = (x^2 - 1)^2 - x^2 = (x^2 + x - 1)(x^2 - x - 1).$$
In HW 7 Q3bonus, you will show that $x^4 + 1$ is reducible in $\F_p[x]$ for every prime $p$.



Note that $x^2 + 1$ has very different factorization behavior in $\F_2[x]$, $\F_3[x]$ or $\F_5[x]$. Namely, $x^2 + 1$ has a repeated factor in $\F_2[x]$, is irreducible in $\F_3[x]$, and is the product of two distinct monic linear polynomial in $\F_5[x]$. \qt{What can we say about the quotients $\F_2[x]/(x^2 + 1)$, $\F_3[x]/(x^2 + 1)$ and $\F_5[x]/(x^2 + 1)$?}

In Tutorial 17.5, we worked out the size of $\F_2[x]/(x^2 + x + 1)$ (or of $\F_5[x]/(x^2 + 3)$ in an alternate universe). The same argument gives the following.

\begin{lemma}\label{lem:Fmodg}
    Let $F$ be a field. Let $g(x)\in F[x]$ be a polynomial of degree $d\geq1$. Then
    $$F[x]/(g(x)) = \{[f(x)]\colon f(x)\in F[x],\deg(f) < d\}.$$
    If $F$ is finite, then
    $$|F[x]/(g(x))| = |F|^d.$$
\end{lemma}

We saw in Tutorial 17.5 that $\F_2[x]/(x^2 + 1)$ is a ring of characteristic $2$ and order $4$ with a nonzero element $[x+1]$ that square to $0$, and a non-identity element $[x]$ that square to $1$. So it is not isomorphic to $\Z/4\Z$ or $(\Z/2\Z)\times(\Z/2\Z) = \F_2\times\F_2$. Note that $\F_2\times\F_2$ has the special property that every element squares to itself! You will explore this more in HW 7 P2.

We consider $\F_5[x]/(x^2 + 1)$ next. In this case, $$\F_5[x]/(x^2 + 1) = \F_5[x]/((x - 2)(x - 3)).$$
We can now apply the Chinese Remainder Theorem (Theorem \ref{thm:CRTPID}). We need to check that $x - 2$ and $x - 3$ are coprime. Note that $1 = (x - 2) + (-1)(x  - 3) \in(x - 2,x-3)$. So $(x-2,x-3) = \F_5[x]$. Hence
$$\F_5[x]/((x - 2)(x - 3))\cong \F_5[x]/(x-2)\times\F_5[x]/(x-3)\cong\F_5\times\F_5.$$

The ring $\F_3[x]/(x^2 + 1)$ is a field for the same reason that $\F_5[x]/(x^2 + 3)$ is a field: the polynomial $x^2 + 1$ is irreducible in $\F_3[x]$.



\begin{comment}
Imagine trying to show that $[x+1]$ is a unit in $\F_3[x]/(x^2 + 1)$. This amounts to proving the existence of some $f(x)\in\F_3[x]$ such that
$$(x + 1)f(x) - 1 \in (x^2 + 1).$$
In other words, we want to show that there exists $f(x),g(x)\in\F_3[x]$ such that
$$(x + 1)f(x) + (x^2 + 1)g(x) = 1.$$
This is the same as proving that the ideal $(x + 1, x^2 + 1)$ is the entire ring, since we want it to contain $1$. Now $\F_3[x]$ is a PID, so we know $(x + 1,x^2 + 1) = (h(x))$ for some polynomial $h(x)\in\F_3[x]$. Note that this implies $h(x)\mid x^2 + 1$. However, $x^2 + 1$ is \wow{irreducible}! So either $h(x)$ is a unit, or $h(x)$ is a unit times $x^2 + 1$. If $h(x)$ is a unit, then $(x + 1, x^2 + 1)$ is the entire ring as desired. If $h(x)$ is a unit times $x^2 + 1$, then from $h(x)\mid x+1$, we get $x^2 + 1\mid x+1$, which is not possible for degree reasons, but more intrinsically contradicts $[x+1]\neq 0$. We have thus given a proof by example of $(a)\Rightarrow(b)$ below:
\end{comment}

\begin{proposition}\label{prop:F/g}
    Let $F$ be a field and let $g(x)\in F[x]$ with degree at least $1$. Then the following are equivalent:
    \begin{enumerate}[(a)]
        \item $g(x)$ is irreducible.
        \item $F[x]/(g(x))$ is a field;
        \item $F[x]/(g(x))$ is an integral domain;
    \end{enumerate}
\end{proposition}

\begin{proof}
    The main content is $(a)\Rightarrow(b)$. Let $[f(x)]$ be a nonzero element of $F[x]/(g(x))$. Then $g(x)\nmid f(x)$. The ideal $(f(x),g(x))$ in $F[x]$ is of the form $(a(x))$ for some $a(x)\in F[x]$ since $F[x]$ is a PID. Since $a(x)\mid g(x)$ and $g(x)$ is irreducible, we see that either $a(x) = u$ or $a(x) = g(x)u$ for some unit $u\in F[x]^\times = F^\times$. If $a(x) = g(x)u$, then from $a(x)\mid f(x)$, we have $g(x)\mid f(x)$ which is not possible. So $a(x) = u$ and hence $(f(x),g(x)) = F[x]$. There then exist $b(x),c(x)\in F[x]$ such that $f(x)b(x) + g(x)c(x) = 1$. In $F[x]/(g(x))$, this gives $[f(x)][b(x)] = 1$ and so $[f(x)]$ is a unit.

    $(b)\Rightarrow(c)$ follows because fields are integral domains (Lemma \ref{lem:fieldid}(c)). To prove $(c)\Rightarrow(a)$, we consider its contrapositive. Suppose $g(x)$ is reducible. \qt{(This is essentially the $\F_2[x]/(x^2 + 1)$ and $\F_5[x]/(x^2 + 1)$ example.)} By definition, $g(x) = a(x)b(x)$ for some $a(x),b(x)\in F[x]$ with degrees between $1$ and $\deg(g) - 1$. Then $[a(x)]$ and $[b(x)]$ are nonzero in $F[x]/(g(x))$ but their product is $[g(x)] = [0]$. Hence $F[x]/(g(x))$ is not an integral domain. This proves $(c)\Rightarrow(a).$
\end{proof}

We can now construct a field of order $4$, we can try finding an irreducible polynomial $g(x)\in\F_2[x]$ of degree $2$ so that $\F_2[x]/(g(x))$ is a field of order $2^2 = 4$. We need $g(0)\neq 0$ so $g(x) = x^2 + ax + 1$. We need $g(1)\neq 0$, so $g(1) = a\neq 0$. Then $g(x) = x^2 + x + 1$ is the unique irreducible polynomial of $\F_2[x]$ of degree $2$. We then have our $\F_4 =\F_2[x]/(x^2 + x + 1).$

Let's find all irreducible polynomials in $\F_2[x]$ of degree $3$. The same characterization using roots applies. From $g(0)\neq 0$, we have $g(x) = x^3 + ax^2 + bx + 1$ for some $a,b\in\F_2$. From $g(1) \neq 0$, we have $a + b\neq 0$. So there are two choices: $a = 1,b=0$ or $a = 0,b=1$. i.e
$$x^3 + x^2 + 1\aa x^3 + x + 1.$$
Then both $\F_2[x]/(x^3 + x^2 + 1)$ and $\F_2[x]/(x^3 + x + 1)$ are fields of order $8$. \qt{Are they isomorphic?}

What about irreducible polynomials in $\F_2[x]$ of degree $4$? We can list out all polynomials $x^4 + ax^3 + bx^2 + cx + 1$ with $a + b + c \neq 0$ (so that it has no root in $\F_2$), and then remove the any polynomial that is a product of two irreducible quadratic polynomials. Since $x^2 + x + 1$ is the only irreducible quadratic polynomial, we just need to remove $(x^2 + x + 1)^2 = x^4 + x^2 + 1$. So we have
$$x^4 + x^3 + x^2 + x + 1\aa x^4 + x^3 + 1\aa x^4 + x + 1.$$
\wow{Challenging question: Note that $x^4 + x^3 + x^2 + x + 1 = \Phi_5(x)$ and $x^2 + x + 1 = \Phi_3(x)$. When is $\Phi_m(x)$ irreducible in $\F_2[x]$?} \qt{Given a prime $p$ and a degree $d\geq 1$, is there always an irreducible polynomial in $\F_p[x]$ of degree $d$?} The polynomial $$x^{420} + x^{419} + \cdots + x + 1 = \Phi_{421}(x)$$
turns out to be irreducible in $\F_2[x]$ of degree $420$. In HW 7 Q3bonus, you will find necessary and sufficient conditions for $\Phi_m(x)$ to be irreducible in $\F_p[x]$.


\v
We construct a field of order $p^2$ in general where $p>2$. In light of Lemma \ref{lem:Fmodg} and Proposition \ref{prop:F/g}, we need to find an irreducible quadratic polynomial $g(x)$ in $\F_p[x]$. We know that for degree $2$ polynomials, being irreducible is the same as having no roots. So a candidate for $g(x)$ would be $x^2 - r$ where $r\in\F_p$ is not a square. For example in $\F_7$, we have
$$0^2 = 0,\qquad1^2 = 6^2 = 1,\qquad2^2 = 5^2 = 4, \qquad 3^2 = 4^2 = 2.$$
So the non-squares are $3,5,6$ and we see that $x^2 - 3$, $x^2 - 5$, $x^2 - 6$ are all irreducible in $\F_7$. By taking for example $\F_7[x]/(x^2 - 3)$, we get a field of order $49$.


\begin{center}
    \add{Lecture 20 Fri 10/25}

    \re{$\F_{p^2}$}
\end{center}
\begin{proposition}
    Let $p>2$ be a prime. Then there exists $r\in \F_p$ such that $x^2 - r$ is irreducible in $\F_p[x]$. We can then take $\F_{p^2} \cong \F_p[x]/(x^2 - r)$.
\end{proposition}

\begin{proof}
    We need to show the existence of some $r\in\F_p$ that is not the square of some element of $\F_p$. We can simply count the squares in $\F_p = \{0,1,\ldots,p-1\}$. Note that for any $a = 1,2,\ldots,(p-1)/2$, we have
    $$a^2 = (-a)^2 = (p-a)^2$$
    while $p-a$ covers all the values $(p+1)/2,\ldots,p-1$. So there are at most $(p+1)/2 = (p-1)/2 + 1$ squares in $\F_p$. Now $p - (p+1)/2 = (p-1)/2\geq1$ and so we may take $r$ to be one of the non-squares. Then $x^2 - r$ has no root in $\F_p$.
\end{proof}

It is easy to check that the squares $1^2,2^2,\ldots,((p-1)/2)^2$ are distinct in $\F_p$, \add{as $a^2 = b^2$ iff $a^2 - b^2 = (a - b)(a + b) = 0$ iff $a = \pm b$}. So there are exactly $(p-1)/2$ nonzero squares. Note that if $r$ is a nonzero square and $s$ is a non-square, then $rs$ is a non-square (for if $rs$ is a square, then $s = (rs)/r$ is a square). If we fix a non-square $r_0\in \F_p$, then we can split $\F_p$ into $$\F_p = \{0\} \cup \{1^2,2^2,\ldots,((p-1)/2)^2\} \cup \{r_0\cdot 1^2, r_0\cdot 2^2,\ldots, r_0\cdot ((p-1)/2)^2\}.$$

\begin{cor}
    Let $p>2$ be a prime. If $r$ and $s$ are two non-squares in $\F_p$, then $r/s$ is a square.
\end{cor}

For example, in $\F_7$, the nonzero squares are $1,2=3^2,4=2^2$ and the non-squares are $3, 5=3\cdot2^2, 6 = 3\cdot 3^2.$ Let's prove that $\F_7[x]/(x^2 - 3)$ and $\F_7[x]/(x^2 - 5)$ are isomorphic.
\begin{itemize}
    \item Since $\F_7[x]/(x^2 - 5)$ is a field, any homomorphism from it is automatically injective (Corollary \ref{cor:fieldinj}).
    \item Since $\F_7[x]/(x^2 - 5)$ and $\F_7[x]/(x^2 - 3)$ have the same size $49$, any injective homomorphism between them is automatically surjective and so an isomorphism.
    \item To write down a homomorphism $\F_7[x]/(x^2 - 5)\rightarrow \F_7[x]/(x^2 - 3)$, it is the same to write down a homomorphism $\psi:\F_7[x]\rightarrow \F_7[x]/(x^2 - 3)$ such that $\psi(x^2 - 5) = 0$ (Proposition \ref{prop:quotuniv}).
    \item To write down $\psi$, it is the same to write down a homomorphism $\varphi:\F_7\rightarrow\F_7[x]/(x^2 - 3)$ along with some $\beta\in\F_7[x]/(x^2 - 3)$ as the image of $x$ (Proposition \ref{prop:univRx}).
    \item Since $\varphi(1) = 1$, it must be the identity map on $\F_7$ and so
    $$\psi(a_nx^n + \cdots + a_0) = a_n\beta^n + \cdots + a_0.$$
    \item The condition $\psi(x^2 - 5) = 0$ translates to $\beta^2 - 5 = 0$. So we just need to find an element $\beta$ of $\F_7[x]/(x^2 - 3)$ such that $\beta^2 = 5$.
    \item We write $[f(x)]$ for an element of $\F_7[x]/(x^2 - 3)$. Then $[x]^2 = [x^2] = [x^2 - 3 + 3] = [3] = 3.$ Since $5 = 3\cdot 4 = 3\cdot 2^2$, we see that $[2x]^2 = [x]^2\cdot2^2 = 5.$ Hence we may take $\beta = [2x]$. This concludes the proof that
    $$\F_7[x]/(x^2 - 5)\cong \F_7[x]/(x^2 - 3)$$
\end{itemize}

The above proof works more generally and implies:

\begin{proposition}
    Let $p>2$ be a prime. If $r$ and $s$ are two non-squares in $\F_p$, then $$\F_p[x]/(x^2 - r)\cong\F_p[x]/(x^2 - s).$$
\end{proposition}

\noindent\wow{Exercise}: Find an isomorphism $\F_2[x]/(x^3 + x^2 + 1)\cong\F_2[x]/(x^3 + x + 1)$. In other words, find an element $\beta\in\F_2[x]/(x^3 + x + 1)$ satisfying $\beta^3 + \beta^2 + 1 = 0.$

\subsection*{Exercise}
\begin{enumerate}[\thesection .1]
    \item Prove that the ideal $(2,x)$ in $\Z[x]$ is not principal.
    \item Let $R$ be a commutative ring and let $I$ be a proper ideal of $R$. We say $I$ is a \textbf{maximal ideal} of $R$ if there does not exist a proper ideal $J$ such that $I$ is a proper subset of $J$. Prove that $I$ is maximal if and only if $R/I$ is a field.

    \item Give an example of a commutative ring $R$, a maximal ideal $I$, and a subring $S$ such that $S\cap I$ is not maximal in $S$.\label{exer:9.4}
    \item Let $R$ be a commutative ring and let $S$ be a subring. Let $I$ be a prime ideal of $R$. Prove that $S\cap I$ is a prime ideal of $S$.

\end{enumerate}

\section{Finite fields}

The main theorem in the theory of finite fields is:
\begin{theorem}\label{thm:fieldmain} (Classification of finite fields)
    \begin{enumerate}[(a)]
        \item Every finite field has order $p^d$ for some prime $p$ and positive integer $d$.
        \item Any two finite fields of the same order are isomorphic.
        \item For every prime $p$ and every positive integer $d$, there exists a polynomial $g(x)\in\F_p[x]$ irreducible of degree $d$. We write $\F_{p^d}\cong\F_p[x]/(g(x))$.
        \item There exists a homomorphism $\F_{p^d}\rightarrow \F_{p^n}$ if and only if $d\mid n$.
    \end{enumerate}
\end{theorem}

\v
\noindent\textbf{Proof of Theorem \ref{thm:fieldmain}(a)}: We proved (a) before. Let $F$ be a finite field. Since a field is an integral domain, we know by Lemma \ref{lem:charid} that $\mathrm{char}(F)$ is some prime $p$, and Theorem \ref{thm:69} then gives $p\mid |F|$. By HW 5 Q2, for every element $a\in F$, its additive order $o_+(a)$ divides $\mathrm{char}(F)$, and so it is either $p$ or $1$. By HW 5 Q3, if $q$ is a prime divisor of $|F|$, then $F$ contains an element with additive order $q$, which must be $p$ or $1$. Hence $p$ is the only prime divisor of $|F|$, implying that $|F| = p^d$ for some positive integer $d$.\hfill$\Box$

\v
A very important step in the proof of Theorem \ref{thm:fieldmain} is the following.

\begin{proposition}\label{prop:82}
    Let $F$ be a finite field with a subring $E$. Then $F\cong E[x]/(g(x))$ for some irreducible polynomial $g(x)\in E[x]$.
\end{proposition}

Note that any subring of $F$ will be a finite integral domain, and so is automatically a field. We will also say $E$ is a subfield of $F$.

We have some immediate consequences of Proposition \ref{prop:82}. Suppose $F$ is a finite field of characteristic $p$. Then we may view $\F_p$ as a subfield of $F$. Proposition \ref{prop:82} then gives $F\cong \F_p[x]/(g(x))$ for some irreducible $g(x)\in\F_p[x]$, which gives another proof of Theorem \ref{thm:fieldmain}(a) as $|F| = p^{\deg(g)}$. To prove Theorem \ref{thm:fieldmain}(b), we just need to show that if $g,h$ are irreducible polynomials in $\F_p[x]$ of the same degree, then $\F_p[x]/(g(x))$ and $\F_p[x]/(h(x))$ are isomorphic. Using the same approach for proving that $\F_7[x]/(x^2 - 3)$ and $\F_7[x]/(x^2 - 5)$ are isomorphic, we are just trying to find some root $\beta$ of $g(x)$ in $\F_p[x]/(h(x))$. This is another very important step.

\begin{proposition}\label{cor:irredroot}
    Let $F$ be a field of order $p^n$ and let $g(x)\in \F_p[x]$ be an irreducible polynomial of degree $d$ with $d\mid n$. Then $g(x)$ has a root in $F$.
\end{proposition}

\begin{center}
    \add{Lecture 20.5 Fri 10/25\\ Tutorial}

    \re{Classification of commutative rings of order $p^2$}
\end{center}

We have seen that there are $4$ commutative rings of order $4$: $$\Z/4\Z,\qquad\F_2\times\F_2,\qquad\F_2[x]/(x^2 + 1),\qquad\F_2[x]/(x^2 + x + 1) = \F_4.$$
Recall also that $\F_5[x]/((x - 2)(x - 3))\cong \F_5\times\F_5$, so we can view $\F_2\times\F_2$ as $\F_2[x]/(x^2 + x)$ using the factorization $x^2 + x = x(x + 1)$ and the Chinese Remainder Theorem:
$$\F_2[x]/(x^2 + x)\cong \F_2[x]/(x)\times\F_2[x]/(x+1)\cong \F_2\times\F_2.$$
The only missing degree $2$ polynomial is $x^2$, but it is easy to check that
$$\F_2[x]/(x^2)\cong\F_2[x]/((x+1)^2) = \F_2[x]/(x^2 + 1),$$
via the homomorphism $\F_2[x]\rightarrow\F_2[x]/((x+1)^2)$ sending $x \mapsto x+1 + ((x+1)^2).$

\begin{proposition}\label{prop:ringp2}
    Let $p$ be a prime. There are exactly four commutative rings of order $p^2$ up to isomorphism:
$$\Z/p^2\Z,\qquad\F_p\times\F_p,\qquad\F_p[x]/(x^2),\qquad\F_{p^2}.$$
\end{proposition}

\begin{proof}
    We will prove soon that finite fields of the same order are isomorphic (\qt{spoiler!}), so we only classify commutative rings of order $p^2$ that are not fields. Let $R$ be a commutative ring of order $p^2$ that is not a field. We know from Lemma \ref{lem:chardiv} that the characteristic of $R$ divides $p^2$. Hence it is either $p$ or $p^2$. If the characteristic of $R$ is $p^2$, then by Proposition \ref{prop:orderchar}, we have $R\cong\Z/p^2\Z$.

    Suppose now $R$ has characteristic $p$. Then the prime subring (image of the canonical map $\Z\rightarrow R$) is isomorphic to $\F_p$. We will use this to view $\F_p$ as a subring of $R$. Since $|R| > p$, we may take some $\beta\in R\backslash\F_p$. We claim that
    $$R = \{a + b\beta\colon a,b\in\F_p\}.$$
    The RHS is clearly a subset of $R$. There are $p^2$ possible choices for $(a,b)$. We claim that they give distinct elements. Suppose $a_1,b_1,a_2,b_2\in\F_p$ such that
    $$a_1 + b_1\beta = a_2 + b_2\beta.$$
    Then $a_1 - a_2 = (b_2 - b_1)\beta$. If $b_1\neq b_2$, then $b_2 - b_1\neq 0$ and we can divide to find
    $$\beta = (a_1 - a_2)(b_2 - b_1)^{-1}\in\F_p.$$
    Contradiction. Hence $b_1 = b_2$ and then $a_1 - a_2 = 0$ implying that $a_1 = a_2$. Thus, $\{a + b\beta\colon a,b\in\F_p\}$ is a subset of $R$ containing the same number of elements as $R$ and so equals $R$.

    Now that we know that $R$ is \wow{generated by $\F_p$ and $\beta$}, we look at the evaluation homomorphism $\mathrm{ev}_\beta:\F_p[x]\rightarrow R.$ Note that $\mathrm{ev}_\beta(a + bx) = a + b\beta$ for any $a,b\in\F_p$. Hence $\mathrm{ev}_\beta$ is surjective. By the first isomorphism theorem, we have $R\cong \F_p[x]/\ker(\mathrm{ev}_\beta).$ Since $\F_p[x]$ is a PID, we see that $\ker(\mathrm{ev}_\beta) = (g(x))$ for some polynomial $g(x)\in F[x]$. By dividing by the leading coefficient of $g(x)$, which is a unit in $F[x]$, we may assume $g(x) = x^d + \cdots$ is monic of degree $d$. By Lemma \ref{lem:Fmodg}, we have
    $$p^2 = |R| = |\F_p[x]/(g(x))| = p^d \qquad\Longrightarrow\qquad d = 2.$$
    Since we assumed that $R$ is not a field, we know that $g(x)$ is not irreducible. Since $g(x)$ has degree $2$, we have
    $$g(x) = (x - c)(x - d)\qquad\mbox{for some }c,d\in\F_p.$$
    If $c\neq d$, then we use the Chinese Remainder Theorem to obtain
    $$R\cong\F_p[x]/((x - c)(x - d))\cong\F_p[x]/(x - c)\times\F_p[x]/(x - d)\cong\F_p\times\F_p.$$
    If $c = d$, then we have
    $$R\cong\F_p[x]/((x - c)^2)\cong\F_p[x]/(x^2).$$
    This completes the proof.
\end{proof}


The key to the above argument is
$$R = \{a + b\beta\colon a,b\in\F_p\}.$$
It allows us to have a surjection $\F_p[x]\rightarrow R$. For the purpose of classifying finite fields, we will prove a similar result.


\begin{theorem}\label{thm:fieldprim}
    Let $F$ be a finite field of size $q$. Then there exists $\alpha\in F^\times$ such that $o(\alpha) = q - 1$.
\end{theorem}

Suppose we have $o(\alpha) = q - 1$. Then the elements $\alpha^1,\alpha^2,\ldots,\alpha^{q-1}$ are all distinct. Indeed, if $\alpha^i = \alpha^j$ for some $1\leq i < j \leq q - 1$, then $1 = \alpha^{j-i}$ where $0 < j - i < q - 1$, contradicting $o(\alpha) = q - 1$. Note that $|F^\times| = q - 1$. So we have
$$F^\times = \{\alpha^1,\alpha^2,\ldots,\alpha^{q-1}\}.$$
Suppose now $E$ is a subfield of $F$. Then the evaluation homomorphism $\mathrm{ev}_\alpha:E[x]\rightarrow F$ sending $f(x)$ to $f(\alpha)$ is surjective, since $\mathrm{ev}_\alpha(x^j) = \alpha^j$ gives all the elements of $F^\times$ and certainly $\mathrm{ev}_\alpha(0) = 0.$ By the first isomorphism theorem, we have
$$F\cong E[x]/\ker(\mathrm{ev}_\alpha) = E[x]/(g(x))$$
for some polynomial $g(x)\in E[x]$. Since $F$ is a field, we see that $g(x)$ is irreducible in $E[x]$ by Proposition \ref{prop:F/g}. We have now proven Proposition \ref{prop:82} assuming Theorem \ref{thm:fieldprim}.



We can also prove Theorem \ref{thm:fieldmain}(d,$\Rightarrow$). Suppose there is a homomorphism $\varphi:\F_{p^d}\rightarrow\F_{p^n}$. Since a homomorphism from a field is automatically injective, we apply Proposition \ref{prop:82} to $F = \F_{p^n}$ and $E = \mathrm{im}(\varphi)\cong\F_{p^d}.$ We get $F\cong E[x]/(g(x))$ for some polynomial $g(x)\in E[x]$ of degree $m$. Then  by Lemma \ref{lem:Fmodg}, we have
$|F| = p^n = |E|^m = p^{dm}.$
So $n = dm$ is divisible by $d$.

\begin{center}
    \add{Lecture 21 Mon 10/28}

    \re{Finite fields}
\end{center}

We have seen, assuming Theorem \ref{thm:fieldprim}, that every finite field of characteristic $p$ is isomorphic to $\F_p[x]/(g(x))$ for some irreducible polynomial $g(x)\in\F_p[x]$. Moreover, if $F'$ is a field of characteristic $p$, so that $\F_p\subseteq F'$, then to define a homomorphism $\F_p[x]/(g(x))\rightarrow F'$, it suffices to find a root $\beta$ of $g(x)$ in $F'$. It will be automatically be injective since  $\F_p[x]/(g(x))$ is a field, and surjective if $|F'| = p^{\deg(g)}$.

For any field $F$ and any polynomial $f(x)\in F[x]$ of degree $d\geq 1$, we say $f(x)$ \wow{splits completely} in $F$ if
$f(x) = c_0(x - c_1)\cdots(x - c_d)$
for some $c_0,\ldots,c_d\in F$. The key result is:

\begin{proposition}\label{cor:irredsplit}
    Let $F$ be a field of order $p^n$ and let $g(x)\in \F_p[x]$ be an irreducible polynomial of degree $d$ with $d\mid n$. Then $g(x)$ splits completely in $F$.
\end{proposition}

\noindent\textbf{Proof of Theorem \ref{thm:fieldmain}(b) and (d, $\Leftarrow$) assuming Proposition \ref{cor:irredsplit}}: Suppose $g(x)\in \F_p[x]$ is irreducible of degree $d$. Taking $n = d$, we see that if $F$ is a field of order $p^d$, then $g(x)$ splits completely in $F$ and in particular has a root $\beta$. Then the usual argument implies that $\F_p[x]/(g(x))\rightarrow F$ sending $[f(x)]$ to $f(\beta)$ is an isomorphism.

To prove (d, $\Leftarrow$), we assume $d\mid n$. By definition, $\F_{p^n}$ is a field of order $p^n$. So by Proposition \ref{cor:irredsplit}, $g(x)$ splits completely in $\F_{p^n}$. Using a root $\beta$ in $\F_{p^n}$, we obtain a homomorphism $\F_p[x]/(g(x))\rightarrow\F_{p^n}$. Composing this with $\F_p[x]/(g(x))\cong\F_{p^d}$ gives the desired homomorphism of (d, $\Leftarrow$). \hfill$\Box$

\v
To prove Proposition \ref{cor:irredsplit}, we note that for every $\alpha\in F^\times$, we have $\alpha^{|F^\times|} = 1$ by Theorem \ref{thm:69}(b). Since $|F^\times| = |F| - 1 = p^n - 1$, we see that
$$\forall \alpha\in F,\qquad \alpha^{p^n} = \alpha.$$
The polynomial $x^{p^n} - x\in\F_p[x]$ has degree $p^n$, and has every element of $F$ as a root. Since there are exactly $p^n$ elements of $F$, we see that similar to the factorization of $x^p - x$, we have
$$x^{p^n} - x = \prod_{\alpha\in F}(x - \alpha).$$


\begin{theorem}\label{thm:fact}
    Let $p$ be a prime and let $n\in\N$. Then $x^{p^n}-x$ is the product of all monic irreducible polynomials in $\F_p[x]$ of degree dividing $n$.
\end{theorem}

As a consequence, if $g(x)\in\F_p[x]$ is monic irreducible of degree $d\mid n$, then $g(x)\mid x^{p^n} - x$ in $\F_p[x]$. Since $x^{p^n} - x$ splits completely in $F$, so does its factor $g(x)$. This completes the proof of Proposition \ref{cor:irredsplit} assuming Theorem \ref{thm:fact}.

\v
Let $S_p(n)$ denote the set of monic irreducible polynomials in $\F_p[x]$ of degree $n$. Then Theorem \ref{thm:fact} is equivalent to the factorization
$$x^{p^n} - x = \prod_{d\mid n}\prod_{g\in S_p(d)}g(x).$$
Taking degrees, we have
$$p^n = \sum_{d\mid n}d\cdot|S_p(d)|.$$
We recall the Mobius inversion formula from HW 3 P4. Let $\mu:\N\rightarrow\{-1,0,1\}$ denote the Mobius function defined by
$$\mu(n) = \begin{cases}(-1)^{d(n)}&\mbox{if }n\mbox{ is squarefree}\\
0&\mbox{otherwise}\end{cases}$$
where $d(n)$ denotes the number of distinct prime divisors of $n$. You proved that if $f,g:\N\rightarrow\C$ satisfy $\displaystyle f(n) = \sum_{d\mid n}g(d)$, then $\displaystyle g(n) = \sum_{d\mid n}\mu(d)f(n/d).$ We now use this with $f(n) = p^n$ and $g(n) = n\cdot |S_p(n)|$ to get
$$n\cdot |S_p(n)| = \sum_{d\mid n}\mu(d)p^{n/d}.$$
For example
$$|S_2(69)| = \frac{1}{69}\Big(2^{69} - 2^{23} - 2^{3} + 2^1\Big)> 0.$$
This example illustrates the main idea: \wow{the term $d = 1$ gives $p^n$}, which dominates all other terms.
Note that if $d>1$, then $n/d \leq n/2$. Hence
$$\left|\sum_{d\mid n,d>1} \mu(d)p^{n/d}\right| \leq p^{\lfloor n/2\rfloor} + p^{\lfloor n/2\rfloor-1} + \cdots + 1 < p^{\lfloor n/2\rfloor+1} \leq p^n.$$
Hence
$$|S_p(n)| = \frac{1}{n}\left(p^n - \sum_{d\mid n,d>1} \mu(d)p^{n/d}\right) > 0.$$
This completes the proof of Theorem \ref{thm:fieldmain}(c).

\v
\noindent\textbf{Proof of Theorem \ref{thm:fact}}: We first note that $x^{p^n} - x$ has no repeated factors since its derivative is $p^nx^{p^n-1} - 1 = -1$, which has no factors. (If $f(x) = g(x)^2h(x)$, then $g(x)\mid f'(x)$.)

Let now $g(x)\in S_p(d)$. It remains to show that $g(x)\mid x^{p^n} - x$ in $\F_p[x]$ if and only if $d\mid n$. Let $F = \F_p[x]/(g(x))$ and let $\beta = [x]$. Then $F$ is a field of order $p^d$ and $g(x)\mid x^{p^n} - x$ if and only if $\beta^{p^n} = \beta$. Without loss of generality, we assume $g(x)\neq x$ so that $\beta\neq 0$. On the other hand, from the formula $$\gcd(p^n - 1, p^m - 1) = p^{\gcd(n,m)} - 1$$
hinted at HW 1, we know that $d\mid n$ if and only if $p^d - 1 \mid p^n - 1$. Hence, it remains to prove
$$\beta^{p^n - 1} = 1 \quad\Longleftrightarrow\quad p^d - 1\mid p^n - 1.$$
Since $\beta\in F^\times$, we know that $\beta^{p^d - 1} = 1$. This gives immediately ($\Leftarrow$). For $(\Rightarrow)$, let $\sigma:F\rightarrow F$ be the raising to the $p^n$ homomorphism. In other words, $\sigma = \mathrm{Frob}_p^n$ is the Frobenius homomorphism composed with itself $n$ times. The assumption that $\beta^{p^n} = \beta$ implies that $\sigma(\beta) = \beta$. Since $\sigma(a) = a$ for every $a\in\F_p$, we see that $\sigma$ is in fact the identity map on $F$. In other words, for every $\alpha\in F^\times$, we have $\alpha^{p^n} = \alpha$ and so $\alpha^{p^n - 1} =1$, which implies that $o(a)\mid p^n - 1$. By Theorem \ref{thm:fieldprim}, there exists $\alpha\in F^\times$ with $o(\alpha) = p^d - 1$, and so $p^d - 1\mid p^n - 1$. \hfill$\Box$


\begin{center}
    \add{Lecture 22 Wed 10/30}

    \re{Using finite fields}
\end{center}

\v
All that remains now is to prove Theorem \ref{thm:fieldprim}.

\v
\noindent\textbf{Proof of Theorem \ref{thm:fieldprim}}: Let $F$ be a field of $q$ elements. We want an element $a$ with $o(a) = m = q-1$. Every element of $F^\times$ has order dividing $m$. For any positive divisor $d$ of $m$, let $N_d$ denote the number of elements in $F$ with order exactly $d$. Then we have $$m = \sum_{d\mid m} N_d.$$
Recall that we also have
$$m = \sum_{d\mid m} \phi(d)$$ from the factorization of $x^m - 1$ in cyclotomic polynomials (Corollary \ref{cor:sumphi}). We first prove that $N_d=0$ or $N_d = \phi(d)$. Suppose $N_d > 0$ and let $\alpha$ be an element of order $d$. \qt{Can we express all elements of order $d$ in terms of $\alpha$?} Any element of order $d$ is a root of the degree $d$ polynomial $x^d - 1\in F[x]$ and $\alpha,\alpha^2,\ldots,\alpha^{d}$ already give $d$ of them, which are all distinct since $d = o(\alpha)$. In other words, any element of order $d$ must be one of these $d$ powers of $\alpha$. Recall from HW 4 P1(a) that for any integer $k$, $$o(\alpha^k) = \frac{o(\alpha)}{\gcd(k, o(\alpha))}.$$ Hence we see that $o(\alpha^k) = d$ if and only if $\gcd(k, o(\alpha)) = 1$. Therefore, $N_d = \phi(d)$.

Note that in both cases, we have $N_d \leq \phi(d)$ so $\phi(d) - N_d\geq0$. Now
$$0 = \sum_{d\mid m} (\phi(d) - N_d).$$
Hence, we must have $\phi(d) = N_d$ for all $d\mid m$. In particular, $N_m = \phi(m) > 0$. \hfill$\Box$


\v
\add{It is worth noting that $F[x]$ and $\Z$ are very similar. We have the division algorithm so that both are Euclidean domains and PIDs. We have a notion of irreducible/prime elements. We can pretend that monic polynomials are like positive integers. We have unique factorizations into irreducible/primes. However, $F[x]$ has an extra operation, namely differentiation, that allows one to prove more. For example, the versions of the abc conjecture (Mason's Theorem) and Fermat's last theorem over $F[x]$ are much easier. One can also test for the existence of repeated roots by applying the Euclidean algorithm to find the gcd of $h(x)$ and $h'(x)$. However, testing for squarefree integers is as difficult as factorization.}



For $n = 1$, we have the factorization
$$x^p - x = x(x - 1)\cdots(x - (p-1)).$$
Canceling the $x$ gives $$x^{p-1} - 1 = (x - 1)(x - 2)\cdots(x - (p-1)),$$
which we already knew from Fermat's little theorem. Setting $x = 0$ gives $$-1 = (-1)^{p-1}(p-1)!\qquad\mbox{in }\F_p.$$
Translating it to integer congruences gives Wilson's Theorem
$$(p-1)!\equiv -1\pmod{p}.$$
The fact that $x^p - x$ has all of its roots in $\F_p$ is also very useful for determining when an element $\alpha\in\F_{p^n}$ actually belongs to $\F_p$.

\begin{cor}\label{cor:Fppn}
    Let $F$ be a field of order $p^n$ for some prime $p$ and positive integer $n$. Then $\alpha\in F$ belongs to the prime subfield $\F_p$ if and only if $\alpha^p = \alpha$.
\end{cor}


When $n = 2$, we note that every quadratic polynomial over $\F_p$ splits completely in $\F_{p^2}$. Indeed, if a quadratic polynomial $f(x)\in\F_p[x]$ is reducible, then it already splits completely in $\F_p$; if $f(x)$ is irreducible, then it splits completely in $\F_{p^2}$ by Corollary \ref{cor:irredsplit}.

\begin{cor}
    Let $p$ be a prime and $n\in\N$. Then any degree $n$ polynomial in $\F_p[x]$ splits completely in $\F_{p^{L_n}}$ where $L_n = \lcm(1,2,\ldots,n)$. \add{The statement is false if $\F_{p^{L_n}}$ is replaced by any smaller field.}
\end{cor}

\begin{proof}
    Let $f(x)\in\F_p[x]$ be an arbitrary polynomial of degree $n$. Let $g(x)\in\F_p[x]$ be any irreducible factor of $f(x)$. Then $\deg(g)\leq n$ and so $\deg(g)\mid L_n$. By Corollary \ref{cor:irredsplit}, we have that $g(x)$ splits completely in $\F_{p^{L_n}}$. Since $f(x)$ is a product of its irreducible factors (with multiplicities), we see that $f(x)$ also splits completely in $\F_{p^{L_n}}.$

    \add{We now prove the second statement. Suppose any degree $n$ polynomial splits completely in $\F_{p^N}$ for some $N\in\N$. It suffices to prove $L_n\mid N$. Let $q\leq n$ be any prime and let $k = \lfloor \log_q n\rfloor = \nu_q(L_n)$. Then $q^k\leq n$. Let $h(x)\in\F_p[x]$ be an irreducible polynomial of degree $q^k$ and let $f(x) = h(x)x^{n - q^k}$. Since $f(x)$ splits completely in $\F_{p^N}$, we see that $h(x)$ splits completely in $\F_{p^N}$. In particular, $h(x)$ has a root in $\F_{p^N}$ and so we have an homomorphism $\F_p[x]/(h(x))\rightarrow\F_{p^N}$ which is only possible if $\deg(h)\mid N$ by Theorem \ref{thm:fieldmain}(d). So $q^k\mid N$. Since this is true for all primes $q\leq n$, we have $L_n\mid N$.}
\end{proof}

We now use the field $\F_{p^2}$ to prove the infinitude of primes $\equiv -1\pmod{7}$.
\begin{theorem}\label{thm:p7}
    Let $p$ be a prime divisor of $n^3 + n^2 - 2n - 1$ for some integer $n$. Then $p = 7$ or $p\equiv \pm1\pmod{7}$.
\end{theorem}

\begin{proof}
    We have some $n\in\F_p$ such that $n^3 + n^2 - 2n - 1 = 0$. Let $\alpha\in\F_{p^2}$ be a root of $x^2 - nx + 1$ since any quadratic polynomial splits completely in $\F_{p^2}$. Then $\alpha\neq 0$ and $n = \alpha + \alpha^{-1}$. Now
    \begin{eqnarray*}
        0 &=& (\alpha + \alpha^{-1})^3 + (\alpha + \alpha^{-1})^2 - 2(\alpha + \alpha^{-1}) - 1\\
        &=& \alpha^3 + 3\alpha + 3\alpha^{-1} + \alpha^{-3} + \alpha^2 + 2 + \alpha^{-2} - 2(\alpha + \alpha^{-1}) - 1\\
        &=& \alpha^3 + \alpha^2 + \alpha + 1 + \alpha^{-1} + \alpha^{-2} + \alpha^{-3}.
    \end{eqnarray*}
    Multiplying by $\alpha^3$ gives $$\Phi_7(\alpha) = \alpha^6 + \alpha^5 + \alpha^4 \alpha^3 + \alpha^2 + \alpha + 1 = 0.$$
    If $p\neq 7$, then by HW 7 P3, we have $o(\alpha) = 7$. Since $o(\alpha)\mid|\F_{p^2}^\times|$, we get $7\mid p^2 - 1.$ So $7\mid (p-1)(p+1)$ and hence $7\mid p-1$ or $7\mid p+1$ since $7$ is a prime. So $p\equiv \pm1\pmod{7}$.
\end{proof}

We can now prove the infinitude of primes that are $-1$ mod $7$. Suppose for a contradiction that $p_1,\ldots,p_n$ are all the primes that are $-1$ mod $7$. Let $$N = (7p_1\cdots p_n)^3 + (7p_1\cdots p_n)^2 - 2(7p_1\cdots p_n) - 1.$$
Then it is easy to see that $N \geq 2$ and $N\equiv -1\pmod{7}$. Theorem \ref{thm:p7} then implies that the prime divisors of $N$ are $1$ or $-1$ mod $7$. Since a product of primes that are $1$ mod $7$ is also $1$ mod $7$, we see that $N$ has a prime divisor that is $-1$ mod $7$. However, $N$ is not divisible by $p_1,\ldots,p_n$. Contradiction.


The key to this cute result is that for the polynomial $f_7(x) = x^3 + x^2 - 2x - 1$, we have
$$f_7(x + x^{-1}) = x^{-3}\,\Phi_7(x).$$
It follows from the fact that $\Phi_m(x)$ is palindromic (HW 4 P1) that for any $m\geq 3$, there exists a (unique) monic polynomial $f_m(x)\in\Z[x]$ of degree $\phi(m)/2$ such that
$$f_m(x + x^{-1}) = x^{-\phi(m)/2}\,\Phi_m(x).$$
For example, one finds
$$f_{11}(x) = x^5 + x^4 - 4x^3 - 3x^2 + 3x + 1.$$
However, we can't use this polynomial as above to prove the infinitude of primes that are $-1$ mod $11$ because the constant coefficient of $f_{11}(x)$ is $1$ instead of $-1$ so we have $f_{11}(11n)\equiv 1\pmod{11}$. So it is possible that all the prime divisors of $f_{11}(11n)$ are $1$ mod $11$. The trick here is to notice that the degree of $f_{11}$ is odd. So we can use
$$-f_{11}(-x) = x^5 - x^4 - 4x^3 + 3x^2 + 3x - 1,$$
for a polynomial with positive leading coefficient (so that it is at least $2$ when $x$ is large enough) with $-f_{11}(-11n)\equiv -1\pmod{11}$. Hence for large enough $n$, the positive integer $-f_{11}(-11n)$ will have a prime divisor $\equiv -1\pmod{11}$.

This trick unfortunately doesn't work for $m = 17$ as
$$f_{17}(x) = x^8 + x^7 - 7 x^6 - 6 x^5 + 15 x^4 + 10 x^3 - 10 x^2 - 4 x + 1.$$
More generally, by computing $\Phi_m(i)$ (\url{https://arxiv.org/pdf/1611.06783.pdf}, Lemma~23), we find that $f_m(0) = \pm 1$ unless $m = 4p^k$ for some prime $p$ and non-negative integer $k$. We now work towards modifying the above technique to prove:
\begin{theorem}\label{thm:DL-1}
    Suppose $m = q^k$ is an odd prime power. Suppose there exists a prime $\ell\equiv -1\pmod{m}$. Then there are infinitely many primes $\equiv -1\pmod{m}$.
\end{theorem}

\begin{center}
    \add{Lecture 23 Fri 11/01}

    \re{Primes $\equiv-1\pmod{q^k}$}
\end{center}

The importance of prime powers is as follows.
\begin{proposition}\label{prop:pm1m}
    Suppose $m = q^k$ is an odd prime power. Let $p\neq q$ be a prime divisor of $f_m(n)$ for some integer $n$. Then $p\equiv\pm1\pmod{m}$.
\end{proposition}

\begin{proof}
    The proof of Theorem \ref{thm:p7} allows us to conclude that $m\mid p^2 - 1$. So $q^k\mid (p-1)(p+1)$. If an integer $d$ divides both $p-1$ and $p+1$, then $d\mid 2$. Hence since $q$ is odd, we see that either $q^k\mid p-1$ or $q^k\mid p+1$, which gives $p\equiv\pm1\pmod{q^k}$. %When $q = 2$, we see that $p$ is odd and so $2$ divides $p-1$ and $p+1$ but $4$ does not. Hence either $\nu_2(p-1) = k-1$ or $\nu_2(p+1) = k-1$, which gives $p\equiv 1\pmod{2^{k-1}}.$
\end{proof}

If $f_m(0) = -1$, then the same argument as above gives the infinitude of primes $\equiv -1\pmod{m}$. So we assume $f_m(0) = 1$ in what follows. The next result shows that primes $\equiv -1\pmod{m}$ do show up as divisors of $f_m(n)$.

\begin{proposition}
    Suppose $m = q^k$ is an odd prime power. Let $p\equiv -1\pmod{m}$ be any prime. Then there exists $b\in\Z$ such that $p\mid f_m(b)$. Moreover, we can choose $b$ such that $\nu_p(f_m(b)) = 1.$
\end{proposition}

\begin{proof}
    We basically run the proof of Theorem \ref{thm:p7} backwards. Since $p\equiv -1\pmod{m}$, we see that $m\mid p^2 - 1$. Let $\alpha\in\F_{p^2}^\times$ be an element with $o(\alpha) = m$. By HW 7 P3, we know that $\Phi_{m}(\alpha) = 0$ in $\F_{p^2}$. So $f_{m}(\alpha + \alpha^{-1}) = 0.$ Since $\alpha^m = 1$ and $p\equiv-1\pmod{m}$, we see that
    $$(\alpha + \alpha^{-1})^p = \alpha^p + \alpha^{-p} = \alpha^{-1} + \alpha.$$
    Hence $\alpha + \alpha^{-1}\in\F_p$. There is then an integer $b$ such that $b = \alpha + \alpha^{-1}$ in $\F_p$ and we have $p\mid f_m(b)$.

    Next we check that $p\nmid f_m'(b)$. We differentiate the formula $f_m(x + x^{-1}) = x^{-\phi(m)/2}\Phi_m(x)$ to get
    $$f_m'(x + x^{-1})(1 - x^{-2}) = (-\frac{\phi(m)}{2})x^{-\phi(m)/2 - 1}\Phi_m(x) + x^{-\phi(m)/2}\Phi_m'(x).$$
    Set $x = \alpha$. We know $1-\alpha^{-2}\neq 0$ since $o(\alpha) = m$, and $\Phi_m(\alpha) = 0$ by construction and $\Phi_m'(\alpha)\neq 0$ by HW 7 P3. So $f_m'(\alpha + \alpha^{-1})\neq 0$. Since $b = \alpha + \alpha^{-1}$ in $\F_p$, we see that $f_m'(b)\neq 0$ in $\F_p$, which is the same as $p\nmid f_m'(b)$. If $p^2\nmid f_m(b)$, then we are done. If $p^2\mid f_m(b)$, then we can use HW 4 P4a to get
    $$f_m(b + p) \equiv f_m(b) + f_m'(b)p\equiv f_m'(b)p\pmod{p^2}$$
    which is not divisible by $p^2$. Hence $b + p$ does the job in this case.
\end{proof}

\noindent\textbf{Proof of Theorem \ref{thm:DL-1}}: Suppose for a contradiction that $p_1,\ldots,p_n$ are all the primes $\equiv -1\pmod{m}$ and different from $\ell$. Since $f_m(0) = 1$, we see that if we do our usual $f_m(mp_1\cdots p_n)$, then it will be $1$ mod $m$, and it's possible that all of its prime factors are $1$ mod $m$. We will modify it so that $\ell$ divides it. Let $b\in\Z$ such that $\nu_{\ell}(f_m(b)) = 1$. Since $\ell$ is coprime to $m,p_1,\ldots,p_n$, there exists some integer $c$ such that
$$mp_1\cdots p_nc\equiv b\pmod{\ell^2}.$$
We also choose $c$ large enough so that $f_m(mp_1\cdots p_nc)\geq 2\ell$. Now
$$f_m(mp_1\cdots p_nc)\equiv f_m(b)\pmod{\ell^2}.$$
Since $\ell\mid f_m(b)$ and $\ell^2\nmid f_m(b)$, we see that the same is true for $f_m(mp_1\cdots p_nc)$. Let $$N = \frac{f_m(mp_1\cdots p_nc)}{\ell} \geq2.$$
Then $\ell\nmid N$ and $N\equiv -1\pmod{m}$ since $\ell\equiv -1\pmod{m}$. Any prime divisor $p$ of $N$ is a prime divisor of $f_m(mp_1\cdots p_nc)$ and so it can't divide $m$ and doesn't equal to $p_1,\ldots, p_n$. We now have a contradiction because Proposition \ref{prop:pm1m} implies that $p\equiv \pm1\pmod{m}$ but none of the primes $\equiv -1\pmod{m}$ divide $N$. So all the prime divisors of $N$ are $1$ mod $m$, but then $N$ would be $1$ mod $m$. Contradiction. \hfill$\Box$

\begin{center}
    \add{Lecture 23.5 Fri 11/01\\ Tutorial}

    \re{Discriminant of $\Phi_q(x)$ in $\F_p[x]$}
\end{center}

Let $p,q$ be two distinct odd primes. In HW 7 and HW 8, you explored the factorization of $\Phi_q(x)$ in $\F_p[x]$. As a concrete example, consider
$$\Phi_7(x) = x^6 + x^5 + x^4 + x^3 + x^2 + x + 1 = (x^2 + 3x + 1)(x^2 + 5x + 1)(x^2 + 6x + 1) \in \F_{13}[x].$$
\begin{itemize}
    \item Let $d = o_q(p)$ so that $q\mid p^d - 1$. Then $\F_{p^d}$ is the smallest field containing an element $\zeta$ with $o(\zeta) = q$. \qt{In this example, we have $13^2 = 169 = 1 + 7\cdot 24\equiv 1\pmod{7}$. So $d = 2$ and we can find $\zeta$ with $o(\zeta) = 7$ in $\F_{169}$.}
    \item The roots of $\Phi_q(x)$ in a field $F$ of characteristic not dividing $q$ are exactly the ones with order $q$, and $\Phi_q(x)$ splits completely in $\F_{p^d}$. \qt{In this example, we have all $6$ roots of $\Phi_7(x)$ in $\F_{169}$, namely $\zeta,\zeta^2,\zeta^3,\zeta^4,\zeta^5,\zeta^6$.}
    \item Let $r = \phi(q)/d$. Then $\Phi_q(x) = f_1(x)\cdots f_r(x)$ factors into a product of $r$ irreducible polynomials in $\F_p[x]$ of degree $d$. \qt{In this example, $r = \phi(7)/2 = 3$ and $\Phi_7(x)$ factors into a product of $3$ irreducible quadratics.}
    \item The roots of an irreducible polynomial of degree $d$ in $\F_p[x]$ are of the form $\alpha, \alpha^p, \alpha^{p^2},\ldots,\alpha^{p^{d-1}}$. \qt{In this example, note that $\zeta^7 = 1$. So $\zeta^{13} = \zeta^6$ and $\zeta^{169} = \zeta$. We may group the roots as:
    \begin{eqnarray*}
        f_1(x) &=& (x - \zeta)(x - \zeta^6)\\
        f_2(x) &=& (x - \zeta^2)(x - \zeta^5)\\
        f_3(x) &=& (x - \zeta^3)(x - \zeta^4).
    \end{eqnarray*}}
    \item For $\displaystyle\beta = \prod_{0\leq i < j \leq d - 1}(\alpha^{p^i} - \alpha^{p^j}),$ we have $\beta^p = (-1)^{d-1}\beta$. For $\ell = 1,\ldots,r$, let $\alpha_\ell$ be a root of $f_\ell(x)$ and define $\beta_\ell$ for $f_\ell(x)$. Then $\beta_\ell^p = (-1)^{d-1}\beta_\ell$ and $(\beta_1\cdots\beta_r)^p = (-1)^{(d-1)r}\beta_1\cdots\beta_r$. \qt{In this case, we have $$\beta_1 = \zeta - \zeta^6,\qquad\beta_2 = \zeta^2 - \zeta^5,\qquad\beta_3 = \zeta^3 - \zeta^4.$$
    Since $d = 2$ in this case, they all satisfy $\beta_i^{13} = -\beta_i$ and we have $(\beta_1\beta_2\beta_3)^{13} = -\beta_1\beta_2\beta_3$, in $\F_{169}$. }
\end{itemize}
Note that
$$\beta_1\cdots\beta_r = \prod_{\ell = 1}^r \prod_{0\leq i < j \leq d - 1}(\alpha_\ell^{p^i} - \alpha_\ell^{p^j}).$$
We can similarly define $\beta$ for the entire $\Phi_q(x)$ as
$$\beta = \prod_{1\leq i < j \leq q-1}(\zeta^i - \zeta^j)$$
as $\zeta,\ldots,\zeta^{q-1}$ are all the roots of $\Phi_q(x)$. \qt{In this example, we have}
\begin{eqnarray*}
    \beta &=& \qt{\pm(\zeta - \zeta^6)(\zeta^2 - \zeta^5)(\zeta^3 - \zeta^4)}\wow{(\zeta - \zeta^2)(\zeta - \zeta^5)(\zeta^6 - \zeta^2)(\zeta^6 - \zeta^5)}\\
    &&\cdot\add{(\zeta - \zeta^3)(\zeta - \zeta^4)(\zeta^6 - \zeta^3)(\zeta^6 - \zeta^4)}\re{(\zeta^2 - \zeta^3)(\zeta^2 - \zeta^4)(\zeta^5 - \zeta^3)(\zeta^5 - \zeta^4)}.
\end{eqnarray*}
Note that the first \qt{piece} is exactly $\beta_1\cdots\beta_r$. Each colored piece is
$$\beta_{\ell_1\ell_2}:= \prod_{\delta\text{ root of }f_{\ell_1}}\prod_{\eta\text{ root of }f_{\ell_2}}(\delta - \eta). %= \prod_{i=0}^{d-1}\prod_{j=0}^{d-1}(\alpha_{\ell_1}^{p^i} - \alpha_{\ell_2}^{p^j}).
$$
The key observation now is that the $p$-th power of a root of $f_\ell$ is another root of $f_\ell$. So $$\beta_{\ell_1\ell_2}^p = \prod_{\delta\text{ root of }f_{\ell_1}}\prod_{\eta\text{ root of }f_{\ell_2}}(\delta^p - \eta^p) = \prod_{\delta'\text{ root of }f_{\ell_1}}\prod_{\eta'\text{ root of }f_{\ell_2}}(\delta' - \eta') = \beta_{\ell_1\ell_2}.$$ In this example,
\begin{eqnarray*}
    (\wow{(\zeta - \zeta^2)(\zeta - \zeta^5)(\zeta^6 - \zeta^2)(\zeta^6 - \zeta^5)})^{13} &=& (\zeta^{13} - \zeta^{26})(\zeta^{13} - \zeta^{65})(\zeta^{78} - \zeta^{26})(\zeta^{78} - \zeta^{65})\\
    &=& \wow{(\zeta^6 - \zeta^5)(\zeta^6 - \zeta^2)(\zeta - \zeta^5)(\zeta - \zeta^2)}.
\end{eqnarray*}
As a consequence, we have
$$\frac{\beta^p}{\beta} = \frac{(\beta_1\cdots\beta_r)^p}{\beta_1\cdots\beta_r} = (-1)^{(d-1)r}.$$
So $\beta\in\F_p$ if and only if $(d-1)r$ is even, which by HW 8 P1 is equivalent to $p$ being a square in $\F_q$. \qt{In this example, $(d-1)r = 3$ is odd and $13 = 6$ is not a square mod $7$, as the squares mod $7$ are $0,1,2,4$.}

On the other hand, we can actually compute $\beta^2$ directly and find that
$$\beta^2 = (-1)^{(q-1)/2}q^{q-2}.$$
Let $q^* = (-1)^{(q-1)/2}q$. Then
$$\beta^2 = q^*q^{q-3} = q^*(q^{(q-3)/2})^2.$$
Hence $\beta\in\F_p$ is and only if $q^*$ is a square in $\F_p$. This is quadratic reciprocity!
$$p\mbox{ is a square in }\F_q \qquad\Longleftrightarrow\qquad q^*\mbox{ is a square in }\F_p.$$
\qt{In this case, $13$ is not a square mod $7$ and so $7^* = -7 = 6$ is not a square mod $13$. The squares mod $13$ are $0,1,4,9,3,12,10$.}

\add{We now give a proof for the formula $$\beta^2 = (-1)^{(q-1)/2}q^{q-2}.$$
Note that we have the factorization
$$x^{q-1} + \cdots + x + 1 = \Phi_q(x) = \prod_{i=1}^{q-1}(x - \zeta^i).$$
Setting $x = 1$ gives
$$q = \prod_{i=1}^{q-1}(1 - \zeta^i).$$
Note also that
$$\beta^2 = \prod_{1\leq i < j\leq q - 1}(\zeta^i - \zeta^j)^2 = (-1)^{(q-1)(q-2)/2}\prod_{1\leq i\neq j\leq q - 1}(\zeta^i - \zeta^j).$$
This follows because given any pair $(i,j)$ with $i\neq j$, we pick up a negative sign from
$$(\zeta^i - \zeta^j)(\zeta^j - \zeta^i) = -(\zeta^i - \zeta^j)^2$$
and there are $\binom{q-1}{2}$ possible pairs. Now for a fixed $i=1,\ldots,q-1$,
$$\prod_{\substack{1\leq j\leq q - 1\\ j\neq i}}(\zeta^i - \zeta^j) = (\zeta^i)^{q-2}\prod_{\substack{1\leq k\leq q - 1\\ k+i\neq q}}(1 - \zeta^k) = \frac{(\zeta^i)^{q-2}}{1 - \zeta^{q-i}}\prod_{k=1}^{q-1}(1-\zeta^k) = \frac{(\zeta^i)^{q-2}}{1 - \zeta^{q-i}}q.$$
Multiply over all $i = 1,\ldots,q-1$:
$$\prod_{i=1}^{q-1}(\zeta^i)^{q-2} = \zeta^{q(q-1)(q-2)/2} = 1\aa\prod_{i=1}^{q-1}(1 - \zeta^{q-i}) = \prod_{k=1}^{q-1}(1 - \zeta^k) = q.$$
Hence, we have
$$\beta^2 = (-1)^{(q-1)(q-2)/2}\frac{q^{q-1}}{q} = (-1)^{(q-1)/2}q^{q-2},$$
since $q-2$ is odd so $(-1)^{q-2} = -1.$

}

\subsection*{Exercise}
\begin{enumerate}[\thesection .1]
    \item Let $F$ be a finite field and let $k\in\N$ such that $\gcd(k,|F| - 1) = 1$. Prove that every element in $F$ is the $k$-th power of some element in $F$.\label{exer:10.1}
    \item Let $F$ be a finite field and let $k\in\N$. Let $S$ be the subset of $F$ consists of sums of $k$-th powers. (Note that an empty sum is $0$.) Prove that $S$ is a subfield of $F$.
    \item Prove that for any positive integer $n\neq 2$, every element in $\F_{2^n}$ is a sum of cubes. Note that the cubes in $\F_4$ are precisely $0$ and $1$ and so the subfield of sums of cubes in $\F_4$ is $\F_2$.
    \item Let $F$ be a finite field with $3\mid |F| - 1$. Suppose there exist $u,v\in F^\times$ such that $u^3 + v^3 = 1$. Let $w$ be an arbitrary element of $F$. Let
    $$A = \{a^3\colon a\in F\},\quad B = \{w + b^3\colon b\in F\},\quad C = \{u^3w + c^3\colon c\in F\}.$$
    \begin{enumerate}
        \item Prove that $A$, $B$, $C$ are not pairwise disjoint.
        \item Prove that $w$ is a sum of two cubes. In other words, every element of $F$ is a sum of two cubes.
    \end{enumerate}\label{exer:10.4}
    \item Let $F$ be a finite field with $3\mid |F| - 1$ and $|F| > 7$. Suppose there does not exist $u,v\in F^\times$ such that $u^3 + v^3 = 1$. Let $\alpha\in F^\times$ be a primitive element. Let
    $$A = \{\alpha^{3k}\colon k\in\Z\},\quad D = \{\alpha^{3k+1}\colon k\in\Z\},\quad E = \{\alpha^{3k+2}\colon k\in\Z\}.$$
    \begin{enumerate}
        \item Prove that at least one of $\alpha^3-1$, $\alpha^3 +1$, $\alpha^6-1$ belongs to $D$, and at least one of them belongs to $E$.
        \item Prove that every element of $F$ is a sum of two cubes.
    \end{enumerate}\label{exer:10.5}
    \item Exercises 10.\ref{exer:10.1}, 10.\ref{exer:10.4}, 10.\ref{exer:10.5} imply that for any finite field except $\F_4$ and $\F_7$, every element is a sum of two cubes. Prove that for $F =\F_7$, every element is a sum of three cubes, and not every element is a sum of two cubes.
    \item Prove that for any $\alpha\in\F_7$, the polynomial $x^4 - \alpha\in\F_7[x]$ is reducible.
    \item Let $q = p^n$ be a power of a prime. Let $\alpha\in\F_q$ be a primitive element. Suppose $q\equiv 1\pmod{d}$ for some positive integer $d$. Prove that $x^d - \alpha\in \F_q[x]$ is irreducible.
\end{enumerate}



\begin{center}
    \add{Lecture 24 Mon 11/04}

    \re{Quadratic reciprocity}
\end{center}

\section{Quadratic reciprocity}

Now that we have proved quadratic reciprocity, let's talk about what it is.

An element $a\in\F_p$ is a square in $\F_p$ if $a = b^2$ for some $b\in\F_p$. Recalling that $\F_p = \Z/p\Z$, we can state this in terms of congruences: $x^2\equiv a\pmod{p}$ has a solution. More generally, we say an integer $a$ is a \wow{quadratic residue} mod $m$ (or in $\Z/m\Z$) if the equation $x^2 \equiv a\pmod{m}$ has an integer solution. Otherwise, we say it is a \wow{quadratic non-residue}. Our eventual goal will be to give an algorithm for determining whether $a$ is a quadratic residue mod $m$. For example, \qt{is $69$ a square mod $420$?} We factor $420 = 4\cdot3\cdot5\cdot7$ into coprime factors so we can use the Chinese Remainder Theorem to say that
$$b^2\equiv 69\pmod{420} \qquad\Longleftrightarrow\qquad\begin{cases}
    b^2\equiv 69\pmod{4}\\
    b^2\equiv 69\pmod{3}\\
    b^2\equiv 69\pmod{5}\\
    b^2\equiv 69\pmod{7}
\end{cases}$$
In other words, $69$ is a square mod $420$ if and only if $69$ is square mod all of $4,3,5,7$. The latter can be checked directly because the numbers are small: $69\equiv 1\pmod{4}$ is a square; $69\equiv 0\pmod{3}$ is a square; $69\equiv 4\pmod{5}$ is a square; $69\equiv 6\pmod{7}$ is \wow{not} a square. Hence $69$ is not a square mod $420$.

\v
\noindent\wow{Exercise:} For any odd positive integer $m$, prove that $69$ is an $m$-th power mod $420$. In fact, $$69^m\equiv 69\pmod{420}.$$

More generally, we see that applying the Chinese Remainder Theorem allows us to reduce to the case $m = p^k$ using the prime factorization $p_1^{k_1}\cdots p_r^{k_r}$ of $m$. In the above example, the numbers are small enough that we can calculate directly, but what if we need to determine if $69$ is a square mod $101^{420}$? Here is the general algorithm.
\begin{itemize}
    \item Chinese Remainder Theorem allows us to reduce to the case $m = p^k$.
    \item Hensel's Lemma (to be discussed later) allows us to reduce to the case $m = p$.
    \item Quadratic reciprocity allows us to handle the $m = p$ case.
\end{itemize}
We consider the case where $m = p$ is a prime first. When $p = 2$, every integer is a quadratic residue. So we assume $p$ is odd. Let's use $p = 7$ as an example. Recall by Theorem \ref{thm:fieldprim} that there exists a primitive element $\alpha\in\F_{7}^\times$, so that all the elements of $\F_{7}$ are given by $0,\alpha,\alpha^2,\alpha^3,\alpha^4,\alpha^5,\alpha^6$. (Even more explicitly, we can take $\alpha = 3$.) Let's square them to find the squares, recalling that $\alpha^{6} = 1$.
$$
\begin{tabular}{c|c|c|c|c|c|c|c}
     $b$ & 0 & $\alpha$ & $\alpha^2$ & $\alpha^3$ & $\alpha^4$ & $\alpha^5$ & $\alpha^6$\\
     %\hline
     $b^2$& 0 & $\alpha^2$ & $\alpha^4$ & $\alpha^6$ & $\alpha^2$ & $\alpha^4$ & $\alpha^6$\\
     Is $b$ a square & $\checkmark$ & $\times$ & $\checkmark$ & $\times$ & $\checkmark$ & $\times$ & $\checkmark$\\
     $b^3$ & 0 & $\alpha^3$ & $\alpha^6$ & $\alpha^3$ & $\alpha^6$ & $\alpha^3$ & $\alpha^6$\\
     \wow{$b^{(p-1)/2}$}& \wow{0} & \wow{$-1$} & \wow{1} & \wow{$-1$} & \wow{1} & \wow{$-1$} & \wow{1}
\end{tabular}
$$
We collect some important observations:
\begin{itemize}
    \item $b = \alpha^k$ is a square if and only if $k$ is even. \wow{This is essentially because $p-1$ is even, so there is no funny wrapping around.} \add{If $k = 2\ell$ is even, then $\alpha^k = (\alpha^\ell)^2$. Conversely, if $\alpha^k = (\alpha^\ell)^2$ for some $\ell\in\Z$, then $p - 1 \mid k - 2\ell$ and so $k$ is even since $p$ is odd.}
    \item $\alpha^{(p-1)/2} = -1$. \add{This is because $\alpha^{(p-1)/2}\neq 1$ but its square is $1$. In a field, the only roots of $x^2 = 1$ are $\pm1$.}
\end{itemize}


\begin{cor}
    Let $p$ be an odd prime. Let $a\in\F_p$, then
    $$a^{(p-1)/2} = \begin{cases}
        1&\mbox{ if }a\mbox{ is a nonzero quadratic residue}\\
        -1&\mbox{ if }a\mbox{ is a quadratic non-residue}\\
        0&\mbox{ if }a = 0.
    \end{cases}$$
\end{cor}

\add{\begin{proof}
    Let $\alpha$ be a primitive element. Write $a = \alpha^k$ for some $k = 0,\ldots,p-2$. If $k = 2\ell$ is even, then $a^{(p-1)/2} = \alpha^{(p-1)\ell} = 1$. If $k = 2\ell+1$ is odd, then $a^{(p-1)/2} = \alpha^{(p-1)\ell + (p-1)/2} = -1$.
\end{proof}}


We define the \wow{Legendre symbol} $\displaystyle\lg{a}{p}$ to be the integer $1$, $-1$ or $0$ depending on if $a$ is a nonzero quadratic residue, quadratic non-residue, or $0$ in $\F_p$. In other words, $$\lg{a}{p} \equiv a^{(p-1)/2}\pmod{p},$$
from which we see that it is multiplicative:
$$\lg{ab}{p} = \lg{a}{p}\lg{b}{p}$$
so that \wow{the product/quotient of two quadratic non-residues is a quadratic residue.} The result $$p\mbox{ is a square in }\F_q \qquad\Longleftrightarrow\qquad q^*\mbox{ is a square in }\F_p$$
that we proved (where $q^* = (-1)^{(q-1)/2}q$) can be expressed as
$$\lg{p}{q} = \lg{q^*}{p}.$$
We now state the full quadratic reciprocity (and its complementary laws).

\begin{theorem}\label{thm:QR}
    The Legendre symbols satisfy:
    \begin{enumerate}[(a)]
        \item $-1$ is a quadratic residue mod $p$ if and only if $p = 2$ or $p\equiv 1\pmod{4}$. In other words, for $p\neq 2,$ $$\lg{-1}{p} = (-1)^{(p-1)/2}.$$
        \item $2$ is a quadratic residue mod $p$ if and only if $p = 2$ or $p\equiv \pm1\pmod{8}$. In other words, for $p\neq 2,$ $$\lg{2}{p} = (-1)^{(p^2-1)/8}.$$
        \item If $p,q$ are distinct odd primes, then $$\lg{p}{q}\lg{q}{p} = (-1)^{\frac{p-1}{2}\frac{q-1}{2}}.$$
        In particular
\begin{eqnarray*}
 \lg{p}{q} &=& -\lg{q}{p},\mbox{ if both }p,q\equiv3\pmod{4};\\
 \lg{p}{q} &=& \lg{q}{p},\,\,\,\,\,\mbox{ otherwise}.
\end{eqnarray*}
    \end{enumerate}
\end{theorem}
For example, suppose we want to find $\lg{69}{101}$. We first use multiplicativity to get
$$\lg{69}{101} = \lg{3}{101}\lg{23}{101}.$$
Then we apply (c):
$$\lg{3}{101} = \lg{101}{3} = \lg{2}{3} = -1$$
$$\lg{23}{101} = \lg{101}{23} = \lg{9}{23} = 1.$$
So $\lg{69}{101} = -1$ and $69$ is not a square mod $101$.



Theorem \ref{thm:QR}(a) follows almost immediately from the definition of the Legendre symbol. We know $$\lg{-1}{p} \equiv (-1)^{(p-1)/2} \pmod{p}.$$
Since both sides are $\pm1$ and $1\not\equiv-1\pmod{p}$ since $p\nmid2 $, we see that they must be equal. Theorem \ref{thm:QR}(c) then follows from what we proved and multiplicativity:
$$\lg{p}{q} = \lg{q^*}{p} = \lg{q}{p} \lg{-1}{p}^{(q-1)/2} = \lg{q}{p}(-1)^{(p-1)(q-1)/4}$$
and then multiplying both sides by $\lg{q}{p}$ noting that $\lg{q}{p} = \pm1$ so it squares to $1$. Theorem \ref{thm:QR}(b) requires some work. The key idea is
$$\zeta_8 = \frac{\sqrt{2}}{2} + \frac{\sqrt{2}}{2}i\aa\zeta_8^{-1} = \bar{\zeta}_8 = \frac{\sqrt{2}}{2} - \frac{\sqrt{2}}{2}i,\qquad\mbox{so}\qquad \zeta_8 + \zeta_8^{-1} = \sqrt{2},$$
except we need to do this in $\F_p$, not $\C$. \qt{In which $\F_{p^d}$ can we find an element $\alpha$ with $o(\alpha) = 8$?} \spp{Any $d$ such that $8\mid p^d - 1$.} We can always take $d = \phi(8) = 4$, but we can also take $d = 2$ since any odd number squared is $1$ mod $8$. Now we take $\beta = \alpha + \alpha^{-1}$. Then
$$\beta^2 = \alpha^2 + 2 + \alpha^{-2}.$$ Since $\alpha^8 = 1$ and $\alpha^4\neq 1$, we have $\alpha^4 = -1$, and so $\alpha^2 = -\alpha^{-2}$. Hence $\beta^2 = 2$. Since we are in characteristic $p$, we have $\beta^p = \alpha^p + \alpha^{-p}$. Since $\alpha^8 = 1$, we see that $\beta^p$ depends only on what $p$ is mod $8$. It is now easy to check that if $p\equiv \pm1\pmod{8}$, then
$$\beta^p = \alpha^1 + \alpha^{-1} = \beta$$
and when $p\equiv \pm3\pmod{8}$,
$$\beta^p = \alpha^3 + \alpha^{-3} = -\alpha^{-1} - \alpha = -\beta.$$
Therefore, $\beta\in\F_p$ if and only if $p\equiv \pm 1\pmod{8}$. \hfill $\Box$

\v
\add{\noindent\textbf{Remark:} There is another proof of (b) using the complex $\zeta_8$. We consider $(1 + i)^2 = 2i.$ Then
$$(1 + i)^p = ((1 + i)^2)^{(p-1)/2}(1 + i) = 2^{(p-1)/2}i^{(p-1)/2}(1 + i).$$
On the other hand, we have $$(1 + i)^p\equiv 1 + i^p \pmod{p}.$$
By considering the possible values of $p$ mod $8$, we can compute $2^{(p-1)/2}$ mod $p$, which is exactly $\lg{2}{p}$.}

\begin{center}
    \add{Lecture 25 Wed 11/06}

    \re{Some applications}
\end{center}

From Theorem \ref{thm:QR}(b), we can prove the infinitude of primes $p\equiv -1\pmod{8}$. Suppose for a contradiction that $p_1,\ldots,p_n$ are all of them. Take $N = (2p_1\cdots p_n + 1)^2 - 2$. Then we note that $N\equiv -1\pmod{8}$ and all of its prime divisors are $\equiv\pm1\pmod{8}$ since $2$ would be a square. Hence $N$ has a prime divisor that is $\equiv -1\pmod{8}$ but is not divisible by $p_1,\ldots,p_n$.

\begin{cor}
    We have that $-2$ is a quadratic residue mod $p$ if and only if $p = 2$ or $p\equiv 1$ or $3$ mod $8$.
\end{cor}



\begin{proof}
    Suppose $p\neq 2$. We know that $-2$ is a quadratic residue precisely when both $-1$ and $2$ are quadratic residues or when they are both non-residues. The first case corresponds to $p\equiv 1\pmod{8}$ and the second case corresponds to $p\equiv 3\pmod{8}$.
\end{proof}

Similarly, we can use $N = (2p_1\cdots p_n + 1)^2 + 2$, which is $\equiv 3\pmod{8}$, to prove the infinitude of primes $\equiv 3\pmod{8}$. What about primes $\equiv 5\pmod{8}$? We actually could do this a long time ago. Recall that $-1$ is a square mod $p$ where $p$ is odd if and only if $p\equiv 1\pmod{4}$, which is equivalent to $p\equiv 1\mbox{ or }5\pmod{8}$. We then take $N = (2p_1\cdots p_n + 1)^2 + 4$ so that it is $\equiv 5\pmod{8}$.

\add{
\begin{cor} We have
    \begin{enumerate}[(a)]
        \item $3$ is a quadratic residue mod $p$ if and only if $p = 3$ or $p\equiv \pm1\pmod{12}.$
        \item $5$ is a quadratic residue mod $p$ if and only if $p = 5$ or $p\equiv \pm1,\pm9\pmod{20}.$
        \item $7$ is a quadratic residue mod $p$ if and only if $p = 7$ or $p\equiv \pm1, \pm9, \pm25\pmod{28}.$
        \item Suppose $p,q$ are distinct odd primes. Then $q$ is a quadratic residue mod $p$ if and only if $p\equiv \pm a^2\pmod{4q}$ for some odd integer $a$.
    \end{enumerate}
\end{cor}
}

\add{There are over 200 proofs of Quadratic reciprocity (usually referring to Theorem \ref{thm:QR}(c))! Here is another proof similar to (b). Let $\alpha\in\F_{p^{q-1}}$ be an element with $o(\alpha) = q$. We define
$$\beta = \sum_{m\in\F_q} \lg{m}{q}\alpha^m.$$
Then one proves that
$$\beta^2 = q^*\aa\beta^p = \lg{p}{q}\beta.$$
As a running example, we take $p = 5$ and $q = 3$. Then $\alpha\in\F_{25}$ is a primitive cube root of unity. In fact, we may take $\alpha = x + (x^2 + x + 1)$ in $\F_5[x]/(x^2 + x + 1).$ Then
$$\beta = \lg{0}{3}\alpha^0 + \lg{1}{3}\alpha^1 + \lg{2}{3}\alpha^2 = \alpha - \alpha^2 = \alpha - (-\alpha - 1) = 2\alpha + 1.$$
We can now compute $$\beta^2 = 4\alpha^2 + 4\alpha + 1 = 4(-\alpha-1) + 4\alpha + 1 = -3 = 3^*.$$
Note also that
$$\beta^5 = \alpha^5 - \alpha^{10} = \alpha^2 - \alpha = -\beta = \lg{3}{5}\beta.$$
If we were to try this with $p = 7$ and $q = 3$, then in fact we may take $\alpha = 2 \in\F_7.$ Then $\beta = \alpha - \alpha^2 = -2$ and $\beta^2 = 4 = -3$ in $\F_7$.

Back to the general case, we square $\beta$ to get
$$\beta^2 = \sum_{m\in\F_q}\sum_{n\in\F_q}\leg{m}{q}\lg{n}{q}\alpha^{m+n} = \sum_{m\in\F_q}\sum_{n\in\F_q}\leg{mn}{q}\alpha^{m+n}.$$
Now we collect terms with the same power of $\alpha$. Note that $t=m+n$ takes arbitrary values in $\F_q$:
$$\beta^2 = \sum_{t\in\F_q} \left(\sum_{m\in\F_q} \lg{m(t-m)}{q}\right)\alpha^t = \sum_{t\in\F_q} \left(\sum_{m\in\F_q^\times} \lg{m(t-m)}{q}\right)\alpha^t$$ where we removed the $m = 0$ term because the legendre symbol $\leg{m(t-m)}{q}$ is $0$. Let's see what the inner sum is equal to in our example:
\begin{eqnarray*}
    t=0&\colon& \lg{1(-1)}{3} + \lg{2(-2)}{3} = \lg{-1}{3}\cdot 2\\
    t=1&\colon& \lg{1(0)}{3} + \lg{2(-1)}{3} = \lg{-1}{3}\cdot (-1)\\
    t=2&\colon& \lg{1(1)}{3} + \lg{2(0)}{3} = \lg{-1}{3}\cdot (-1)
\end{eqnarray*}
If we then factor out the $\lg{-1}{3}$, we get
$$2 - \alpha - \alpha^2 = 3 - (1 + \alpha + \alpha^2) = 3.$$
In general, as a primitive $q$-th root of unity, $\alpha$ satisfies $$1 + \alpha + \cdots + \alpha^{q-1} = 0.$$
This suggests that we should prove
\begin{eqnarray*}
    t=0&\colon& \sum_{m\in\F_q^\times} \lg{m(t-m)}{q} = \lg{-1}{q}\cdot (q-1),\\
    t\neq 0&\colon& \sum_{m\in\F_q^\times} \lg{m(t-m)}{q} = \lg{-1}{q}\cdot (-1),
\end{eqnarray*}
which would imply that
$$\beta^2 = \lg{-1}{q}\left((q-1) - \alpha - \alpha^2 - \cdots - \alpha^{q-1}\right) = \lg{-1}{q}q = q^*.$$

Since $m\neq0$, we have
$$\leg{m(t-m)}{q} = \leg{-m^2(1-tm^{-1})}{q} = \leg{-m^2}{q}\leg{1-tm^{-1}}{q} = \leg{-1}{q}\leg{1-tm^{-1}}{q}.$$
If $t = 0$, then we get $\lg{-1}{q}$ for each $m\in\F_q^\times$. There are $q-1$ of them, so we get the desired formula for $t = 0$. When $t\neq 0$, $tm^{-1}$ runs through every element in $\F_q^\times$ and so $1 - tm^{-1}$ runs through every element in $\F_q$ that is not $1$. Hence
$$\sum_{m\in\F_q^\times}\leg{1-tm^{-1}}{q} = \sum_{s\in\F_q}\leg{s}{q} - \leg{1}{q} = \sum_{s\in\F_q^\times}\leg{s}{q} + \leg{0}{q} - \leg{1}{q} = -1.$$
Here the first sum is $0$ because half the elements of $\F_q^\times$ are quadratic residues and the other halfs are quadratic nonresidues. We have therefore proved that
$$\beta^2 = q^*.$$


We next compare $\beta^p$ with $\beta$ to see if $\beta$ lies in $\F_p$. Since we are in characteristic $p$ and since $\lg{m}{q}$ only takes value in $0,1,-1$, all of which are fixed by raising to the power $p$, we have
$$\beta^p = \sum_{m\in\F_q}\leg{m}{q}^p\alpha^{mp} = \sum_{m\in\F_q}\leg{m}{q}\alpha^{mp}.$$
Since $p\neq q$, as $m$ varies in $\F_q$, $mp$ runs through all values of $\F_q$. Setting $t = mp$, we get
$$\beta^p = \sum_{t\in\F_q} \lg{tp^{-1}}{q}\alpha^t = \lg{p^{-1}}{q}\sum_{t\in\F_q} \lg{t}{q}\alpha^t = \lg{p}{q}\beta.$$
Therefore, we conclude that $q^*$ is a quadratic residue in $\F_p$ if and only if $\lg{p}{q} = 1$. In other words,
$$\lg{q^*}{p} = \lg{p}{q}.$$
}

We also have some application regarding Fermat numbers.

\begin{proposition}
    Suppose $F_n = 2^{2^n} + 1$ is a Fermat prime where $n\geq 2$. Then $10$ is primitive mod $F_n$.
\end{proposition}

\begin{proof}
    We need to prove that $o_{F_n}(10) = F_n - 1 = 2^{2^n}$. Since we know $o_{F_n}(10)\mid 2^{2^n}$, it suffices to show that $o_{F_n}(10)\nmid 2^{2^{n}-1}$. Note that $2^{2^{n}-1} = (F_n - 1)/2$. Hence, it suffices to prove that
    $$\lg{10}{F_n} \equiv 10^{2^{2^{n}-1}} \not\equiv 1\pmod{F_n}.$$
    Since $n\geq 2$, we know that $2^n\geq 4$. So $F_n\equiv 1\pmod{8}$. Hence we have $\lg{2}{F_n} = 1$. Moreover, we have $4\mid 2^n$ and $2^4\equiv 1\pmod{5}$. So $F_n\equiv 2\pmod{5}$. Hence we have
    $$\lg{10}{F_n} = \lg{5}{F_n} = \lg{F_n}{5} = \lg{2}{5} = -1,$$
    as desired.
\end{proof}

For example, we know that $10$ is primitive mod $17, 257, 65537$. The Fermat numbers $F_n$ for $5\leq n\leq34$ are all known to be composite.

\begin{proposition}\label{prop:96}
    Suppose $F_n = 2^{2^n} + 1$ with $n\geq 2$. Let $p$ be a prime divisor of $F_n$. Then $p\equiv 1\pmod{2^{n+2}}$.
\end{proposition}

\begin{proof}
    In HW4 Q3, it is shown that $p\equiv 1\pmod{2^{n+1}}$. This follows because $2^{2^n}\equiv -1\pmod{p}$ and so $o_p(2) = 2^{n+1}$, which must divide $p-1$. Now since $n\geq 2$, we see that $p\equiv 1\pmod{8}$ and so $2\equiv a^2\pmod{p}$ for some $a\in\Z$. Then we have $a^{2^{n+1}}\equiv 2^{2^n}\equiv -1\pmod{p}$, from which we can conclude that $o_p(a) = 2^{n+2}$ which must divide $p-1$.
\end{proof}

Multiplicativity of the Legendre symbol and quadratic reciprocity allow us to determine whether $a$ is a square mod $p$ for any prime $p$. We will talk about Hensel's lemma next time which upgrades this to mod $p^k$. We first reduce to the case $p\nmid a$.

\add{We start with an example: \qt{is $69$ a square mod $23^2$?} Suppose there is an integer $c$ such that $$c^2\equiv 69\pmod{23^2}.$$
Hence $23^2\mid c^2 - 69$. So $\nu_{23}(c^2 - 69) \geq 2$ but $\nu_{23}(69) = 1$. Hence $\nu_{23}(c^2) = 1.$ (\add{Recall that if $\nu_p(m)\neq\nu_p(n)$, then $\nu_p(m+n)=\min\{\nu_p(m),\nu_p(n)\}$.} However, this is impossible because $\nu_{23}(c^2) = 2\nu_{23}(c)$ is odd.}

\begin{lemma}
    Suppose $p\mid a$. Then $x^2 \equiv a\pmod{p^k}$ has a solution if and only if $\nu_p(a)\geq k$ or if $\nu_p(a)$ is even and $$x^2\equiv a/p^{\nu_p(a)}\pmod{p^{k-\nu_p(a)}}$$ has a solution.
\end{lemma}
\add{
\begin{proof}
    Suppose $\nu_p(a) < k$ and $k\geq 2$. Suppose $c\in\Z$ such that $c^2\equiv a\pmod{p^k}$. Then $\nu_p(c^2 - a)\geq k$ but $\nu_p(a) < k$. So $2\nu_p(c) = \nu_p(c^2) = \nu_p(a)$ is even. Moreover, dividing by $p^{\nu_p(a)}$ gives
    $$\nu_p((c/p^{\nu_p(c)})^2 - a/p^{\nu_p(a)}) \geq k - \nu_p(a).$$
    Hence $x^2\equiv a/p^{\nu_p(a)}\pmod{p^{k-\nu_p(a)}}$ has a solution.

    Conversely, given a solution $b^2\equiv a/p^{\nu_p(a)}\pmod{p^{k-\nu_p(a)}}$ with $\nu_p(a) = 2d$ even, we easily obtain a solution to the original equation by taking $bp^d$.
\end{proof}}

We now assume that $p\nmid a$. The punchline is that the question can be reduced to $m = p$ for $p$ odd, or to $m = 8$ when $p = 2$.


\begin{theorem}\label{thm:hensel}
    (Hensel's lemma) Suppose $f(x)\in\Z[x]$. Let $p$ be a prime and let $\alpha\in \Z$. Suppose $$\nu_p(f(\alpha)) > 2\nu_p(f'(\alpha)).$$ Then for any $n\in\N$, there exists  $\alpha_n\in\Z$ such that
    \begin{enumerate}[(a)]
        \item $\nu_p(f(\alpha_n)) \geq \nu_p(f(\alpha)) + n-1$,
        \add{\item $\nu_p(\alpha_n-\alpha) = \nu_p(f(\alpha))-\nu_p(f'(\alpha)) > \nu_p(f'(\alpha))$,
        \item $\nu_p(f'(\alpha_n)) = \nu_p(f'(\alpha))$.}
    \end{enumerate}
\end{theorem}



\begin{cor}
    Suppose $f(x)\in\Z[x]$. Let $p$ be a prime and let $\alpha\in \Z$. Suppose $f(\alpha)\equiv 0\pmod{p}$ and $p\nmid f'(\alpha)$. Then for any $n\in\N$, there exists $\alpha_n\in\Z$ such that $\alpha_n\equiv \alpha\pmod{p}$ and $f(\alpha_n)\equiv 0\pmod{p^n}.$
\end{cor}

This process of ``lifting'' a root mod $p$ to a root mod $p^n$ is called \wow{Hensel lifting}.

\begin{cor}\label{cor:p2n}
    Let $p$ be an odd prime and let $a\in\Z$ such that $p\nmid a$. Suppose $x^2\equiv a\pmod{p}$ has a solution. Then $x^2\equiv a\pmod{p^n}$ has a solution for any $n\in\N$.
\end{cor}

\begin{proof}
    Consider $f(x) = x^2 - a \in\Z[x]$. Let $\alpha\in\Z$ be a solution to $x^2 \equiv a\pmod{p}$. Then we have $f(\alpha) = 0\pmod{p}$. Now $f'(\alpha) = 2\alpha$. Since $p\nmid a$, we have $p\nmid \alpha$. Since $p$ is odd, we have $p\nmid 2$. So $p\nmid f'(\alpha)$. Hence for any $n\in\N$, there exists $\alpha_n\in\Z$ such that $f(\alpha_n)\equiv 0\pmod{p^n}$, which is the same as $\alpha_n^2 \equiv a\pmod{p^n}.$
\end{proof}

\begin{cor}
    Let $a$ be an odd integer. Suppose $x^2\equiv a\pmod{8}$ has a solution. Then $x^2\equiv a\pmod{2^n}$ has a solution for any integer $n\geq 3$.
\end{cor}

\begin{proof}
    Consider $f(x) = x^2 - a \in\Z[x]$. Let $\alpha\in\Z$ be a solution to $x^2 \equiv a\pmod{8}$. Then we have $\nu_2(f(\alpha))\geq 3$. Now $f'(\alpha) = 2\alpha$. Since $a$ is odd, we have $\alpha$ is odd. So $\nu_2(f'(\alpha)) = 1$ which satisfies $\nu_2(f(\alpha)) > 2\nu_2(f'(\alpha))$.  Hence by Theorem \ref{thm:hensel}, for any integer $n\geq 3$, we have $n-2\geq 1$ and there exists $\alpha_{n-2}\in\Z$ such that $$\nu_2(f(\alpha_{n-2})) = \nu_2(f(\alpha)) + (n-2)-1 \geq n.$$
    In other words, $\alpha_{n-2}^2\equiv a\pmod{2^n}.$
\end{proof}

It is easy to check that the only odd quadratic residue mod $4$ is $1$, and the only odd quadratic residue mod $8$ is also $1$. Note that $x^2 \equiv 5\pmod{8}$ has no solution but $x^2 \equiv 5\pmod{4}$ does.

\begin{center}
    \add{Lecture 26 Fri 11/08}

    \re{Hensel's Lemma}
\end{center}
\vspace{5pt}
\noindent\textbf{Proof of Theorem \ref{thm:hensel}}: We will use HW 4 Q4a: for any integers $a,m$, we have
$$f(a + m) \equiv f(a) + f'(a)m\pmod{m^2}.$$
%Since both sides are linear in $f(x)$, it is enough to check it for $f(x) = x^n$, in which case $$f(a) + f'(a)m = a^n + na^{n-1}m\equiv (a+m)^n = f(a+m)\pmod{m^2}$$ follows from the binomial expansion for $(a+m)^n$.

We construct $\alpha_n$ by induction on $n$. When $n = 1$, we take $\alpha_1 = \alpha$. For $n\geq 2$, we define $$\alpha_n = \alpha_{n-1} - \left[\frac{f(\alpha_{n-1})}{f'(\alpha_{n-1})}\right]_p.$$
Here, for two integers $a,b$ with $\nu_p(a)\geq\nu_p(b)$, we use $[\frac{a}{b}]_p$ to denote any integer $c$ such that $\nu_p(a - bc) > \nu_p(a).$ (This is not standard notation!) To see such an integer always exist, we write $a = p^su$ and $b = p^tv$ where $p\nmid uv$ and $s\geq t$. Let $w$ be an integer such that $u\equiv vw\pmod{p}$. Then $p\mid u - vw.$ We then take $[\frac{a}{b}]_p = p^{s-t}w$.  Note that $\nu_p([\frac{a}{b}]_p) = \nu_p(a) - \nu_p(b)$. We now prove inductively that for $n\geq 2$,
\begin{itemize}
    \item $\nu_p(f(\alpha_n)) > \nu_p(f(\alpha_{n-1}))$
    \item $\nu_p(f'(\alpha_n)) = \nu_p(f'(\alpha))$
    \item $\nu_p(f(\alpha_n))>2\nu_p(f'(\alpha_n))$.
\end{itemize}
\add{Indeed, we have
$$f(\alpha_n) \equiv f(\alpha_{n-1}) - f'(\alpha_{n-1})\left[\frac{f(\alpha_{n-1})}{f'(\alpha_{n-1})}\right]_p\pmod{\left[\frac{f(\alpha_{n-1})}{f'(\alpha_{n-1})}\right]_p^2}$$
where
$$\nu_p\left(f(\alpha_{n-1}) - f'(\alpha_{n-1})\left[\frac{f(\alpha_{n-1})}{f'(\alpha_{n-1})}\right]_p\right) > \nu_p(f(\alpha_{n-1}))$$
and
$$\nu_p\left(\left[\frac{f(\alpha_{n-1})}{f'(\alpha_{n-1})}\right]_p^2\right) = 2\nu_p(f(\alpha_{n-1})) - 2\nu_p(f'(\alpha_{n-1})) > \nu_p(f(\alpha_{n-1}))$$
by induction. This proves $\nu_p(f(\alpha_n)) > \nu_p(f(\alpha_{n-1})).$ For the derivative, we have
$$f'(\alpha_n) \equiv f'(\alpha_{n-1}) - f''(\alpha_{n-1})\left[\frac{f(\alpha_{n-1})}{f'(\alpha_{n-1})}\right]_p\pmod{\left[\frac{f(\alpha_{n-1})}{f'(\alpha_{n-1})}\right]_p^2}$$
where $$\nu_p\left(\left[\frac{f(\alpha_{n-1})}{f'(\alpha_{n-1})}\right]_p\right) = \nu_p(f(\alpha_{n-1})) - \nu_p(f'(\alpha_{n-1})) > \nu_p(f'(\alpha_{n-1})).$$
This proves $\nu_p(f'(\alpha_n)) = \nu_p(f'(\alpha_{n-1})) = \nu_p(f'(\alpha))$ and
$$\nu_p(f(\alpha_n)) > \nu_p(f(\alpha_{n-1})) > 2\nu_p(f'(\alpha_{n-1})) = 2\nu_p(f'(\alpha_n)).$$
It now follows (by another easy induction) from $\nu_p(f(\alpha_n))\geq\nu_p(f(\alpha_{n-1}))+1$ that $$\nu_p(f(\alpha_n))\geq\nu_p(f(\alpha)) + n-1$$
and
$$\alpha_n - \alpha = -\left[\frac{f(\alpha_1)}{f'(\alpha_1)}\right]_p-\left[\frac{f(\alpha_{2})}{f'(\alpha_{2})}\right]_p-\cdots-\left[\frac{f(\alpha_{n-1})}{f'(\alpha_{n-1})}\right]_p$$
has the same valuation as the first term.  $\Box$

If we go through the above proof, it is not hard to see that our construction was pretty much forced. In particular, we have the following uniqueness result.

\begin{proposition}
    (Uniqueness of Hensel's lemma) Suppose $f(x)\in\Z[x]$. Let $p$ be a prime and let $\alpha\in \Z$. Suppose $\nu_p(f(\alpha)) > 2\nu_p(f'(\alpha)).$ For any $n\in\N$, let $\alpha_n$ be constructed as above. Then if $\beta\in\Z$ such that
    \begin{enumerate}[(a)]
        \item $\nu_p(f(\beta)) \geq \nu_p(f(\alpha)) + n-1$,
        \item $\nu_p(\beta-\alpha) \geq \nu_p(f(\alpha))-\nu_p(f'(\alpha))$.
    \end{enumerate}
    Then $$\nu_p(\beta-\alpha_n)\geq \nu_p(f(\alpha)) - \nu_p(f'(\alpha)) + n - 1.$$
\end{proposition}

\begin{proof}
    Write $\beta = \alpha_n + m$. Then by condition (b) for $\beta$ (and for $\alpha_n)$, we have
    $$\nu_p(m)  = \nu_p((\beta-\alpha)-(\alpha_n-\alpha))\geq \nu_p(f(\alpha)) - \nu_p(f'(\alpha)) > \nu_p(f'(\alpha)).$$ %Then
%$$f(\beta) \equiv f(\alpha_n) + f'(\alpha_n)m \pmod{m^2}.$$
Let $a = f(\beta) - f(\alpha_n)$, which we know has valuation at least $\nu_p(f(\alpha)) + n-1$. Let $u = f'(\alpha_n)$ which we know has the same valuation as $f'(\alpha)$. Then from $f(\beta) \equiv f(\alpha_n) + f'(\alpha_n)m \pmod{m^2}$, we have $$m^2\mid a - um.$$
Hence $$\nu_p(a - um) \geq 2\nu_p(m) > \nu_p(f'(\alpha)) + \nu_p(m) = \nu_p(um).$$ So
$$\nu_p(a) = \nu_p(a - um + um) = \nu_p(um) = \nu_p(f'(\alpha)) + \nu_p(m).$$
Hence
$$\nu_p(m) = \nu_p(a) - \nu_p(f'(\alpha)) \geq \nu_p(f(\alpha)) - \nu_p(f'(\alpha)) + n - 1,$$
as desired.
\end{proof}

}
\vspace{5pt}
\noindent\textbf{Remark:} The notation $[\frac{a}{b}]_p$ is very awkward. In HW 9 P4 (bonus), you will see that in the correct ring, namely $\Z_p$, we can literally write $\frac{a}{b}$. Then Hensel's Lemma is exactly Newton's method but done in $\Z_p$.

\v
\noindent\textbf{Example}: Consider $f(x) = (x^2 - 2)(x^2 - 17)(x^2 - 34)\in\Z[x]$. Then $f(x) = 0$ has no solution in $\Z$. We claim that it has a solution in $\Z/m\Z$ for any $m\in\N$. By the Chinese Remainder Theorem, it suffices to consider when $m = p^k$ is a power of $p$ and show that at least one of $2, 17, 34$ is a quadratic residue mod $m$. If $p\neq 2,17$, then at least one of $2, 17, 34$ is a quadratic residue mod $p$ as
$$\lg{34}{p}\lg{2}{p}\lg{17}{p} = \lg{2}{p}^2\lg{17}{p}^2 = 1$$
and by Corollary \ref{cor:p2n} is a quadratic residue mod $p^k$. If $p = 17$, then $2 = 6^2$ is a quadratic residue mod $17$ and also mod $17^k$. Finally, since $17\equiv 1\pmod{8}$, it is a quadratic residue mod $8$ and so is also mod $2^k$.

\v
\noindent\textbf{Remark}: It is a fairly nontrivial fact that if $f(x)\in\Z[x]$ is irreducible (in $\Q[x]$), then there are infinitely many primes $p$ for which $f(x)$ has no roots mod $p$. An irreducible polynomial in $\Z[x]$ can be reducible mod $p$ for all primes $p$. We have seen that $x^4 + 1$ satisfies this. As we will learn soon, most cyclotomic polynomials are reducible mod every prime \add{but are irreducible in $\Z[x]$}.



Our algorithm for determining whether $a$ is a square mod $m$ starts by factoring $m$. However, factorization is notoriously difficult. For example, let's see if $69$ is a square mod $5338$. We can quickly factor $5338 = 2\times 2669$ so it suffices to check mod $2$ and mod $2669$. Everything is a square mod $2$ but it takes some nontrivial effort to check whether $2669$ is prime or not. If we pretend that we can use the Legendre symbol with composite ``denominators'' and that the same laws of quadratic reciprocity hold, then
$$\lg{69}{2669} = \lg{2669}{69} = \lg{2600}{69} = \lg{26}{69} = \lg{2}{69}\lg{13}{69} = -\lg{69}{13} = -\lg{4}{13} = -1.$$
We would then guess that $69$ is not a square mod $2669$. This in fact can be made precise using the \wow{Jacobi symbol}.

Given two coprime integers $a,b$ where $b$ is a positive odd integer, we factor $b=p_1\cdots p_r$ into a product of (possibly equal) odd primes. Then we define the Jacobi symbol
$$\lg{a}{b}:= \prod_{j=1}^r\lg{a}{p_j}.$$
Note that if $\lg{a}{b} = -1$, then that means some $\lg{a}{p_j} = -1$ so $a$ is not a square mod $p_j$ for some prime divisor $p_j$ of $b$, which implies that $a$ is not a square mod $b$. However, if $\lg{a}{b} = 1$, then we cannot deduce anything about whether $a$ is a square mod $b$. It is not hard to use the usual laws of quadratic reciprocity for Legendre symbols to deduce the same laws of quadratic reciprocity for Jacobi symbols.

\begin{theorem}\label{thm:QRJ}
    (Quadratic reciprocity for Jacobi symbols) Let $b$ be a positive odd integer. Then:
    \begin{enumerate}[(a)]
        \item $\displaystyle\lg{-1}{b} = (-1)^{(b-1)/2}$;
        \item $\displaystyle\lg{2}{b} = (-1)^{(b^2 - 1)/8}$;
        \item if $a$ is a positive odd integer coprime to $b$, then $\displaystyle\lg{a}{b}\lg{b}{a} = (-1)^{(a-1)(b-1)/4}.$
    \end{enumerate}
\end{theorem}

\add{
\begin{proof} We write $b = p_1\cdots p_r$.
    (a) Note that for any odd integer $m$, $(-1)^{(m-1)/2}\equiv m\pmod{4}$. Hence
$$\lg{-1}{b} = \prod_{i=1}^r (-1)^{(p_i-1)/2} \equiv p_1\cdots p_r\equiv b \equiv (-1)^{(b-1)/2}\pmod{4}.$$
Hence they are equal as integers because they are $\pm1$.

\v
\noindent(b) It suffices to prove that $$\sum_{i=1}^r\frac{p_i^2-1}{8} \equiv \frac{(p_1\cdots p_r)^2 - 1}{8}\pmod{2}$$
by induction on $r$. It is clearly true for $r = 1$. Suppose $r\geq 2$. Then,
\begin{eqnarray*}
    \frac{(p_1\cdots p_r)^2 - 1}{8} &=& p_r^2\frac{(p_1\cdots p_{r-1})^2 - 1}{8} + \frac{p_r^2-1}{8}\\
    &\equiv& \frac{(p_1\cdots p_{r-1})^2 - 1}{8} + \frac{p_r^2-1}{8}\pmod{2} \qquad\mbox{since }p_r\mbox{ is odd}\\
    &\equiv&\sum_{i=1}^{r-1} \frac{p_i^2-1}{8} + \frac{p_r^2-1}{8}\pmod{2}\qquad\mbox{by induction}\\
    &\equiv&\sum_{i=1}^{r} \frac{p_i^2-1}{8}\pmod{2}.
\end{eqnarray*}

\noindent(c) Let $b^* = (-1)^{(b-1)/2}b$. Then by (a) and multiplicativity, we have
$$\lg{b^*}{a} = (-1)^{\frac{a-1}{2}\frac{b-1}{2}}\lg{b}{a}.$$
Note also by (a), we have $b^* = p_1^*\cdots p_r^*.$ Note that
$$b^* = \lg{-1}{b}b = \prod_{i=1}^r \lg{-1}{p_i}p_i = \prod_{i=1}^r p_i^*.$$
Therefore, for $a = q_1\cdots q_t$, we have
$$\lg{a}{b} = \prod_{i=1}^r\lg{a}{p_i} = \prod_{i=1}^r\prod_{j=1}^t\lg{q_j}{p_i} = \prod_{j=1}^t\prod_{i=1}^r\lg{p_i^*}{q_j} = \prod_{j=1}^r \lg{b^*}{q_j} = \lg{b^*}{a}.$$
The proof is now complete.
\end{proof}
}

\noindent\textbf{Remark 1:} It turns out that 2669 is a prime. So $\lg{69}{2669}$ is the actual Legendre symbol, but we could use Jacobi symbols to compute it. If it is $1$, we would be able to say that the ``numerator'' is a square mod 2669.

\v
\noindent\textbf{Remark 2:} It is very easy to write down examples where $\lg{a}{b} = 1$ but $a$ is not a square mod $b$. For example, if $b$ is a square, then $\lg{a}{b} = 1$ for any $a$ coprime to $b$. Say $\lg{2}{9} = 1$ but $2$ is not a square mod $3$ and so not a square mod $9$.

\v
\noindent\textbf{Remark 3:} It is very fast to compute the Jacobi symbol $\lg{a}{b}$. We only need to factor out $2$, whereas for the Legendre symbol, we need to factor $a$ into primes in order to use multiplicativity and quadratic reciprocity.

\begin{center}
    \add{Lecture 26.5 Fri 11/08\\ Tutorial}

    \re{Jacobi symbol}
\end{center}

In HW 9 Q2, you are asked to prove that if $2^n - 1\mid 3^n - 1$, then $n = 1$. Let's give another proof. By (a) of the problem, we know that $n$ is odd. Then from $3^n\equiv 1\pmod{2^n - 1}$, we get
$$1 = \lg{1}{2^n - 1} = \lg{3^n}{2^n - 1} = \lg{3}{2^n - 1}.$$
Suppose now $n\geq 3$ is odd. Then $2^n - 1\equiv -1\pmod{8}$. In particular, $2^n - 1\equiv 3\pmod{4}$. So we have
$$\lg{3}{2^n - 1} = -\lg{2^n - 1}{3}.$$
Now since $n$ is odd, we have $2^n\equiv (-1)^n\equiv -1\equiv 2\pmod{3}$. So
$$1 = \lg{3}{2^n - 1} = -\lg{2^n - 1}{3} = -\lg{1}{3} = -1.$$
Contradiction.

The same argument can be used to solve the (in)famous IMO 2022 Shortlist N8:
$$\forall n\in\N,\quad 2^n + 65\nmid 5^n - 3^n.$$
\add{Suppose for a contradiction that $2^n + 65\mid 5^n - 3^n$. Since $3\nmid 5^n - 3^n$ and $2^n + 65 \equiv (-1)^n + 2\pmod{3}$, we see that $n$ is odd and so $2^n + 65 \equiv 1\pmod{3}$. Then since $5^n\equiv3^n\pmod{2^n + 65}$, we have
$$\lg{5}{2^n + 65} = \lg{5^n}{2^n + 65} = \lg{3^n}{2^n + 65} = \lg{3}{2^n + 65}.$$
Since $n$ is odd and the statement is immediate when $n = 1$, we may assume $n\geq 3$ and so $2^n + 65\equiv 1\pmod{4}$. Then, we have
$$\lg{5}{2^n + 65} = \lg{2^n + 65}{5} = \lg{2^n}{5} = \lg{2}{5} = -1$$
but
$$\lg{3}{2^n + 65} = \lg{2^n + 65}{3} = \lg{1}{3} = 1.$$
Contradiction.}

\v
As another example, consider the Fermat numbers $F_n = 2^{2^n} + 1$ again. Suppose $m > n \geq 2$ so that $F_n,F_m\equiv 1\pmod{8}$. %We saw before that the distinct Fermat numbers are coprime.
Now
$$2^{2^m} = 2^{2^n2^{m-n}} = (2^{2^n})^{2^{m-n}} \equiv (-1)^{2^{m-n}}\equiv 1\pmod{F_n}.$$
Hence, we have
$$F_m\equiv 2\pmod{F_n}.$$
Computing Jacobi symbols gives
$$\lg{F_n}{F_m} = \lg{F_m}{F_n} = \lg{2}{F_n} = 1.$$
However, using $F_2 = 17$ and the prime divisor $641$ of $F_5$, we have
$$\lg{17}{641} = \lg{641}{17} = \lg{12}{17} = \lg{3}{17} = \lg{17}{3} = \lg{2}{3} = -1.$$
So $F_2$ is not a square mod $F_5$. We prove next that $F_m$ is a square mod $F_n$ if $m > n\geq 2$. It suffices to prove that $F_m$ is a square mod $p$ for any prime $p\mid F_n$. Since $F_m\equiv 2\pmod{F_n}$, we also have $F_m\equiv 2\pmod{p}$. Moreover, we know $p\equiv 1\pmod{8}$ (since in fact, $p\equiv 1\pmod{2^{n+2}}$ by Proposition \ref{prop:96}). Hence
$$\lg{F_m}{p} = \lg{2}{p} = 1.$$

Recall that the Legendre symbol satisfies
$$a^{(p-1)/2}\equiv \lg{a}{p}\pmod{p}.$$
This was in some sense the definition of Legendre symbols and it relies on the fact that $\F_p^\times$ has a primitive element. Suppose now $n$ is a composite squarefree odd integer, say $69$. \qt{Is it possible for all $a$ coprime to $69$ to satisfy}
$$\qt{a^{34}\equiv\lg{a}{69}\pmod{69}?}$$
Suppose it is true. Then we would also have
$$a^{34}\equiv\lg{a}{69}\pmod{23}.$$
Note that $a^{34}$ mod $23$ depends only on $a$ mod $23$, but $$\lg{a}{69} = \lg{a}{3}\lg{a}{23}$$
depends both on $a$ mod $23$ and on $a$ mod $3$. So we would have a contradiction by taking $a_1 = 2$ and $a_2 = 25$. They are congruent mod $23$, but
$$\lg{a_1}{3} = \lg{2}{3} = -1\neq \lg{1}{3} = \lg{a_2}{3}.$$
So we have a contradiction because
$$a_1^{34}\equiv a_2^{34}\pmod{23}\qquad\mbox{but}\qquad \lg{a_1}{69}\not\equiv\lg{a_2}{69}\pmod{23}.$$
It turns out in this case that $$2^{34}\equiv 25\not\equiv\pm1\pmod{69}.$$
The above argument relies on the fact that $69$ has two distinct prime factors and can be generalized to:
\begin{cor}\label{cor:SSJ}
    If $n$ is an odd positive integer with at least two distinct prime factors, then there exists an integer $a$ coprime with $n$ such that $$a^{(n-1)/2}\not\equiv \lg{a}{n}\pmod{n}.$$
\end{cor}
Due to how fast it is to compute the Jacobi symbols, this idea can be used for primality testing! We note that discrete exponentiation, namely the computation of $a^m\pmod{n}$ is fast using the Square-and-Multiply method. For example, let's try to compute $69^{420}\pmod{2024}$. We first express $420$ as a sum of powers of $2$ (which it already is):
$$420 = 256 + 128 + 32 + 4.$$
Next we repeated square $69$ to find
\begin{eqnarray*}
    69^2 &\equiv& a_1\pmod{2024}\\
    69^4 &\equiv& a_1^2 \,\,\,\equiv\,\,\, a_2\pmod{2024}\\
    69^8 &\equiv& a_2^2 \,\,\,\equiv\,\,\, a_3\pmod{2024}\\
    &\vdots&\\
    69^{256} &\equiv& a_7^2 \,\,\,\equiv\,\,\, a_8\pmod{2024}.
\end{eqnarray*}
Then we multiply the ones that show up:
$$69^{420} \equiv a_8\cdot a_7\cdot a_5\cdot a_2\pmod{2024}.$$
The number of squaring that we need to perform is $\lfloor\log_2 m\rfloor$. The number of multiplication at the end is one less than the number of nonzero digits in the binary representation of $m$, which is also bounded by $\lfloor\log_2 m\rfloor$. Hence the number of multiplications needed in total is bounded by $2\log_2 m$. We say this algorithm can be done in \wow{polynomial time}, since the number of operations needed is bounded by some polynomial in the number of bits of $m$.

Corollary \ref{cor:SSJ} turns out to be true when $n = p^k$, but we also have a very fast algorithm for testing whether $n = p^k$ for some prime $p$ and some $k\geq 2$. We note that if $n = p^k$, then $k = \log_p n \leq \log_2 n$. For each $k = 1,2,\ldots,\lfloor\log_2 n\rfloor$, we will test if $n$ is a perfect $k$-th power by running a binary search.
\begin{center}
    \wow{Binary search for testing for prime powers}
\end{center}
\begin{enumerate}
    \item Set $a_L = 2$ and $a_H = n-1$. So $n^{1/k}\in[a_L, a_H)$.
    \item If $a_H \leq a_L + 1$, return True if $a_L^k = n$ and False if $a_L^k\neq n$.

    Else, let $c = \lfloor(a_L + a_H)/2\rfloor$.
    \item If $c^k = n$, then return True. If $c^k > n$, then $c$ is too big and we replace $a_H$ by $c$. If $c^k < n$, then $c$ is too small and we replace $a_L$ by $c$. Go back to step 2.
\end{enumerate}

Even though computing $\lg{a}{n}$ and $a^{(n-1)/2}\pmod{n}$ are both fast, ain't nobody got time to test every single $a$. We might as well just check for $a\mid n$ in that case!


\subsection*{Exercises}
\begin{enumerate}[\thesection .1]
    \item Let $p\geq 3$ be a prime and let $a,b$ be two primitive elements mod $p$. Prove that $ab$ is not primitive.
    \item Is $91$ a quadratic residue mod $253$?
    \item Prove that the polynomial $x^8 - 16$ has a root mod $p$ for all primes $p$.
    \item Find all solutions to $x^4 + x^3 + 2x^2 + x\equiv 13\pmod{343}$.
    \item Find all solutions to $x^3 - 2x - 1\equiv 0\pmod{125}.$
\end{enumerate}



\begin{center}
    \add{Lecture 27 Mon 11/11}

    \re{Basic definition of Group theory}
\end{center}

\section{Group Theory}

A \wow{group} is a set $G$ equipped with one binary operation, one unary operation and one nullary operation:
$$(a,b)\mapsto ab:G\times G\rightarrow G\qquad a\mapsto a^{-1}:G\rightarrow G, \qquad e\in G$$
such that for any $a,b,c\in G$,
\begin{enumerate}[(a)]
    \item (Associative) $a(bc) = (ab)c$;
    \item (Multiplicative identity) $a\cdot e = a$ and $a\cdot a^{-1} = e$.
\end{enumerate}
With a little bit of work, one can prove that $e\cdot a = a$ and $a^{-1}\cdot a = e$. If $ab = ba$ for all $a,b\in G$, we say $G$ is an \wow{abelian} group. All the groups that we will encounter in this class are abelian groups.

The advantage of doing rings first is that we now have a lot of examples of abelian groups. Suppose $R$ is a commutative ring. Then we can associate to it two abelian groups:
\begin{itemize}
    \item The additive group $(R,+)$ of a ring $R$, where we forget about multiplication and use addition as the binary operation, negation as inversion, and $0$ as $e$.
    \item The multiplicative group $(R^\times,\cdot)$ of units $R^\times$ with multiplication, inversion and $1$ from the ring $R$.
\end{itemize}
For example, we have the group $\Z/m\Z$ with addition, and the group $(\Z/m\Z)^\times$ with multiplication.

A \wow{subgroup} of a group $G$ is a subset $H\subseteq G$ closed under all the group operations: $e\in H$ and for all $a,b\in H$, we have $a^{-1}\in H$ and $ab\in H$. The standard notation is $\wow{H\leq G}$. Given any element $g\in G$, we write $\wow{\langle g\rangle}$ for the subgroup of $G$ generated by $g$. Namely,
$$\langle g\rangle = \{g^n\colon n\in\Z\} = \{e,g,g^2,\ldots,g^{-1},g^{-2},\ldots\}.$$
For example, in $(\Z/69\Z,+)$, we have
$$\langle 23\rangle = \{0,23,46\}\aa\langle 5\rangle = \{0,5,10,15,20,25,\ldots,65,1,6,11,\ldots\} = \Z/69\Z.$$
In $(\Z/69\Z)^\times$, we find that
$$\langle 5\rangle = \{1,5,25,56,4,20,31,17,16,11,55,\wow{68},64,44,13,65,49,38,52,53,58,14\}$$
is a subgroup of order $22$ while $(\Z/69\Z)^\times$ has order $\phi(69) = 44$. As usual, we define the \wow{order} $o(g)$ of an element $g$ as the smallest positive integer $d$ such that $g^d = e$, if it exists. Then $o(g) = |\langle g\rangle|$.

\begin{theorem}\label{thm:LagT}
    (Lagrange's Theorem) Suppose $H$ is a subgroup of a finite group $G$. Then $|H|\,\mid\,|G|$.
\end{theorem}

\noindent\textbf{``Proof'' by example:} Note that
\begin{eqnarray*}
    \langle 5\rangle &=& \{1,5,25,56,4,20,31,17,16,11,55,\wow{68},64,44,13,65,49,38,52,53,58,14\}\\
    2\cdot\langle 5\rangle &=& \{2,10,50,43,8,40,62,34,32,22,41,\wow{67},59,19,26,61,29,7,35,37,47,28\}.
\end{eqnarray*}
They have the same size as $|\langle 5\rangle|$ and form a partition of $(\Z/69\Z)^\times$.\hfill$\Box$

\v
\add{
\begin{proof}
    Define a relation on $G$ by $a\sim b$ if $a = bh$ for some $h\in H$. We check that it is an equivalence relation.
    \begin{itemize}
        \item $a\sim a$ follows because $e\in H$ and $a = ae$.
        \item If $a\sim b$, then $a = bh$ for some $h\in H$. Multiplying by $h^{-1}\in H$ gives $ah^{-1} = b$. So $b\sim a$.
        \item If $a\sim b$ and $b\sim c$, then $a = bh_1$ and $b = ch_2$ for some $h_1,h_2\in H$. Then $a = ch_2h_1$ and $h_2h_1\in H$. So $a\sim c$.
    \end{itemize}
    Each equivalence class is of the form $$[a] = aH = \{ah\colon h\in H\}$$
    which has the same number of elements as $H$. Since the equivalence classes form a partition of the entire $G$, we see that $|H|\mid |G|$ and the quotient $|G|/|H|$ is the number of distinct equivalence classes.
\end{proof}
}

\begin{cor}
    Suppose $G$ is a finite group and $g\in G$. Then $g^{|G|} = e$.
\end{cor}

\begin{cor}\label{cor:propersmall}
    Suppose $G$ is a finite group and $H$ is a proper subgroup ($H\leq G$ and $H\neq G$). Then $|H|\leq |G|/2$.
\end{cor}

If there is some $g\in G$ such that $G = \langle g\rangle$, then we say $G$ is \wow{cyclic} and call $g$ a \wow{generator}. In general, $\Z/m\Z$ is cyclic with 1 as a generator. If $F$ is a finite field, then $F^\times$ is cyclic, generated by a primitive element. \qt{What about $(\Z/69\Z)^\times$ and $(\Z/m\Z)^\times$ in general?} When $m = p$ is a prime, $\Z/p\Z$ is secretly $\F_p$ in which case we know $(\Z/p\Z)^\times$ is cyclic.

Given two groups $G_1$ and $G_2$, a \wow{group homomorphism} is a map $\varphi:G_1\rightarrow G_2$ preserving all the group operations. That is,
$$\varphi(e_{G_1}) = e_{G_2}\aa\varphi(ab) = \varphi(a)\varphi(b).$$
By taking $b = a^{-1}$, we also get $\varphi(a^{-1}) = \varphi(a)^{-1}$. A \wow{group isomorphism} is a group homomorphism that is a bijection, and we say the two groups are \wow{isomorphic}, written $\wow{G_1\cong G_2}$. Any two cyclic groups of the same order are isomorphic (\add{by a map sending a generator of $G_1$ to a generator of $G_2$}). We write $\wow{C_m}$ for a/the cyclic group of order $m$.

From the Chinese Remainder Theorem, we have the ring isomorphism
$$\Z/69\Z\cong\Z/3\Z\times\Z/23\Z.$$
Taking the group of units gives
$$(\Z/69\Z)^\times\cong(\Z/3\Z)^\times\times(\Z/23\Z)^\times\cong C_2\times C_{22}.$$
\qt{Is this secretly cyclic?} We note that for any $(a,b)\in C_2\times C_{22}$, we have $a^2 = e$ and $b^{22} = e$. Then $(a,b)^{22} = (a^{22},b^{22}) = (e,e).$ So $o(a,b)\mid 22$. Hence, no element in $C_2\times C_{22}$ can have order $44$, implying that it is not cyclic. Similarly, $C_4\times C_{22}$ is not cyclic, because $(a,b)^{\lcm(4,22)} = (e,e)$ and $\lcm(4,22) < 4\times 22$.

\v\noindent\wow{Challenge Exercise}: Let $p$ be a prime and $d\in\N$. Then the set $\Aut(\F_{p^d})$ of ring homomorphisms $\F_{p^d}\rightarrow\F_{p^d}$ (which are all automatically isomorphisms, so are called automorphisms), with composition as the binary operation, inverse as the unary operation, and the identity map as $e$, form a group. Prove that
$$\Aut(\F_{p^d})\cong C_d.$$

\begin{center}
    \add{Lecture 28 Wed 11/13}

    \re{$(\Z/m\Z)^\times$}
\end{center}


\begin{lemma}
    Let $m,n\in\N$. Then $C_m\times C_n$ is cyclic if and only if $\gcd(m,n) = 1$.
\end{lemma}

\begin{proof}
    We have proven by example above that if $m,n$ are not coprime, then $\lcm(m,n) < mn$ in which case $C_m\times C_n$ does not have an element of order $mn$. When $m,n$ are coprime, we already know by the Chinese Remainder Theorem that $\Z/mn\Z\cong\Z/m\Z\times\Z/n\Z$ as rings. Forgetting the multiplication gives a group isomorphism $C_{mn}\cong C_m\times C_n$.
\end{proof}

We now consider $(\Z/m\Z)^\times$ in general. Suppose $m = p_1^{k_1}\cdots p_r^{k_r}$. Then by the Chinese Reminder Theorem, we have
$$(\Z/m\Z)^\times\cong(\Z/p_1^{k_1}\Z)^\times\times\cdots\times(\Z/p_r^{k_r}\Z)^\times.$$

\begin{theorem}\label{thm:Zpktimes}
    For any positive integer $t$,
\begin{eqnarray*}
    (\Z/p^t\Z)^\times &\cong & C_{p^{t-1}(p-1)},\qquad\mbox{if }p\mbox{ is odd,}\\
    (\Z/2^t\Z)^\times &\cong &\begin{cases}
        1&\mbox{ if }t=1,\\
        C_2&\mbox{ if }t = 2,\\
        C_2\times C_{2^{t-2}}&\mbox{ if }t\geq3.
    \end{cases}
\end{eqnarray*}
\end{theorem}
For example, we have
\begin{eqnarray*}
    (\Z/2023\Z)^\times&\cong&(\Z/7\Z)^\times\times(\Z/17^2\Z)^\times\cong C_6\times C_{17\cdot16},\\
    (\Z/2024\Z)^\times&\cong&(\Z/8\Z)^\times\times(\Z/11\Z)^\times\times(\Z/23\Z)^\times \cong C_2\times C_2\times C_{10}\times C_{22},\\
    (\Z/2025\Z)^\times&\cong&(\Z/3^4\Z)^\times\times(\Z/5^2\Z)^\times\cong C_{3^3\cdot2}\times C_{5\cdot4}.
\end{eqnarray*}
\qt{Is any of them cyclic?}

\v
\begin{proof}
    Suppose first that $p$ is odd. To prove $(\Z/p^t\Z)^\times$ is cyclic, we need to find some $a\in\Z$ such that $o_{p^t}(a) = p^{t-1}(p-1)$. \qt{A long time ago, in a tutorial far far away, we worked out $o_{49}(2)$ using... LTE!} Let's prove by example by finding a generator $a$ for $(\Z/17^3\Z)^\times$.

    We start with a generator $a$ for $(\Z/17\Z)^\times$, which we know exists from the theory of finite fields. Let's say $a = 3$ and we hope that it just works mod $17^3$. Note $$a^{o_{17^3}(a)}\equiv 1\pmod{17^3}\quad\Rightarrow\quad a^{o_{17^3}(a)}\equiv 1\pmod{17}\quad\Rightarrow\quad 16 = o_{17}(a)\mid o_{17^3}(a).$$ \qt{While it is not important for the proof, it is a fun to see how to find $a$ in this case. Note that $(\Z/17\Z)^\times$ has order $16$. So $a$ is a generator if and only if $a^8\neq 1$. Recall that $a^8 = \lg{a}{17}$. So we just need to find a non-square mod $17$. We can't take $2$ because $17\equiv 1\pmod{8}$. We can take $3$ because $\lg{3}{17} = \lg{17}{3} = \lg{2}{3} = -1$.}

    We know $o_{17}(3) = 16$. So $\nu_{17}(3^{16} - 1)\geq 1$. Suppose first $\nu_{17}(3^{16} - 1)\geq 2$. Then we consider
    $$(3 + 17)^{16} - 1 = (3^{16} - 1) + 16\cdot 3^{15}\cdot 17 + 17^2(\cdots).$$
    Note that $\nu_{17}(16\cdot 3^{15}\cdot 17) = 1$ while all the other terms have $\nu_{17}\geq 2$. Hence, we see that either $\nu_{17}(3^{16} - 1) = 1$ or $\nu_{17}(20^{16} - 1) = 1$. We take $a = 3$ or $a = 20$ depending on which gives $\nu_{17} = 1$. \qt{In this case, $\nu_{17}(3^8 + 1) = \nu_{17}(6562) = 1$ and we know $17\nmid 3^8 - 1$, so $\nu_{17}(3^{16} - 1) = 1$.}

    We write $o_{17^3}(a) = 16q$ for some $q\in\N$. Then we can apply LTE (Proposition \ref{prop:LTE}) to get $$3\leq\nu_{17}(a^{16q} - 1) = \nu_{17}(a^{16} - 1) + \nu_{17}(q).$$
    So $\nu_{17}(q)\geq 2$, which gives $17^2\mid q$. Then $17^2\cdot 16\mid d$ but $d\leq \phi(17^3) = 17^2\cdot 16$. So $d = \phi(17^3)$.
   % This implies that $17^3\nmid a^{16\cdot 17} - 1$. So $o_{17^3}(a)\nmid 16\cdot 17$. However, we know that $$o_{17^3}(a)\mid 16\cdot 17^2\aa 16\mid o_{17^3}(a).$$
    %Combining these, we find that $o_{17^3}(a) = 16\cdot 17^2$ is the maximal possible.

    Suppose now $p = 2$. The cases $(\Z/2\Z)^\times = 1$ and $(\Z/4\Z)^\times = \{1,3\}\cong C_2$ can be checked directly. Suppose now $t\geq 3$. We use the same LTE argument with $a = 5$. We have $\nu_2(5 - 1) = 2$. Since $5\equiv 1\pmod{4}$, we can use LTE (Proposition \ref{prop:LTEp2}) to get
    \begin{eqnarray*}
        \nu_2(5^{2^{t-3}} - 1) &=& \nu_2(5 - 1) + t - 3 = t - 1,\\
        \nu_2(5^{2^{t-2}} - 1) &=& \nu_2(5 - 1) + t - 2 = t.
    \end{eqnarray*}
    So $o_{2^t}(5) = 2^{t-2}$. Since $5\equiv 1\pmod{4}$, the same is true for every power of $5$. Hence the subgroup $\langle 5\rangle$ is missing all the elements in $(\Z/2^t\Z)^\times$ that are congruent to $3$ mod $4$. It is easy to check that the map
    \begin{eqnarray*}
        \langle -1\rangle \times \langle 5\rangle &\rightarrow& (\Z/2^t\Z)^\times\\
        (a,b) &\mapsto&ab
    \end{eqnarray*}
    is a group isomorphism. Therefore,
    $$(\Z/2^t\Z)^\times\cong \langle -1\rangle \times \langle 5\rangle\cong C_2\times C_{2^{t-2}}.$$
    The proof is now complete.
\end{proof}

Now that we have a complete description of $(\Z/m\Z)^\times$, \qt{which of them are cyclic?} Note that if $(\Z/m\Z)^\times$ is not cyclic, then for any prime $p$, we have $o_m(p)\neq \phi(m)$ in which case $\Phi_m(x)$ is not irreducible in any $\F_p[x]$.



Recall the examples
\begin{eqnarray*}
    (\Z/2023\Z)^\times&\cong&(\Z/7\Z)^\times\times(\Z/17^2\Z)^\times\cong C_6\times C_{17\cdot16},\\
    (\Z/2024\Z)^\times&\cong&(\Z/8\Z)^\times\times(\Z/11\Z)^\times\times(\Z/23\Z)^\times \cong C_2\times C_2\times C_{10}\times C_{22},\\
    (\Z/2025\Z)^\times&\cong&(\Z/3^4\Z)^\times\times(\Z/5^2\Z)^\times\cong C_{3^3\cdot2}\times C_{5\cdot4}.
\end{eqnarray*}
We note that every cyclic factor has even order. As a result, similar to the $C_m\times C_n$ case with $\gcd(m,n)\neq 1$, we see that no element can have a big enough order to generate the full group. For example, every element in $(\Z/2024\Z)^\times$ has order dividing $\lcm(2,2,10,22) = 110$ but $(\Z/2024\Z)^\times$ has order $880$. In order for $(\Z/m\Z)^\times$ to be cyclic, there can only be one cyclic factor of even order.

\begin{cor}
    Let $m\in\N$. Then $(\Z/m\Z)^\times$ is cyclic if and only if $m = 2, 4,p^t,2p^t$ for some odd prime $p$ and positive integer $t$. In particular, if $m$ is an odd composite integer, then $(\Z/m\Z)^\times$ is not cyclic.
\end{cor}



We can use this observation to test for primality! The cause for $(\Z/m\Z)^\times$ to be non-cyclic is the multitude of $C_n$ factors with $n$ even. Every such factor produces 2 elements $a$ with $a^2 = e$, namely the identity $e$ and $g^{n/2}$ where $g$ is any generator. (In HW 10 P1, you will prove that a cyclic group has a unique subgroup of every possible order, which implies that there are no other elements of order 2.) In terms of the isomorphism
$$(\Z/p^t\Z)^\times\cong C_{p^{t-1}(p-1)},$$
these two elements with $a^2 = 1$ are simply $1$ and $-1$. When there are multiple cyclic factors of even order, for example for $$(\Z/2023\Z)^\times\cong(\Z/7\Z)^\times\times(\Z/17^2\Z)^\times\cong C_6\times C_{17\cdot16},$$
there are four elements with $a^2 = 1$, as they can be $\pm1$ mod $7$ and $\pm1$ mod $17^2$. Note that $288 = 289 - 1 = 287 + 1$. So the four elements of $(\Z/2023\Z)^\times$ that square to $1$ are $\pm1, \pm288.$

\begin{center}
    \add{Lecture 29.5 Fri 11/15\\ Tutorial}

    \re{Shor's factorization and RSA}
\end{center}

One does not teach a first year intro to number theory course without mentioning RSA. \add{(See also slides on RSA.)} RSA (Rivest-Shamir-Adleman) is a public-key cryptosystem, one of the oldest, that is widely used for secure data transmission. Let's discuss its setup:
\begin{enumerate}
    \item Pick two large distinct primes $p$ and $q$, say on the order of $2^{1024}$ or approximately $300$ digits.
    \item Let $n = pq$ so that $\phi(n) = (p-1)(q-1)$.

    Then for any integer $M$ coprime to $n$, we have $M^{\phi(n)}\equiv 1\pmod{n}$. Now if $N\equiv 1\pmod{\phi(n)}$, then $N = 1 + \phi(n)k$ for some $k\in\Z$ so
    $$M^N = M\cdot M^{\phi(n)k} \equiv M\pmod{n}.$$
    \item Pick an integer $d$ coprime to $\phi(n)$.

    Then there exist integers $e,t$ such that $de + t\phi(n)=1$. The integer $e$ can be easily found using the (Extended) Euclidean algorithm. Note that for any integer $M$ coprime to $n$,
    $$de \equiv 1\pmod{\phi(n)} \qquad\Longrightarrow\qquad M^{de}\equiv M\pmod{n}.$$
    \item Publish $(e,n)$ as the public key. Keep $(d,n)$ (and $p$, $q$) hidden as the private key. It is also customary to replace $e$ and $d$ by their remainders mod $\phi(n)$.
\end{enumerate}
Now when someone wants to send a message $M$ to me, they would take my $(e,n)$ and compute $$C \equiv M^e\pmod{n}$$
and send $C$ to me. When we receive $C$, we can recover $M$ mod $n$ via
$$C^d\equiv M^{de} \equiv M\pmod{n}.$$
If we further require that $M = 1,\ldots, n$, for example by restricting the size of the message or by breaking it up into multiple messages, we would recover $M$ exactly.

\vspace{5pt}
The efficiency of RSA relies on the ability to compute $M^e\pmod{n}$ and $C^d\pmod{n}$ in polynomial time, which we have already seen. It should also be ``easy'' to generate primes. The traditional sieve of Eratosthenes produces all the primes, but is too slow to generate $300$ digit primes. From the prime number theorem, we know that roughly 1 out of $\log n$ numbers up to $n$ are primes. So it is much more efficient to take a bunch of random large numbers and test for primality.

\vspace{5pt}
The security of RSA relies on the following:
\begin{enumerate}
    \item Given the public key $(e,n)$, it is practically impossible to find the private key $(d,n)$.

    Note that we can find $d$ by solving $ex\equiv 1\pmod{\phi(n)}$ but this requires finding $p$ and $q$ so we can compute $\phi(n) = (p-1)(q-1)$. In other words, factorization should be hard.
    \item Given the message $M$ and the encrypted $C$, it is practically impossible to find $d$ such that $M\equiv C^d\pmod{n}$.

    This problem is known as discrete logarithm.
\end{enumerate}
In the above, practically impossible means that the current best algorithm would take longer than say 100 years to complete. These algorithms' runtime are exponential in $\log n$, which is basically the number of bits that $n$ has. Even something like $e^{100}$ is already more than $10^{43}$. Both of the two problems can be solved with quantum computing!



\begin{proposition}
    Suppose $m$ is an odd composite integer with at least two distinct prime factors. Then there exists an integer $a\not\equiv\pm1\pmod{m}$ such that $a^2\equiv 1\pmod{m}$. Given such an $a$, the two integers $\gcd(m, a-1)$ and $\gcd(m,a+1)$ are nontrivial divisors of $m$.
\end{proposition}

\begin{proof}
     Let $m = p_1^{k_1}\cdots p_r^{k_r}$ be the prime factorization of $m$. Then $a\equiv\pm1\pmod{p_i^{k_i}}$ for $i=1,\ldots,r$. Then $\gcd(m,a-1)$ is the product of $p_i^{k_i}$ for which $a\equiv 1\pmod{p_i^{k_i}}$; and $\gcd(m,a+1)$ is the rest. Since $a\not\equiv\pm1\pmod{m}$, both $1$ and $-1$ appear.
\end{proof}

The difficulty is now to find such a \wow{nontrivial} solution to $x^2\equiv 1\pmod{m}$. We don't want to just check one-by-one (we might as well check for division directly in that case). In practice, $m$ could be some $600$ digits number and aint nobody got time for dat. We say a certain algorithm is \wow{in polynomial time} if the number of arithmetic operations needed is bounded by some polynomial in the number of digits/bits, that is, polynomial in $\log m$. For example, computing $\gcd$ via the Euclidean algorithm is in polynomial time, because every time we take the remainder, we lower the number of bits. Finding a nontrivial solution to $x^2\equiv 1\pmod{m}$ by testing inputs one-by-one for division is in exponential time.
\begin{center}
    \wow{Shor's factorization algorithm}
\end{center}
\begin{enumerate}
    \item Pick $b = 1,\ldots,m-1$ at random.
    \item Compute $\gcd(b,m)$. If $\gcd(b,m) > 1$, then it is a nontrivial divisor of $m$ and we are done.
    \item Suppose $\gcd(b,m) = 1$. \wow{Compute $d = o_m(b)$}. Then $b^d\equiv 1\pmod{m}$.
    \item If $d$ is odd, go back to step 1. If $d$ is even, then $b^{d/2}$ is a solution to $x^2\equiv 1\pmod{m}$. If $b^{d/2}\equiv \pm 1\pmod{m}$, then go back to step 1. If $b^{d/2}\not\equiv \pm 1\pmod{m}$, then we have found a nontrivial solution. (Note that $b^{d/2}\equiv  1\pmod{m}$ is not possible since $d = o_m(b)$.)
\end{enumerate}
When $m$ has at least 2 odd prime divisors, there are at most $\frac12\phi(m)$ elements $b\in(\Z/m\Z)^\times$ such that $o_m(b)$ is odd or $b^{o_m(b)/2}\equiv -1\pmod{m}$. You will work this out for an example in HW 10. This means that for a randomly chosen $b$, there is at least a $50\%$ probability that it produces a nontrivial divisor of $m$. Hence the probability that no answer is found after $k$ iterations is at most $1/2^k$. For $k\geq 80$, this is less than $10^{-24}$ which is roughly the probability that a calculation error occurs from a cosmic ray hitting the cpu causing Mario to warp to a parallel universe.



There are two important computations in Shor's algorithm: computing $o_m(b)$; and computing $b^{d/2}\pmod{m}$. We have already seen that the latter (also known as discrete exponentiation), can be done very quickly using the Square and Multiply method. The former is the problem of discrete logarithm (for example, finding the smallest $d$ such that $b^d\equiv 1\pmod{m}$), which is very slow on a classical computer but can be done in polynomial time on a quantum computer. A quantum computer can compute $b^n$ mod $m$ for all non-negative integers $n < m$ at the same time, using the fact that a qubit can be $0$ and $1$ at the same time. In the above example, we can use $11$ qubits to store $452^{2^k\cdot(0\text{ or }1)}\text{ mod }2023$ for $k = 0,\ldots,10$. Then multiplying them together to find $452^n\text{ mod }2023$ at the same time for $n = 0,\ldots,2047$.  However, it will be a superposition of states $|n, b^n\mbox{ mod }m\rangle$. Measuring the first registry gives a random $n_0$ and the value $b^{n_0}\mbox{ mod }m$. Measuring the second registry gives a random $c_0$ and a superposition of states $|n\rangle$ such that $b^n\equiv c_0\pmod{m}$.

    The key is that there is a hidden period in this. In other words, the integers $n$ such that $b^n\equiv c_0\pmod{m}$ are of the form
    $$n_1, n_1 + o_m(b), n_1 + 2o_m(b), \ldots$$
 Quantum Fourier Transform can be used to find this hidden period.


\begin{center}
    \add{Lecture 29 Fri 11/15}

    \re{Fermat primality test}
\end{center}








\vspace{5pt}


For the rest of the semester, we will discuss:
\begin{enumerate}
    \item Fermat, Miller-Rabin and Solovay-Strassen primality tests. These are polynomial time but probabilistic. However, similar to Shor's algorithm, the chance of them failing is lower than the chance of computation error.
    \item AKS primality test. This is deterministic and in polynomial time.
    \item Lucas-Lehmer primality test. This only works for Mersenne primes $2^p - 1$.
    \item The Gaussian and cyclotomic integers $\Z[i]$ and $\Z[\zeta_3]$ and some history of Fermat's Last Theorem.
\end{enumerate}




\section{Probabilistic primality test}
In this section, we consider three probabilistic primality tests, the Fermat test, the Miller-Rabin test and the Solovay-Strassen test. They all build upon Fermat's little theorem: $a^{p-1}\equiv 1\pmod{p}$ if $p$ is a prime and $a = 1,\ldots,p-1$.

\begin{lemma}
    If $a^{n-1}\equiv 1\pmod{n}$ for every $a = 1,\ldots,n-1$, then $n$ is a prime.
\end{lemma}

\begin{proof}
    Every $a = 1,\ldots,n-1$ is invertible in $\Z/n\Z$.
\end{proof}

Similar to Shor's algorithm, it is not practical to test all integers less than $n$ (we might as well just check for division in this case), so we use a probabilistic approach:
\begin{center}
    \wow{Fermat test}
\end{center}
\begin{enumerate}
    \item Pick $a = 1,\ldots,n-1$ at random.
    \item Compute $\gcd(a,n)$. If it is bigger than $1$, then $n$ is not a prime.
    \item Compute $a^{n-1}$ mod $n$. If it is not $1$, then $n$ is not a prime. Otherwise, return to step 1.
\end{enumerate}
Let's consider the set of bad inputs. Let $$F_n = \{a\in (\Z/n\Z)^\times \colon a^{n-1} = 1\}.$$
If a randomly chosen $a$ lies in $F_n$, then we have to restart; otherwise, we would conclude that $n$ is not a prime. \qt{How big is $F_n$?}

\begin{lemma}
    The set $F_n$ is a subgroup of $(\Z/n\Z)^\times$.
\end{lemma}

\begin{proof}
    Clearly $1\in F_n$. If $a,b\in F_n$, then $(ab)^{n-1} = a^{n-1}b^{n-1} = 1$ and $(a^{-1})^{n-1} = (a^{n-1})^{-1} = 1$. \add{Note that by HW 10 P1(a), since $(\Z/n\Z)^\times$ is finite, we don't need to check for $a^{-1}$.}
\end{proof}

By Corollary \ref{cor:propersmall}, since the order of a subgroup divides the order of the group, we see that if $F_n\neq(\Z/n\Z)^\times$, then $|F_n| \leq \frac12\phi(n)$ and we have a probability of at least $1/2$ that a randomly chosen $a$ can be used to prove that $n$ is not a prime. Unfortunately, there exists (infinitely many) odd composite numbers $n$ where $F_n = (\Z/n\Z)^\times$. These numbers are called \textbf{Carmichael} numbers. The smallest Carmichael number is $561 = 3\cdot 11\cdot 17.$ Note that
$$2\mid 560,\qquad 10\mid 560,\qquad 16\mid 560.$$
Hence if $a$ is an integer not divisible by $3, 11, 17$, then
\begin{eqnarray*}
    a^2\equiv 1\pmod{3} &\Longrightarrow& a^{560}\equiv 1\pmod{3}\\
    a^{10}\equiv 1\pmod{11} &\Longrightarrow& a^{560}\equiv 1\pmod{11}\\
    a^{16}\equiv 1\pmod{17} &\Longrightarrow& a^{560}\equiv 1\pmod{17}
\end{eqnarray*}
As another example, we have $1105 = 5\cdot 13\cdot 17$ and similarly $4\mid 1104$, $12\mid 1104$, $16\mid 1104$.
If we attempt to run the Fermat test on a Carmichael number, then we are just hoping to hit integers $a$ that share a prime factor with $n$. If $n$ is a product of very few large primes, we are in trouble. Carmichael numbers are all squarefree and so have at least 2 distinct prime divisors. In HW11, you will show that they have at least 3 distinct prime divisors.

\begin{proposition}\label{prop:CMsqf}
    If $p^2\mid n$ for some prime $p\geq 3$, then $n$ is not a Carmichael number.
\end{proposition}

\begin{proof}
    The key observation is that $$(1 + p)^{n-1} = 1 + (n-1)p + \sum_{r=2}^{n-1}\binom{n-1}{r}p^r\equiv 1 + (n-1)p\pmod{p^2}.$$
    Since $p\mid n$, we have $p\nmid n-1$ and so $(1+p)^{n-1}\not\equiv 1\pmod{p^2}$. Write $n = p^km$ where $k = \nu_p(n)\geq 2$. By the Chinese Remainder Theorem, we can find an integer $a$ coprime to $n$ such that
    $$\begin{cases}
        a\equiv1+p\pmod{p^k},\\
        a\equiv 1\pmod{m}.
    \end{cases}$$
    Then $a^{n-1}\equiv (1+p)^{n-1} \not\equiv 1\pmod{p^2}$. Hence $a^{n-1}\not\equiv 1\pmod{n}$.
\end{proof}

To deal with the Carmichael numbers, we can use the Solovay-Strassen test. Recall that we ``proved'' by example in the tutorial on Jacobi symbols that if $n$ is a squarefree compositive odd integer, then the congruence equation
$$a^{(n-1)/2}\equiv \lg{a}{n}\pmod{n}$$
does not hold for all $a\in(\Z/n\Z)^\times$. \add{The idea is that if $p$ is a prime divisor of $n$, then $a^{(n-1)/2}$ mod $p$ depends only on $a$ mod $p$, but $\lg{a}{n}$ depends also on $a$ mod $\frac{n}{p}$.} It is easy to check that
$$J_n = \{a\in(\Z/n\Z)^\times\colon a^{(n-1)/2}\equiv \lg{a}{n}\pmod{n}\}$$
is a subgroup of $(\Z/n\Z)^\times$ since both sides of the congruence equation are multiplicative in $a$. It is now a proper subgroup and so has size at most $\phi(n)/2$. So by randomly choosing 80 possible $a$'s, we will be able to tell with high confidence whether $n$ is prime or not.
\begin{center}
    \wow{Solovay-Strassen test}
\end{center}
\begin{enumerate}
    \item Pick $a = 1,\ldots,n-1$ at random.
    \item Compute $\gcd(a,n)$. If it is bigger than $1$, then $n$ is not a prime.
    \item Compute $a^{(n-1)/2}$ mod $n$. Compute the Jacobi symbol $\lg{a}{n}$. If they are not equal, then $n$ is not a prime. If they are equal mod $n$, return to step 1.
\end{enumerate}





When computing $a^{(n-1)/2}$ mod $n$ in the Solovay-Strassen test, we find that a lot of times, it is not even $\pm1$. For example,
$$3^{280}\equiv 441\pmod{561}.$$
However, $3^{560}\equiv 1\pmod{561}$. This means that $441$ is a nontrivial solution to $x^2\equiv 1\pmod{561}$, which also implies that $561$ is not a prime. If we run this with $2$, we actually have
$$2^{280}\equiv 1\pmod{561}.$$
\qt{Is there some other power of $2$ that we can try?} We can try $2^{140}$ and see if that's $\pm1$ mod $561$. As luck would have it, $2^{140}\equiv 67\pmod{561}$. So now we have found another nontrivial solution, namely $67$. If we run with $256$, then we have
$$256^{280}\equiv 256^{140}\equiv 256^{70}\equiv256^{35}\equiv 1\pmod{561}.$$
Now there is no way to produce some nontrivial solution to $x^2\equiv 1\pmod{561}$ starting with $256$. This is where we would ``return to step 1''. The above is exact the Miller-Rabin test:
\begin{center}
    \wow{Miller-Rabin test}
\end{center}
Write $n - 1 = u\cdot 2^k$ where $u$ is odd and $k = \nu_2(n-1)$.
\begin{enumerate}
    \item Pick $a = 1,\ldots,n-1$ at random.
    \item Compute $\gcd(a,n)$. If it is bigger than $1$, then $n$ is not a prime.
    \item Compute $b_0\equiv a^u$ mod $n$. If $b_0\equiv 1$ mod $n$, return to step 1.
    \item Repeatedly compute $b_{i+1}\equiv b_i^2$ mod $n$. If $-1$ mod $n$ is reached before $1$ mod $n$, return to step 1. If $1$ mod $n$ is reached before $-1$ mod $n$, then $n$ is not prime because we have a nontrivial solution to $x^2\equiv 1\pmod{n}$. If none of $b_0,\ldots, b_{k-1}$ equals $-1$ mod $n$, then $n$ is not a prime. \add{This last point follows because if $b_k\equiv1$, then $b_{k-1}$ is a nontrivial solution; and if $b_k\not\equiv1$, then it fails the Fermat test.}
\end{enumerate}

\begin{center}
    \add{Lecture 30 Mon 11/18}

    \re{Failure management}
\end{center}
We now consider the bad set for the Miller-Rabin test. Let
$$M_n = \{a\in(\Z/n\Z)^\times\colon a^u = 1\mbox{ or }a^{u2^i} = -1\mbox{ for some }i=0,\ldots,k-1\}.$$
Let's find $M_{69}$. We have $69 - 1 = 68 = 17\cdot 4$. So
$$M_{69} = \{a\in(\Z/69\Z)^\times\colon a^{17} = 1\mbox{ or }a^{17} = -1\mbox{ or }a^{34} = -1\}.$$
We note that
$$(\Z/69\Z)^\times\cong (\Z/3\Z)^\times\times (\Z/23\Z)^\times\cong C_2\times C_{22}.$$
Hence for any $a\in (\Z/69\Z)^\times$, we have $a^{22} = 1$. Since $\gcd(22,17) = 1$, there exist integers $x,y$ such that $22x + 17y = 1$. Since $22x$ is even, we must have $17y$ odd and so $y$ is odd.

Now if $a^{17} = 1$, then $$a = a^1 = a^{22x + 17y} = (a^{22})^x(a^{17})^y = 1^x1^y = 1.$$
If $a^{17} = -1$, then $$a = a^1 = a^{22x + 17y} = (a^{22})^x(a^{17})^y = 1^x(-1)^y = -1.$$
It is also easy to check conversely that if $a = \pm1$, then $a^{17} = a = \pm1$. Finally we observe that $a^2\equiv 1\pmod{3}$ and so $a^{34}\equiv 1\pmod{3}$. Hence it is not possible for $a^{34} = -1$. As a result, we have
$$M_{69} = \{1,-1\}.$$

Let's find $F_{69}$ next. Recall that
$$F_{69} = \{a\in(\Z/69\Z)^\times\colon a^{68} = 1\}.$$
Now since $\gcd(68,22) = 2$, we see that if $a^{68} = 1$, then $a^2 = 1$. Conversely, if $a^2 = 1$, then $a^{68} = 1$. Hence
$$F_{69} = \{a\in(\Z/69\Z)^\times\colon a^{2} = 1\}.$$
Under the isomorphism $(\Z/69\Z)^\times\cong (\Z/3\Z)^\times\times (\Z/23\Z)^\times$, we see that $a^2 = 1$ if and only if $a = (\pm1,\pm1)$. In other words, we have
$$\begin{cases}
    a&\equiv\,\,\,\pm1\pmod{3}\\
    a&\equiv\,\,\,\pm1\pmod{23}.
\end{cases}$$
Solving these gives
$$F_{69} = \{1,22,47,68\}.$$

What about $J_{69}$? We have
$$J_{69} = \{a\in(\Z/69\Z)^\times\colon a^{34} = \lg{a}{69}\}\subseteq F_{69}.$$
Hence we only need to consider $(\pm1,\pm1)\in (\Z/3\Z)^\times\times (\Z/23\Z)^\times.$ Their $34$-th powers are all $1$. Note that if $a = (g,h)\in (\Z/3\Z)^\times\times (\Z/23\Z)^\times$, then
$$\lg{a}{69} = \lg{a}{3}\lg{a}{23} = \lg{g}{3}\lg{h}{23}.$$
As $23\equiv3\pmod{4}$, we have $$\lg{-1}{3} = \lg{-1}{23} = -1.$$
Hence we have $\lg{a}{69} = 1$ if and only if $a = (1,1)$ or $(-1,-1)$. In other words,
$$J_{69} = \{1,-1\}.$$

Finally, let's find the bad set for Shor's algorithm:
$$S(69) = \{b\in(\Z/69\Z)^\times\colon o(b)\mbox{ is odd or }b^{o(b)/2} = -1\}.$$
As before, we view
$$b = (g,h) \in (\Z/3\Z)^\times\times (\Z/23\Z)^\times \cong C_2\times C_{22}.$$
Let $\alpha = o(g) \mid 2$ and so $\alpha = 1,2$. Let $\beta = o(h)\mid 22$ and so $\beta = 1,2,11,22$. Then
\begin{eqnarray*}
    o(b) &=& \mbox{smallest }d\in\N\mbox{ such that }(g^d,h^d) = (1,1)\\
    &=& \mbox{smallest }d\in\N\mbox{ such that }o(g)\mid d\mbox{ and }o(h)\mid d\\
    &=&\lcm(\alpha,\beta).
\end{eqnarray*}
Hence we see that
\begin{eqnarray*}
    o(b)\mbox{ is odd} &\Leftrightarrow&\alpha = 1\mbox{ and }\beta = 1,11\\
    &\Leftrightarrow&g = 1\mbox{ and }h^{11} = 1\\
    &\Leftrightarrow&\begin{cases}
        b&\equiv\,\,\,1\pmod{3}\\
        b&\equiv\,\,\,\mbox{square}\pmod{23}.
    \end{cases}
\end{eqnarray*}
There are $11$ such elements.

Suppose now $\alpha$ is even and $\beta$ is odd. Then we have $2\beta\mid\lcm(\alpha,\beta)$ (in fact, $\lcm(\alpha,\beta) = 2\beta$). That is, $\beta\mid o(b)/2$, which implies that $h^{o(b)/2} = 1$. In other words, $b^{o(b)/2}\equiv 1\pmod{23}$ and so it is not congruent to $-1$ mod $69$. Similarly, if $\alpha$ is odd and $\beta$ is even, then $\alpha\mid o(b)/2$ and so $b^{o(b)/2}\equiv 1\pmod{3}$, which is also not congruent to $-1$ mod $69$.

The only remaining case is $\alpha = 2$ and $\beta = 2,22$. The point now is that $$\nu_2(\alpha) = \nu_2(\beta) = \nu_2(\lcm(\alpha,\beta)).$$
As a result, $o(b)/2$ is an odd multiple of $\alpha/2$ and also an odd multiple of $\beta/2$. Since $-1$ is the unique element of order $2$ in $(\Z/3\Z)^\times$ and $(\Z/23\Z)^\times$, we see that
\begin{eqnarray*}
    g^{\alpha/2} = -1&\Rightarrow& g^{o(b)/2} = -1\\
    h^{\beta/2} = -1&\Rightarrow& h^{o(b)/2} = -1.
\end{eqnarray*}
As a result, we have $b^{o(b)/2} = -1$ in this case. Hence, we have
\begin{eqnarray*}
    b^{o(b)/2} = -1 &\Leftrightarrow&\alpha = 2\mbox{ and }\beta = 2,2\\
    &\Leftrightarrow&g = -1\mbox{ and }h^{11} \neq 1\\
    &\Leftrightarrow&\begin{cases}
        b&\equiv\,\,\,-1\pmod{3}\\
        b&\equiv\,\,\,\mbox{non-square}\pmod{23}.
    \end{cases}
\end{eqnarray*}
There are $11$ such elements. In total, we have $|S(69)| = 22$.

\v
There are a few ways to prove in general that $|M_n| \leq \phi(n)/2$ when $n$ has at least two distinct prime divisors. \add{For any $a\in M_n$, if $a^u = 1$, we set $i(a) = -1$; otherwise, we set $i(a)$ to be the integer $i = 0,\ldots,k-1$ such that $a^{u2^i} = -1$. Note that $(-1)^u = -1$ and $(-1)^{2u} = 1$ and so $i(-1) = 0$. Let $j\leq k-1$ be the largest $i(a)$ over $a\in M_n$. Then $j\geq i(-1) = 0$. For any $a\in M_n$, since $i(a)\leq j$, we have $a^{u2^j} = \pm 1$. In other words, $M_n$ is a subset of
$$E_n = \{a\in (\Z/n\Z)^\times\colon a^{u\cdot2^j} = \pm 1\}.$$
It is easy to see that $E_n$ is a subgroup of $(\Z/n\Z)^\times$.

\begin{proposition}
    Suppose $n$ is a positive odd number with at least two distinct prime divisors (for example if $n$ is a Carmichael number). Then $E_n$ is a proper subgroup of $(\Z/n\Z)^\times$. As a result, $|M_n|/\phi(n) \leq\frac12.$
\end{proposition}

\begin{proof}
    We write $n = m_1m_2$ where $m_1$ and $m_2$ are coprime odd integers. Let $a_0\in M_n$ with $i(a_0) = j$. Then $a_0^{u2^j} = -1$ in $(\Z/n\Z)^\times$. By the Chinese Remainder Theorem, there exists an integer $a$ such that \begin{eqnarray*}
        a&\equiv& a_0\pmod{m_1}\\
        a&\equiv&1\pmod{m_2}.
    \end{eqnarray*}
    Then $a^{u\cdot2^j}$ is $-1$ mod $m_1$ and $1$ mod $m_2$. So it can't be $\pm1$ mod $m_1m_2$. Hence $a\notin E_n$.
\end{proof}}

Alternatively, We can prove that \wow{the bad set for the Miller-Rabin test is the same as the bad set for Shor's algorithm when $n$ is Carmichael}. Recall the bad set for the Shor's algorithm:
$$S(n) = \{a\in(\Z/n\Z)^\times\colon o(a)\mbox{ is odd or }a^{o(a)/2} = -1\}.$$

\begin{lemma}
    For any Carmichael number $n$, we have $M_n = S(n)$.
\end{lemma}

\add{\begin{proof}
    With the notation $\Z/n\Z$, we will write $=$ instead of $\equiv$ mod $n$. Let $a\in(\Z/n\Z)^\times$ and we write $o(a) = v\cdot 2^t$ with $v$ odd. Since $n$ is Carmichael, we have $a^{n-1} = 1$ and so $o(a)\mid n - 1$. Hence $u = vw$ for some positive odd integer $w$ and $t\leq k$. The condition $o(a)$ is odd is then equivalent to $o(a)\mid u$ which is equivalent to $a^u = 1$.

    Suppose now $o(a)$ is even (i.e. $t\geq 1$). \wow{Suppose first that $a\in S(n)$.} Then $a^{v2^{t-1}} = -1$. Since $w$ is odd and $u = vw$, we can raise this to the power $w$ to get $a^{u2^{t-1}} = (-1)^w = -1$ and so $a\in M_n$. \wow{Suppose now conversely that $a\in M_n$.} Then $a^{u2^i} = -1$ for some $i = 0,1,\ldots,k-1$. Since $a^{u2^i} = (a^{v2^i})^w$, we see that $a^{v2^i}\neq 1$ and so $i < t$. Note that
    $$(a^{v2^i})^w = -1\aa (a^{v2^i})^{2^{t-i}} = 1.$$
    Since $w$ is odd and is coprime to $2^{t-i}$, there exist integers $x,y$ such that $$wx + 2^{t-i}y = 1.$$
    Since $2^{t-i}y$ is even, we see that $wx$ is odd and so $x$ is odd. Now
    $$a^{v2^i} = (a^{v2^i})^{wx}(a^{v2^i})^{2^{t-i}y} = (-1)^x\cdot1^y = -1.$$
    This implies that $a^{v2^{i+1}}$ = 1. In other words, $o(a) = v2^{i+1}$ and $a^{o(a)/2} = -1$. So $a\in S(n)$.
\end{proof}}

In HW 10 P3 bonus, you will find the size of $S(2023^{69}\cdot 2025^{420})$. You will essentially be giving a ``proof'' by example for the following formula.

\begin{proposition}\label{prop:Shorbad}
    Let $n = p_1^{k_1}\cdots p_r^{k_r}$ be an integer where $p_1,\ldots,p_r$ are distinct odd primes and where $r\geq 2$ and $k_i \geq 1$. For $i=  1,\ldots, r$, write $p_i - 1=  m_i\cdot2^{e_i}$ where $m_i$ is odd. Let $e = \min\{e_1,\ldots,e_r\}$. Then
    $$|S(n)| = \frac{\phi(n)}{2^{e_1 + \cdots + e_r}}\left(\frac{2^{re}-1}{2^r - 1}+1\right) \leq \frac{\phi(n)}{2^{r-1}}.$$
\end{proposition}
For example, for $n = 561 = 3\cdot11\cdot17$, we have $e_1 = 1$, $e_2 = 1$, $e_3 = 4$ and $e = 1$. Then
$$|S(561)| = \frac{2\cdot10\cdot16}{2^{1+1+4}}(1 + 1) = 10.$$
Note that% when $n$ is squarefree (for example when $n$ is Carmichael), then
$$\frac{\phi(n)}{2^{e_1 + \cdots + e_r}} = m_1p_1^{k_1-1}\cdots m_rp_r^{k_r-1} = \mbox{odd part of }\phi(n).$$
For the inequality, we note that $e_1 + \cdots + e_r \geq re \geq r$. So
$$\frac{1}{2^{e_1 + \cdots + e_r}}\left(\frac{2^{re}-1}{2^r - 1}+1\right)\leq \frac{1 - 2^{-r}}{2^r - 1} + \frac{1}{2^r} = \frac{1}{2^{r-1}}.$$
When $n$ is Carmichael, we have $r\geq 3$, so the Miller-Rabin test would fail with probability at most $25\%$ each iteration.



\subsection*{Exercises}
\begin{enumerate}[\thesection.1]
    \item Let $n>1$ be an integer. Let $a\in\N$ and let $p$ be a prime number such that:
    \begin{itemize}
        \item $a^{n-1}\equiv 1\pmod{n}$;
        \item $p\mid n-1$ and $p>\sqrt{n}-1$;
        \item $\gcd(a^{(n-1)/p}-1, n) = 1$.
    \end{itemize}
    Prove that $n$ is a prime.

    This result can be used to recursively generate candidates for primes with deterministic proofs: given a large prime $p$, consider $n = 2pq + 1$ where $q$ is some large random natural number less than $p/2$.
\end{enumerate}

\begin{center}
    \add{Lecture 31 Wed 11/20}

    \re{AKS}
\end{center}


\section{Deterministic primality test}
The Agrawal-Kayal-Saxena primality test is a deterministic primality test whose run time is polynomial in $\log n$. %It uses pretty much exactly everything we have learned in this class!

For any commutative ring $R$ and any $a,b,m_1,\ldots,m_r\in R$, we write $$a\equiv b\pmod{m_1,\ldots,m_r}\qquad\Longleftrightarrow\qquad a - b \in (m_1,\ldots,m_r).$$ Recall that when $n = p$ is a prime, we have for any $a\in\Z$, the following congruence in $\Z[x]$, $$(x + a)^p\equiv x^p + a^p\equiv x^p + a\pmod{p}.$$

\begin{lemma}\label{lem:np}
    Let $n\geq 2$ be an integer such that for some $a\in\Z$ coprime to $n$,
    $$(x + a)^n \equiv x^n + a\pmod{n}.$$
    Then $n$ is a prime.
\end{lemma}

\begin{proof}
    Suppose for a contradiction that $n$ is not a prime. Let $p<n$ be a prime divisor of $n$. Let $k$ be a positive integer such that $p^k \leq n < p^{k+1}$. By Lemma \ref{lem:nmn}, we have $p^k\binom{n}{p^k}\mid L_n$ where $L_n = \lcm(1,2,\ldots,n)$ but $\nu_p(L_n) = k$. So we have $p\nmid \binom{n}{p^k}.$ Since $a$ is coprime to $n$, we have $p\nmid \binom{n}{p^k}a^{n-p^k}$. This gives a nonzero middle term if $p^k < n$. If $p^k = n$, then again from $p\binom{n}{p}\mid L_n$, we get $\nu_p(\binom{n}{p}) \leq k-1 < \nu_p(n)$ and so $n\nmid \binom{n}{p}a^{n-p}.$
\end{proof}



The key idea of the AKS test is to check the congruence
$$(x + a)^n \equiv x^n + a\pmod{x^r -1, n}$$
for a suitably chosen $r \leq (\log_2 n)^5$ and for positive integers $a\leq \sqrt{\phi(r)}\log_2n \leq (\log_2n)^{3.5}.$ We can use the usual square and multiply method to compute $(x+a)^n$ mod $(x^r - 1,n)$ in polynomial time for each $a$. Hence the full algorithm is in polynomial time. In what follows, we write $\log n$ for $\log_2 n$.



\begin{lemma}
    For $n\geq 4$, there exists a positive integer $r\leq (\log n)^5$ such that either $\gcd(r,n) > 1$ or $o_r(n) > (\log n)^2.$
\end{lemma}

\begin{proof}
    Suppose for a contradiction that for all positve integer $r\leq (\log n)^5$, we have $\gcd(r,n) = 1$ and $r\mid n^d - 1$ for some $d\leq (\log n)^2$. Let $m = \lfloor(\log n)^5\rfloor$. Then $L_m = \lcm(1,2,\ldots,m)$ divides
    $$\prod_{1\leq d\leq (\log n)^2} (n^d - 1) \leq n^{\sum_{1\leq d\leq (\log n)^2}d} = n^{\frac12\lfloor(\log n)^2\rfloor(\lfloor(\log n)^2\rfloor+1)} = 2^{(\log n)(\frac12\lfloor(\log n)^2\rfloor(\lfloor(\log n)^2\rfloor+1))}.$$
    Recall that $L_{m}\geq 2^m$ for any integer $m\geq7$. From $n\geq 4$, we have $m\geq 32$, so from $L_m$ dividing the above product, we have $$m\leq (\log n)(\frac12\lfloor(\log n)^2\rfloor(\lfloor(\log n)^2\rfloor+1)).$$
    Note the RHS grows like $\frac12(\log n)^5$. Hence we have a contradiction by taking $m$ roughly $(\log n)^5$. \add{It is easy to check that $(\log n)^5$ works.}
\end{proof}

\noindent\textbf{Remark}: The precise bound for $r$ is not important. For theoretical purposes, any bound that is polynomial in $\log n$ is enough. In practice, one just tests $r$ one-by-one to find one in polynomial time.

\vspace{5pt}
\noindent\textbf{Step 1 of AKS}: Find the smallest positive integer $r$ such that $\gcd(r,n) > 1$ or $o_r(n) > (\log n)^2$.

\v
We know we only need to test at most $(\log n)^5$ different $r$. For each $r$, we simply compute $r, r^2, r^3, \ldots r^{\lfloor(\log n)^2\rfloor}$ mod $n$ to see if any of them is $1$. Hence this step can be done in polynomial time. If $n<(\log n)^5$ is small (only happens when $n < 10^7$) so that this step does not terminate before $r \geq n$, then we have checked that $\gcd(r,n) = 1$ for all $r < n$ and so $n$ is prime. If this step terminates at an $r$ with $\gcd(r,n) > 1$, then $n$ is composite. Suppose now we have found a positive integer $r\leq (\log n)^5$ coprime with $n$ with $o_r(n) > (\log n)^2$. Note this also implies that $\phi(r) \geq o_r(n) > (\log n)^2$. Since $n\not\equiv 1\pmod{r}$, we see that $n$ has a prime divisor $p\not\equiv1\pmod{r}$ so that $o_r(p) > 1$.

\vspace{5pt}
\noindent\textbf{Step 2 of AKS}: For every positive integer $a \leq r$, check if $\gcd(a,n) = 1$.

\v
Suppose Step 2 is passed. Then that means we may assume $p > r$. So we have
$$\sqrt{\phi(r)}\log n < \phi(r) < r < p.$$

\vspace{5pt}
\noindent\textbf{Step 3 of AKS}: For every positive integer $a \leq \sqrt{\phi(r)}\log n$, check the congruence
$$(x + a)^n \equiv x^n + a\pmod{x^r -1, n}.$$
\begin{theorem}\label{thm:mainAKS}
    Suppose positive integers $n,r$ and prime $p$ satisfy:
    \begin{itemize}
        \item $o_r(n) > (\log n)^2$
        \item $p\mid n$, $p> r$ and $o_r(p) > 1$
        \item For all positive integers $a < \sqrt{\phi(r)}\log n$, the congruence
        $(x + a)^n \equiv x^n + a\pmod{x^r -1, p}.$
    \end{itemize}
    Then $n$ is a power of $p$.
\end{theorem}

Note that we don't know what $p$ is! So when running the test, we have to check mod $n$, not mod $p$.

\v
\noindent\textbf{Step 0 of AKS}: Check if $n$ is a perfect power.



\vspace{5pt}
It remains now to prove Theorem \ref{thm:mainAKS}. We may assume that $n\geq 4$. The congruence $$(x + a)^n\equiv x^n + a\pmod{x^r -1, p}$$
translates to: for every $f(x) \in S :=\{x, x+1, \ldots, x+\ell\} \subseteq \F_p[x]$,
$$f(x)^n - f(x^n) = j(x)(x^r - 1)$$
for some $j(x)\in\F_p[x]$. To test whether $x^r - 1$ divides a polynomial in $\F_p[x]$, we consider $r$-th roots of unities in $\F_{p^d}$ where $d = o_r(p) > 1$. Let $\alpha_0\in\F_{p^d}$ with $o(\alpha_0) = r$ and let $$\mu_r = \langle \alpha_0\rangle = \{\alpha_0^k\colon k\in\Z/r\Z\}$$ be the subgroup of all $r$-th roots of unities. Then we have
$$x^r - 1 = \prod_{\alpha\in\mu_r}(x - \alpha).$$
Hence, in order for $x^r - 1$ to divide $f(x)^n - f(x^n)$, it is equivalent for every $\alpha\in\mu_r$ to be a root. In other words, we have for every $f(x)\in S$, $$f(\alpha)^n = f(\alpha^n),\mbox{ for every }\alpha\in\mu_r.$$
Note since $\ell < p$, the set $S$ contains $\ell+1$ distinct linear polynomials.

\begin{center}
    \add{Lecture 32 + 32.5 Fri 11/22}

    \re{Proof of AKS}
\end{center}

We say a polynomial $g(x)\in\F_p[x]$ \textit{commutes} with a positive integer $m$ if
$$g(\alpha)^m = g(\alpha^m) \in \F_{p^d},\mbox{ for every }\alpha\in\mu_r.$$
Hence, every element in $S$ commutes with $n$. We have the following lemma about commuting polynomials and integers.

\begin{lemma}
    We have:
    \begin{enumerate}[(a)]
        \item Any $g\in \F_p[x]$ commutes with $p$ and $1$.
        \item If $g_1,g_2\in\F_p[x]$ both commute with $m$, then $g_1g_2$ commutes with $m$
        \item If $g\in\F_p[x]$ commutes with $m_1$ and $m_2$, then $g$ commutes with $m_1m_2$.
        \item If $g\in\F_p[x]$ commutes with $m$ and $p\mid m$, then $g$ commutes with $\frac{m}{p}$.
    \end{enumerate}
\end{lemma}

\begin{proof}
    (a) follows from the equality $g(x)^1 = g(x^1)$ and $g(x)^p = g(x^p)$ of polynomials in $\F_p[x]$. To see the latter, we have
    $$g(x)^p = (a_nx^n + \cdots + a_0)^p = a_n^px^{np} + \cdots + a_0^p = a_nx^{np} + \cdots + a_0 = g(x^p)$$
    since each $a_i\in\F_p$. For (b), take any $\alpha\in\mu_r$. Then
    $$((g_1g_2)(\alpha))^m = g_1(\alpha)^mg_2(\alpha)^m = g_1(\alpha^m)g_2(\alpha^m) = (g_1g_2)(\alpha^m).$$
    For (c), we have
    $$g(\alpha)^{m_1m_2} = (g(\alpha^{m_1}))^{m_2} = g(\alpha^{m_1m_2})$$
    since $\alpha^{m_1}\in\mu_r$. For (d), we have
    $$\big(g(\alpha)^{m/p}\big)^p = g(\alpha)^m =  g(\alpha^m) = g(\alpha^{m/p})^p.$$
    Hence $(g(\alpha)^{m/p} - g(\alpha^{m/p}))^p = 0$ and so $g(\alpha)^{m/p} = g(\alpha^{m/p})$.
\end{proof}

Let $\bar{S}$ denote the set of polynomials in $\F_p[x]$ that are products of elements in $S$. So $$\bar{S} = \{x^{n_0}(x+1)^{n_1}\cdots(x+\ell)^{n_\ell}\colon n_0,\ldots,n_\ell\geq 0\}.$$ Then every element in $\bar{S}$ commutes with every positive integer of the form $(n/p)^i p^j$. Note that even though there are infinitely many $m$ of the form $(n/p)^i p^j$, $\alpha_0^m$ only takes at most $r$ possible values. In other words, the set
$$T = \{\alpha_0^{(n/p)^ip^j}\colon i,j\geq0\}\subseteq\mu_r$$
is finite. Let $m_1>m_2$ be two integers of the form $(n/p)^ip^j$ such that $\alpha_0^{m_1} = \alpha_0^{m_2}$. Note that this condition is equivalent to $m_1\equiv m_2\pmod{r}$.

Suppose for a contradiction that $n$ is not a power of $p$. Then \wow{the integers $(n/p)^ip^j$ are all distinct for distinct pairs $(i,j)$. This allows us to choose $m_1$ and $m_2$ so that $m_1 - m_2$ is fairly small.} Let $N = |T|$. For $i,j = 0,1,\ldots,\lfloor\sqrt{N}\rfloor$, we have $(\lfloor\sqrt{N}\rfloor + 1)^2 > N$ distinct integers of the form $(n/p)^ip^j$. There are only $N$ possible elements of the form $\alpha_0^{(n/p)^ip^j}$. Hence, by the Pigeonhole principle, there exist two distinct integers $m_1>m_2$ among them such that $\alpha_0^{m_1} = \alpha_0^{m_2}$. Moreover, $$m_1 - m_2 < m_1 \leq (n/p)^{\lfloor\sqrt{N}\rfloor}p^{\lfloor\sqrt{N}\rfloor} = n^{\lfloor\sqrt{N}\rfloor}.$$ Now for any $g\in \bar{S}$, we have
$$g(\alpha_0)^{m_1} = g(\alpha_0^{m_1}) = g(\alpha_0^{m_2}) = g(\alpha_0)^{m_2}.$$
Since $g\in\bar{S}$ splits completely in $\F_p$ and $\alpha_0\notin\F_p$ (\wow{this is where we use $o_r(p)>1$}), we have $g(\alpha_0)\neq 0$ and so
$$g(\alpha_0)^{m_1-m_2} = 1.$$
\wow{The idea now is that by taking $\ell$ large enough, the set $\{g(\alpha_0)\colon g\in \bar{S}\}$ is too large.}

Suppose $g,h\in\bar{S}$ with $g(\alpha_0) = h(\alpha_0)$. We know that for every integer $m$ of the form $(n/p)^ip^j$, we have
$$g(\alpha_0^m) = g(\alpha_0)^m = h(\alpha_0)^m = h(\alpha_0^m).$$
In other words, every $\alpha\in T$ is a root of $g(x) - h(x)$. Hence if we further require that $\deg(g)$ and $\deg(h)$ are less than $N = |T|$, then $\deg(g-h) < N$ so $g - h$ must be $0$ in order for every $\alpha\in T$ to be root. Let $C(\ell+1,N-1)$ be the number of elements in $\bar{S}$ of degree at most $N-1$. Then we have
$$|\{g(\alpha_0)\colon g\in\bar{S}\}| \geq C(\ell+1,N-1).$$
Therefore, it remains to prove that $$n^{\lfloor\sqrt{N}\rfloor}\leq C(\ell+1, N-1).$$
Let's estimate the sizes of the variables involved. By taking $i = j$, we see that $(n/p)^ip^j = n^i$. So we have
$$\{n^i\mbox{ mod }r\colon i\geq 0\} \subseteq \{(n/p)^ip^j\mbox{ mod }r\colon i,j\geq 0\} \subseteq (\Z/r\Z)^\times.$$
In other words,
$$(\log n)^2 < o_r(n) \leq N \leq \phi(r).$$
Let $M = \lfloor\lfloor\sqrt{N}\rfloor\log n\rfloor.$ Then
\begin{eqnarray*}
    n^{\lfloor\sqrt{N}\rfloor} &=& 2^{\lfloor\sqrt{N}\rfloor\log n} \leq 2^{M+1},\\
    \ell + 1  &=& \lfloor\sqrt{\phi(r)}\log n\rfloor + 1 \geq \lfloor \sqrt{N}\log n \rfloor + 1 \geq M + 1,\\
    N - 1 &> &\sqrt{N}\log n - 1 \geq M - 1,\\
    C(\ell+1,N-1) &\geq& C(M+1, M).
\end{eqnarray*}
Hence, it is enough to prove that $$C(M+1, M) \geq 2^{M+1}.$$


Since $x, x+1,\ldots,x+M$ are all distinct linear polynomials in $\F_p[x]$, $C(M+1, M)$ is the same as the number of monomials of the form $x_1^{a_1}\cdots x_{M+1}^{a_{M+1}}$ in $M+1$ variables of degree $a_1 + \cdots + a_{M+1}$ at most $M$. By adding in one more variable $x_0$ and setting $a_0 = M - (a_1 + \cdots + a_{M+1})$, this is the same as the number of monomials of the form $x_0^{a_0}x_1^{a_1}\cdots x_{M+1}^{a_{M+1}}$ in $M+2$ variables of degree exactly $M$.

\begin{theorem}\label{thm:sb}
    The number of monomials of the form $x_1^{a_1}\cdots x_k^{a_k}$ in $k$ variables of degree $d = a_1 + \cdots + a_k$ is $\binom{d+k-1}{k-1}.$
\end{theorem}

In particular, we have
$$C(M+1, M) = \binom{2M+1}{M+1} = \binom{2M+1}{M} > \frac{4^M}{M+1}\geq 2^{M+1}$$
when $2^M \geq 2(M+1)$, which is true for $M\geq3$. Since $n\geq 4$, we have $\log n \geq 2$ and $M\geq 4$.

\vspace{5pt}
The standard proof of Theorem \ref{thm:sb} is the stars and bars method. Imagining placing $d$ stars and $k-1$ bars in $d + k - 1$ slots. The number of ways to do this is $\binom{d+k-1}{k-1}$. The number of stars before the first bar is the exponent of $x_1$. The number of stars between the $i$-th bar and the $(i+1)$-st bar is the exponent of $x_{i+1}$ for $i=1,\ldots,k-2$. The number of stars after the last bar is the exponent of $x_k$.



A Mersenne number is a number of the form $M_n = 2^n - 1$ for some $n\in\N$. Note since $2^d - 1\mid 2^n - 1$ whenever $d\mid n$, in order for $2^n - 1$ to be a prime, $n$ itself must be a prime. For example,
$$M_3 = 7,\qquad M_5 = 31,\qquad M_7 = 127$$
are all primes. However, $M_{11} = 2047 = 23\times 89$ and $M_{23} = 47\times178481$ are not primes. The Lucas-Lehmer test is a very efficient test specifically for Mersenne numbers. The current record for the largest known prime number is $$2^{136279841} - 1,$$
proved only a month ago!

The fact that $23\mid M_{11}$ and $47\mid M_{23}$ are not coincidences. Let's prove $47\mid 2^{23} - 1$ without wolfram alpha. This amounts to proving that $2^{23}\equiv 1\pmod{47}$. Since $47$ is a prime and $23 = (47 - 1)/2$. We know that
$$2^{23}\equiv \lg{2}{47}\pmod{47}\aa \lg{2}{47} = 1$$
since $47\equiv 7\pmod{8}$. \qt{What's special about the prime $p = 23$ in this proof by example?} In order for $23 = (47 - 1)/2$, we need $47 = 2p + 1$. We also need it to be a prime in order for $2^{(47 - 1)/2}$ to be given by the Legendre symbol. Finally, we need $47\equiv\pm1\pmod{8}$ in order for the Legendre symbol to be $1$. This corresponds to $p\equiv 3\pmod{4}$.

A \wow{Sophie Germain prime} is a prime $p$ such that $2p + 1$ is also prime. The primes $p = 3,11,23$ are all Sophie Germain primes that are $3$ mod $4$, while $5$ is a Sophie Germain prime that is $1$ mod $4$. The infinitude of Sophie Germain primes is an open conjecture. The heuristic count for the number of them less than $x$ is about $1.32032\,x/(\ln x)^2.$

\begin{proposition}
    Suppose $p\equiv 3\pmod{4}$ is a Sophie Germain prime. Then $2p+1\mid M_p$ and so $M_p$ is not prime for $p > 3$.
\end{proposition}

\add{
\begin{proof}
    From $p\equiv 3\pmod{4}$, we get $2p+1\equiv 7\pmod{8}$. Hence $2$ is a quadratic residue mod $2p+1$. Let $a$ be an integer such that $2\equiv a^2\pmod{2p+1}.$ Then
    $$2^p \equiv a^{2p} \equiv 1\pmod{2p+1}$$
    by Fermat's little theorem. Then $2p+1\mid 2^p - 1$.
\end{proof}}

In the Lucas-Lehmer test, we define the sequence
$$a_0 = 4,\qquad a_{n+1} = a_n^2 - 2\mbox{ for }n\geq 0.$$
\begin{theorem}\label{thm:Mer}
    Let $p$ be an odd prime. The Mersenne number $M_p = 2^p - 1$ is prime if and only if $a_{p-2}\equiv 0\pmod{M_p}.$
\end{theorem}
For example, we have
\begin{eqnarray*}
    a_0 &=& 4\\
    a_1 &=& 14 \,\,\,\equiv\,\,\, 0\pmod{7}\\
    a_2 &=& 194\\
    a_3 &=& 37634 \,\,\,=\,\,\, 2\times31\times 607\,\,\,\equiv\,\,\, 0\pmod{31}
\end{eqnarray*}
Note that the $a_n$ grows very quickly. However, since we only care about mod $M_p$, we can reduce mod $M_p$ at every step so we only have a $p$ bit number to deal with before computing $a_{n+1}$. Moreover, it is very easy to find the remainder of an integer $a$ mod a number of the form $2^p - 1$. We apply the division algorithm to divide $a$ by $2^p$ first to find
\begin{eqnarray*}
    a &=& 2^pq + r\\
    &\equiv&q + r\pmod{2^p - 1}.
\end{eqnarray*}
Finding the quotient $q$ and remainder $r$ are extremely easy, since the numbers are already in binary. So $q$ is the simply the number after removing the last $p$ bits from $a$, and $r$ is the last $p$ bits of $a$. Applying the same method to $q$, we find that $a$ mod $2^p - 1$ is simply the sum of all $p$-bits chucks of $a$.

\v
The proof of Theorem \ref{thm:Mer} tends to be quite magical. Let's give a more motivated proof.  How can we prove that a positive integer $n$ is a prime? If we can find some $a\in\Z$ such that $o_n(a) = n-1$, then we would know that $\phi(n) = n - 1$ and so $n$ is prime. How can we find the order of some element? If we know that $a^{2^k}\equiv -1\pmod{n}$, then we can conclude that $o_n(a) = 2^{k+1}$. However, here $n = 2^p - 1$, so if $o_n(a)$ is a power of $2$, we would have something like $o_n(a) = n + 1$. The group $(\Z/n\Z)^\times$ certainly doesn't have an element of order $n + 1$, but when $n$ is a prime, the field $\F_{n^2}$ does have an element of order $n + 1$ since $n + 1\mid n^2 - 1$.

Suppose now $n = 2^p - 1 = q$ is a prime. How can we understand $\F_{q^2}$? We know that $$\F_{q^2}\cong\F_q[x]/(x^2 - r)$$
where $r$ is some quadratic non-residue mod $q$. Since $q\equiv -1\pmod{8}$, we know that $2$ is a square mod $q$. For $3$, we compute
$$\lg{3}{q} = -\lg{q}{3} = -\lg{(-1)^p - 1}{3} = -\lg{1}{3} = -1.$$
Hence $3$ is not a square mod $q$ and so we may take $r = 3$. Note now
$$\F_{q^2}\cong \F_q[x]/(x^2 - 3)\cong\Z[x]/(x^2 - 3,q)\cong\Z[\sqrt{3}]/(q).$$
We have thus proved the forward direction of the following result.

\begin{proposition}\label{prop:nprime}
    Let $p$ be an odd prime and let $n = 2^p - 1$. Then $n$ is a prime if and only if there exists $\alpha\in\Z[\sqrt{3}]$ such that $\alpha^{2^{p-1}} = -1$ in $\Z[\sqrt{3}]/(n)$.
\end{proposition}

\begin{center}
    \add{Lecture 33 Mon 11/25}

    \re{Lucas-Lehmer}
\end{center}

\begin{proof}
    It remains to prove the backwards direction. Let $R = \Z[\sqrt{3}]$. Let $q$ be any prime divisor of $n$. From $\alpha^{2^{p-1}} = -1$ in $R/(n)$, we also get the same equality in $R/(q)$. Then the order of $\alpha$ in $R/(q)$ is $2^p = n + 1$. However, $R/(q)$ is a ring of order $q^2$ and so we have $n + 1 < q^2$. Hence $q > \sqrt{n}$, for any prime divisor $q$ of $n$. This forces $n$ to be prime.
\end{proof}

Suppose now $n = 2^p - 1 = q$ is a prime. Let's find this element $\alpha\in\F_q[x]/(x^2 - 3)$ with $\alpha^{(q+1)/2} = -1$. Since $2$ is a square mod $q$ and $3$ is not a square mod $q$, we see that
$$2^{(q-1)/2} = 1,\qquad\mbox{and}\qquad 3^{(q-1)/2} = -1.$$
Elements in $\F_q[x]/(x^2 - 3)$ are of the form $a + b[x]$ for $a,b\in\F_q$. Since $[x]^2 = 3$, we write suggestively $[x] = \sqrt{3}$. The key observation now is that
$$(a + b\sqrt{3})^q = a^q + b^q\sqrt{3}^q = a + b3^{(q-1)/2}\sqrt{3} = a - b\sqrt{3}.$$
Hence $$(a + b\sqrt{3})^{q+1} = (a + b\sqrt{3})(a - b\sqrt{3}) = a^2 - 3b^2.$$
By taking $a = b = 1$, we see that
$$((1 + \sqrt{3})^2)^{(q+1)/2} = -2.$$
This is now very good because $2^{(q+1)/2} = 2$. So we take
$$\alpha = \frac{(1 + \sqrt{3})^2}{2} = 2 + \sqrt{3}.$$
We can now upgrade Proposition \ref{prop:nprime}.

\begin{proposition}\label{prop:nprime2}
    Let $p$ be an odd prime and let $n = 2^p - 1$. Then $n$ is a prime if and only if $(2 + \sqrt{3})^{2^{p-1}} = -1$ in $\Z[\sqrt{3}]/(n)$.
\end{proposition}

Let $\omega = 2 + \sqrt{3}$. Then $$\omega^{-1} = \frac{1}{2 + \sqrt{3}} = 2 - \sqrt{3}.$$
So $\omega$ is a unit in $R$. It will stay a unit in any quotient of $R$. Hence
\begin{eqnarray*}
    &&\omega^{2^{p-1}} = -1 \mbox{ in } R/(n)\\
    &\Longleftrightarrow& \omega^{2^{p-1}} + 1 = 0 \mbox{ in } R/(n)\\
    &\Longleftrightarrow& \omega^{2^{p-2}} + \omega^{-2^{p-2}} = 0 \mbox{ in } R/(n)
\end{eqnarray*}
The upshot now is that $\omega^{2^{p-2}} + \omega^{-2^{p-2}}$ is an integer. In fact, it is exactly $a_{p-2}$. Indeed, we have $\omega + \omega^{-1} = 4 = a_0$. Now
\begin{eqnarray*}
    a_1 &=& a_0^2 - 2 \,\,\,=\,\,\, \omega^2 + 2 + \omega^{-2} - 2 \,\,\,=\,\,\, \omega^2 + \omega^{-2}\\
    a_2 &=& a_1^2 - 2 \,\,\,=\,\,\, \omega^4 + 2 + \omega^{-4} - 2 \,\,\,=\,\,\, \omega^4 + \omega^{-4}
\end{eqnarray*}
It is then easy to check via induction that $$a_m = \omega^{2^m} + \omega^{-2^m}.$$
This completes the proof of Theorem \ref{thm:Mer}.

    \v
    \add{
    We can understand the quotient $R/qR$ better where $R\cong \Z[x]/(x^2 - 3)$. Suppose $q$ is a prime. We use the third isomorphism theorem (recall the Tutorial on Oct 11) to get
    $$R/qR \cong \Z[x]/(x^2 - 3, q) \cong \F_q[x]/(x^2 - 3).$$
    From the Legendre symbol calculation above, we saw that $3$ is not a square mod $q$ and so $x^2 - 3$ is irreducible in $\F_q[x]$. Hence, we have $$R/qR\cong \F_{q^2}.$$
    One can prove that there are two field homomorphisms (automatically isomorphisms) $\F_{q^2}\rightarrow\F_{q^2}$: the identity map $\mathrm{id}$ and the \wow{Frobenius map} $\tau(x) = x^q$. Our calculation above gives
    $$\tau(a + b\sqrt{3}) = a - b\sqrt{3}$$
    and
    $$a^2 - 3b^2 = \mathrm{id}(a + b\sqrt{3})\cdot\tau(a + b\sqrt{3}) = \wow{N_{\F_{q^2}/\F_q}(a + b\sqrt{3})}.$$
    This is a special case of the \wow{norm map}. We will use the norm map $N_{\C/\R}$ next to prove some interesting results about representing integers as sums of squares next.

\vspace{5pt}
\noindent\textbf{Remark:} IMO 2003 N7 asks that if $q$ is an odd prime divisor of $a_n$, then $2^{n+3}\mid q^2 - 1.$ We can give a very quick proof of this! The assumption $q\mid a_n$ implies as above that $\omega^{2^{n+1}} = -1$ in $R/qR$. Note first that $a_n\equiv -1\pmod{3}$ for $n\geq 1$. So $q\neq 3$. If $3 = \alpha^2$ is a quadratic residue mod $q$, then $$R/qR \cong \F_q[x]/(x^2 - \alpha^2) \cong \F_q\times\F_q.$$
The image of $\omega$ in either of the $\F_q$ factor is an element whose $2^{n+1}$ power is $-1$. Hence $2^{n+2}\mid q-1$, which implies that $2^{n+3}\mid q^2 -1$. Suppose now $3$ is not a quadratic residue mod $q$. Then $R/qR\cong \F_{q^2}$. Recall that $(1+\sqrt{3})^2 = 2\omega$ and there exists $\beta\in\F_{q^2}$ such that $\beta^2 = 2$. Hence $((1+\sqrt{3})/\beta)^{2^{n+2}} = -1$ in $\F_{q^2}$, which implies that $2^{n+3}\mid q^2 - 1$.}


\section{The Gaussian and Eisenstein integers}
In this section, we consider the ring \wow{$\Z[i]$ of Gaussian integers} and the ring \wow{$\Z[\zeta_3]$ of Eisenstein integers}. Note that $i = \zeta_4$ is a root of $\Phi_4(x) = x^2 + 1$ and $\zeta_3$ is a root of $\Phi_3(x) = x^2 + x + 1$. Both of these polynomials are irreducible in $\Q[x]$ and monic in $\Z[x]$. Hence by HW 6 P4, we have
\begin{eqnarray*}
    \Z[i] &=& \{a + bi\colon a,b\in\Z\} \quad\cong\quad \Z[x]/(x^2 + 1),\\
    \Z[\zeta_3] &=& \{a + b\zeta_3\colon a,b\in\Z\} \quad\cong\quad \Z[x]/(x^2 + x + 1).
\end{eqnarray*}
Note that $\zeta_6$ is a root of $\Phi_6(x) = x^2 - x + 1$, so we have a similar description for $\Z[\zeta_6]$. However, $$\zeta_3 = -\frac12 + \frac{\sqrt{3}}{2}i\aa\zeta_6 = \frac12 + \frac{\sqrt{3}}{2}i = \zeta_3 + 1.$$ So $\Z[\zeta_6] = \Z[\zeta_3]$. We define the \wow{norm} of an element in $\Z[i]$ or $\Z[\zeta_3]$ by $$N(\alpha) = \alpha\overline{\alpha} = |\alpha|^2.$$
More explicitly, we have
\begin{eqnarray*}
    N(a + bi) &=& a^2 + b^2,\\
    N(a + b\zeta_3) &=& N((a - \frac{b}{2}) + \frac{\sqrt{3}}{2}bi) = a^2 - ab + b^2.
\end{eqnarray*}
Note that the norm function is multiplicative: $N(\alpha\beta) = N(\alpha)N(\beta)$. So from
$$(a + bi)(c + di) = ac - bd + (ad + bc)i$$
we have the well-known formula
$$(a^2 + b^2)(c^2 + d^2) = (ac - bd)^2 + (ad + bc)^2;$$
and from
$$(a + b\zeta_3)(c + d\zeta_3) = ac + (bc + ad)\zeta_3 + bd(-1-\zeta_3) = ac - bd + (bc + ad - bd)\zeta_3$$
we have the less-known formula
$$(a^2 - ab + b^2)(c^2 - cd + d^2) = (ac - bd)^2 - (ac - bd)(bc + ad - bd) + (bc + ad - bd)^2.$$
If we use the above formula with $a,b,c,d\in\Z$, we see that the sets
\begin{eqnarray*}
    S_4 &=& \{a^2 + b^2\colon a,b\in\Z\}\\
    S_3 &=& \{a^2 - ab + b^2\colon a,b\in\Z\}
\end{eqnarray*}
are closed under multiplication. Hence to understand what they are, it remains to understand which prime powers do $S_4$ and $S_3$ contain. They clearly contain $p^2$ for every prime $p$ by taking $a = p$ and $b = 0$. It is easy to check that $$2\in S_4\aa2\notin S_3\aa3\in S_3.$$
In HW 9 P1, you proved that if $p\in S_4$, then $p=2$ or $p\equiv 1\pmod{4}$; and if $p\in S_3$, then $p=3$ or $p\equiv 1\pmod{3}$. Our main theorem is that the converse is also true.

\begin{theorem}\label{thm:p14}
    If $p$ is a prime congruent to $1$ mod $4$, then there exist $a,b\in\Z$ such that $p = a^2 + b^2$.
\end{theorem}

\begin{theorem}\label{thm:p23}
    If $p$ is a prime congruent to $1$ mod $3$, then there exist $a,b\in\Z$ such that $p = a^2 - ab + b^2$.
\end{theorem}
For example, $2023 = 7\cdot 17^2 \in S_3$ since $7\equiv 1\pmod{3}$, but $2023\notin S_4$ since $7\not\equiv 1\pmod{4}$. More explicitly,
$$7 = 3^2 - 3\cdot 1 + 1^2\aa 2023 = 51^2 - 51\cdot17 + 17^2.$$

\begin{center}
    \add{Lecture 34 Wed 11/27}

    \re{The rings $\Z[\zeta_4]$ and $\Z[\zeta_3]$}
\end{center}

We give a ring-theoretic proof of these results. \add{There is also a ``descent''-type proof. They look different but really are the same.} Let $m = 3$ or $4$. We will treat them with the same argument. The key ring theoretic result is the following.

\begin{proposition}\label{prop:34Euc}
    The rings $\Z[\zeta_m]$ for $m = 3,4$ are Euclidean domains with respect to the norm function. As a consequence, $\Z[\zeta_m]$ is a PID for $m = 3,4$.
\end{proposition}

\begin{proof}
    Let $\alpha,\beta\in \Z[\zeta_m]$ where $m = 3$ or $4$ and $\alpha\neq 0$. We are looking for some $q\in \Z[\zeta_m]$ such that $N(\beta - \alpha q) < N(\alpha).$ In other words, we want $$N\Big(\frac{\beta}{\alpha} - q\Big) < 1.$$ We divide $\beta$ by $\alpha$ in $\C$ to get
    $$\frac{\beta}{\alpha} = \frac{\beta\overline{\alpha}}{\alpha\overline{\alpha}} = \frac{\beta\overline{\alpha}}{N(\alpha)}.$$
    Next we note that since $\alpha\in\Z[\zeta_m]$, we also have $\overline{\alpha}\in\Z[\zeta_m]$:
    $$\overline{a + b\zeta_m} = a + b\overline{\zeta_m}\aa\overline{i} = -i\aa\overline{\zeta_3} = -\frac12 - \frac{\sqrt{3}}{2}i = -1-\zeta_3.$$
    Since $\Z[\zeta_m]$ is a ring, we see that $\beta\overline{\alpha}\in\Z[\zeta_m]$. Since $N(\alpha)\in\Z$, we see that
    $$\frac{\beta}{\alpha} = t + s\zeta_m,\qquad\mbox{for some }t,s\in\Q.$$
    Let $a\in\Z$ be an integer that is the closest to $t$ and let $b\in\Z$ be an integer that is the closest to $s$. (In other words, either the floor or ceiling of $t$ and $s$.) Hence
    $$\frac{\beta}{\alpha} = (a + b\zeta_m) + \big((t - a) + (s - b)\zeta_m\big),\qquad |t-a| \leq \frac12,\qquad |s - b| \leq \frac12.$$
    Then
    $$N\big((t - a) + (s - b)\zeta_m\big) \leq |t-a|^2 + |t-a||s-b| + |s-b|^2 \leq \frac34 < 1.$$
    Therefore $q =  a+ b\zeta_m \in\Z[\zeta_m]$ does the job.
\end{proof}

\add{
\noindent\textbf{Remark}: When $t = 1/2$ for example, there are two choices for $a$. Hence the ``quotient'' and ``remainder'' are not unique in this division algorithm. The same argument also works for $\Z[\sqrt{2}i]$, $\Z[\sqrt{2}]$ and $\Z[\sqrt{3}].$ There is a complete classification for which of the $\Z[\zeta_m]$ are Euclidean domains. It turns out that being a Euclidean domain (not necessarily with the norm function) and being a PID is equivalent for $\Z[\zeta_m]$ and it is the case for all $m\leq 40$ except for $m = 23, 29, 31, 37, 39$ and for $m = 44, 45, 48, 60, 84, (42, 50, 54, 66, 70).$ The numbers in paranthesis are of the form $2n$ where $n$ is odd in which case $\Z[\zeta_m] = \Z[\zeta_n].$ For example for $m = 23$, one can prove that
$$(2) = (2, \frac{1 + \sqrt{-23}}{2})(2, \frac{1 - \sqrt{-23}}{2})$$
and that none of the factors are principal in $\Z[\zeta_{23}].$ You will prove in HW 11 P4 that $$\frac{1 \pm \sqrt{-23}}{2} \in \Z[\zeta_{23}].$$ %Writing $\zeta = \zeta_{23}$, we have $$-\zeta^5 - \zeta^7 - \zeta^{10} - \zeta^{11} - \zeta^{14} - \zeta^{15} - \zeta^{17} - \zeta^{19} - \zeta^{20} - \zeta^{21} - \zeta^{22} = \frac{1 + \sqrt{-23}}{2} \in \Z[\zeta_{23}].$$
%$$1 + \zeta + \zeta^2 + \zeta^3 + \zeta^4 + \zeta^6 + \zeta^8 + \zeta^9 + \zeta^{12} + \zeta^{13} + \zeta^{16} + \zeta^{18} = \frac{1 + \sqrt{-23}}{2} \in \Z[\zeta_{23}].$$
}


\noindent\textbf{Proof of Theorems \ref{thm:p14} and \ref{thm:p23}:} Suppose $p$ is a prime congruent to $1$ mod $m$, where $m = 3$ or $4$. Then $o_m(p) = 1$ and so $\Phi_m(x)$ splits completely in $\F_p[x]$. Let $n\in\Z$ such that $x - n \in \F_p[x]$ is a factor of $\Phi_m(x)$. Consider the ideal $I_p = (p, \zeta_m - n)$ in $\Z[\zeta_m]$. We apply the third isomorphism theorem to get
$$\Z[\zeta_m]/I_p \cong \Z[x]/(\Phi_m(x), p, x - n) \cong \F_p[x]/(\Phi_m(x), x - n) = \F_p[x]/(x - n) \cong \F_p.$$
As a consequence, we see that $I_p$ is a proper ideal (\add{in fact, a prime ideal}). Since $\Z[\zeta_m]$ is a PID, there exists some $\alpha\in\Z[\zeta_m]$ such that $I_p = (\alpha)$. The fact that $I_p$ is a proper ideal implies that $\alpha$ is not a unit. We prove now that $N(\alpha) = p$, so that upon writing $\alpha = a + b\zeta_m$ for $a,b\in\Z$, we have
$$p = a^2 + b^2\mbox{ for }m=4,\qquad\mbox{and}\qquad p = a^2 - ab + b^2\mbox{ for }m=3.$$ Note that the intrinsic reason for $N(\alpha) = p$ is that
$$p = |\Z[\zeta_m]/I_p| = |\Z[\zeta_m]/(\alpha)| = N(\alpha).$$
Since $p\in I_p = (\alpha)$. We write $p = \alpha\beta$ for some $\beta\in\Z[\zeta_m]$. Since $p\nmid\zeta_m - n$, we see that $I_p\neq (p)$ and so $\beta$ is also not a unit. Taking norm on $p = \alpha\beta$ gives $$p^2 = N(p) = N(\alpha)N(\beta).$$
Now for any $\gamma\in \Z[\zeta_m]$, we saw earlier that $\overline{\gamma}\in\Z[\zeta_m]$. Hence if $N(\gamma) = \gamma\overline{\gamma} = 1$, we see that $\gamma$ is a unit. Since neither $\alpha$ nor $\beta$ is a unit, we see that $N(\alpha)\neq 1$ and $N(\beta)\neq 1$, but they are positive integers that multiply to $p^2$. Therefore, they must both be $p$.\hfill$\Box$

\v
The converse direction $$\gamma\in\Z[\zeta_m]^\times\quad\Longrightarrow\quad N(\gamma) = 1$$ is also true. To see this, we note that $\gamma^{-1}\in \Z[\zeta_m]$ and so $N(\gamma)$ and $N(\gamma^{-1})$ are positive integers that multiply to $N(1) = 1$. So they are both $1$. Using this characterization of units, we can solve for $a^2 + b^2 = 1$ and $a^2 - ab + b^2 = 1$ to find that
\begin{eqnarray*}
    \Z[i]^\times &=& \{1, -1, i, -i\} = \mu_4,\\
    \Z[\zeta_3]^\times &=& \{1, -1, \zeta_3, -\zeta_3, 1 + \zeta_3, -1 - \zeta_3\} = \mu_6.
\end{eqnarray*}
\wow{Exercise}: Let $R$ be an integral domain where $R^\times$ is finite. Is $R^\times$ is always cyclic?

\begin{center}
    \add{Lecture 35 Fri 11/29}

    \re{Fermat's Last Theorem in degree $3$}
\end{center}

Since $\Z[i]$ and $\Z[\zeta_3]$ are PIDs, everything in Chapters 1 and 2 about primes and prime factorization works just as in the case of polynomials over a field. Recall that a nonzero non-unit $\alpha\in R$ is \textbf{irreducible in $R$} if whenever $\alpha = \beta\gamma$ where $\beta,\gamma\in R$, either $\beta$ or $\gamma$ is a unit. When $R$ is a PID, this is the same as \textbf{prime}: if $\alpha\mid\beta\gamma$ in $R$, then $\alpha\mid\beta$ or $\alpha\mid\gamma$. Let's classify primes of $R = \Z[\zeta_3]$.

Note first that if $\alpha\in R$ such that $N(\alpha) = p$ is a prime number. Then $\alpha$ is prime in $R$. This follows because in order for $N(\beta)N(\gamma) = N(\alpha) = p$, we have either $N(\beta) = 1$ or $N(\gamma) = 1$. By Theorem \ref{thm:p23}, we know this is possible exactly when $p = 3$ or $p\equiv 1\pmod{3}$. When $p\equiv1\pmod{3}$, there exists $\alpha\in R$ such that $\alpha\bar{\alpha} = p$. Here both $\alpha$ and $\bar{\alpha}$ are primes in $R$ and they don't differ by a unit (\wow{why?}). When $p = 3$, then $3 = -(\sqrt{3}i)^2$ but a more useful factorization comes from $3 = N(1 - \zeta_3)$. We set $\pi = 1 - \zeta_3$. Then $$\pi^2 = 1 - 2\zeta_3 + \zeta_3^2 = -3\zeta_3$$ where $-\zeta_3$ is a unit. Since $N(\pi) = 3$, we see that $\pi$ is a prime in $R$. Note that $\zeta_3\equiv 1\pmod{\pi}$ and since $\pi\mid 3$, we have $3\equiv 0\pmod{\pi}$. Therefore, we have $R/(\pi)\cong \F_3$ with an explicit isomorphism given by $$a + b\zeta_3 + (\pi)\mapsto (a + b)\%3. $$

If $p$ is a prime number that is $2$ mod $3$, then there does not exist any $\beta\in R$ such that $N(\beta) = p$. So if $p = \beta\gamma$, we have $p^2 = N(\beta)N(\gamma)$ and either $N(\beta) = 1$ or $N(\gamma) = 1$. Hence $p$ stays a prime in $R$. Therefore, we have the following result:
$$p = \begin{cases}
    -\zeta_3^{-1}\pi^2 & \mbox{ if }p = 3,\qquad\qquad\qquad\,\,\, p \mbox{ ramifies in }R\\
    \alpha\bar{\alpha} & \mbox{ if }p\equiv 1\pmod{3},\qquad p \mbox{ splits in }R\\
    p & \mbox{ if }p\equiv 2\pmod{3}, \qquad p \mbox{ is inert in }R
\end{cases}$$

The important observation now is that knowing how the prime numbers factor in $R$ is enough to let us describe all the primes of $R$. Suppose $\alpha\in R$ is a prime. Then $N(\alpha)$ is some positive integer, which can factor into a product of prime numbers $N(\alpha) = p_1\cdots p_r$. Now we factor each of the primes $p_i$ into primes in $R$ to get $\alpha\bar{\alpha} = N(\alpha) = \alpha_1\cdots \alpha_t$ for primes $\alpha_1,\ldots,\alpha_t\in R$. Then from $\alpha\mid\alpha_1\cdots \alpha_t$ we get that $\alpha\mid\alpha_i$ for some $i = 1,\ldots,t$ since $\alpha$ is prime. Since $\alpha_i$ is also prime, we see that $\alpha_i = \alpha\cdot(\mathrm{unit})$. In other words, all the primes of $R$ are just the unit multiples of the ones we found above.


\v
We now work in $\Z[\zeta_3]$ to prove that there are no integer solutions to $x^3 + y^3 = z^3$ with $xyz\neq 0$. We write $\zeta$ for $\zeta_3$.

\begin{theorem}
    There do not exist nonzero $\alpha,\beta,\gamma\in\Z[\zeta]$ and a unit $\epsilon\in\Z[\zeta]^\times$ such that $$\alpha^3 + \beta^3 + \epsilon\gamma^3 = 0.$$
\end{theorem}

Suppose a solution $(\alpha,\beta,\gamma,\epsilon)$ exists. We take one so that $N(\alpha\beta\gamma)$ is the smallest. If there is a prime $\delta\in\Z[\zeta]$ dividing two of $\alpha,\beta,\gamma$, then it divides the cube of the third and so also the third,  but then $(\alpha/\delta,\beta/\delta,\gamma/\delta,\epsilon)$ is a smaller solution. Hence $\alpha,\beta,\gamma$ are pairwise coprime. We use a descent argument: we construct another solution $(\alpha',\beta',\gamma',\epsilon')$ with $N(\alpha'\beta'\gamma')<N(\alpha\beta\gamma)$.

\v
Recall the prime $\pi = 1 - \zeta$ with $\pi^2 = -3\zeta$. We start with some congruence results about $\pi$.

\begin{lemma}
    If $\delta\equiv e\pmod{\pi}$ where $e = \pm1$, then $\delta^3\equiv e \pmod{9}$.
\end{lemma}

\begin{proof}
    Suppose $\delta = e + \pi\eta$ for some $\eta\in\Z[\zeta]$. Using $e^2 = 1$ and $e^3 = e$, we have
    $$\delta^3 = e + 3\pi\eta + 3e\pi^2\eta^2 + \pi^3\eta^3 \equiv e + 3\pi(\eta-\zeta\eta^3) \pmod{9}.$$
    Since $\Z[\zeta]/(\pi)\cong \F_3$, we have $\zeta\eta^3\equiv \eta^3\equiv\eta\pmod{\pi}$ and so $3\pi^2\mid 3\pi(\eta-\zeta\eta^3)$ but $3\pi^2 = -9\zeta$.
\end{proof}

\begin{lemma}
    If $\epsilon\in\Z[\zeta]^\times$, then $\pm1\pm1\pm\epsilon\not\equiv 0\pmod{9}$. Moreover, if $\pm1 + \epsilon(\pm1)\equiv 0\pmod{3}$, then  $\epsilon = \pm1 = \epsilon^3$.
\end{lemma}

As a result, we see that we can't have $\pi$ not dividing all of $\alpha,\beta,\gamma$, so it divides exactly one of them. If $\pi\mid\alpha$ so that $3\mid \alpha^3$, then we have $\epsilon = \epsilon^3$ so that $(\beta,\epsilon\gamma,\alpha,1)$ is a solution where $\pi$ divides the third argument. %We prove first that we may assume
 Hence, we may assume without loss of generality that $\pi\mid\gamma$. Now from $\pi\mid \alpha^3 + \beta^3$, we have $\pi\mid \alpha + \beta$ since $\alpha^3 + \beta^3 \equiv (\alpha+\beta)^3\pmod{\pi}.$ So we may assume $\alpha\equiv 1\pmod{\pi}$ and $\beta\equiv -1\pmod{\pi}.$ This then gives $\alpha^3 + \beta^3\equiv 0\pmod{9}$ and so we must have $\pi^2\mid\gamma$. In other words, we have $$\alpha\equiv 1\pmod{\pi},\qquad\beta\equiv -1\pmod{\pi},\qquad\pi^2\mid\gamma.$$
 We now factor
$$
    -\epsilon\gamma^3 = (\alpha+\beta)(\alpha^2 - \alpha\beta + \beta^2)= (\alpha + \beta)(\alpha + \beta\zeta)(\alpha - \beta(1+\zeta)).
$$
Note that since $\zeta\equiv 1\pmod{\pi}$, we see that all three factors are divisible by $\pi$. Hence we have
$$(\pi) \supseteq (\alpha+\beta, \alpha+\beta\zeta) \supseteq (\alpha(\zeta-1),\beta(\zeta-1)) = (\zeta-1) = (\pi).$$
The same is true for any two terms in the product. In other words, once we remove one factor of $\pi$ from each of them, we have three pairwise coprime elements that multiply to a cube, up to a unit. Hence they must each be a cube, up to a unit.

\begin{center}
    \add{Lecture 35.5 Fri 11/29}

    \re{Fermat's Last Theorem in degree $3$ and $p$}
\end{center}

In other words, we have the following factorization:
\begin{eqnarray*}
    \alpha + \beta &=& \epsilon_1\pi\delta^3\\
    \alpha + \beta\zeta &=& \epsilon_2\pi\eta^3\\
    \alpha - \beta(1+\zeta) &=& \epsilon_3\pi\rho^3\\
    \gamma &=&\pi\delta\eta\rho
\end{eqnarray*}
where $\delta,\eta,\rho\in\Z[\zeta]$ are pairwise coprime and $\epsilon_1,\epsilon_2,\epsilon_3$ are units. Note since $\pi^2\mid\gamma$, axactly one of $\delta, \eta, \rho$ is divisible by $\pi$.
Multiplying the second equation by $\zeta$ and the third by $\zeta^2$, which are both units, we have
\begin{eqnarray*}
    \alpha + \beta &=& \epsilon_1\pi\delta^3\\
    \alpha\zeta + \beta\zeta^2 &=& \epsilon_4\pi\eta^3\\
    \alpha\zeta^2 + \beta\zeta &=& \epsilon_5\pi\rho^3
\end{eqnarray*}
for some units $\epsilon_4,\epsilon_5$. Adding them gives
$$\epsilon_1\pi\delta^3 + \epsilon_4\pi\eta^3 + \epsilon_5\pi\rho^3 = 0$$
which looks very much like the original equation! Suppose without loss of generality that $\pi\mid\rho$ and $\pi\nmid\delta,\eta$. We divide the above equation by $\epsilon_1\pi$ to get
$$\delta^3 + \epsilon_6\eta^3 + \epsilon_7\rho^3 = 0,$$
for some units $\epsilon_6,\epsilon_7$. From $\pi\mid\rho$, we get $\pm1+\epsilon_6(\pm1)\equiv 0\pmod{3}$ and so $\epsilon_6 = \pm1 = \epsilon_6^3$. Then $(\delta, \epsilon_6\eta, \rho, \epsilon_7)$ is another but smaller solution:
$$N(\delta\cdot\epsilon_6\eta\cdot\rho) = N(\delta\eta\rho)  = N(\gamma/\pi) < N(\gamma) \leq N(\alpha\beta\gamma).$$

The year is 1847. Fermat's Last Theorem had been proved in degrees $3,4, 5,7$. The proofs involve a crude factorization of $x^n + y^n$. For example, when $n = 3$, this factors as $(x + y)(x^2 - xy + y^2)$. It didn't seem plausible to generalize this to higher degrees. Then on March 1st, Lam\'{e} announced a ``proof'' for general prime degrees $p$ by factoring $x^p + y^p$ completely into linear factors, but using complex numbers:
$$x^p + y^p = \prod_{i=0}^{p-1}(x + \zeta_p^i y)$$
from the factorization
$$x^p - 1 = \prod_{i = 0}^{p-1}(x - \zeta_p^i).$$
If this product is a perfect $p$-th power $z^p$, then Lam\'{e} concluded that each of the factors $x + \zeta_p^iy$ must then be a $p$-th power, up to some common factor among the terms. Then some kind of descent argument similar to the known cases can be used to produce a smaller solution, leading eventually to a contradiction. After the presentation, Liouville immediately pointed out the possible lack of unique factorization in the ring $\Z[\zeta_p]$ of \wow{cyclotomic integers} and he found the whole thing very sus. Lam\'{e} agreed but was still optimistic and worked on fixing it. Cauchy also was very enthusiastic and raced to resolve the issue with a series of papers the level of clarity of which is comparable to some of your homework solutions. On May 24, Liouville read a letter from Kummer who had already proved in 1844 that $\Z[\zeta_{23}]$ does not have unique factorization. Lam\'{e} fell silent. Cauchy tried some more before moving on to astronomy. Kummer was able to save the ``proof'' of Fermat's Last Theorem using his new theory of ideals (which he developed in order to prove higher reciprocity laws), but expressed doubts about the case $p = 37$.

The prime $\pi = 1 - \zeta_3$ also played an important role and $3 = \pi^2\cdot(\mathrm{unit})$. In $\Z[\zeta_p]$, we can use $\pi = 1 - \zeta_p$. Note that
$$p = \Phi_p(1) =\prod_{j=1}^{p-1}(1 - \zeta_p^j) = (1 - \zeta_p)^{p-1}\prod_{j=2}^{p-1}\frac{1-\zeta_p^j}{1 - \zeta_p}.$$
\wow{Exercise:} Let $m\geq3$ be an integer. Let $j,k\in\N$ be coprime to $m$. Then $$\frac{1 - \zeta_m^j}{1 - \zeta_m^k}\in\Z[\zeta_m]^\times.$$

As Kummer realized, we no longer have unique factorization in $\Z[\zeta_p]$, but there is unique factorization of ideals into prime ideals! Another seemingly trivial fact that we used multiple times is:
$$\forall\epsilon\in \Z[\zeta]^\times,\quad\epsilon\equiv\pm1\pmod{3}\quad\Longrightarrow \quad\epsilon = \epsilon^3.$$
This turns out to be the major road block!

\begin{theorem}
    (Kummer) Suppose $p$ is a regular prime. Then for any unit $u\in \Z[\zeta_p]^\times$ such that $u$ is congruent to an integer mod $p$, there exists a unit $v\in\Z[\zeta_p]^\times$ such that $u = v^p$.
\end{theorem}

\noindent\textbf{``Sketch'' of the proof:} By replacing $u$ by $u^{p-1}$, we may assume that $u\equiv 1\pmod{p}$. This implies that $u\equiv 1\pmod{\pi^{p-1}}$. One can first show that this automatically implies that $u\equiv 1\pmod{\pi^p}$. This implies that the monic polynomial
$$f(x) = \frac{(\pi x - 1)^p + u}{\pi^p}\in\Z[\zeta_p][x].$$
It has $w = (1 - \sqrt[p]{u})/\pi$ as a root. It then follows from the fact that each $$\frac{1-\zeta_p^j\sqrt[p]{u}}{\pi} - \frac{1-\zeta_p^k\sqrt[p]{u}}{\pi} = \sqrt[p]{u}\,\zeta_p^k\frac{1-\zeta_p^{j-k}}{1 - \zeta_p}$$
is a unit that $K(w)/K$, where $K = \Q(\zeta_p)$, is an ``everywhere unramified abelian extension of degree dividing $p$.'' We say a prime $p$ is a \wow{regular prime} if $\Q(\zeta_p)$ does not have an ``everywhere unramified abelian extension of degree $p$.'' This will force $w\in K$ and one can easily conclude that $\sqrt[p]{u}\in\Z[\zeta_p]^\times$.\hfill$\Box$

\v
It takes a lot of background to define ``everywhere unramified abelian extensions''. When we consider the primes in $\Z[\zeta_3]$, we found that $(3) = (1 - \zeta_3)^2$ but for $p\equiv1\pmod{3}$, we have $(p) = (\alpha)(\bar{\alpha})$ and the two ideals $(\alpha)$ and $(\bar{\alpha})$ are different. We say the prime ideal $(3)$ of $\Z$ \wow{ramifies} in $\Z[\zeta_3]$. In the case of extensions over $K$, we require that no prime ideal of $\Z[\zeta_p]$ ramifies.

By Class Field Theory, the above definition of regular primes is equivalent to $p\nmid h_p$ where $h_p$ is the class number of $\Z[\zeta_p]$. We can define an equivalence relation on the set $S$ of nonzero ideals of $\Z[\zeta_p]$ by defining $I\sim J$ if there exists nonzero $\alpha,\beta\in \Z[\zeta_p]$ such that $I\cdot(\alpha) = J\cdot(\beta)$. In other words, if
$$\{\alpha r\colon r \in I\} = \{\beta t\colon t\in J\}.$$
Then $h_p$ is the number of equivalence classes. Note that principal ideals are all equivalent to $(1)$. Hence $h_p$ is measuring how far $\Z[\zeta_p]$ is from being a PID. We saw that $h_3 = h_4 = 1$. We will see next that $h_{23} > 1$. The only irregular primes less than $100$ are $37, 59, 67$.




For this tutorial and Monday's lecture, we will give Kummer's proof that $\Z[\zeta_{23}]$ doesn't have unique factorization. In what follows, we write $\zeta = \zeta_{23}$.

\begin{theorem}\label{thm:UFD}
    The prime number $47$ has no prime factorization in $\Z[\zeta]$.
\end{theorem}

Recall that $\Z[\zeta]$ consists of elements of form $f(\zeta)$ where $f(x)\in\Z[x]$ and $\zeta$ is a root of $$\Phi_{23}(x) = x^{22} + x^{21} + \cdots + x + 1 = \frac{x^{23} - 1}{x - 1} = \prod_{j=1}^{22}(x - \zeta^j).$$
%Note that by the division algorithm, we can write $f(x) = \Phi_{23}(x)q(x) + r(x)$ for some $q,r\in\Z[x]$ with $\deg(r(x)) < 22$. Since $\Phi_{23}(\zeta) = 0$, we have $f(\zeta) = r(\zeta)$. So it is enough to require $\deg(f) \leq 21$.
Kummer was interested in the factorizations of primes $q\equiv 1\pmod{23}$ in $\Z[\zeta]$. Similar to the proof of Theorems \ref{thm:p14} and \ref{thm:p23}, the cyclotomic polynomial $\Phi_{23}(x)$ splits completely in $\F_q[x]$ for these primes. So there is hope that $q$ splits nicely in $\Z[\zeta]$. We define the \wow{norm}
$$N(f(\zeta)) = \prod_{j=1}^{22}f(\zeta^j).$$
For example, for any integer $a$,
$$N(a - \zeta) = \prod_{j=1}^{22}(a - \zeta^j) = \Phi_{23}(a).$$
More concretely, we have
$$N(2 - \zeta) = \Phi_{23}(2) = 2^{23} - 1 = 47\cdot178481.$$
This gives another motivating reason for why primes $\equiv 1\pmod{23}$ are interesting because they (and 23) are the only possible prime divisors of $\Phi_{23}(a)$.

\begin{lemma}\label{lem:normform}
    For any $f(\zeta)\in\Z[\zeta]$, its norm $N(f(\zeta))$ is a non-negative integer of the form $a^2 - ab + 6b^2$ for some $a,b\in\Z$.
\end{lemma}

\begin{cor}\label{cor:47}
    There does not exist $\alpha\in\Z[\zeta]$ such that $N(\alpha) = 47.$
\end{cor}

\begin{proof}
    Suppose $47 = (a - b/2)^2 + (23/4)b^2$ for some integers $a,b$. Then $|b| = 0,1,2$ in order for $(23/4)b^2 \leq 47$. However, none of $47$, $47 - 23/4 = 165/4$ and $47 - 23 = 24$ are squares of rational numbers.
\end{proof}


\begin{center}
    \add{Lecture 36 Mon 12/02}

    \re{$\Z[\zeta_{23}]$ is not a UFD}
\end{center}
\noindent\textbf{Proof of Lemma \ref{lem:normform}}:
    We let $g(x) = f(x)f(x^2)\cdots f(x^{22})\in\Z[x]$. Then $N(f(\zeta)) = g(\zeta).$ Note that for any $n = 1,\ldots,22$, the elements $\zeta^n, \zeta^{2n},\ldots,\zeta^{22n}$ are just a permuation of $\zeta,\zeta^2,\ldots,\zeta^{22}$. Hence, we have $g(\zeta) = g(\zeta^n)$. So by HW 11 P4(b), we have $g(\zeta)\in\Z$.

    To prove its precise form, we need to use HW 11 P4(c). Recall the notations
    \begin{eqnarray*}
    S &=& \{1,2,3,4,6,8,9,12,13,16,18\} = \langle 2\rangle\subseteq(\Z/23\Z)^\times,\\
    T &=& \{5,7,10,11,14,15,17,19,20,21,22\}.
\end{eqnarray*}
Then $S$ consists of all the nonzero quadratic residues mod $23$ and $T$ consists of all the quadratic non-residues mod $23$. Let
\begin{eqnarray*}
    \theta_1 &=& \sum_{j\in S}\zeta^j \,\,\,\,=\,\,\,\, \zeta + \zeta^2 + \zeta^3 + \zeta^4 + \zeta^6 + \zeta^8 + \zeta^9 + \zeta^{12} + \zeta^{13} + \zeta^{16} + \zeta^{18}\,\,\,\, =\,\,\,\, \frac{-1 + \sqrt{-23}}{2},\\
    \theta_2 &=& \sum_{k\in T}\zeta^k \,\,\,\,=\,\,\,\, \zeta^5 + \zeta^7 + \zeta^{10} + \zeta^{11} + \zeta^{14} + \zeta^{15} + \zeta^{17} + \zeta^{19} + \zeta^{20} + \zeta^{21} + \zeta^{22}\,\,\,\, =\,\,\,\, \frac{-1 - \sqrt{-23}}{2}.
\end{eqnarray*}
We define $$G(x) = \prod_{n\in S}f(x^n) = f(x)f(x^2)f(x^3)f(x^4)f(x^6)f(x^8)\cdots f(x^{18}).$$
Since $-1$ is quadratic non-residue, we see that $n\in S$ if and only if $23 - n \in T$. Moreover since $|\zeta| = 1$, we have
$$\overline{\zeta^n} = \zeta^{-n} = \zeta^{23 - n}.$$
This explains why $\theta_2$ is the complex conjugate of $\theta_1$. Moreover,
$$\overline{G(\zeta)} = \prod_{n\in S}f(\zeta^{23-n}) = \prod_{m\in T}f(\zeta^m).$$
Therefore, we have
$$N(f(\zeta)) = G(\zeta)\overline{G(\zeta)}.$$
Since $S$ is a subgroup of $(\Z/23\Z)^\times$, we see that for any $n\in S$, the set $\{na\colon a\in S\}$ is just a permutation of $S$. Hence $G(\zeta) = G(\zeta^n)$ for any $n\in S$.
By HW 11 P4(c), we have $G(\zeta) = a + b\theta_1$ for some $a,b\in\Z$. Now
$$G(\zeta)\overline{G(\zeta)} = |(a - \frac{b}{2}) + \frac{\sqrt{23}}{2}bi|^2 = a^2 - ab + 6b^2,$$
as desired. \hfill$\Box$




We prove that $47$ does not have a ``prime factorization'' in $\Z[\zeta_{23}]$. We have used the following result multiple times.
$$\beta\mid\alpha\mbox{ in }\Z[\zeta]\quad\Longrightarrow\quad N(\beta)\mid N(\alpha)\mbox{ in }\Z.$$

Recall that we have
$$N(2 - \zeta) = 2^{23} - 1 = 47\cdot178481.$$
The other prime factor is not important. The important factor is $47$, which we know exists because $2$ is a square mod $47$ and so $2^{23} \equiv \lg{2}{47} \equiv 1\pmod{47}$, and that its $\nu_{47} = 1$ which we can fix by taking $(2+47)-\zeta$ if needed (\add{similar to the proof that $(\Z/p^t\Z)^\times$ is cyclic}). Suppose now $\mfp$ is a prime divisor of $47$ in $\Z[\zeta_{23}]$. Then from $$\mfp\mid \prod_{j=1}^{22}(2 - \zeta^j),\qquad\mbox{we have}\qquad\mfp\mid 2 - \zeta^j\mbox{ for some }j.$$
Then we have
$$N(\mfp) \mid N(2 - \zeta^j) = N(2 - \zeta) = 47\cdot178481.$$
On the other hand, since $\mfp\mid 47$, we have
$$N(\mfp)\mid N(47) = 47^{22}.$$
Comparing these, we find that $N(\mfp) = 47$, but we proved in Corollary \ref{cor:47} that no elements of $\Z[\zeta]$ have norm $47$. Therefore, we have proved that $47$ doesn't even have a prime divisor, and so it certainly has no prime factorization!

Kummer went a bit deeper than this. He calculated
$$N(1 - \zeta + \zeta^{21}) = 47\cdot139.$$
Then from the lack of an element with norm $47$, we see that $1 - \zeta + \zeta^{21}$ cannot be factored as a product of two non-units. Elements like this are called \wow{irreducible}. However, $1 - \zeta + \zeta^{21}$ is not \wow{prime} because
$$1 - \zeta + \zeta^{21}\mid 47\cdot139,\qquad\mbox{but}\qquad1 - \zeta + \zeta^{21}\nmid 47\aa1 - \zeta + \zeta^{21}\nmid 139.$$
The two non-divisions follow because the $N(1 - \zeta + \zeta^{21})$ does not divide $47^{22}$ or $139^{22}$.

Kummer resolved this issue of unique factorization using his ``ideal numbers''. It is worth mentioning that Kummer did not define what the ideal numbers are, but only what it means for them to divide a number or another ideal number. The abstract definition of an ideal was given by Dedekind some 30 years later. Since $\Phi_{23}(x)$ splits completely in $\F_{47}[x]$:
$$\Phi_{23}(x) = (x - 2)(x - 3)(x - 4)(x - 6)\cdots(x - 36)(x - 37)(x - 42).$$
There is a very beautiful factorization of the ideal $(47)$:
$$(47) = (47, \zeta - 2)(47, \zeta - 3)(47, \zeta - 4)\cdots(47, \zeta-36)(47, \zeta-37)(47, \zeta - 42)$$
and every factor in the right hand side is a prime ideal of $\Z[\zeta].$ Kummer considered the factorization in the cyclotomic integers $\Z[\zeta_p]$ and Dedekind proved in the more general setting of rings of integers of number fields that every ideal can be factored uniquely into a product of prime ideals. It then follows that the failure of unique factorization can be attributed to some prime ideals being non-principal. Kummer was able to resolve Fermat's Last Theorem in the case of regular primes. There are only three irregular primes less than 100, namely 37, 59, 67:
$$h_{37} = 37, \qquad h_{59} = 3 \cdot 59 \cdot 233, \qquad h_{67} = 67 \cdot 12739.$$
So Kummer was feeling sus about $p = 37$ for a very good reason! It is still open whether there are infinitely many regular primes. It is known that there are infinitely many irregular primes. It is conjectured (by Siegel) that the density of regular primes is $e^{-1/2}$.

We now fast forward to 1954 when Taniyama, and later with the help of Shimura, conjectured that \wow{all elliptic curves are modular}. This roughly predicts that if $a^p + b^p = c^p$ is an integer solution, then the number of $\F_q$-points on the elliptic curve $y^2 = x(x - a^p)(x + b^p)$ (equivalently, the number of solutions in $\F_q$) as the prime $q$ varies should have some very nice patterns. Ribet proved in 1990 that they actually don't. (Frey introduced this curve and Serre made conjectures which Ribet proved.) It then remains to prove the Taniyama-Shimura conjecture for elliptic curves of this form. Wiles announced a proof of the Taniyama-Shimura conjecture for semistable elliptic curves in 1993. A gap was found and fixed soon by Wiles and Taylor in 1995. The full Taniyama-Shimura conjecture was proved in 2001. We now believe that everything is modular!

So did Fermat have a truly ingenius proof? We may never know. What's more impressive is the amount of mathematics that were developed by the countless mathematicians who worked on it over the last 3 centuries!

\end{document}
